import{c as Iv,u as gs,a as Po,j as T,A as Yd,T as Qd,S as jc,I as Cd,F as Ug,M as qg,G as oe,D as Gg,L as gn,b as Cv,d as Ev,B as Mo,e as Av,f as Eo,C as kl,g as Il,h as Cl,i as zl,k as Mu,l as Dc,m as ao,n as Lc,P as Pv,o as Zg,p as Wg,q as Hg,R as Xg,r as Bi,s as Fl,t as Jg,v as Kg,w as so,x as Ed,y as Mv,z as Yg,E as kv,H as zv,J as Dv,K as hm,N as Fv,O as Lv,Q as Bv}from"./mui-VBEwbMcd.js";import{f as Rv,r as Ao,u as Uc,h as ja,i as ep,g as Qg,j as Ov,l as jv,m as Pc,B as Nv,o as $v}from"./react-B2TbqKAK.js";import{c as Vv,a as ey,u as tp,b as rp,d as Uv,P as qv}from"./redux-BJ8gWYy9.js";import{a as Gv}from"./axios-Cm0UX6qg.js";import{r as Zv}from"./rfdc-DdMGI6iU.js";import{L as Wv,M as Hv,T as Xv,a as Jv}from"./reactLeaflet-GBLd9q6V.js";(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const R of document.querySelectorAll('link[rel="modulepreload"]'))M(R);new MutationObserver(R=>{for(const V of R)if(V.type==="childList")for(const A of V.addedNodes)A.tagName==="LINK"&&A.rel==="modulepreload"&&M(A)}).observe(document,{childList:!0,subtree:!0});function I(R){const V={};return R.integrity&&(V.integrity=R.integrity),R.referrerPolicy&&(V.referrerPolicy=R.referrerPolicy),R.crossOrigin==="use-credentials"?V.credentials="include":R.crossOrigin==="anonymous"?V.credentials="omit":V.credentials="same-origin",V}function M(R){if(R.ep)return;R.ep=!0;const V=I(R);fetch(R.href,V)}})();var ty,dm=Rv;ty=dm.createRoot,dm.hydrateRoot;const Nc=Iv({palette:{primary:{main:"#385a8a"},secondary:{main:"#ffffff"},error:{main:"#712024"},warning:{main:"#81692c"},success:{main:"#234720"}},typography:{fontFamily:"BCSans !important"},components:{MuiButton:{styleOverrides:{root:{textTransform:"none",fontFamily:"BCSans"}}},MuiChip:{styleOverrides:{root:{textTransform:"none",fontFamily:"BCSans"}}},MuiLink:{styleOverrides:{root:{textTransform:"none",fontFamily:"BCSans"}}},MuiCardActions:{styleOverrides:{root:{padding:"1em"}}}}});Nc.typography.h1={fontFamily:"BCSans-Bold",fontSize:"2rem",[Nc.breakpoints.up("sm")]:{fontSize:"2.7rem"},lineHeight:"1.5"};Nc.typography.h2={fontFamily:"BCSans",fontSize:"2rem",fontWeight:400,lineHeight:"1.5"};Nc.typography.h6={fontFamily:"BCSans",fontWeight:400,fontSize:"1.25rem"};const Kv="/assets/gov-bc-logo-horiz-DJ4_Y1aJ.png",Yv={appBar:{color:"#ffffff",backgroundColor:"#053662",borderBottom:"0.1em solid rgb(252, 186, 25) !important"}};function pm(){const g=gs(),f=Po(g.breakpoints.up("md"));return T.jsx(Yd,{position:"fixed",sx:Yv.appBar,children:T.jsxs(Qd,{sx:{flexDirection:"row",alignItems:"center",alignContent:"center",justifyContent:"space-between"},id:"back-to-top-anchor",children:[T.jsxs(jc,{direction:"row",id:"logo_name",children:[T.jsx("a",{href:"/",children:T.jsx("img",{alt:"Logo",src:Kv})}),T.jsxs("div",{children:[" ",T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1.5em",lineHeight:"2.25em",marginLeft:"1em",alignItems:"center"},children:"Organics Info"})]})]}),T.jsxs(jc,{direction:"row",id:"nav",children:[f&&T.jsx("div",{children:T.jsxs("a",{href:"/search",target:"_self",style:{textDecoration:"none"},children:[T.jsx(Cd,{children:T.jsx(Ug,{color:"secondary"})}),T.jsxs("span",{style:{color:"#ffffff",textDecoration:"none",textTransform:"none"},children:[" ","Text Search"]})]})}),!f&&T.jsx("div",{children:T.jsx("a",{href:"/search",target:"_self",children:T.jsx(Cd,{children:T.jsx(qg,{color:"secondary"})})})})]})]})})}const El={appBar:{flexShrink:0,top:"auto",bottom:0,color:"#ffffff",backgroundColor:"#053662",display:"flex"},footerButton:{margin:"0.2em",padding:"0.2em",color:"#ffffff"}};function od(){const g=gs();Po(g.breakpoints.up("md"));function f(){const I=Cv({threshold:100}),M=Ao.useCallback(()=>{window.scrollTo({top:0,behavior:"smooth"})},[]);return T.jsx(Ev,{in:I,children:T.jsx(Mo,{sx:{position:"fixed",bottom:{xs:"1.8em",sm:"0.8em"},right:{xs:"2em",sm:"3.3em"},width:"4.25em",height:"4em",minWidth:"4.25em",background:" #F8BA47",borderRadius:".5em",zIndex:9},onClick:()=>{M()},children:T.jsx(Av,{})})})}return T.jsx(Yd,{position:"relative",sx:El.appBar,color:"default",children:T.jsx(Qd,{sx:{padding:{xs:"1.5em 1em",md:"1.5em"},margin:{xs:"0",md:"0 auto"}},children:T.jsxs(oe,{container:!0,direction:{xs:"column",lg:"row"},justifyContent:"center",children:[T.jsx(oe,{item:!0,xs:10,children:T.jsxs(jc,{direction:"row",alignItems:"center",justifyContent:"center",sx:{flexWrap:{xs:"wrap",md:"nowrap"}},divider:T.jsx(Gg,{sx:{height:"1em",color:"#ffffff",borderColor:"#ffffff",alignContent:"center",alignItems:"center",alignSelf:"center",justifyItems:"center",justifyContent:"center"},orientation:"vertical",flexItem:!0}),spacing:2,children:[T.jsx(gn,{"data-testid":"footer-home",sx:El.footerButton,id:"footer-home",target:"_blank",href:"https://www.gov.bc.ca/",children:"Home"}),T.jsx(gn,{"data-testid":"footer-copyright",sx:El.footerButton,color:"primary",id:"footer-copyright",target:"_blank",href:"https://gov.bc.ca/copyright",children:"Copyright"}),T.jsx(gn,{"data-testid":"footer-disclaimer",sx:El.footerButton,id:"footer-disclaimer",target:"_blank",href:"https://gov.bc.ca/disclaimer",children:"Disclaimer"}),T.jsx(gn,{"data-testid":"footer-privacy",sx:El.footerButton,id:"footer-privacy",target:"_blank",href:"https://gov.bc.ca/privacy",children:"Privacy"}),T.jsx(gn,{"data-testid":"footer-accessibility",sx:El.footerButton,color:"primary",id:"footer-accessibility",target:"_blank",href:"https://gov.bc.ca/webaccessibility",children:"Accessibility"})]})}),T.jsx(oe,{item:!0,xs:1,justifyContent:"end",children:T.jsx(oe,{container:!0,spacing:1,justifyContent:"right",children:f()})})]})})})}const Qv="/assets/homepage-banner-unsplash-2eI1eSyM.jpg",fm="/assets/BC-DsHF__Hf.svg",e0="/assets/font-awesome-identity-oHd-6B1b.svg",t0="/assets/font-awesome-government-DB5TY_Dl.svg",r0="/assets/font-awesome-verification-BMJhW5-3.svg";function mm(){return T.jsx(T.Fragment,{children:T.jsxs(oe,{container:!0,direction:{xs:"column",lg:"row"},sx:{zIndex:1},children:[T.jsx(oe,{item:!0,xs:12,children:T.jsx(Eo,{"data-testid":"dashboard_heading",variant:"h2",component:"h2",sx:{fontFamily:"BCSans",fontWeight:400,color:"#000000",marginBottom:"1em"},children:"Organic Recycling in B.C."})}),T.jsx(oe,{item:!0,xs:12,children:T.jsxs("div",{"data-testid":"recycling_regulation",children:[T.jsx("a",{href:"https://www2.gov.bc.ca/gov/content/environment/waste-management/food-and-organic-waste/regulations-guidelines",target:"_blank",rel:"noopener noreferrer",style:{color:"#000000",textDecoration:"underline"},children:"British Columbia's Organic Matter Recycling Regulation (OMRR):"}),T.jsxs("ul",{style:{marginBottom:"2em"},children:[T.jsx("li",{children:"Governs the construction and operation of compost facilities"})," ",T.jsx("li",{children:"Regulates the production, distribution, storage, sale and use of biosolids and compost"})," ",T.jsx("li",{children:"Controls how compost facilities are built and operated"})," "]}),"The B.C. government has a plan to update the regulation to:",T.jsxs("ul",{style:{marginBottom:"2em"},children:[T.jsx("li",{children:"Better protect of human and environment health"}),T.jsx("li",{children:"Increase engagement with Indigenous communities"}),T.jsx("li",{children:" Improve transparency around organic matter management"})]})," ","Learn about the planned changes in the"," ",T.jsx(gn,{sx:{color:"#000000"},href:"https://www2.gov.bc.ca/assets/gov/environment/waste-management/organic-waste/reports-and-papers/omrr-public-update-june-2022.pdf",target:"_blank",children:T.jsx("span",{style:{textDecoration:"underline"},children:"project update report"})})]})})]})})}function gm(){const g=gs(),f=Po(g.breakpoints.up("md")),I=Uc(),M=A=>{I(A)},R=T.jsxs(kl,{sx:{position:"relative",borderRadius:"0px",width:"100%"},children:[T.jsx(Mu,{component:"div",sx:{position:"absolute",width:"100%",height:"100%",backgroundImage:`url(${Qv})`,backgroundSize:"cover",backgroundPosition:"center"}}),T.jsxs(Lc,{children:[T.jsxs(zl,{children:[T.jsx(Eo,{gutterBottom:!0,variant:"h1",component:"h1","data-testid":"dashboard_heading",sx:{margin:{xs:"2em .333em 0",sm:"2.25em .7em 0",md:"5em .7em 0"},color:"#FFFFFF",backgroundColor:"none",position:"relative",textAlign:"left"},children:"Compost and Biosolids"}),T.jsx(Eo,{"data-testid":"dashboard_subheading",variant:"h6",component:"h6",sx:{margin:{xs:"1em .6em 0",sm:"1em 1.6em 0"},color:"#FFFFFF",backgroundColor:"none",position:"relative",textAlign:"left"},children:"Find an authorized compost and biosolid facility in British Columbia"})]}),T.jsxs(Dc,{children:[T.jsx(Mo,{"data-testid":"list_all_authorizations",size:"large",sx:{margin:{sm:"0 2.2em 3em",xs:"0 .9em 3em"},boxSizing:"border-box",border:"1px solid #FFFFFF",borderRadius:"4px",color:"#FFFFFF",textTransform:"none"},onClick:()=>{M("/search")},children:"List all authorizations"}),T.jsx(Mo,{"data-testid":"list_all_authorizations",size:"large",sx:{margin:{sm:"0 2.2em 3em",xs:"0 .9em 3em"},boxSizing:"border-box",border:"1px solid #FFFFFF",borderRadius:"4px",color:"#FFFFFF",textTransform:"none"},onClick:()=>{M("/map")},children:"See all authorizations in map"})]})]})]}),V=T.jsxs(oe,{container:!0,direction:{xs:"column",lg:"row"},sx:{margin:"0",padding:{xs:"2.5em 1.8em 5em",sm:"5em 3em"},borderRadius:"0px",backgroundColor:"#FCC85D",backgroundImage:{xs:"none",md:`url(${fm})`},backgroundPosition:"right 4em top 50%",backgroundSize:"25em",backgroundRepeat:"no-repeat"},children:[f&&T.jsx(T.Fragment,{children:mm()}),!f&&T.jsxs(T.Fragment,{children:[T.jsx(oe,{item:!0,xs:12,sx:{display:"flex",justifyContent:"center"},children:T.jsx(ao,{component:"img",sx:{content:`url(${fm})`,width:"100%",maxWidth:300,marginBottom:"1.5em"}})}),T.jsx(oe,{item:!0,xs:12,children:mm()})]})]});return T.jsxs(oe,{item:!0,sx:{marginTop:"3em"},children:[R,V,T.jsxs(oe,{container:!0,spacing:3,sx:{margin:0,padding:"1em",maxWidth:"100%"},children:[T.jsx(oe,{item:!0,xs:12,sx:{padding:"0 !important",margin:{xs:"1.5em 0.7em 2.5em",sm:"1.5em 1.9em 2.5em",md:"4em 1.9em 3em"}},children:T.jsx(Eo,{variant:"h2",component:"h2",sx:{color:"#000000",marginTop:{xs:".5em",md:"0"}},children:"Learn more"})}),T.jsx(oe,{item:!0,xs:12,sx:{padding:"0 !important",margin:{xs:"0 0.7em",sm:"0 1.9em"}},children:T.jsxs(oe,{container:!0,spacing:3,direction:{xs:"column",md:"row"},sx:{marginBottom:{xs:"4em",md:"9em"}},children:[T.jsx(oe,{item:!0,xs:12,md:4,children:T.jsxs(kl,{elevation:0,children:[T.jsx(Il,{sx:{margin:"0em 0em 0em -1em",display:{xs:"none",md:"flex"}},title:T.jsxs(gn,{sx:{fontFamily:"BCSans-Bold",textDecoration:"none",fontSize:{md:"1rem",lg:"1.25rem"},display:"flex",alignItems:"center",paddingBottom:".4em"},target:"_blank",href:"https://www2.gov.bc.ca/gov/content/environment/waste-management/food-and-organic-waste/regulations-guidelines",children:[" ","Legislation",T.jsx(Cl,{color:"primary",sx:{position:"relative",top:2}})]})}),T.jsx(zl,{sx:{background:"#D8EAFD",height:"15em",display:"flex",justifyContent:"center",alignItems:"center"},children:T.jsx(Mu,{component:"div",sx:{position:"absolute",width:"3em",height:"3em",backgroundImage:`url(${t0})`,backgroundSize:"contain",backgroundPosition:"center"}})}),T.jsx(Il,{sx:{margin:"0",padding:"1.5em 0 .5em",display:{xs:"flex",md:"none"}},title:T.jsxs(gn,{sx:{fontFamily:"BCSans-Bold",textDecoration:"none",fontSize:"1.25rem",display:"flex",alignItems:"center"},target:"_blank",href:"https://www2.gov.bc.ca/gov/content/environment/waste-management/food-and-organic-waste/regulations-guidelines",children:[" ","Legislation",T.jsx(Cl,{color:"primary",sx:{position:"relative",top:2}})]})}),T.jsx(Dc,{sx:{margin:"0",padding:{xs:".5em 0 1.5em",md:"1.5em 0 0"}},children:T.jsx("span",{children:"Learn about the laws that apply to recycling organic matter."})}),T.jsx(ao,{component:"hr",sx:{display:{xs:"block",md:"none"},margin:".5em 0 1.5em",borderColor:"#D8D8D8"}})]})}),T.jsx(oe,{item:!0,xs:12,md:4,children:T.jsxs(kl,{elevation:0,children:[T.jsx(Il,{sx:{margin:"0em 0em 0em -1em",display:{xs:"none",md:"flex"}},title:T.jsxs(gn,{sx:{fontFamily:"BCSans-Bold",textDecoration:"none",fontSize:{md:"1rem",lg:"1.25rem"},display:"flex",alignItems:"center",paddingBottom:".4em"},target:"_blank",href:"https://www2.gov.bc.ca/gov/content/environment/waste-management/waste-discharge-authorization",children:["Process and procedures",T.jsx(Cl,{color:"primary",sx:{position:"relative",top:2}})]})}),T.jsx(zl,{sx:{background:"#D8EAFD",height:"15em",display:"flex",justifyContent:"center",alignItems:"center"},children:T.jsx(Mu,{component:"div",sx:{position:"absolute",width:"3em",height:"3em",backgroundImage:`url(${r0})`,backgroundSize:"contain",backgroundPosition:"center"}})}),T.jsx(Il,{sx:{margin:"0",padding:"1.5em 0 .5em",display:{xs:"flex",md:"none"}},title:T.jsxs(gn,{sx:{fontFamily:"BCSans-Bold",textDecoration:"none",fontSize:"1.25rem",display:"flex",alignItems:"center"},target:"_blank",href:"https://www2.gov.bc.ca/gov/content/environment/waste-management/waste-discharge-authorization",children:["Process and procedures",T.jsx(Cl,{color:"primary",sx:{position:"relative",top:2}})]})}),T.jsx(Dc,{sx:{margin:"0",padding:{xs:".5em 0 1.5em",md:"1.5em 0 0"}},children:T.jsx("span",{children:"Learn about how we administer the authorizations process for compost and biosolids facilities."})}),T.jsx(ao,{component:"hr",sx:{display:{xs:"block",md:"none"},margin:".5em 0 1.5em",borderColor:"#D8D8D8"}})]})}),T.jsx(oe,{item:!0,xs:12,md:4,children:T.jsxs(kl,{elevation:0,children:[T.jsx(Il,{sx:{margin:"0em 0em 0em -1em",display:{xs:"none",md:"flex"}},title:T.jsxs(gn,{sx:{fontFamily:"BCSans-Bold",textDecoration:"none",fontSize:{md:"1rem",lg:"1.25rem"},display:"flex",alignItems:"center",paddingBottom:".4em"},target:"_blank",href:"https://www2.gov.bc.ca/gov/content/environment/natural-resource-stewardship/natural-resource-law-enforcement/environmental-compliance",children:["Compliance and enforcement",T.jsx(Cl,{color:"primary",sx:{position:"relative",top:2}})]})}),T.jsx(zl,{sx:{background:"#D8EAFD",height:"15em",display:"flex",justifyContent:"center",alignItems:"center"},children:T.jsx(Mu,{component:"div",sx:{position:"absolute",width:"3em",height:"3em",backgroundImage:`url(${e0})`,backgroundSize:"contain",backgroundPosition:"center"}})}),T.jsx(Il,{sx:{margin:"0",padding:"1.5em 0 .5em",display:{xs:"flex",md:"none"}},title:T.jsxs(gn,{sx:{fontFamily:"BCSans-Bold",textDecoration:"none",fontSize:"1.25rem",display:"flex",alignItems:"center"},target:"_blank",href:"https://www2.gov.bc.ca/gov/content/environment/research-monitoring-reporting/reporting/environmental-enforcement-reporting",children:["Compliance and enforcement",T.jsx(Cl,{color:"primary",sx:{position:"relative",top:2}})]})}),T.jsx(Dc,{sx:{margin:"0",padding:{xs:".5em 0 1.5em",md:"1.5em 0 0"}},children:T.jsx("span",{children:"Learn about how we coordinate oversight and ensure the process is accountable."})})]})})]})})]})]})}class i0{client;constructor(){this.client=Gv.create({baseURL:"/api",headers:{"Content-Type":"application/json"}}),this.client.interceptors.response.use(f=>(console.info(`received response status: ${f.status}`),f),f=>{console.error(f)})}getAxiosInstance(){return this.client}}const n0=new i0,ku=Zv({circles:!0}),Ou=Vv("data/fetchOMRRRecords",async()=>(await n0.getAxiosInstance().get("https://nr-epd-organics-info-test-frontend.apps.silver.devops.gov.bc.ca/api/omrr")).data),o0={value:[],filteredValue:[],status:"idle",error:null,searchBy:"active",expand:!1,location:null,notificationFilter:!1,permitFilter:!1,approvalFilter:!1,operationalCertificateFilter:!1,compostFacilityFilter:!1,landApplicationBioSolidsFilter:!1,page:1,searchByFilteredValue:[],globalTextSearchFilter:"",compostFacilityFilterDisabled:!0,landApplicationBioSolidsFilterDisabled:!0,lastModified:""};function Us(g){let f=[],I=[];if(g.globalTextSearchFilter&&g.globalTextSearchFilter?.length>0&&(g.filteredValue=g.searchByFilteredValue.filter(M=>Object.values(M).some(R=>R?.toString()?.toLowerCase().includes(g.globalTextSearchFilter.toLowerCase())))),g.approvalFilter){const M=g.filteredValue.filter(R=>R["Authorization Type"]?.toLowerCase()==="approval");f=[...f,...M]}if(g.notificationFilter){const M=g.filteredValue.filter(R=>R["Authorization Type"]?.toLowerCase()==="notification".toLowerCase());f=[...f,...M]}if(g.permitFilter){const M=g.filteredValue.filter(R=>R["Authorization Type"]?.toLowerCase()==="permit");f=[...f,...M]}if(g.operationalCertificateFilter){const M=g.filteredValue.filter(R=>R["Authorization Type"]?.toLowerCase()==="operational certificate");f=[...f,...M]}if(f.length>0&&(g.filteredValue=f),g.compostFacilityFilter){const M=g.filteredValue.filter(R=>R["Operation Type"]?.toLowerCase()==="compost production facility");I=[...I,...M]}if(g.landApplicationBioSolidsFilter){const M=g.filteredValue.filter(R=>R["Operation Type"]?.toLowerCase().includes("land application"));I=[...I,...M]}I.length>0&&(g.filteredValue=I),(g.approvalFilter||g.notificationFilter||g.permitFilter||g.operationalCertificateFilter||g.landApplicationBioSolidsFilter||g.compostFacilityFilter)&&(f.length===0||g.landApplicationBioSolidsFilter&&I.length===0||g.compostFacilityFilter&&I.length===0)&&(g.filteredValue=[]),g.page=1}const ip=ey({name:"omrr",initialState:o0,reducers:{setOmrrData:(g,f)=>{g.value=f.payload},setFilteredValue:(g,f)=>{g.filteredValue=f.payload},setExpand:(g,f)=>{g.expand=f.payload},setLocation:(g,f)=>{g.location=f.payload},setSearchBy:(g,f)=>{switch(g.searchBy=f.payload,g.page=1,f.payload){case"all":g.searchByFilteredValue=g.value,g.filteredValue=g.searchByFilteredValue,Us(g);break;case"inactive":g.searchByFilteredValue=g.value.filter(I=>I["Authorization Status"]==="Inactive"),g.filteredValue=g.searchByFilteredValue,Us(g);break;case"active":g.searchByFilteredValue=g.value.filter(I=>I["Authorization Status"]==="Active"),g.filteredValue=g.searchByFilteredValue,Us(g);break;default:g.searchByFilteredValue=ku(g.value),g.filteredValue=ku(g.searchByFilteredValue),Us(g);break}},setFilters:(g,f)=>{g.filteredValue=g.searchByFilteredValue,f.payload==="notification"&&(g.notificationFilter=!g.notificationFilter,g.notificationFilter?(g.compostFacilityFilterDisabled=!1,g.landApplicationBioSolidsFilterDisabled=!1):(g.compostFacilityFilterDisabled=!0,g.landApplicationBioSolidsFilterDisabled=!0,g.landApplicationBioSolidsFilter=!1,g.compostFacilityFilter=!1)),f.payload==="permit"&&(g.permitFilter=!g.permitFilter),f.payload==="approval"&&(g.approvalFilter=!g.approvalFilter),f.payload==="operationalCertificate"&&(g.operationalCertificateFilter=!g.operationalCertificateFilter),f.payload==="compostFacility"&&(g.compostFacilityFilter=!g.compostFacilityFilter),f.payload==="landApplicationBioSolids"&&(g.landApplicationBioSolidsFilter=!g.landApplicationBioSolidsFilter),Us(g)},resetFilters:g=>{g.notificationFilter=!1,g.permitFilter=!1,g.approvalFilter=!1,g.operationalCertificateFilter=!1,g.compostFacilityFilter=!1,g.landApplicationBioSolidsFilter=!1,Us(g)},setPage:(g,f)=>{g.page=f.payload},searchAuthorizationsByGlobalFilter:(g,f)=>{g.globalTextSearchFilter=f.payload,g.page=1,g.filteredValue=g.searchByFilteredValue,Us(g)}},extraReducers:g=>{g.addCase(Ou.pending,(f,I)=>{f.status="loading"}),g.addCase(Ou.fulfilled,(f,I)=>{if(I.payload===null||I.payload===void 0||I.payload.omrrData===null||I.payload.omrrData===void 0){f.status="failed",f.error="No data found";return}f.status="succeeded";const M=new Date(I.payload.lastModified),R=M.toLocaleString("default",{month:"short"});f.lastModified=R+" "+M.getDate()+", "+M.getFullYear();let V=[];for(const A of I.payload.omrrData){const u={...A};if(u["Effective/Issue Date"]){const le=u["Effective/Issue Date"].substring(0,10);u["Effective/Issue Date"]=le}else u["Effective/Issue Date"]=void 0;if(A["Last Amendment Date"]){const le=u["Last Amendment Date"].substring(0,10);u["Last Amendment Date"]=le}else u["Last Amendment Date"]=void 0;for(const le in u)u[le]==="Y"||u[le]==="Yes"?u[le]=!0:(u[le]==="N"||u[le]==="No")&&(u[le]=!1);V.push(u)}f.value=V,f.searchByFilteredValue=ku(f.value),f.searchByFilteredValue=f.searchByFilteredValue.filter(A=>A["Authorization Status"]==="Active"),f.filteredValue=ku(f.searchByFilteredValue)}),g.addCase(Ou.rejected,(f,I)=>{f.status="failed",f.error=I.error.message})}}),{setOmrrData:AT,setFilteredValue:ym,setFilters:lo,setExpand:ry,setLocation:PT,setSearchBy:qs,resetFilters:iy,setPage:a0,searchAuthorizationsByGlobalFilter:ny}=ip.actions;ip.reducer;function s0(){Ao.useEffect(()=>{window.scrollTo(0,0)},[]);const g=gs(),f=Po(g.breakpoints.up("md")),I=Uc(),M=(tt,Ot)=>{I(tt,{state:{data:Ot}})},R=tp(),{filteredValue:V,expand:A,notificationFilter:u,permitFilter:le,approvalFilter:Ae,compostFacilityFilter:Ne,landApplicationBioSolidsFilter:ve,operationalCertificateFilter:se,location:Ge,searchBy:yt,page:Fe,globalTextSearchFilter:ot,compostFacilityFilterDisabled:zt,landApplicationBioSolidsFilterDisabled:tr,lastModified:bt}=rp(tt=>tt.omrr),Pt=T.jsx(oe,{item:!0,xs:12,children:T.jsxs(oe,{container:!0,spacing:0,direction:{xs:"column",sm:"row"},sx:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"}},children:[T.jsx(Pv,{sx:{margin:{xs:"0 0 1em",sm:"0"},"& .MuiPaginationItem-root.Mui-selected":{backgroundColor:"#053662",color:"#ffffff",":hover":{}},"& .MuiPaginationItem-root":{color:"#053662",backgroundColor:"#ffffff"}},variant:"outlined",shape:"rounded",count:Math.ceil(V.length/10),siblingCount:f?1:0,page:Fe,onChange:(tt,Ot)=>R(a0(Ot))}),T.jsxs(Eo,{sx:{display:"block"},children:["Showing ",(Fe-1)*10+1,"-",Math.min(Fe*10,V.length)," of ",V.length," ","results"]})]})}),Nt=T.jsxs(zl,{sx:{padding:"0"},children:[T.jsx(Eo,{"data-testid":"auth-list-headin1",variant:"h1",sx:{margin:"0 0 .75em"},component:"h1",children:"Authorizations"}),T.jsx(Eo,{"data-testid":"auth-list-heading2",variant:"h6",children:"Authorized compost and biosolid facilities in B.C."})]});return T.jsxs(oe,{container:!0,spacing:2,sx:{marginTop:"4vh"},children:[T.jsx(oe,{item:!0,xs:12,children:T.jsx(kl,{elevation:0,variant:"outlined",sx:{padding:{xs:"7em 1.5em 5em",sm:"5em 2.1em 2.5em",md:"10em 2.25em 5em"},backgroundColor:"#FCC85D",border:"0"},children:Nt})}),T.jsx(oe,{item:!0,xs:12,children:T.jsxs(oe,{container:!0,spacing:2,direction:{xs:"column",md:"row"},sx:{margin:"0",padding:{xs:"1.5em 1.5em 5em",sm:"1.5em 2.1em 5em",md:"4em 2.25em 10em"},width:"100%","& > .MuiGrid-item":{padding:"0",width:"100%"}},children:[T.jsx(oe,{item:!0,xs:12,children:T.jsx(Zg,{sx:{minWidth:"100%",color:"#9F9D9C",marginBottom:"1.5em"},label:"Search Authorizations","data-testid":"auth-list-search-authorizations-textfield",value:ot,onChange:tt=>R(ny(tt.target.value)),variant:"outlined",InputProps:{startAdornment:T.jsx(Wg,{position:"start",children:T.jsx(Hg,{})})}})}),T.jsx(oe,{item:!0,xs:12,children:T.jsxs(oe,{container:!0,sx:{maxWidth:"100%"},justifyContent:"space-between",spacing:0,direction:{xs:"column",sm:"row"},children:[T.jsxs(Lc,{sx:{display:"flex",alignItems:"left",flexDirection:"row",justifyContent:"left"},direction:{xs:"column",md:"row"},children:[T.jsx(ao,{display:"flex",alignItems:"center",sx:{marginRight:"2em"},children:T.jsx("span",{children:"Search by: "})}),T.jsx(ao,{display:"flex",alignItems:"left",children:T.jsxs(Xg,{row:!0,name:"searchBy",defaultValue:"active",value:yt,children:[T.jsx(Bi,{value:"all",control:T.jsx(Fl,{}),label:"All",onClick:()=>R(qs("all"))}),T.jsx(Bi,{value:"active",control:T.jsx(Fl,{}),label:"Active",onClick:()=>R(qs("active"))}),T.jsx(Bi,{value:"inactive",control:T.jsx(Fl,{}),label:"Inactive",onClick:()=>R(qs("inactive"))})]})})]}),T.jsxs(Mo,{sx:{marginTop:{xs:"1.5em",sm:"0"},padding:"0.6em 1.125em",background:"#053662",color:"#ffffff",borderRadius:"4px",textTransform:"none",order:1,display:"flex",justifyContent:"space-between",height:"100%",alignSelf:{sm:"center"},"&:hover":{background:"#053662",color:"#ffffff",boxShadow:"none"}},onClick:()=>R(ry(!A)),children:["Filter by Facility Type"," ",A?T.jsx(Jg,{}):T.jsx(Kg,{})]})]})}),A&&T.jsxs(oe,{item:!0,xs:12,children:[T.jsx(oe,{item:!0,xs:12,children:T.jsxs(oe,{container:!0,spacing:2,direction:{xs:"column",sm:"row"},sx:{marginTop:{xs:"1.5em"}},children:[T.jsx(oe,{item:!0,xs:12,sm:4,md:3,children:T.jsx(Bi,{checked:u,control:T.jsx(so,{}),label:"Notification",onClick:()=>R(lo("notification"))})}),T.jsx(oe,{item:!0,xs:12,sm:4,md:3,children:T.jsx(Bi,{control:T.jsx(so,{}),checked:le,label:"Permit",onClick:()=>R(lo("permit"))})}),T.jsx(oe,{item:!0,xs:12,sm:4,md:3,children:T.jsx(Bi,{checked:Ae,control:T.jsx(so,{}),label:"Approval",onClick:()=>R(lo("approval"))})}),T.jsx(oe,{item:!0,xs:12,sm:4,md:3,children:T.jsx(Bi,{checked:se,control:T.jsx(so,{}),label:"Operational Certificate",onClick:()=>R(lo("operationalCertificate"))})}),T.jsx(oe,{item:!0,xs:12,sm:4,md:3,children:T.jsx(Bi,{checked:Ne,control:T.jsx(so,{}),disabled:zt,label:"Compost Production Facility",onClick:()=>R(lo("compostFacility"))})}),T.jsx(oe,{item:!0,xs:12,sm:4,md:3,children:T.jsx(Bi,{checked:ve,control:T.jsx(so,{}),disabled:tr,label:"Land Application of Biosolids",onClick:()=>R(lo("landApplicationBioSolids"))})})]})}),T.jsx(oe,{item:!0,xs:12,children:T.jsx(oe,{container:!0,spacing:3,direction:"row",sx:{marginTop:"0.1em"},children:T.jsx(oe,{item:!0,xs:12,children:T.jsx(Mo,{sx:{border:"1px solid #353433",borderRadius:"4px",textTransform:"none"},variant:"contained",color:"secondary",onClick:()=>R(iy()),children:"Reset Filters"})})})})]}),T.jsx(oe,{item:!0,xs:12,children:T.jsx(Gg,{sx:{margin:"2em 0em",width:"100%",maxWidth:"100%"}})}),T.jsx(oe,{item:!0,xs:12,children:T.jsxs(Eo,{sx:{margin:"2em 0em",width:"100%",maxWidth:"100%",fontStyle:"italic"},children:["Data Last Updated : ",bt]})}),Pt,T.jsx(oe,{item:!0,xs:12,sx:{margin:{xs:"1.5em 0",md:"2.5em 0"}},children:T.jsx(oe,{container:!0,spacing:3,children:V&&V.length>0&&V.slice((Fe-1)*10,Fe*10).map((tt,Ot)=>T.jsx(oe,{item:!0,xs:12,sx:{width:"100%"},children:T.jsx(kl,{elevation:0,sx:{background:"#F1F8FE",order:5,width:"100%",border:"1px solid #D8D8D8"},children:T.jsxs(zl,{sx:{padding:{xs:"1.5em 1.5em 2.5em !important",md:"1.5em 2.5em 2.5em !important"}},children:[T.jsx(Eo,{variant:"body2",color:"text.secondary",sx:{marginBottom:"0.6em"},children:T.jsxs("span",{style:{fontFamily:"BCSans",fontStyle:"normal"},children:[" ","Authorization #:",T.jsx("span",{style:{textDecoration:"underline",marginLeft:"0.5em"},children:tt["Authorization Number"]})]})}),T.jsx(Eo,{variant:"h5",component:"h5",sx:{marginBottom:{xs:"1em",md:".7em"}},children:T.jsx("span",{style:{fontFamily:"BCSans-Bold"},children:tt["Regulated Party"]})}),T.jsxs(oe,{container:!0,direction:"row",children:[T.jsxs(oe,{item:!0,xs:12,md:6,sx:{marginBottom:{xs:"1.5em",md:"0"}},children:[T.jsx(ao,{sx:{marginBottom:".5em"},children:T.jsx("span",{style:{fontFamily:"BCSans-Bold"},children:"Location of Facility"})}),T.jsx(ao,{children:T.jsx("span",{style:{fontFamily:"BCSans",fontStyle:"normal"},children:tt["Facility Location"]})})]}),T.jsxs(oe,{item:!0,xs:12,md:6,children:[T.jsx(ao,{sx:{marginBottom:".5em"},children:T.jsx("span",{style:{fontFamily:"BCSans-Bold"},children:"Authorization Type"})}),T.jsx(ao,{children:T.jsxs("span",{style:{fontFamily:"BCSans",fontStyle:"normal"},children:[tt["Authorization Type"],tt["Operation Type"]?`, ${tt["Operation Type"]}`:""]})})]})]}),T.jsxs(Lc,{sx:{justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},display:"flex",marginTop:"1em"},direction:{xs:"column",sm:"row"},children:[T.jsxs(Lc,{direction:"row",sx:{alignItems:"center",display:"flex",marginTop:"1em"},spacing:1,children:[T.jsx("span",{children:"Status: "}),T.jsx(Ed,{sx:{background:tt["Authorization Status"]==="Active"?"#42814A":"#605E5C",color:"#ffffff"},label:tt["Authorization Status"]})]}),T.jsx(Dc,{sx:{padding:"1em 0 0",width:{xs:"100%",sm:"auto"}},children:T.jsx(Mo,{"data-testid":`auth-list-view-facility-details-button-${tt["Authorization Number"]}`,size:"large",sx:{border:"1px solid #053662;",borderRadius:"4px",boxSizing:"border-box",textTransform:"none",color:"#255A90;",width:{xs:"100%",sm:"auto"}},onClick:()=>M(`/authorization/${tt["Authorization Number"]}`,{...tt}),children:"View Facility Details"})})]})]})},Ot)},Ot))})}),Pt]})})]})}var oy={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.3.2/LICENSE.txt
 */(function(g,f){(function(I,M){g.exports=M()})(ja,function(){var I={},M={};function R(A,u,le){if(M[A]=le,A==="index"){var Ae="var sharedModule = {}; ("+M.shared+")(sharedModule); ("+M.worker+")(sharedModule);",Ne={};return M.shared(Ne),M.index(I,Ne),typeof window<"u"&&I.setWorkerUrl(window.URL.createObjectURL(new Blob([Ae],{type:"text/javascript"}))),I}}R("shared",["exports"],function(A){function u(r,e,i,o){return new(i||(i=Promise))(function(s,h){function p(w){try{x(o.next(w))}catch(E){h(E)}}function m(w){try{x(o.throw(w))}catch(E){h(E)}}function x(w){var E;w.done?s(w.value):(E=w.value,E instanceof i?E:new i(function(P){P(E)})).then(p,m)}x((o=o.apply(r,e||[])).next())})}function le(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var Ae=Ne;function Ne(r,e){this.x=r,this.y=e}Ne.prototype={clone:function(){return new Ne(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,i=r.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),i=Math.sin(r),o=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=o,this},_rotateAround:function(r,e){var i=Math.cos(r),o=Math.sin(r),s=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ne.convert=function(r){return r instanceof Ne?r:Array.isArray(r)?new Ne(r[0],r[1]):r};var ve=le(Ae),se=Ge;function Ge(r,e,i,o){this.cx=3*r,this.bx=3*(i-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=i,this.p2y=o}Ge.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var i=r,o=0;o<8;o++){var s=this.sampleCurveX(i)-r;if(Math.abs(s)<e)return i;var h=this.sampleCurveDerivativeX(i);if(Math.abs(h)<1e-6)break;i-=s/h}var p=0,m=1;for(i=r,o=0;o<20&&(s=this.sampleCurveX(i),!(Math.abs(s-r)<e));o++)r>s?p=i:m=i,i=.5*(m-p)+p;return i},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};var yt=le(se);let Fe,ot;function zt(){return Fe==null&&(Fe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Fe}function tr(){if(ot==null&&(ot=!1,zt())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<5*5;o++){const s=4*o;e.fillStyle=`rgb(${s},${s+1},${s+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const i=e.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&i[o]!==o){ot=!0;break}}}return ot||!1}function bt(r,e,i,o){const s=new yt(r,e,i,o);return h=>s.solve(h)}const Pt=bt(.25,.1,.25,1);function Nt(r,e,i){return Math.min(i,Math.max(e,r))}function tt(r,e,i){const o=i-e,s=((r-e)%o+o)%o+e;return s===e?i:s}function Ot(r,...e){for(const i of e)for(const o in i)r[o]=i[o];return r}let cr=1;function Cr(r,e,i){const o={};for(const s in r)o[s]=e.call(this,r[s],s,r);return o}function li(r,e,i){const o={};for(const s in r)e.call(this,r[s],s,r)&&(o[s]=r[s]);return o}function Ft(r){return Array.isArray(r)?r.map(Ft):typeof r=="object"&&r?Cr(r,Ft):r}const Er={};function rr(r){Er[r]||(typeof console<"u"&&console.warn(r),Er[r]=!0)}function $t(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function ti(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let di=null;function pi(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const yn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function bi(r,e,i,o,s){return u(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const h=new VideoFrame(r,{timestamp:0});try{const p=h?.format;if(!p||!p.startsWith("BGR")&&!p.startsWith("RGB"))throw new Error(`Unrecognized format ${p}`);const m=p.startsWith("BGR"),x=new Uint8ClampedArray(o*s*4);if(yield h.copyTo(x,function(w,E,P,D,B){const N=4*Math.max(-E,0),q=(Math.max(0,P)-P)*D*4+N,H=4*D,Q=Math.max(0,E),ge=Math.max(0,P);return{rect:{x:Q,y:ge,width:Math.min(w.width,E+D)-Q,height:Math.min(w.height,P+B)-ge},layout:[{offset:q,stride:H}]}}(r,e,i,o,s)),m)for(let w=0;w<x.length;w+=4){const E=x[w];x[w]=x[w+2],x[w+2]=E}return x}finally{h.close()}})}let Ar,nr;const Xr="AbortError";function ur(){return new Error(Xr)}const Zi={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ri(r){return Zi.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const jr="global-dispatcher";class nn extends Error{constructor(e,i,o,s){super(`AJAXError: ${i} (${e}): ${o}`),this.status=e,this.statusText=i,this.url=o,this.body=s}}const Wi=()=>ti(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,qr=function(r,e){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const o=ri(r.url);if(o)return o(r,e);if(ti(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:jr},e)}if(!(/^file:/.test(i=r.url)||/^file:/.test(Wi())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,s){return u(this,void 0,void 0,function*(){const h=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Wi(),signal:s.signal});o.type==="json"&&h.headers.set("Accept","application/json");const p=yield fetch(h);if(!p.ok){const w=yield p.blob();throw new nn(p.status,p.statusText,o.url,w)}let m;m=o.type==="arrayBuffer"||o.type==="image"?p.arrayBuffer():o.type==="json"?p.json():p.text();const x=yield m;if(s.signal.aborted)throw ur();return{data:x,cacheControl:p.headers.get("Cache-Control"),expires:p.headers.get("Expires")}})}(r,e);if(ti(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:jr},e)}var i;return function(o,s){return new Promise((h,p)=>{const m=new XMLHttpRequest;m.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(m.responseType="arraybuffer");for(const x in o.headers)m.setRequestHeader(x,o.headers[x]);o.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=o.credentials==="include",m.onerror=()=>{p(new Error(m.statusText))},m.onload=()=>{if(!s.signal.aborted)if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let x=m.response;if(o.type==="json")try{x=JSON.parse(m.response)}catch(w){return void p(w)}h({data:x,cacheControl:m.getResponseHeader("Cache-Control"),expires:m.getResponseHeader("Expires")})}else{const x=new Blob([m.response],{type:m.getResponseHeader("Content-Type")});p(new nn(m.status,m.statusText,o.url,x))}},s.signal.addEventListener("abort",()=>{m.abort(),p(ur())}),m.send(o.body)})}(r,e)};function Mt(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const e=new URL(r),i=window.location;return e.protocol===i.protocol&&e.host===i.host}function pa(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function _n(r,e,i){if(i&&i[r]){const o=i[r].indexOf(e);o!==-1&&i[r].splice(o,1)}}class Hn{constructor(e,i={}){Ot(this,i),this.type=e}}class vr extends Hn{constructor(e,i={}){super("error",Ot({error:e},i))}}class zo{on(e,i){return this._listeners=this._listeners||{},pa(e,i,this._listeners),this}off(e,i){return _n(e,i,this._listeners),_n(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},pa(e,i,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,i){typeof e=="string"&&(e=new Hn(e,i||{}));const o=e.type;if(this.listens(o)){e.target=this;const s=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const m of s)m.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const m of h)_n(o,m,this._oneTimeListeners),m.call(this,e);const p=this._eventedParent;p&&(Ot(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof vr&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Pn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function fa(r,e){const i={};for(const o in r)o!=="ref"&&(i[o]=r[o]);return Pn.forEach(o=>{o in e&&(i[o]=e[o])}),i}function Kt(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!Kt(r[i],e[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const i in r)if(!Kt(r[i],e[i]))return!1;return!0}return r===e}function qt(r,e){r.push(e)}function Mn(r,e,i){qt(i,{command:"addSource",args:[r,e[r]]})}function Do(r,e,i){qt(e,{command:"removeSource",args:[r]}),i[r]=!0}function Fo(r,e,i,o){Do(r,i,o),Mn(r,e,i)}function kn(r,e,i){let o;for(o in r[i])if(Object.prototype.hasOwnProperty.call(r[i],o)&&o!=="data"&&!Kt(r[i][o],e[i][o]))return!1;for(o in e[i])if(Object.prototype.hasOwnProperty.call(e[i],o)&&o!=="data"&&!Kt(r[i][o],e[i][o]))return!1;return!0}function xn(r,e,i,o,s,h){r=r||{},e=e||{};for(const p in r)Object.prototype.hasOwnProperty.call(r,p)&&(Kt(r[p],e[p])||i.push({command:h,args:[o,p,e[p],s]}));for(const p in e)Object.prototype.hasOwnProperty.call(e,p)&&!Object.prototype.hasOwnProperty.call(r,p)&&(Kt(r[p],e[p])||i.push({command:h,args:[o,p,e[p],s]}))}function Hi(r){return r.id}function Lo(r,e){return r[e.id]=e,r}class Re{constructor(e,i,o,s){this.message=(e?`${e}: `:"")+o,s&&(this.identifier=s),i!=null&&i.__line__&&(this.line=i.__line__)}}function ci(r,...e){for(const i of e)for(const o in i)r[o]=i[o];return r}class Jr extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class zn{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,s]of i)this.bindings[o]=s}concat(e){return new zn(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const vn={kind:"null"},Le={kind:"number"},kt={kind:"string"},It={kind:"boolean"},Nr={kind:"color"},fi={kind:"object"},Ct={kind:"value"},wi={kind:"collator"},bn={kind:"formatted"},zr={kind:"padding"},Z={kind:"resolvedImage"},F={kind:"variableAnchorOffsetCollection"};function L(r,e){return{kind:"array",itemType:r,N:e}}function $(r){if(r.kind==="array"){const e=$(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const X=[vn,Le,kt,It,Nr,bn,fi,L(Ct),zr,Z,F];function ie(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ie(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of X)if(!ie(i,e))return null}}return`Expected ${$(r)} but found ${$(e)} instead.`}function ue(r,e){return e.some(i=>i.kind===r.kind)}function pe(r,e){return e.some(i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r)}function te(r,e){return r.kind==="array"&&e.kind==="array"?r.itemType.kind===e.itemType.kind&&typeof r.N=="number":r.kind===e.kind}const _e=.96422,Me=.82521,Se=4/29,Te=6/29,dt=3*Te*Te,ut=Te*Te*Te,Et=Math.PI/180,vt=180/Math.PI;function Bt(r){return(r%=360)<0&&(r+=360),r}function Gt([r,e,i,o]){let s,h;const p=$r((.2225045*(r=hr(r))+.7168786*(e=hr(e))+.0606169*(i=hr(i)))/1);r===e&&e===i?s=h=p:(s=$r((.4360747*r+.3850649*e+.1430804*i)/_e),h=$r((.0139322*r+.0971045*e+.7141733*i)/Me));const m=116*p-16;return[m<0?0:m,500*(s-p),200*(p-h),o]}function hr(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function $r(r){return r>ut?Math.pow(r,1/3):r/dt+Se}function mt([r,e,i,o]){let s=(r+16)/116,h=isNaN(e)?s:s+e/500,p=isNaN(i)?s:s-i/200;return s=1*Gr(s),h=_e*Gr(h),p=Me*Gr(p),[br(3.1338561*h-1.6168667*s-.4906146*p),br(-.9787684*h+1.9161415*s+.033454*p),br(.0719453*h-.2289914*s+1.4052427*p),o]}function br(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function Gr(r){return r>Te?r*r*r:dt*(r-Se)}function Si(r){return parseInt(r.padEnd(2,r),16)/255}function Ti(r,e){return Zr(e?r/100:r,0,1)}function Zr(r,e,i){return Math.min(Math.max(e,r),i)}function Xn(r){return!r.some(Number.isNaN)}const ql={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Vt{constructor(e,i,o,s=1,h=!0){this.r=e,this.g=i,this.b=o,this.a=s,h||(this.r*=s,this.g*=s,this.b*=s,s||this.overwriteGetter("rgb",[e,i,o,s]))}static parse(e){if(e instanceof Vt)return e;if(typeof e!="string")return;const i=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const s=ql[o];if(s){const[p,m,x]=s;return[p/255,m/255,x/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const p=o.length<6?1:2;let m=1;return[Si(o.slice(m,m+=p)),Si(o.slice(m,m+=p)),Si(o.slice(m,m+=p)),Si(o.slice(m,m+p)||"ff")]}if(o.startsWith("rgb")){const p=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[m,x,w,E,P,D,B,N,q,H,Q,ge]=p,re=[E||" ",B||" ",H].join("");if(re==="  "||re==="  /"||re===",,"||re===",,,"){const de=[w,D,q].join(""),Ie=de==="%%%"?100:de===""?255:0;if(Ie){const Ee=[Zr(+x/Ie,0,1),Zr(+P/Ie,0,1),Zr(+N/Ie,0,1),Q?Ti(+Q,ge):1];if(Xn(Ee))return Ee}}return}}const h=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(h){const[p,m,x,w,E,P,D,B,N]=h,q=[x||" ",E||" ",D].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const H=[+m,Zr(+w,0,100),Zr(+P,0,100),B?Ti(+B,N):1];if(Xn(H))return function([Q,ge,re,de]){function Ie(Ee){const Ye=(Ee+Q/30)%12,lt=ge*Math.min(re,1-re);return re-lt*Math.max(-1,Math.min(Ye-3,9-Ye,1))}return Q=Bt(Q),ge/=100,re/=100,[Ie(0),Ie(8),Ie(4),de]}(H)}}}(e);return i?new Vt(...i,!1):void 0}get rgb(){const{r:e,g:i,b:o,a:s}=this,h=s||1/0;return this.overwriteGetter("rgb",[e/h,i/h,o/h,s])}get hcl(){return this.overwriteGetter("hcl",function(e){const[i,o,s,h]=Gt(e),p=Math.sqrt(o*o+s*s);return[Math.round(1e4*p)?Bt(Math.atan2(s,o)*vt):NaN,p,i,h]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Gt(this.rgb))}overwriteGetter(e,i){return Object.defineProperty(this,e,{value:i}),i}toString(){const[e,i,o,s]=this.rgb;return`rgba(${[e,i,o].map(h=>Math.round(255*h)).join(",")},${s})`}}Vt.black=new Vt(0,0,0,1),Vt.white=new Vt(1,1,1,1),Vt.transparent=new Vt(0,0,0,0),Vt.red=new Vt(1,0,0,1);class ma{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ga{constructor(e,i,o,s,h){this.text=e,this.image=i,this.scale=o,this.fontStack=s,this.textColor=h}}class Yt{constructor(e){this.sections=e}static fromString(e){return new Yt([new ga(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Yt?e:Yt.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class mi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof mi)return e;if(typeof e=="number")return new mi([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const i of e)if(typeof i!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new mi(e)}}toString(){return JSON.stringify(this.values)}}const Bo=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Dr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Dr)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let i=0;i<e.length;i+=2){const o=e[i],s=e[i+1];if(typeof o!="string"||!Bo.has(o)||!Array.isArray(s)||s.length!==2||typeof s[0]!="number"||typeof s[1]!="number")return}return new Dr(e)}}toString(){return JSON.stringify(this.values)}}class Fr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Fr({name:e,available:!1}):null}}function ya(r,e,i,o){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[r,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[r,e,i,o]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function gi(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Vt||r instanceof ma||r instanceof Yt||r instanceof mi||r instanceof Dr||r instanceof Fr)return!0;if(Array.isArray(r)){for(const e of r)if(!gi(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!gi(r[e]))return!1;return!0}return!1}function dr(r){if(r===null)return vn;if(typeof r=="string")return kt;if(typeof r=="boolean")return It;if(typeof r=="number")return Le;if(r instanceof Vt)return Nr;if(r instanceof ma)return wi;if(r instanceof Yt)return bn;if(r instanceof mi)return zr;if(r instanceof Dr)return F;if(r instanceof Fr)return Z;if(Array.isArray(r)){const e=r.length;let i;for(const o of r){const s=dr(o);if(i){if(i===s)continue;i=Ct;break}i=s}return L(i||Ct,e)}return fi}function Ro(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof Vt||r instanceof Yt||r instanceof mi||r instanceof Dr||r instanceof Fr?r.toString():JSON.stringify(r)}class po{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!gi(e[1]))return i.error("invalid value");const o=e[1];let s=dr(o);const h=i.expectedType;return s.kind!=="array"||s.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(s=h),new po(s,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Pr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const fo={string:kt,number:Le,boolean:It,object:fi};class Xi{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,s=1;const h=e[0];if(h==="array"){let m,x;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in fo)||w==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);m=fo[w],s++}else m=Ct;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=e[2],s++}o=L(m,x)}else{if(!fo[h])throw new Error(`Types doesn't contain name = ${h}`);o=fo[h]}const p=[];for(;s<e.length;s++){const m=i.parse(e[s],s,Ct);if(!m)return null;p.push(m)}return new Xi(o,p)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!ie(this.type,dr(o)))return o;if(i===this.args.length-1)throw new Pr(`Expected value to be of type ${$(this.type)}, but found ${$(dr(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Oo={"to-boolean":It,"to-color":Nr,"to-number":Le,"to-string":kt};class on{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0];if(!Oo[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");const s=Oo[o],h=[];for(let p=1;p<e.length;p++){const m=i.parse(e[p],p,Ct);if(!m)return null;h.push(m)}return new on(s,h)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let i,o;for(const s of this.args){if(i=s.evaluate(e),o=null,i instanceof Vt)return i;if(typeof i=="string"){const h=e.parseColor(i);if(h)return h}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:ya(i[0],i[1],i[2],i[3]),!o))return new Vt(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Pr(o||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const o of this.args){i=o.evaluate(e);const s=mi.parse(i);if(s)return s}throw new Pr(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const o of this.args){i=o.evaluate(e);const s=Dr.parse(i);if(s)return s}throw new Pr(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const s=Number(i);if(!isNaN(s))return s}throw new Pr(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return Yt.fromString(Ro(this.args[0].evaluate(e)));case"resolvedImage":return Fr.fromString(Ro(this.args[0].evaluate(e)));default:return Ro(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Na=["Unknown","Point","LineString","Polygon"];class jo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Na[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Vt.parse(e)),i}}class Zt{constructor(e,i,o=[],s,h=new zn,p=[]){this.registry=e,this.path=o,this.key=o.map(m=>`[${m}]`).join(""),this.scope=h,this.errors=p,this.expectedType=s,this._isConstant=i}parse(e,i,o,s,h={}){return i?this.concat(i,o,s)._parse(e,h):this._parse(e,h)}_parse(e,i){function o(s,h,p){return p==="assert"?new Xi(h,[s]):p==="coerce"?new on(h,[s]):s}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const s=e[0];if(typeof s!="string")return this.error(`Expression name must be a string, but found ${typeof s} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[s];if(h){let p=h.parse(e,this);if(!p)return null;if(this.expectedType){const m=this.expectedType,x=p.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||x.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string")if(m.kind!=="padding"||x.kind!=="value"&&x.kind!=="number"&&x.kind!=="array")if(m.kind!=="variableAnchorOffsetCollection"||x.kind!=="value"&&x.kind!=="array"){if(this.checkSubtype(m,x))return null}else p=o(p,m,i.typeAnnotation||"coerce");else p=o(p,m,i.typeAnnotation||"coerce");else p=o(p,m,i.typeAnnotation||"coerce");else p=o(p,m,i.typeAnnotation||"assert")}if(!(p instanceof po)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){const m=new jo;try{p=new po(p.type,p.evaluate(m))}catch(x){return this.error(x.message),null}}return p}return this.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o){const s=typeof e=="number"?this.path.concat(e):this.path,h=o?this.scope.concat(o):this.scope;return new Zt(this.registry,this._isConstant,s,i||null,h,this.errors)}error(e,...i){const o=`${this.key}${i.map(s=>`[${s}]`).join("")}`;this.errors.push(new Jr(o,e))}checkSubtype(e,i){const o=ie(e,i);return o&&this.error(o),o}}class $a{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let h=1;h<e.length-1;h+=2){const p=e[h];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,h);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",h);const m=i.parse(e[h+1],h+1);if(!m)return null;o.push([p,m])}const s=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return s?new $a(o,s):null}outputDefined(){return this.result.outputDefined()}}class Dn{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new Dn(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class y{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Le),s=i.parse(e[2],2,L(i.expectedType||Ct));return o&&s?new y(s.type.itemType,o,s):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new Pr(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new Pr(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new Pr(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class S{constructor(e,i){this.type=It,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Ct),s=i.parse(e[2],2,Ct);return o&&s?ue(o.type,[It,kt,Le,vn,Ct])?new S(o,s):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${$(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!pe(i,["boolean","string","number","null"]))throw new Pr(`Expected first argument to be of type boolean, string, number or null, but found ${$(dr(i))} instead.`);if(!pe(o,["string","array"]))throw new Pr(`Expected second argument to be of type array or string, but found ${$(dr(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class O{constructor(e,i,o){this.type=Le,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Ct),s=i.parse(e[2],2,Ct);if(!o||!s)return null;if(!ue(o.type,[It,kt,Le,vn,Ct]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${$(o.type)} instead`);if(e.length===4){const h=i.parse(e[3],3,Le);return h?new O(o,s,h):null}return new O(o,s)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!pe(i,["boolean","string","number","null"]))throw new Pr(`Expected first argument to be of type boolean, string, number or null, but found ${$(dr(i))} instead.`);if(!pe(o,["string","array"]))throw new Pr(`Expected second argument to be of type array or string, but found ${$(dr(o))} instead.`);if(this.fromIndex){const s=this.fromIndex.evaluate(e);return o.indexOf(i,s)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class K{constructor(e,i,o,s,h,p){this.inputType=e,this.type=i,this.input=o,this.cases=s,this.outputs=h,this.otherwise=p}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);const h={},p=[];for(let w=2;w<e.length-1;w+=2){let E=e[w];const P=e[w+1];Array.isArray(E)||(E=[E]);const D=i.concat(w);if(E.length===0)return D.error("Expected at least one branch label.");for(const N of E){if(typeof N!="number"&&typeof N!="string")return D.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return D.error("Numeric branch labels must be integer values.");if(o){if(D.checkSubtype(o,dr(N)))return null}else o=dr(N);if(h[String(N)]!==void 0)return D.error("Branch labels must be unique.");h[String(N)]=p.length}const B=i.parse(P,w,s);if(!B)return null;s=s||B.type,p.push(B)}const m=i.parse(e[1],1,Ct);if(!m)return null;const x=i.parse(e[e.length-1],e.length-1,s);return x?m.type.kind!=="value"&&i.concat(1).checkSubtype(o,m.type)?null:new K(o,s,m,h,p,x):null}evaluate(e){const i=this.input.evaluate(e);return(dr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class ne{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const s=[];for(let p=1;p<e.length-1;p+=2){const m=i.parse(e[p],p,It);if(!m)return null;const x=i.parse(e[p+1],p+1,o);if(!x)return null;s.push([m,x]),o=o||x.type}const h=i.parse(e[e.length-1],e.length-1,o);if(!h)return null;if(!o)throw new Error("Can't infer output type");return new ne(o,s,h)}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}}class ae{constructor(e,i,o,s){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Ct),s=i.parse(e[2],2,Le);if(!o||!s)return null;if(!ue(o.type,[L(Ct),kt,Ct]))return i.error(`Expected first argument to be of type array or string, but found ${$(o.type)} instead`);if(e.length===4){const h=i.parse(e[3],3,Le);return h?new ae(o.type,o,s,h):null}return new ae(o.type,o,s)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!pe(i,["string","array"]))throw new Pr(`Expected first argument to be of type array or string, but found ${$(dr(i))} instead.`);if(this.endIndex){const s=this.endIndex.evaluate(e);return i.slice(o,s)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function fe(r,e){const i=r.length-1;let o,s,h=0,p=i,m=0;for(;h<=p;)if(m=Math.floor((h+p)/2),o=r[m],s=r[m+1],o<=e){if(m===i||e<s)return m;h=m+1}else{if(!(o>e))throw new Pr("Input is not a number.");p=m-1}return 0}class ze{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[s,h]of o)this.labels.push(s),this.outputs.push(h)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,Le);if(!o)return null;const s=[];let h=null;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);for(let p=1;p<e.length;p+=2){const m=p===1?-1/0:e[p],x=e[p+1],w=p,E=p+1;if(typeof m!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(s.length&&s[s.length-1][0]>=m)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const P=i.parse(x,E,h);if(!P)return null;h=h||P.type,s.push([m,P])}return new ze(h,o,s)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const s=this.input.evaluate(e);if(s<=i[0])return o[0].evaluate(e);const h=i.length;return s>=i[h-1]?o[h-1].evaluate(e):o[fe(i,s)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Oe(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var We=Ze;function Ze(r,e,i,o){this.cx=3*r,this.bx=3*(i-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=i,this.p2y=o}Ze.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var i=r,o=0;o<8;o++){var s=this.sampleCurveX(i)-r;if(Math.abs(s)<e)return i;var h=this.sampleCurveDerivativeX(i);if(Math.abs(h)<1e-6)break;i-=s/h}var p=0,m=1;for(i=r,o=0;o<20&&(s=this.sampleCurveX(i),!(Math.abs(s-r)<e));o++)r>s?p=i:m=i,i=.5*(m-p)+p;return i},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};var $e=Oe(We);function xt(r,e,i){return r+i*(e-r)}function pr(r,e,i){return r.map((o,s)=>xt(o,e[s],i))}const gt={number:xt,color:function(r,e,i,o="rgb"){switch(o){case"rgb":{const[s,h,p,m]=pr(r.rgb,e.rgb,i);return new Vt(s,h,p,m,!1)}case"hcl":{const[s,h,p,m]=r.hcl,[x,w,E,P]=e.hcl;let D,B;if(isNaN(s)||isNaN(x))isNaN(s)?isNaN(x)?D=NaN:(D=x,p!==1&&p!==0||(B=w)):(D=s,E!==1&&E!==0||(B=h));else{let ge=x-s;x>s&&ge>180?ge-=360:x<s&&s-x>180&&(ge+=360),D=s+i*ge}const[N,q,H,Q]=function([ge,re,de,Ie]){return ge=isNaN(ge)?0:ge*Et,mt([de,Math.cos(ge)*re,Math.sin(ge)*re,Ie])}([D,B??xt(h,w,i),xt(p,E,i),xt(m,P,i)]);return new Vt(N,q,H,Q,!1)}case"lab":{const[s,h,p,m]=mt(pr(r.lab,e.lab,i));return new Vt(s,h,p,m,!1)}}},array:pr,padding:function(r,e,i){return new mi(pr(r.values,e.values,i))},variableAnchorOffsetCollection:function(r,e,i){const o=r.values,s=e.values;if(o.length!==s.length)throw new Pr(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${e.toString()}`);const h=[];for(let p=0;p<o.length;p+=2){if(o[p]!==s[p])throw new Pr(`Cannot interpolate values containing mismatched anchors. from[${p}]: ${o[p]}, to[${p}]: ${s[p]}`);h.push(o[p]);const[m,x]=o[p+1],[w,E]=s[p+1];h.push([xt(m,w,i),xt(x,E,i)])}return new Dr(h)}};class Wt{constructor(e,i,o,s,h){this.type=e,this.operator=i,this.interpolation=o,this.input=s,this.labels=[],this.outputs=[];for(const[p,m]of h)this.labels.push(p),this.outputs.push(m)}static interpolationFactor(e,i,o,s){let h=0;if(e.name==="exponential")h=ke(i,e.base,o,s);else if(e.name==="linear")h=ke(i,1,o,s);else if(e.name==="cubic-bezier"){const p=e.controlPoints;h=new $e(p[0],p[1],p[2],p[3]).solve(ke(i,1,o,s))}return h}static parse(e,i){let[o,s,h,...p]=e;if(!Array.isArray(s)||s.length===0)return i.error("Expected an interpolation type expression.",1);if(s[0]==="linear")s={name:"linear"};else if(s[0]==="exponential"){const w=s[1];if(typeof w!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);s={name:"exponential",base:w}}else{if(s[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(s[0])}`,1,0);{const w=s.slice(1);if(w.length!==4||w.some(E=>typeof E!="number"||E<0||E>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);s={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(h=i.parse(h,2,Le),!h)return null;const m=[];let x=null;o==="interpolate-hcl"||o==="interpolate-lab"?x=Nr:i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType);for(let w=0;w<p.length;w+=2){const E=p[w],P=p[w+1],D=w+3,B=w+4;if(typeof E!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(m.length&&m[m.length-1][0]>=E)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const N=i.parse(P,B,x);if(!N)return null;x=x||N.type,m.push([E,N])}return te(x,Le)||te(x,Nr)||te(x,zr)||te(x,F)||te(x,L(Le))?new Wt(x,o,s,h,m):i.error(`Type ${$(x)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const s=this.input.evaluate(e);if(s<=i[0])return o[0].evaluate(e);const h=i.length;if(s>=i[h-1])return o[h-1].evaluate(e);const p=fe(i,s),m=Wt.interpolationFactor(this.interpolation,s,i[p],i[p+1]),x=o[p].evaluate(e),w=o[p+1].evaluate(e);switch(this.operator){case"interpolate":return gt[this.type.kind](x,w,m);case"interpolate-hcl":return gt.color(x,w,m,"hcl");case"interpolate-lab":return gt.color(x,w,m,"lab")}}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ke(r,e,i,o){const s=o-i,h=r-i;return s===0?0:e===1?h/s:(Math.pow(e,h)-1)/(Math.pow(e,s)-1)}class ct{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null;const s=i.expectedType;s&&s.kind!=="value"&&(o=s);const h=[];for(const m of e.slice(1)){const x=i.parse(m,1+h.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,h.push(x)}if(!o)throw new Error("No output type");const p=s&&h.some(m=>ie(s,m.type));return new ct(p?Ct:o,h)}evaluate(e){let i,o=null,s=0;for(const h of this.args)if(s++,o=h.evaluate(e),o&&o instanceof Fr&&!o.available&&(i||(i=o.name),o=null,s===this.args.length&&(o=i)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function Qt(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Vr(r,e,i,o){return o.compare(e,i)===0}function gr(r,e,i){const o=r!=="=="&&r!=="!=";return class ay{constructor(h,p,m){this.type=It,this.lhs=h,this.rhs=p,this.collator=m,this.hasUntypedArgument=h.type.kind==="value"||p.type.kind==="value"}static parse(h,p){if(h.length!==3&&h.length!==4)return p.error("Expected two or three arguments.");const m=h[0];let x=p.parse(h[1],1,Ct);if(!x)return null;if(!Qt(m,x.type))return p.concat(1).error(`"${m}" comparisons are not supported for type '${$(x.type)}'.`);let w=p.parse(h[2],2,Ct);if(!w)return null;if(!Qt(m,w.type))return p.concat(2).error(`"${m}" comparisons are not supported for type '${$(w.type)}'.`);if(x.type.kind!==w.type.kind&&x.type.kind!=="value"&&w.type.kind!=="value")return p.error(`Cannot compare types '${$(x.type)}' and '${$(w.type)}'.`);o&&(x.type.kind==="value"&&w.type.kind!=="value"?x=new Xi(w.type,[x]):x.type.kind!=="value"&&w.type.kind==="value"&&(w=new Xi(x.type,[w])));let E=null;if(h.length===4){if(x.type.kind!=="string"&&w.type.kind!=="string"&&x.type.kind!=="value"&&w.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(E=p.parse(h[3],3,wi),!E)return null}return new ay(x,w,E)}evaluate(h){const p=this.lhs.evaluate(h),m=this.rhs.evaluate(h);if(o&&this.hasUntypedArgument){const x=dr(p),w=dr(m);if(x.kind!==w.kind||x.kind!=="string"&&x.kind!=="number")throw new Pr(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${x.kind}, ${w.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=dr(p),w=dr(m);if(x.kind!=="string"||w.kind!=="string")return e(h,p,m)}return this.collator?i(h,p,m,this.collator.evaluate(h)):e(h,p,m)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}}}const bs=gr("==",function(r,e,i){return e===i},Vr),Js=gr("!=",function(r,e,i){return e!==i},function(r,e,i,o){return!Vr(0,e,i,o)}),fr=gr("<",function(r,e,i){return e<i},function(r,e,i,o){return o.compare(e,i)<0}),Ks=gr(">",function(r,e,i){return e>i},function(r,e,i,o){return o.compare(e,i)>0}),Gl=gr("<=",function(r,e,i){return e<=i},function(r,e,i,o){return o.compare(e,i)<=0}),Fn=gr(">=",function(r,e,i){return e>=i},function(r,e,i,o){return o.compare(e,i)>=0});class _a{constructor(e,i,o){this.type=wi,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const s=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,It);if(!s)return null;const h=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,It);if(!h)return null;let p=null;return o.locale&&(p=i.parse(o.locale,1,kt),!p)?null:new _a(s,h,p)}evaluate(e){return new ma(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Va{constructor(e,i,o,s,h){this.type=kt,this.number=e,this.locale=i,this.currency=o,this.minFractionDigits=s,this.maxFractionDigits=h}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Le);if(!o)return null;const s=e[2];if(typeof s!="object"||Array.isArray(s))return i.error("NumberFormat options argument must be an object.");let h=null;if(s.locale&&(h=i.parse(s.locale,1,kt),!h))return null;let p=null;if(s.currency&&(p=i.parse(s.currency,1,kt),!p))return null;let m=null;if(s["min-fraction-digits"]&&(m=i.parse(s["min-fraction-digits"],1,Le),!m))return null;let x=null;return s["max-fraction-digits"]&&(x=i.parse(s["max-fraction-digits"],1,Le),!x)?null:new Va(o,h,p,m,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class xa{constructor(e){this.type=bn,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const s=[];let h=!1;for(let p=1;p<=e.length-1;++p){const m=e[p];if(h&&typeof m=="object"&&!Array.isArray(m)){h=!1;let x=null;if(m["font-scale"]&&(x=i.parse(m["font-scale"],1,Le),!x))return null;let w=null;if(m["text-font"]&&(w=i.parse(m["text-font"],1,L(kt)),!w))return null;let E=null;if(m["text-color"]&&(E=i.parse(m["text-color"],1,Nr),!E))return null;const P=s[s.length-1];P.scale=x,P.font=w,P.textColor=E}else{const x=i.parse(e[p],1,Ct);if(!x)return null;const w=x.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,s.push({content:x,scale:null,font:null,textColor:null})}}return new xa(s)}evaluate(e){return new Yt(this.sections.map(i=>{const o=i.content.evaluate(e);return dr(o)===Z?new ga("",o,null,null,null):new ga(Ro(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}}class va{constructor(e){this.type=Z,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const o=i.parse(e[1],1,kt);return o?new va(o):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),o=Fr.fromString(i);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(i)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class No{constructor(e){this.type=Le,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${$(o.type)} instead.`):new No(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Pr(`Expected value to be of type string or array, but found ${$(dr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Ii=8192;function Ht(r,e){const i=(180+r[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,s=Math.pow(2,e.z);return[Math.round(i*s*Ii),Math.round(o*s*Ii)]}function ws(r,e){const i=Math.pow(2,e.z);return[(s=(r[0]/Ii+e.x)/i,360*s-180),(o=(r[1]/Ii+e.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,s}function ba(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function $o(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function Ys(r,e,i){const o=r[0]-e[0],s=r[1]-e[1],h=r[0]-i[0],p=r[1]-i[1];return o*p-h*s==0&&o*h<=0&&s*p<=0}function wa(r,e,i,o){return(s=[o[0]-i[0],o[1]-i[1]])[0]*(h=[e[0]-r[0],e[1]-r[1]])[1]-s[1]*h[0]!=0&&!(!an(r,e,i,o)||!an(i,o,r,e));var s,h}function Zl(r,e,i){for(const o of i)for(let s=0;s<o.length-1;++s)if(wa(r,e,o[s],o[s+1]))return!0;return!1}function Vo(r,e,i=!1){let o=!1;for(const m of e)for(let x=0;x<m.length-1;x++){if(Ys(r,m[x],m[x+1]))return i;(h=m[x])[1]>(s=r)[1]!=(p=m[x+1])[1]>s[1]&&s[0]<(p[0]-h[0])*(s[1]-h[1])/(p[1]-h[1])+h[0]&&(o=!o)}var s,h,p;return o}function Ua(r,e){for(const i of e)if(Vo(r,i))return!0;return!1}function qa(r,e){for(const i of r)if(!Vo(i,e))return!1;for(let i=0;i<r.length-1;++i)if(Zl(r[i],r[i+1],e))return!1;return!0}function Qs(r,e){for(const i of e)if(qa(r,i))return!0;return!1}function an(r,e,i,o){const s=o[0]-i[0],h=o[1]-i[1],p=(r[0]-i[0])*h-s*(r[1]-i[1]),m=(e[0]-i[0])*h-s*(e[1]-i[1]);return p>0&&m<0||p<0&&m>0}function Ga(r,e,i){const o=[];for(let s=0;s<r.length;s++){const h=[];for(let p=0;p<r[s].length;p++){const m=Ht(r[s][p],i);ba(e,m),h.push(m)}o.push(h)}return o}function Ss(r,e,i){const o=[];for(let s=0;s<r.length;s++){const h=Ga(r[s],e,i);o.push(h)}return o}function el(r,e,i,o){if(r[0]<i[0]||r[0]>i[2]){const s=.5*o;let h=r[0]-i[0]>s?-o:i[0]-r[0]>s?o:0;h===0&&(h=r[0]-i[2]>s?-o:i[2]-r[0]>s?o:0),r[0]+=h}ba(e,r)}function Ts(r,e,i,o){const s=Math.pow(2,o.z)*Ii,h=[o.x*Ii,o.y*Ii],p=[];for(const m of r)for(const x of m){const w=[x.x+h[0],x.y+h[1]];el(w,e,i,s),p.push(w)}return p}function Sa(r,e,i,o){const s=Math.pow(2,o.z)*Ii,h=[o.x*Ii,o.y*Ii],p=[];for(const x of r){const w=[];for(const E of x){const P=[E.x+h[0],E.y+h[1]];ba(e,P),w.push(P)}p.push(w)}if(e[2]-e[0]<=s/2){(m=e)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const x of p)for(const w of x)el(w,e,i,s)}var m;return p}class Jn{constructor(e,i){this.type=It,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(gi(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const s=[];for(const h of o.features){const{type:p,coordinates:m}=h.geometry;p==="Polygon"&&s.push(m),p==="MultiPolygon"&&s.push(...m)}if(s.length)return new Jn(o,{type:"MultiPolygon",coordinates:s})}else if(o.type==="Feature"){const s=o.geometry.type;if(s==="Polygon"||s==="MultiPolygon")return new Jn(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Jn(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){const s=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const m=Ga(o.coordinates,h,p),x=Ts(i.geometry(),s,h,p);if(!$o(s,h))return!1;for(const w of x)if(!Vo(w,m))return!1}if(o.type==="MultiPolygon"){const m=Ss(o.coordinates,h,p),x=Ts(i.geometry(),s,h,p);if(!$o(s,h))return!1;for(const w of x)if(!Ua(w,m))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){const s=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const m=Ga(o.coordinates,h,p),x=Sa(i.geometry(),s,h,p);if(!$o(s,h))return!1;for(const w of x)if(!qa(w,m))return!1}if(o.type==="MultiPolygon"){const m=Ss(o.coordinates,h,p),x=Sa(i.geometry(),s,h,p);if(!$o(s,h))return!1;for(const w of x)if(!Qs(w,m))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Is=class{constructor(r=[],e=Wl){if(this.data=r,this.length=this.data.length,this.compare=e,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:e,compare:i}=this,o=e[r];for(;r>0;){const s=r-1>>1,h=e[s];if(i(o,h)>=0)break;e[r]=h,r=s}e[r]=o}_down(r){const{data:e,compare:i}=this,o=this.length>>1,s=e[r];for(;r<o;){let h=1+(r<<1),p=e[h];const m=h+1;if(m<this.length&&i(e[m],p)<0&&(h=m,p=e[m]),i(p,s)>=0)break;e[r]=p,r=h}e[r]=s}};function Wl(r,e){return r<e?-1:r>e?1:0}function mo(r,e,i,o,s){Cs(r,e,i,o||r.length-1,s||Hl)}function Cs(r,e,i,o,s){for(;o>i;){if(o-i>600){var h=o-i+1,p=e-i+1,m=Math.log(h),x=.5*Math.exp(2*m/3),w=.5*Math.sqrt(m*x*(h-x)/h)*(p-h/2<0?-1:1);Cs(r,e,Math.max(i,Math.floor(e-p*x/h+w)),Math.min(o,Math.floor(e+(h-p)*x/h+w)),s)}var E=r[e],P=i,D=o;for(Ta(r,i,e),s(r[o],E)>0&&Ta(r,i,o);P<D;){for(Ta(r,P,D),P++,D--;s(r[P],E)<0;)P++;for(;s(r[D],E)>0;)D--}s(r[i],E)===0?Ta(r,i,D):Ta(r,++D,o),D<=e&&(i=D+1),e<=D&&(o=D-1)}}function Ta(r,e,i){var o=r[e];r[e]=r[i],r[i]=o}function Hl(r,e){return r<e?-1:r>e?1:0}function Uo(r,e){if(r.length<=1)return[r];const i=[];let o,s;for(const h of r){const p=Es(h);p!==0&&(h.area=Math.abs(p),s===void 0&&(s=p<0),s===p<0?(o&&i.push(o),o=[h]):o.push(h))}if(o&&i.push(o),e>1)for(let h=0;h<i.length;h++)i[h].length<=e||(mo(i[h],e,1,i[h].length-1,Ia),i[h]=i[h].slice(0,e));return i}function Ia(r,e){return e.area-r.area}function Es(r){let e=0;for(let i,o,s=0,h=r.length,p=h-1;s<h;p=s++)i=r[s],o=r[p],e+=(o.x-i.x)*(i.y+o.y);return e}const Za=1/298.257223563,Wa=Za*(2-Za),qo=Math.PI/180;class As{constructor(e){const i=6378.137*qo*1e3,o=Math.cos(e*qo),s=1/(1-Wa*(1-o*o)),h=Math.sqrt(s);this.kx=i*h*o,this.ky=i*h*s*(1-Wa)}distance(e,i){const o=this.wrap(e[0]-i[0])*this.kx,s=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+s*s)}pointOnLine(e,i){let o,s,h,p,m=1/0;for(let x=0;x<e.length-1;x++){let w=e[x][0],E=e[x][1],P=this.wrap(e[x+1][0]-w)*this.kx,D=(e[x+1][1]-E)*this.ky,B=0;P===0&&D===0||(B=(this.wrap(i[0]-w)*this.kx*P+(i[1]-E)*this.ky*D)/(P*P+D*D),B>1?(w=e[x+1][0],E=e[x+1][1]):B>0&&(w+=P/this.kx*B,E+=D/this.ky*B)),P=this.wrap(i[0]-w)*this.kx,D=(i[1]-E)*this.ky;const N=P*P+D*D;N<m&&(m=N,o=w,s=E,h=x,p=B)}return{point:[o,s],index:h,t:Math.max(0,Math.min(1,p))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function tl(r,e){return e[0]-r[0]}function Go(r){return r[1]-r[0]+1}function Ln(r,e){return r[1]>=r[0]&&r[1]<e}function Ps(r,e){if(r[0]>r[1])return[null,null];const i=Go(r);if(e){if(i===2)return[r,null];const s=Math.floor(i/2);return[[r[0],r[0]+s],[r[0]+s,r[1]]]}if(i===1)return[r,null];const o=Math.floor(i/2)-1;return[[r[0],r[0]+o],[r[0]+o+1,r[1]]]}function Ha(r,e){if(!Ln(e,r.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)ba(i,r[o]);return i}function Ca(r){const e=[1/0,1/0,-1/0,-1/0];for(const i of r)for(const o of i)ba(e,o);return e}function or(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function sn(r,e,i){if(!or(r)||!or(e))return NaN;let o=0,s=0;return r[2]<e[0]&&(o=e[0]-r[2]),r[0]>e[2]&&(o=r[0]-e[2]),r[1]>e[3]&&(s=r[1]-e[3]),r[3]<e[1]&&(s=e[1]-r[3]),i.distance([0,0],[o,s])}function St(r,e,i){const o=i.pointOnLine(e,r);return i.distance(r,o.point)}function Kn(r,e,i,o,s){const h=Math.min(St(r,[i,o],s),St(e,[i,o],s)),p=Math.min(St(i,[r,e],s),St(o,[r,e],s));return Math.min(h,p)}function er(r,e,i,o,s){if(!Ln(e,r.length)||!Ln(o,i.length))return 1/0;let h=1/0;for(let p=e[0];p<e[1];++p){const m=r[p],x=r[p+1];for(let w=o[0];w<o[1];++w){const E=i[w],P=i[w+1];if(wa(m,x,E,P))return 0;h=Math.min(h,Kn(m,x,E,P,s))}}return h}function yr(r,e,i,o,s){if(!Ln(e,r.length)||!Ln(o,i.length))return NaN;let h=1/0;for(let p=e[0];p<=e[1];++p)for(let m=o[0];m<=o[1];++m)if(h=Math.min(h,s.distance(r[p],i[m])),h===0)return h;return h}function go(r,e,i){if(Vo(r,e,!0))return 0;let o=1/0;for(const s of e){const h=s[0],p=s[s.length-1];if(h!==p&&(o=Math.min(o,St(r,[p,h],i)),o===0))return o;const m=i.pointOnLine(s,r);if(o=Math.min(o,i.distance(r,m.point)),o===0)return o}return o}function Zo(r,e,i,o){if(!Ln(e,r.length))return NaN;for(let h=e[0];h<=e[1];++h)if(Vo(r[h],i,!0))return 0;let s=1/0;for(let h=e[0];h<e[1];++h){const p=r[h],m=r[h+1];for(const x of i)for(let w=0,E=x.length,P=E-1;w<E;P=w++){const D=x[P],B=x[w];if(wa(p,m,D,B))return 0;s=Math.min(s,Kn(p,m,D,B,o))}}return s}function Xa(r,e){for(const i of r)for(const o of i)if(Vo(o,e,!0))return!0;return!1}function rl(r,e,i,o=1/0){const s=Ca(r),h=Ca(e);if(o!==1/0&&sn(s,h,i)>=o)return o;if($o(s,h)){if(Xa(r,e))return 0}else if(Xa(e,r))return 0;let p=1/0;for(const m of r)for(let x=0,w=m.length,E=w-1;x<w;E=x++){const P=m[E],D=m[x];for(const B of e)for(let N=0,q=B.length,H=q-1;N<q;H=N++){const Q=B[H],ge=B[N];if(wa(P,D,Q,ge))return 0;p=Math.min(p,Kn(P,D,Q,ge,i))}}return p}function il(r,e,i,o,s,h){if(!h)return;const p=sn(Ha(o,h),s,i);p<e&&r.push([p,h,[0,0]])}function Ja(r,e,i,o,s,h,p){if(!h||!p)return;const m=sn(Ha(o,h),Ha(s,p),i);m<e&&r.push([m,h,p])}function Ea(r,e,i,o,s=1/0){let h=Math.min(o.distance(r[0],i[0][0]),s);if(h===0)return h;const p=new Is([[0,[0,r.length-1],[0,0]]],tl),m=Ca(i);for(;p.length>0;){const x=p.pop();if(x[0]>=h)continue;const w=x[1],E=e?50:100;if(Go(w)<=E){if(!Ln(w,r.length))return NaN;if(e){const P=Zo(r,w,i,o);if(isNaN(P)||P===0)return P;h=Math.min(h,P)}else for(let P=w[0];P<=w[1];++P){const D=go(r[P],i,o);if(h=Math.min(h,D),h===0)return 0}}else{const P=Ps(w,e);il(p,h,o,r,m,P[0]),il(p,h,o,r,m,P[1])}}return h}function Wo(r,e,i,o,s,h=1/0){let p=Math.min(h,s.distance(r[0],i[0]));if(p===0)return p;const m=new Is([[0,[0,r.length-1],[0,i.length-1]]],tl);for(;m.length>0;){const x=m.pop();if(x[0]>=p)continue;const w=x[1],E=x[2],P=e?50:100,D=o?50:100;if(Go(w)<=P&&Go(E)<=D){if(!Ln(w,r.length)&&Ln(E,i.length))return NaN;let B;if(e&&o)B=er(r,w,i,E,s),p=Math.min(p,B);else if(e&&!o){const N=r.slice(w[0],w[1]+1);for(let q=E[0];q<=E[1];++q)if(B=St(i[q],N,s),p=Math.min(p,B),p===0)return p}else if(!e&&o){const N=i.slice(E[0],E[1]+1);for(let q=w[0];q<=w[1];++q)if(B=St(r[q],N,s),p=Math.min(p,B),p===0)return p}else B=yr(r,w,i,E,s),p=Math.min(p,B)}else{const B=Ps(w,e),N=Ps(E,o);Ja(m,p,s,r,i,B[0],N[0]),Ja(m,p,s,r,i,B[0],N[1]),Ja(m,p,s,r,i,B[1],N[0]),Ja(m,p,s,r,i,B[1],N[1])}}return p}function yo(r){return r.type==="MultiPolygon"?r.coordinates.map(e=>({type:"Polygon",coordinates:e})):r.type==="MultiLineString"?r.coordinates.map(e=>({type:"LineString",coordinates:e})):r.type==="MultiPoint"?r.coordinates.map(e=>({type:"Point",coordinates:e})):[r]}class Ri{constructor(e,i){this.type=Le,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(gi(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new Ri(o,o.features.map(s=>yo(s.geometry)).flat());if(o.type==="Feature")return new Ri(o,yo(o.geometry));if("type"in o&&"coordinates"in o)return new Ri(o,yo(o))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){const s=i.geometry(),h=s.flat().map(x=>ws([x.x,x.y],i.canonical));if(s.length===0)return NaN;const p=new As(h[0][1]);let m=1/0;for(const x of o){switch(x.type){case"Point":m=Math.min(m,Wo(h,!1,[x.coordinates],!1,p,m));break;case"LineString":m=Math.min(m,Wo(h,!1,x.coordinates,!0,p,m));break;case"Polygon":m=Math.min(m,Ea(h,!1,x.coordinates,p,m))}if(m===0)return m}return m}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){const s=i.geometry(),h=s.flat().map(x=>ws([x.x,x.y],i.canonical));if(s.length===0)return NaN;const p=new As(h[0][1]);let m=1/0;for(const x of o){switch(x.type){case"Point":m=Math.min(m,Wo(h,!0,[x.coordinates],!1,p,m));break;case"LineString":m=Math.min(m,Wo(h,!0,x.coordinates,!0,p,m));break;case"Polygon":m=Math.min(m,Ea(h,!0,x.coordinates,p,m))}if(m===0)return m}return m}(e,this.geometries);if(e.geometryType()==="Polygon")return function(i,o){const s=i.geometry();if(s.length===0||s[0].length===0)return NaN;const h=Uo(s,0).map(x=>x.map(w=>w.map(E=>ws([E.x,E.y],i.canonical)))),p=new As(h[0][0][0][1]);let m=1/0;for(const x of o)for(const w of h){switch(x.type){case"Point":m=Math.min(m,Ea([x.coordinates],!1,w,p,m));break;case"LineString":m=Math.min(m,Ea(x.coordinates,!0,w,p,m));break;case"Polygon":m=Math.min(m,rl(w,x.coordinates,p,m))}if(m===0)return m}return m}(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const _o={"==":bs,"!=":Js,">":Ks,"<":fr,">=":Fn,"<=":Gl,array:Xi,at:y,boolean:Xi,case:ne,coalesce:ct,collator:_a,format:xa,image:va,in:S,"index-of":O,interpolate:Wt,"interpolate-hcl":Wt,"interpolate-lab":Wt,length:No,let:$a,literal:po,match:K,number:Xi,"number-format":Va,object:Xi,slice:ae,step:ze,string:Xi,"to-boolean":on,"to-color":on,"to-number":on,"to-string":on,var:Dn,within:Jn,distance:Ri};class Lr{constructor(e,i,o,s){this.name=e,this.type=i,this._evaluate=o,this.args=s}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,i){const o=e[0],s=Lr.definitions[o];if(!s)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(s)?s[0]:s.type,p=Array.isArray(s)?[[s[1],s[2]]]:s.overloads,m=p.filter(([w])=>!Array.isArray(w)||w.length===e.length-1);let x=null;for(const[w,E]of m){x=new Zt(i.registry,vo,i.path,null,i.scope);const P=[];let D=!1;for(let B=1;B<e.length;B++){const N=e[B],q=Array.isArray(w)?w[B-1]:w.type,H=x.parse(N,1+P.length,q);if(!H){D=!0;break}P.push(H)}if(!D)if(Array.isArray(w)&&w.length!==P.length)x.error(`Expected ${w.length} arguments, but found ${P.length} instead.`);else{for(let B=0;B<P.length;B++){const N=Array.isArray(w)?w[B]:w.type,q=P[B];x.concat(B+1).checkSubtype(N,q.type)}if(x.errors.length===0)return new Lr(o,h,E,P)}}if(m.length===1)i.errors.push(...x.errors);else{const w=(m.length?m:p).map(([P])=>{return D=P,Array.isArray(D)?`(${D.map($).join(", ")})`:`(${$(D.type)}...)`;var D}).join(" | "),E=[];for(let P=1;P<e.length;P++){const D=i.parse(e[P],1+E.length);if(!D)return null;E.push($(D.type))}i.error(`Expected arguments of type ${w}, but found (${E.join(", ")}) instead.`)}return null}static register(e,i){Lr.definitions=i;for(const o in i)e[o]=Lr}}function nl(r,[e,i,o,s]){e=e.evaluate(r),i=i.evaluate(r),o=o.evaluate(r);const h=s?s.evaluate(r):1,p=ya(e,i,o,h);if(p)throw new Pr(p);return new Vt(e/255,i/255,o/255,h,!1)}function Yn(r,e){return r in e}function Ka(r,e){const i=e[r];return i===void 0?null:i}function xo(r){return{type:r}}function vo(r){if(r instanceof Dn)return vo(r.boundExpression);if(r instanceof Lr&&r.name==="error"||r instanceof _a||r instanceof Jn||r instanceof Ri)return!1;const e=r instanceof on||r instanceof Xi;let i=!0;return r.eachChild(o=>{i=e?i&&vo(o):i&&o instanceof po}),!!i&&Ho(r)&&Aa(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ho(r){if(r instanceof Lr&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Jn||r instanceof Ri)return!1;let e=!0;return r.eachChild(i=>{e&&!Ho(i)&&(e=!1)}),e}function Xo(r){if(r instanceof Lr&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(i=>{e&&!Xo(i)&&(e=!1)}),e}function Aa(r,e){if(r instanceof Lr&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild(o=>{i&&!Aa(o,e)&&(i=!1)}),i}function Ya(r){return{result:"success",value:r}}function ln(r){return{result:"error",value:r}}function wn(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function ol(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function me(r){return!!r.expression&&r.expression.interpolated}function xe(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Ve(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function ft(r){return r}function ir(r,e){const i=e.type==="color",o=r.stops&&typeof r.stops[0][0]=="object",s=o||!(o||r.property!==void 0),h=r.type||(me(e)?"exponential":"interval");if(i||e.type==="padding"){const E=i?Vt.parse:mi.parse;(r=ci({},r)).stops&&(r.stops=r.stops.map(P=>[P[0],E(P[1])])),r.default=E(r.default?r.default:e.default)}if(r.colorSpace&&(p=r.colorSpace)!=="rgb"&&p!=="hcl"&&p!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var p;let m,x,w;if(h==="exponential")m=Oi;else if(h==="interval")m=Br;else if(h==="categorical"){m=wr,x=Object.create(null);for(const E of r.stops)x[E[0]]=E[1];w=typeof r.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);m=Mr}if(o){const E={},P=[];for(let N=0;N<r.stops.length;N++){const q=r.stops[N],H=q[0].zoom;E[H]===void 0&&(E[H]={zoom:H,type:r.type,property:r.property,default:r.default,stops:[]},P.push(H)),E[H].stops.push([q[0].value,q[1]])}const D=[];for(const N of P)D.push([E[N].zoom,ir(E[N],e)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:Wt.interpolationFactor.bind(void 0,B),zoomStops:D.map(N=>N[0]),evaluate:({zoom:N},q)=>Oi({stops:D,base:r.base},e,N).evaluate(N,q)}}if(s){const E=h==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Wt.interpolationFactor.bind(void 0,E),zoomStops:r.stops.map(P=>P[0]),evaluate:({zoom:P})=>m(r,e,P,x,w)}}return{kind:"source",evaluate(E,P){const D=P&&P.properties?P.properties[r.property]:void 0;return D===void 0?Lt(r.default,e.default):m(r,e,D,x,w)}}}function Lt(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function wr(r,e,i,o,s){return Lt(typeof i===s?o[i]:void 0,r.default,e.default)}function Br(r,e,i){if(xe(i)!=="number")return Lt(r.default,e.default);const o=r.stops.length;if(o===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[o-1][0])return r.stops[o-1][1];const s=fe(r.stops.map(h=>h[0]),i);return r.stops[s][1]}function Oi(r,e,i){const o=r.base!==void 0?r.base:1;if(xe(i)!=="number")return Lt(r.default,e.default);const s=r.stops.length;if(s===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[s-1][0])return r.stops[s-1][1];const h=fe(r.stops.map(E=>E[0]),i),p=function(E,P,D,B){const N=B-D,q=E-D;return N===0?0:P===1?q/N:(Math.pow(P,q)-1)/(Math.pow(P,N)-1)}(i,o,r.stops[h][0],r.stops[h+1][0]),m=r.stops[h][1],x=r.stops[h+1][1],w=gt[e.type]||ft;return typeof m.evaluate=="function"?{evaluate(...E){const P=m.evaluate.apply(void 0,E),D=x.evaluate.apply(void 0,E);if(P!==void 0&&D!==void 0)return w(P,D,p,r.colorSpace)}}:w(m,x,p,r.colorSpace)}function Mr(r,e,i){switch(e.type){case"color":i=Vt.parse(i);break;case"formatted":i=Yt.fromString(i.toString());break;case"resolvedImage":i=Fr.fromString(i.toString());break;case"padding":i=mi.parse(i);break;default:xe(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0)}return Lt(i,r.default,e.default)}Lr.register(_o,{error:[{kind:"error"},[kt],(r,[e])=>{throw new Pr(e.evaluate(r))}],typeof:[kt,[Ct],(r,[e])=>$(dr(e.evaluate(r)))],"to-rgba":[L(Le,4),[Nr],(r,[e])=>{const[i,o,s,h]=e.evaluate(r).rgb;return[255*i,255*o,255*s,h]}],rgb:[Nr,[Le,Le,Le],nl],rgba:[Nr,[Le,Le,Le,Le],nl],has:{type:It,overloads:[[[kt],(r,[e])=>Yn(e.evaluate(r),r.properties())],[[kt,fi],(r,[e,i])=>Yn(e.evaluate(r),i.evaluate(r))]]},get:{type:Ct,overloads:[[[kt],(r,[e])=>Ka(e.evaluate(r),r.properties())],[[kt,fi],(r,[e,i])=>Ka(e.evaluate(r),i.evaluate(r))]]},"feature-state":[Ct,[kt],(r,[e])=>Ka(e.evaluate(r),r.featureState||{})],properties:[fi,[],r=>r.properties()],"geometry-type":[kt,[],r=>r.geometryType()],id:[Ct,[],r=>r.id()],zoom:[Le,[],r=>r.globals.zoom],"heatmap-density":[Le,[],r=>r.globals.heatmapDensity||0],"line-progress":[Le,[],r=>r.globals.lineProgress||0],accumulated:[Ct,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Le,xo(Le),(r,e)=>{let i=0;for(const o of e)i+=o.evaluate(r);return i}],"*":[Le,xo(Le),(r,e)=>{let i=1;for(const o of e)i*=o.evaluate(r);return i}],"-":{type:Le,overloads:[[[Le,Le],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[Le],(r,[e])=>-e.evaluate(r)]]},"/":[Le,[Le,Le],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[Le,[Le,Le],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[Le,[],()=>Math.LN2],pi:[Le,[],()=>Math.PI],e:[Le,[],()=>Math.E],"^":[Le,[Le,Le],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[Le,[Le],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[Le,[Le],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[Le,[Le],(r,[e])=>Math.log(e.evaluate(r))],log2:[Le,[Le],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[Le,[Le],(r,[e])=>Math.sin(e.evaluate(r))],cos:[Le,[Le],(r,[e])=>Math.cos(e.evaluate(r))],tan:[Le,[Le],(r,[e])=>Math.tan(e.evaluate(r))],asin:[Le,[Le],(r,[e])=>Math.asin(e.evaluate(r))],acos:[Le,[Le],(r,[e])=>Math.acos(e.evaluate(r))],atan:[Le,[Le],(r,[e])=>Math.atan(e.evaluate(r))],min:[Le,xo(Le),(r,e)=>Math.min(...e.map(i=>i.evaluate(r)))],max:[Le,xo(Le),(r,e)=>Math.max(...e.map(i=>i.evaluate(r)))],abs:[Le,[Le],(r,[e])=>Math.abs(e.evaluate(r))],round:[Le,[Le],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[Le,[Le],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[Le,[Le],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[It,[kt,Ct],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[It,[Ct],(r,[e])=>r.id()===e.value],"filter-type-==":[It,[kt],(r,[e])=>r.geometryType()===e.value],"filter-<":[It,[kt,Ct],(r,[e,i])=>{const o=r.properties()[e.value],s=i.value;return typeof o==typeof s&&o<s}],"filter-id-<":[It,[Ct],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[It,[kt,Ct],(r,[e,i])=>{const o=r.properties()[e.value],s=i.value;return typeof o==typeof s&&o>s}],"filter-id->":[It,[Ct],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[It,[kt,Ct],(r,[e,i])=>{const o=r.properties()[e.value],s=i.value;return typeof o==typeof s&&o<=s}],"filter-id-<=":[It,[Ct],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[It,[kt,Ct],(r,[e,i])=>{const o=r.properties()[e.value],s=i.value;return typeof o==typeof s&&o>=s}],"filter-id->=":[It,[Ct],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[It,[Ct],(r,[e])=>e.value in r.properties()],"filter-has-id":[It,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[It,[L(kt)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[It,[L(Ct)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[It,[kt,L(Ct)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[It,[kt,L(Ct)],(r,[e,i])=>function(o,s,h,p){for(;h<=p;){const m=h+p>>1;if(s[m]===o)return!0;s[m]>o?p=m-1:h=m+1}return!1}(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:It,overloads:[[[It,It],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[xo(It),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:It,overloads:[[[It,It],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[xo(It),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[It,[It],(r,[e])=>!e.evaluate(r)],"is-supported-script":[It,[kt],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[kt,[kt],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[kt,[kt],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[kt,xo(Ct),(r,e)=>e.map(i=>Ro(i.evaluate(r))).join("")],"resolved-locale":[kt,[wi],(r,[e])=>e.evaluate(r).resolvedLocale()]});class Rr{constructor(e,i){var o;this.expression=e,this._warningHistory={},this._evaluator=new jo,this._defaultValue=i?(o=i).type==="color"&&Ve(o.default)?new Vt(0,0,0,0):o.type==="color"?Vt.parse(o.default)||null:o.type==="padding"?mi.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?Dr.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,o,s,h,p){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=s,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,s,h,p){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=s,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p||null;try{const m=this.expression.evaluate(this._evaluator);if(m==null||typeof m=="number"&&m!=m)return this._defaultValue;if(this._enumValues&&!(m in this._enumValues))throw new Pr(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(m)} instead.`);return m}catch(m){return this._warningHistory[m.message]||(this._warningHistory[m.message]=!0,typeof console<"u"&&console.warn(m.message)),this._defaultValue}}}function ji(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in _o}function Ji(r,e){const i=new Zt(_o,vo,[],e?function(s){const h={color:Nr,string:kt,number:Le,enum:kt,boolean:It,formatted:bn,padding:zr,resolvedImage:Z,variableAnchorOffsetCollection:F};return s.type==="array"?L(h[s.value]||Ct,s.length):h[s.type]}(e):void 0),o=i.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?Ya(new Rr(o,e)):ln(i.errors)}class ii{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!Xo(i.expression)}evaluateWithoutErrorHandling(e,i,o,s,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,s,h,p)}evaluate(e,i,o,s,h,p){return this._styleExpression.evaluate(e,i,o,s,h,p)}}class cn{constructor(e,i,o,s){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Xo(i.expression),this.interpolationType=s}evaluateWithoutErrorHandling(e,i,o,s,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,s,h,p)}evaluate(e,i,o,s,h,p){return this._styleExpression.evaluate(e,i,o,s,h,p)}interpolationFactor(e,i,o){return this.interpolationType?Wt.interpolationFactor(this.interpolationType,e,i,o):0}}function Sn(r,e){const i=Ji(r,e);if(i.result==="error")return i;const o=i.value.expression,s=Ho(o);if(!s&&!wn(e))return ln([new Jr("","data expressions not supported")]);const h=Aa(o,["zoom"]);if(!h&&!ol(e))return ln([new Jr("","zoom expressions not supported")]);const p=Or(o);return p||h?p instanceof Jr?ln([p]):p instanceof Wt&&!me(e)?ln([new Jr("",'"interpolate" expressions cannot be used with this property')]):Ya(p?new cn(s?"camera":"composite",i.value,p.labels,p instanceof Wt?p.interpolation:void 0):new ii(s?"constant":"source",i.value)):ln([new Jr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Tn{constructor(e,i){this._parameters=e,this._specification=i,ci(this,ir(this._parameters,this._specification))}static deserialize(e){return new Tn(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Or(r){let e=null;if(r instanceof $a)e=Or(r.result);else if(r instanceof ct){for(const i of r.args)if(e=Or(i),e)break}else(r instanceof ze||r instanceof Wt)&&r.input instanceof Lr&&r.input.name==="zoom"&&(e=r);return e instanceof Jr||r.eachChild(i=>{const o=Or(i);o instanceof Jr?e=o:!e&&o?e=new Jr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new Jr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function un(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!un(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Ms={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ks(r){if(r==null)return{filter:()=>!0,needGeometry:!1};un(r)||(r=Ut(r));const e=Ji(r,Ms);if(e.result==="error")throw new Error(e.value.map(i=>`${i.key}: ${i.message}`).join(", "));return{filter:(i,o,s)=>e.value.evaluate(i,o,{},s),needGeometry:Xt(r)}}function Xl(r,e){return r<e?-1:r>e?1:0}function Xt(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(Xt(r[e]))return!0;return!1}function Ut(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Qn(r[1],r[2],"=="):e==="!="?yi(Qn(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Qn(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(Ut))):e==="all"?["all"].concat(r.slice(1).map(Ut)):e==="none"?["all"].concat(r.slice(1).map(Ut).map(yi)):e==="in"?Bn(r[1],r.slice(2)):e==="!in"?yi(Bn(r[1],r.slice(2))):e==="has"?Jo(r[1]):e!=="!has"||yi(Jo(r[1]));var i}function Qn(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function Bn(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",r,["literal",e.sort(Xl)]]:["filter-in-small",r,["literal",e]]}}function Jo(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function yi(r){return["!",r]}function _i(r){const e=typeof r;if(e==="number"||e==="boolean"||e==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let s="[";for(const h of r)s+=`${_i(h)},`;return`${s}]`}const i=Object.keys(r).sort();let o="{";for(let s=0;s<i.length;s++)o+=`${JSON.stringify(i[s])}:${_i(r[i[s]])},`;return`${o}}`}function eo(r){let e="";for(const i of Pn)e+=`/${_i(r[i])}`;return e}function to(r){const e=r.value;return e?[new Re(r.key,e,"constants have been deprecated as of v8")]:[]}function mr(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Ci(r){if(Array.isArray(r))return r.map(Ci);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=Ci(r[i]);return e}return mr(r)}function Wr(r){const e=r.key,i=r.value,o=r.valueSpec||{},s=r.objectElementValidators||{},h=r.style,p=r.styleSpec,m=r.validateSpec;let x=[];const w=xe(i);if(w!=="object")return[new Re(e,i,`object expected, ${w} found`)];for(const E in i){const P=E.split(".")[0],D=o[P]||o["*"];let B;if(s[P])B=s[P];else if(o[P])B=m;else if(s["*"])B=s["*"];else{if(!o["*"]){x.push(new Re(e,i[E],`unknown property "${E}"`));continue}B=m}x=x.concat(B({key:(e&&`${e}.`)+E,value:i[E],valueSpec:D,style:h,styleSpec:p,object:i,objectKey:E,validateSpec:m},i))}for(const E in o)s[E]||o[E].required&&o[E].default===void 0&&i[E]===void 0&&x.push(new Re(e,i,`missing required property "${E}"`));return x}function Pa(r){const e=r.value,i=r.valueSpec,o=r.style,s=r.styleSpec,h=r.key,p=r.arrayElementValidator||r.validateSpec;if(xe(e)!=="array")return[new Re(h,e,`array expected, ${xe(e)} found`)];if(i.length&&e.length!==i.length)return[new Re(h,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new Re(h,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let m={type:i.value,values:i.values};s.$version<7&&(m.function=i.function),xe(i.value)==="object"&&(m=i.value);let x=[];for(let w=0;w<e.length;w++)x=x.concat(p({array:e,arrayIndex:w,value:e[w],valueSpec:m,validateSpec:r.validateSpec,style:o,styleSpec:s,key:`${h}[${w}]`}));return x}function Ko(r){const e=r.key,i=r.value,o=r.valueSpec;let s=xe(i);return s==="number"&&i!=i&&(s="NaN"),s!=="number"?[new Re(e,i,`number expected, ${s} found`)]:"minimum"in o&&i<o.minimum?[new Re(e,i,`${i} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&i>o.maximum?[new Re(e,i,`${i} is greater than the maximum value ${o.maximum}`)]:[]}function Yo(r){const e=r.valueSpec,i=mr(r.value.type);let o,s,h,p={};const m=i!=="categorical"&&r.value.property===void 0,x=!m,w=xe(r.value.stops)==="array"&&xe(r.value.stops[0])==="array"&&xe(r.value.stops[0][0])==="object",E=Wr({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(B){if(i==="identity")return[new Re(B.key,B.value,'identity function may not have a "stops" property')];let N=[];const q=B.value;return N=N.concat(Pa({key:B.key,value:q,valueSpec:B.valueSpec,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:P})),xe(q)==="array"&&q.length===0&&N.push(new Re(B.key,q,"array must have at least one stop")),N},default:function(B){return B.validateSpec({key:B.key,value:B.value,valueSpec:e,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec})}}});return i==="identity"&&m&&E.push(new Re(r.key,r.value,'missing required property "property"')),i==="identity"||r.value.stops||E.push(new Re(r.key,r.value,'missing required property "stops"')),i==="exponential"&&r.valueSpec.expression&&!me(r.valueSpec)&&E.push(new Re(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(x&&!wn(r.valueSpec)?E.push(new Re(r.key,r.value,"property functions not supported")):m&&!ol(r.valueSpec)&&E.push(new Re(r.key,r.value,"zoom functions not supported"))),i!=="categorical"&&!w||r.value.property!==void 0||E.push(new Re(r.key,r.value,'"property" property is required')),E;function P(B){let N=[];const q=B.value,H=B.key;if(xe(q)!=="array")return[new Re(H,q,`array expected, ${xe(q)} found`)];if(q.length!==2)return[new Re(H,q,`array length 2 expected, length ${q.length} found`)];if(w){if(xe(q[0])!=="object")return[new Re(H,q,`object expected, ${xe(q[0])} found`)];if(q[0].zoom===void 0)return[new Re(H,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new Re(H,q,"object stop key must have value")];if(h&&h>mr(q[0].zoom))return[new Re(H,q[0].zoom,"stop zoom values must appear in ascending order")];mr(q[0].zoom)!==h&&(h=mr(q[0].zoom),s=void 0,p={}),N=N.concat(Wr({key:`${H}[0]`,value:q[0],valueSpec:{zoom:{}},validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:Ko,value:D}}))}else N=N.concat(D({key:`${H}[0]`,value:q[0],valueSpec:{},validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec},q));return ji(Ci(q[1]))?N.concat([new Re(`${H}[1]`,q[1],"expressions are not allowed in function stops.")]):N.concat(B.validateSpec({key:`${H}[1]`,value:q[1],valueSpec:e,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec}))}function D(B,N){const q=xe(B.value),H=mr(B.value),Q=B.value!==null?B.value:N;if(o){if(q!==o)return[new Re(B.key,Q,`${q} stop domain type must match previous stop domain type ${o}`)]}else o=q;if(q!=="number"&&q!=="string"&&q!=="boolean")return[new Re(B.key,Q,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&i!=="categorical"){let ge=`number expected, ${q} found`;return wn(e)&&i===void 0&&(ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Re(B.key,Q,ge)]}return i!=="categorical"||q!=="number"||isFinite(H)&&Math.floor(H)===H?i!=="categorical"&&q==="number"&&s!==void 0&&H<s?[new Re(B.key,Q,"stop domain values must appear in ascending order")]:(s=H,i==="categorical"&&H in p?[new Re(B.key,Q,"stop domain values must be unique")]:(p[H]=!0,[])):[new Re(B.key,Q,`integer expected, found ${H}`)]}}function Ki(r){const e=(r.expressionContext==="property"?Sn:Ji)(Ci(r.value),r.valueSpec);if(e.result==="error")return e.value.map(o=>new Re(`${r.key}${o.key}`,r.value,o.message));const i=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!i.outputDefined())return[new Re(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Xo(i))return[new Re(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Xo(i))return[new Re(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Aa(i,["zoom","feature-state"]))return[new Re(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Ho(i))return[new Re(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Rn(r){const e=r.key,i=r.value,o=r.valueSpec,s=[];return Array.isArray(o.values)?o.values.indexOf(mr(i))===-1&&s.push(new Re(e,i,`expected one of [${o.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(o.values).indexOf(mr(i))===-1&&s.push(new Re(e,i,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(i)} found`)),s}function Ma(r){return un(Ci(r.value))?Ki(ci({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Qo(r)}function Qo(r){const e=r.value,i=r.key;if(xe(e)!=="array")return[new Re(i,e,`array expected, ${xe(e)} found`)];const o=r.styleSpec;let s,h=[];if(e.length<1)return[new Re(i,e,"filter array must have at least 1 element")];switch(h=h.concat(Rn({key:`${i}[0]`,value:e[0],valueSpec:o.filter_operator,style:r.style,styleSpec:r.styleSpec})),mr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&mr(e[1])==="$type"&&h.push(new Re(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new Re(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(s=xe(e[1]),s!=="string"&&h.push(new Re(`${i}[1]`,e[1],`string expected, ${s} found`)));for(let p=2;p<e.length;p++)s=xe(e[p]),mr(e[1])==="$type"?h=h.concat(Rn({key:`${i}[${p}]`,value:e[p],valueSpec:o.geometry_type,style:r.style,styleSpec:r.styleSpec})):s!=="string"&&s!=="number"&&s!=="boolean"&&h.push(new Re(`${i}[${p}]`,e[p],`string, number, or boolean expected, ${s} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)h=h.concat(Qo({key:`${i}[${p}]`,value:e[p],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":s=xe(e[1]),e.length!==2?h.push(new Re(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):s!=="string"&&h.push(new Re(`${i}[1]`,e[1],`string expected, ${s} found`))}return h}function ea(r,e){const i=r.key,o=r.validateSpec,s=r.style,h=r.styleSpec,p=r.value,m=r.objectKey,x=h[`${e}_${r.layerType}`];if(!x)return[];const w=m.match(/^(.*)-transition$/);if(e==="paint"&&w&&x[w[1]]&&x[w[1]].transition)return o({key:i,value:p,valueSpec:h.transition,style:s,styleSpec:h});const E=r.valueSpec||x[m];if(!E)return[new Re(i,p,`unknown property "${m}"`)];let P;if(xe(p)==="string"&&wn(E)&&!E.tokens&&(P=/^{([^}]+)}$/.exec(p)))return[new Re(i,p,`"${m}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const D=[];return r.layerType==="symbol"&&(m==="text-field"&&s&&!s.glyphs&&D.push(new Re(i,p,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&Ve(Ci(p))&&mr(p.type)==="identity"&&D.push(new Re(i,p,'"text-font" does not support identity functions'))),D.concat(o({key:r.key,value:p,valueSpec:E,style:s,styleSpec:h,expressionContext:"property",propertyType:e,propertyKey:m}))}function al(r){return ea(r,"paint")}function Jl(r){return ea(r,"layout")}function Zc(r){let e=[];const i=r.value,o=r.key,s=r.style,h=r.styleSpec;i.type||i.ref||e.push(new Re(o,i,'either "type" or "ref" is required'));let p=mr(i.type);const m=mr(i.ref);if(i.id){const x=mr(i.id);for(let w=0;w<r.arrayIndex;w++){const E=s.layers[w];mr(E.id)===x&&e.push(new Re(o,i.id,`duplicate layer id "${i.id}", previously used at line ${E.id.__line__}`))}}if("ref"in i){let x;["type","source","source-layer","filter","layout"].forEach(w=>{w in i&&e.push(new Re(o,i[w],`"${w}" is prohibited for ref layers`))}),s.layers.forEach(w=>{mr(w.id)===m&&(x=w)}),x?x.ref?e.push(new Re(o,i.ref,"ref cannot reference another ref layer")):p=mr(x.type):e.push(new Re(o,i.ref,`ref layer "${m}" not found`))}else if(p!=="background")if(i.source){const x=s.sources&&s.sources[i.source],w=x&&mr(x.type);x?w==="vector"&&p==="raster"?e.push(new Re(o,i.source,`layer "${i.id}" requires a raster source`)):w!=="raster-dem"&&p==="hillshade"?e.push(new Re(o,i.source,`layer "${i.id}" requires a raster-dem source`)):w==="raster"&&p!=="raster"?e.push(new Re(o,i.source,`layer "${i.id}" requires a vector source`)):w!=="vector"||i["source-layer"]?w==="raster-dem"&&p!=="hillshade"?e.push(new Re(o,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!i.paint||!i.paint["line-gradient"]||w==="geojson"&&x.lineMetrics||e.push(new Re(o,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Re(o,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new Re(o,i.source,`source "${i.source}" not found`))}else e.push(new Re(o,i,'missing required property "source"'));return e=e.concat(Wr({key:o,value:i,valueSpec:h.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${o}.type`,value:i.type,valueSpec:h.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:i,objectKey:"type"}),filter:Ma,layout:x=>Wr({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":w=>Jl(ci({layerType:p},w))}}),paint:x=>Wr({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":w=>al(ci({layerType:p},w))}})}})),e}function ta(r){const e=r.value,i=r.key,o=xe(e);return o!=="string"?[new Re(i,e,`string expected, ${o} found`)]:[]}const Wc={promoteId:function({key:r,value:e}){if(xe(e)==="string")return ta({key:r,value:e});{const i=[];for(const o in e)i.push(...ta({key:`${r}.${o}`,value:e[o]}));return i}}};function Kl(r){const e=r.value,i=r.key,o=r.styleSpec,s=r.style,h=r.validateSpec;if(!e.type)return[new Re(i,e,'"type" is required')];const p=mr(e.type);let m;switch(p){case"vector":case"raster":return m=Wr({key:i,value:e,valueSpec:o[`source_${p.replace("-","_")}`],style:r.style,styleSpec:o,objectElementValidators:Wc,validateSpec:h}),m;case"raster-dem":return m=function(x){var w;const E=(w=x.sourceName)!==null&&w!==void 0?w:"",P=x.value,D=x.styleSpec,B=D.source_raster_dem,N=x.style;let q=[];const H=xe(P);if(P===void 0)return q;if(H!=="object")return q.push(new Re("source_raster_dem",P,`object expected, ${H} found`)),q;const Q=mr(P.encoding)==="custom",ge=["redFactor","greenFactor","blueFactor","baseShift"],re=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const de in P)!Q&&ge.includes(de)?q.push(new Re(de,P[de],`In "${E}": "${de}" is only valid when "encoding" is set to "custom". ${re} encoding found`)):B[de]?q=q.concat(x.validateSpec({key:de,value:P[de],valueSpec:B[de],validateSpec:x.validateSpec,style:N,styleSpec:D})):q.push(new Re(de,P[de],`unknown property "${de}"`));return q}({sourceName:i,value:e,style:r.style,styleSpec:o,validateSpec:h}),m;case"geojson":if(m=Wr({key:i,value:e,valueSpec:o.source_geojson,style:s,styleSpec:o,validateSpec:h,objectElementValidators:Wc}),e.cluster)for(const x in e.clusterProperties){const[w,E]=e.clusterProperties[x],P=typeof w=="string"?[w,["accumulated"],["get",x]]:w;m.push(...Ki({key:`${i}.${x}.map`,value:E,validateSpec:h,expressionContext:"cluster-map"})),m.push(...Ki({key:`${i}.${x}.reduce`,value:P,validateSpec:h,expressionContext:"cluster-reduce"}))}return m;case"video":return Wr({key:i,value:e,valueSpec:o.source_video,style:s,validateSpec:h,styleSpec:o});case"image":return Wr({key:i,value:e,valueSpec:o.source_image,style:s,validateSpec:h,styleSpec:o});case"canvas":return[new Re(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Rn({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:s,validateSpec:h,styleSpec:o})}}function Yl(r){const e=r.value,i=r.styleSpec,o=i.light,s=r.style;let h=[];const p=xe(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new Re("light",e,`object expected, ${p} found`)]),h;for(const m in e){const x=m.match(/^(.*)-transition$/);h=h.concat(x&&o[x[1]]&&o[x[1]].transition?r.validateSpec({key:m,value:e[m],valueSpec:i.transition,validateSpec:r.validateSpec,style:s,styleSpec:i}):o[m]?r.validateSpec({key:m,value:e[m],valueSpec:o[m],validateSpec:r.validateSpec,style:s,styleSpec:i}):[new Re(m,e[m],`unknown property "${m}"`)])}return h}function Ql(r){const e=r.value,i=r.styleSpec,o=i.sky,s=r.style,h=xe(e);if(e===void 0)return[];if(h!=="object")return[new Re("sky",e,`object expected, ${h} found`)];let p=[];for(const m in e)p=p.concat(o[m]?r.validateSpec({key:m,value:e[m],valueSpec:o[m],style:s,styleSpec:i}):[new Re(m,e[m],`unknown property "${m}"`)]);return p}function Hc(r){const e=r.value,i=r.styleSpec,o=i.terrain,s=r.style;let h=[];const p=xe(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new Re("terrain",e,`object expected, ${p} found`)]),h;for(const m in e)h=h.concat(o[m]?r.validateSpec({key:m,value:e[m],valueSpec:o[m],validateSpec:r.validateSpec,style:s,styleSpec:i}):[new Re(m,e[m],`unknown property "${m}"`)]);return h}function Xc(r){let e=[];const i=r.value,o=r.key;if(Array.isArray(i)){const s=[],h=[];for(const p in i)i[p].id&&s.includes(i[p].id)&&e.push(new Re(o,i,`all the sprites' ids must be unique, but ${i[p].id} is duplicated`)),s.push(i[p].id),i[p].url&&h.includes(i[p].url)&&e.push(new Re(o,i,`all the sprites' URLs must be unique, but ${i[p].url} is duplicated`)),h.push(i[p].url),e=e.concat(Wr({key:`${o}[${p}]`,value:i[p],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return e}return ta({key:o,value:i})}const ec={"*":()=>[],array:Pa,boolean:function(r){const e=r.value,i=r.key,o=xe(e);return o!=="boolean"?[new Re(i,e,`boolean expected, ${o} found`)]:[]},number:Ko,color:function(r){const e=r.key,i=r.value,o=xe(i);return o!=="string"?[new Re(e,i,`color expected, ${o} found`)]:Vt.parse(String(i))?[]:[new Re(e,i,`color expected, "${i}" found`)]},constants:to,enum:Rn,filter:Ma,function:Yo,layer:Zc,object:Wr,source:Kl,light:Yl,sky:Ql,terrain:Hc,string:ta,formatted:function(r){return ta(r).length===0?[]:Ki(r)},resolvedImage:function(r){return ta(r).length===0?[]:Ki(r)},padding:function(r){const e=r.key,i=r.value;if(xe(i)==="array"){if(i.length<1||i.length>4)return[new Re(e,i,`padding requires 1 to 4 values; ${i.length} values found`)];const o={type:"number"};let s=[];for(let h=0;h<i.length;h++)s=s.concat(r.validateSpec({key:`${e}[${h}]`,value:i[h],validateSpec:r.validateSpec,valueSpec:o}));return s}return Ko({key:e,value:i,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const e=r.key,i=r.value,o=xe(i),s=r.styleSpec;if(o!=="array"||i.length<1||i.length%2!=0)return[new Re(e,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let h=[];for(let p=0;p<i.length;p+=2)h=h.concat(Rn({key:`${e}[${p}]`,value:i[p],valueSpec:s.layout_symbol["text-anchor"]})),h=h.concat(Pa({key:`${e}[${p+1}]`,value:i[p+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:s}));return h},sprite:Xc};function Qa(r){const e=r.value,i=r.valueSpec,o=r.styleSpec;return r.validateSpec=Qa,i.expression&&Ve(mr(e))?Yo(r):i.expression&&ji(Ci(e))?Ki(r):i.type&&ec[i.type]?ec[i.type](r):Wr(ci({},r,{valueSpec:i.type?o[i.type]:i}))}function tc(r){const e=r.value,i=r.key,o=ta(r);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Re(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Re(i,e,'"glyphs" url must include a "{range}" token'))),o}function In(r,e=be){let i=[];return i=i.concat(Qa({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,validateSpec:Qa,objectElementValidators:{glyphs:tc,"*":()=>[]}})),r.constants&&(i=i.concat(to({key:"constants",value:r.constants,style:r,styleSpec:e,validateSpec:Qa}))),Jc(i)}function hn(r){return function(e){return r({...e,validateSpec:Qa})}}function Jc(r){return[].concat(r).sort((e,i)=>e.line-i.line)}function Cn(r){return function(...e){return Jc(r.apply(this,e))}}In.source=Cn(hn(Kl)),In.sprite=Cn(hn(Xc)),In.glyphs=Cn(hn(tc)),In.light=Cn(hn(Yl)),In.sky=Cn(hn(Ql)),In.terrain=Cn(hn(Hc)),In.layer=Cn(hn(Zc)),In.filter=Cn(hn(Ma)),In.paintProperty=Cn(hn(al)),In.layoutProperty=Cn(hn(Jl));const zs=In,ph=zs.light,Kc=zs.paintProperty,Yc=zs.layoutProperty;function rc(r,e){let i=!1;if(e&&e.length)for(const o of e)r.fire(new vr(new Error(o.message))),i=!0;return i}class Ds{constructor(e,i,o){const s=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const p=new Int32Array(this.arrayBuffer);e=p[0],this.d=(i=p[1])+2*(o=p[2]);for(let x=0;x<this.d*this.d;x++){const w=p[3+x],E=p[3+x+1];s.push(w===E?null:p.subarray(w,E))}const m=p[3+s.length+1];this.keys=p.subarray(p[3+s.length],m),this.bboxes=p.subarray(m),this.insert=this._insertReadonly}else{this.d=i+2*o;for(let p=0;p<this.d*this.d;p++)s.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=e,this.padding=o,this.scale=i/e,this.uid=0;const h=o/i*e;this.min=-h,this.max=e+h}insert(e,i,o,s,h){this._forEachCell(i,o,s,h,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(s),this.bboxes.push(h)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,i,o,s,h,p){this.cells[h].push(p)}query(e,i,o,s,h){const p=this.min,m=this.max;if(e<=p&&i<=p&&m<=o&&m<=s&&!h)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(e,i,o,s,this._queryCell,x,{},h),x}}_queryCell(e,i,o,s,h,p,m,x){const w=this.cells[h];if(w!==null){const E=this.keys,P=this.bboxes;for(let D=0;D<w.length;D++){const B=w[D];if(m[B]===void 0){const N=4*B;(x?x(P[N+0],P[N+1],P[N+2],P[N+3]):e<=P[N+2]&&i<=P[N+3]&&o>=P[N+0]&&s>=P[N+1])?(m[B]=!0,p.push(E[B])):m[B]=!1}}}}_forEachCell(e,i,o,s,h,p,m,x){const w=this._convertToCellCoord(e),E=this._convertToCellCoord(i),P=this._convertToCellCoord(o),D=this._convertToCellCoord(s);for(let B=w;B<=P;B++)for(let N=E;N<=D;N++){const q=this.d*N+B;if((!x||x(this._convertFromCellCoord(B),this._convertFromCellCoord(N),this._convertFromCellCoord(B+1),this._convertFromCellCoord(N+1)))&&h.call(this,e,i,o,s,q,p,m,x))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,i=3+this.cells.length+1+1;let o=0;for(let p=0;p<this.cells.length;p++)o+=this.cells[p].length;const s=new Int32Array(i+o+this.keys.length+this.bboxes.length);s[0]=this.extent,s[1]=this.n,s[2]=this.padding;let h=i;for(let p=0;p<e.length;p++){const m=e[p];s[3+p]=h,s.set(m,h),h+=m.length}return s[3+e.length]=h,s.set(this.keys,h),h+=this.keys.length,s[3+e.length+1]=h,s.set(this.bboxes,h),h+=this.bboxes.length,s.buffer}static serialize(e,i){const o=e.toArrayBuffer();return i&&i.push(o),{buffer:o}}static deserialize(e){return new Ds(e.buffer)}}const ra={};function rt(r,e,i={}){if(ra[r])throw new Error(`${r} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),ra[r]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}rt("Object",Object),rt("TransferableGridIndex",Ds),rt("Color",Vt),rt("Error",Error),rt("AJAXError",nn),rt("ResolvedImage",Fr),rt("StylePropertyFunction",Tn),rt("StyleExpression",Rr,{omit:["_evaluator"]}),rt("ZoomDependentExpression",cn),rt("ZoomConstantExpression",ii),rt("CompoundExpression",Lr,{omit:["_evaluate"]});for(const r in _o)_o[r]._classRegistryKey||rt(`Expression_${r}`,_o[r]);function Qc(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Fs(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error)return r;if(Qc(r)||pi(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const i=r;return e&&e.push(i.buffer),i}if(r instanceof ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const o of r)i.push(Fs(o,e));return i}if(typeof r=="object"){const i=r.constructor,o=i._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${i.name}`);if(!ra[o])throw new Error(`${o} is not registered.`);const s=i.serialize?i.serialize(r,e):{};if(i.serialize){if(e&&s===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const h in r){if(!r.hasOwnProperty(h)||ra[o].omit.indexOf(h)>=0)continue;const p=r[h];s[h]=ra[o].shallow.indexOf(h)>=0?p:Fs(p,e)}r instanceof Error&&(s.message=r.message)}if(s.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(s.$name=o),s}throw new Error("can't serialize object of type "+typeof r)}function ro(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||Qc(r)||pi(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(ro);if(typeof r=="object"){const e=r.$name||"Object";if(!ra[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:i}=ra[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(r);const o=Object.create(i.prototype);for(const s of Object.keys(r)){if(s==="$name")continue;const h=r[s];o[s]=ra[e].shallow.indexOf(s)>=0?h:ro(h)}return o}throw new Error("can't deserialize object of type "+typeof r)}class eu{constructor(){this.first=!0}update(e,i){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const Ke={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function ic(r){for(const e of r)if(nc(e.charCodeAt(0)))return!0;return!1}function fh(r){for(const e of r)if(!tu(e.charCodeAt(0)))return!1;return!0}function tu(r){return!(Ke.Arabic(r)||Ke["Arabic Supplement"](r)||Ke["Arabic Extended-A"](r)||Ke["Arabic Presentation Forms-A"](r)||Ke["Arabic Presentation Forms-B"](r))}function nc(r){return!(r!==746&&r!==747&&(r<4352||!(Ke["Bopomofo Extended"](r)||Ke.Bopomofo(r)||Ke["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Ke["CJK Compatibility Ideographs"](r)||Ke["CJK Compatibility"](r)||Ke["CJK Radicals Supplement"](r)||Ke["CJK Strokes"](r)||!(!Ke["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Ke["CJK Unified Ideographs Extension A"](r)||Ke["CJK Unified Ideographs"](r)||Ke["Enclosed CJK Letters and Months"](r)||Ke["Hangul Compatibility Jamo"](r)||Ke["Hangul Jamo Extended-A"](r)||Ke["Hangul Jamo Extended-B"](r)||Ke["Hangul Jamo"](r)||Ke["Hangul Syllables"](r)||Ke.Hiragana(r)||Ke["Ideographic Description Characters"](r)||Ke.Kanbun(r)||Ke["Kangxi Radicals"](r)||Ke["Katakana Phonetic Extensions"](r)||Ke.Katakana(r)&&r!==12540||!(!Ke["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Ke["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Ke["Unified Canadian Aboriginal Syllabics"](r)||Ke["Unified Canadian Aboriginal Syllabics Extended"](r)||Ke["Vertical Forms"](r)||Ke["Yijing Hexagram Symbols"](r)||Ke["Yi Syllables"](r)||Ke["Yi Radicals"](r))))}function ru(r){return!(nc(r)||function(e){return!!(Ke["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ke["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ke["Letterlike Symbols"](e)||Ke["Number Forms"](e)||Ke["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ke["Control Pictures"](e)&&e!==9251||Ke["Optical Character Recognition"](e)||Ke["Enclosed Alphanumerics"](e)||Ke["Geometric Shapes"](e)||Ke["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ke["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ke["CJK Symbols and Punctuation"](e)||Ke.Katakana(e)||Ke["Private Use Area"](e)||Ke["CJK Compatibility Forms"](e)||Ke["Small Form Variants"](e)||Ke["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function ia(r){return r>=1424&&r<=2303||Ke["Arabic Presentation Forms-A"](r)||Ke["Arabic Presentation Forms-B"](r)}function iu(r,e){return!(!e&&ia(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Ke.Khmer(r))}function oc(r){for(const e of r)if(ia(e.charCodeAt(0)))return!0;return!1}const na=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class _r{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new eu,this.transition={})}isSupportedScript(e){return function(i,o){for(const s of i)if(!iu(s.charCodeAt(0),o))return!1;return!0}(e,na.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*i}}}class sl{constructor(e,i){this.property=e,this.value=i,this.expression=function(o,s){if(Ve(o))return new Tn(o,s);if(ji(o)){const h=Sn(o,s);if(h.result==="error")throw new Error(h.value.map(p=>`${p.key}: ${p.message}`).join(", "));return h.value}{let h=o;return s.type==="color"&&typeof o=="string"?h=Vt.parse(o):s.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?s.type==="variableAnchorOffsetCollection"&&Array.isArray(o)&&(h=Dr.parse(o)):h=mi.parse(o),{kind:"constant",evaluate:()=>h}}}(i===void 0?e.specification.default:i,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class es{constructor(e){this.property=e,this.value=new sl(e,void 0)}transitioned(e,i){return new nu(this.property,this.value,i,Ot({},e.transition,this.transition),e.now)}untransitioned(){return new nu(this.property,this.value,null,{},0)}}class ts{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Ft(this._values[e].value.value)}setValue(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new es(this._values[e].property)),this._values[e].value=new sl(this._values[e].property,i===null?void 0:Ft(i))}getTransition(e){return Ft(this._values[e].transition)}setTransition(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new es(this._values[e].property)),this._values[e].transition=Ft(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const s=this.getTransition(i);s!==void 0&&(e[`${i}-transition`]=s)}return e}transitioned(e,i){const o=new ac(this._properties);for(const s of Object.keys(this._values))o._values[s]=this._values[s].transitioned(e,i._values[s]);return o}untransitioned(){const e=new ac(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class nu{constructor(e,i,o,s,h){this.property=e,this.value=i,this.begin=h+s.delay||0,this.end=this.begin+s.duration||0,e.specification.transition&&(s.delay||s.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const s=e.now||0,h=this.value.possiblyEvaluate(e,i,o),p=this.prior;if(p){if(s>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(s<this.begin)return p.possiblyEvaluate(e,i,o);{const m=(s-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,i,o),h,function(x){if(x<=0)return 0;if(x>=1)return 1;const w=x*x,E=w*x;return 4*(x<.5?E:3*(x-w)+E-.75)}(m))}}return h}}class ac{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const s=new ll(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].possiblyEvaluate(e,i,o);return s}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ls{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Ft(this._values[e].value)}setValue(e,i){this._values[e]=new sl(this._values[e].property,i===null?void 0:Ft(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const s=new ll(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].possiblyEvaluate(e,i,o);return s}}class io{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,s){return this.property.evaluate(this.value,this.parameters,e,i,o,s)}}class ll{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ht{constructor(e){this.specification=e}possiblyEvaluate(e,i){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(i)}interpolate(e,i,o){const s=gt[this.specification.type];return s?s(e,i,o):e}}class _t{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,s){return new io(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,s)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new io(this,{kind:"constant",value:void 0},e.parameters);const s=gt[this.specification.type];if(s){const h=s(e.value.value,i.value.value,o);return new io(this,{kind:"constant",value:h},e.parameters)}return e}evaluate(e,i,o,s,h,p){return e.kind==="constant"?e.value:e.evaluate(i,o,s,h,p)}}class c extends _t{possiblyEvaluate(e,i,o,s){if(e.value===void 0)return new io(this,{kind:"constant",value:void 0},i);if(e.expression.kind==="constant"){const h=e.expression.evaluate(i,null,{},o,s),p=e.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,m=this._calculate(p,p,p,i);return new io(this,{kind:"constant",value:m},i)}if(e.expression.kind==="camera"){const h=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new io(this,{kind:"constant",value:h},i)}return new io(this,e.expression,i)}evaluate(e,i,o,s,h,p){if(e.kind==="source"){const m=e.evaluate(i,o,s,h,p);return this._calculate(m,m,m,i)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},o,s),e.evaluate({zoom:Math.floor(i.zoom)},o,s),e.evaluate({zoom:Math.floor(i.zoom)+1},o,s),i):e.value}_calculate(e,i,o,s){return s.zoom>s.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class t{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,s){if(e.value!==void 0){if(e.expression.kind==="constant"){const h=e.expression.evaluate(i,null,{},o,s);return this._calculate(h,h,h,i)}return this._calculate(e.expression.evaluate(new _r(Math.floor(i.zoom-1),i)),e.expression.evaluate(new _r(Math.floor(i.zoom),i)),e.expression.evaluate(new _r(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,o,s){return s.zoom>s.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class n{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,s){return!!e.expression.evaluate(i,null,{},o,s)}interpolate(){return!1}}class a{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in e){const o=e[i];o.specification.overridable&&this.overridableProperties.push(i);const s=this.defaultPropertyValues[i]=new sl(o,void 0),h=this.defaultTransitionablePropertyValues[i]=new es(o);this.defaultTransitioningPropertyValues[i]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=s.possiblyEvaluate({})}}}rt("DataDrivenProperty",_t),rt("DataConstantProperty",ht),rt("CrossFadedDataDrivenProperty",c),rt("CrossFadedProperty",t),rt("ColorRampProperty",n);const l="-transition";class d extends zo{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new Ls(i.layout)),i.paint)){this._transitionablePaint=new ts(i.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ll(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,o={}){i!=null&&this._validate(Yc,`layers.${this.id}.layout.${e}`,e,i,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return e.endsWith(l)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,o={}){if(i!=null&&this._validate(Kc,`layers.${this.id}.paint.${e}`,e,i,o))return!1;if(e.endsWith(l))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const s=this._transitionablePaint._values[e],h=s.property.specification["property-type"]==="cross-faded-data-driven",p=s.value.isDataDriven(),m=s.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value;return x.isDataDriven()||p||h||this._handleOverridablePaintPropertyUpdate(e,m,x)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),li(e,(i,o)=>!(i===void 0||o==="layout"&&!Object.keys(i).length||o==="paint"&&!Object.keys(i).length))}_validate(e,i,o,s,h={}){return(!h||h.validate!==!1)&&rc(this,e.call(zs,{key:i,layerType:this.type,objectKey:o,value:s,styleSpec:be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof io&&wn(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}const _={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class v{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class b{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function C(r,e=1){let i=0,o=0;return{members:r.map(s=>{const h=_[s.type].BYTES_PER_ELEMENT,p=i=z(i,Math.max(e,h)),m=s.components||1;return o=Math.max(o,h),i+=h*m,{name:s.name,type:s.type,components:m,offset:p}}),size:z(i,Math.max(o,e)),alignment:e}}function z(r,e){return Math.ceil(r/e)*e}class k extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const s=2*e;return this.int16[s+0]=i,this.int16[s+1]=o,e}}k.prototype.bytesPerElement=4,rt("StructArrayLayout2i4",k);class j extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,o)}emplace(e,i,o,s){const h=3*e;return this.int16[h+0]=i,this.int16[h+1]=o,this.int16[h+2]=s,e}}j.prototype.bytesPerElement=6,rt("StructArrayLayout3i6",j);class U extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,s)}emplace(e,i,o,s,h){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=o,this.int16[p+2]=s,this.int16[p+3]=h,e}}U.prototype.bytesPerElement=8,rt("StructArrayLayout4i8",U);class G extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,s,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,s,h,p)}emplace(e,i,o,s,h,p,m){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=s,this.int16[x+3]=h,this.int16[x+4]=p,this.int16[x+5]=m,e}}G.prototype.bytesPerElement=12,rt("StructArrayLayout2i4i12",G);class Y extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,s,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,s,h,p)}emplace(e,i,o,s,h,p,m){const x=4*e,w=8*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.uint8[w+4]=s,this.uint8[w+5]=h,this.uint8[w+6]=p,this.uint8[w+7]=m,e}}Y.prototype.bytesPerElement=8,rt("StructArrayLayout2i4ub8",Y);class W extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const s=2*e;return this.float32[s+0]=i,this.float32[s+1]=o,e}}W.prototype.bytesPerElement=8,rt("StructArrayLayout2f8",W);class ee extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,s,h,p,m,x,w,E){const P=this.length;return this.resize(P+1),this.emplace(P,e,i,o,s,h,p,m,x,w,E)}emplace(e,i,o,s,h,p,m,x,w,E,P){const D=10*e;return this.uint16[D+0]=i,this.uint16[D+1]=o,this.uint16[D+2]=s,this.uint16[D+3]=h,this.uint16[D+4]=p,this.uint16[D+5]=m,this.uint16[D+6]=x,this.uint16[D+7]=w,this.uint16[D+8]=E,this.uint16[D+9]=P,e}}ee.prototype.bytesPerElement=20,rt("StructArrayLayout10ui20",ee);class ce extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,s,h,p,m,x,w,E,P,D){const B=this.length;return this.resize(B+1),this.emplace(B,e,i,o,s,h,p,m,x,w,E,P,D)}emplace(e,i,o,s,h,p,m,x,w,E,P,D,B){const N=12*e;return this.int16[N+0]=i,this.int16[N+1]=o,this.int16[N+2]=s,this.int16[N+3]=h,this.uint16[N+4]=p,this.uint16[N+5]=m,this.uint16[N+6]=x,this.uint16[N+7]=w,this.int16[N+8]=E,this.int16[N+9]=P,this.int16[N+10]=D,this.int16[N+11]=B,e}}ce.prototype.bytesPerElement=24,rt("StructArrayLayout4i4ui4i24",ce);class J extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,o)}emplace(e,i,o,s){const h=3*e;return this.float32[h+0]=i,this.float32[h+1]=o,this.float32[h+2]=s,e}}J.prototype.bytesPerElement=12,rt("StructArrayLayout3f12",J);class he extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}he.prototype.bytesPerElement=4,rt("StructArrayLayout1ul4",he);class ye extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,s,h,p,m,x,w){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,o,s,h,p,m,x,w)}emplace(e,i,o,s,h,p,m,x,w,E){const P=10*e,D=5*e;return this.int16[P+0]=i,this.int16[P+1]=o,this.int16[P+2]=s,this.int16[P+3]=h,this.int16[P+4]=p,this.int16[P+5]=m,this.uint32[D+3]=x,this.uint16[P+8]=w,this.uint16[P+9]=E,e}}ye.prototype.bytesPerElement=20,rt("StructArrayLayout6i1ul2ui20",ye);class we extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,s,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,s,h,p)}emplace(e,i,o,s,h,p,m){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=s,this.int16[x+3]=h,this.int16[x+4]=p,this.int16[x+5]=m,e}}we.prototype.bytesPerElement=12,rt("StructArrayLayout2i2i2i12",we);class Ce extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,s,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,o,s,h)}emplace(e,i,o,s,h,p){const m=4*e,x=8*e;return this.float32[m+0]=i,this.float32[m+1]=o,this.float32[m+2]=s,this.int16[x+6]=h,this.int16[x+7]=p,e}}Ce.prototype.bytesPerElement=16,rt("StructArrayLayout2f1f2i16",Ce);class De extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,s,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,s,h,p)}emplace(e,i,o,s,h,p,m){const x=16*e,w=4*e,E=8*e;return this.uint8[x+0]=i,this.uint8[x+1]=o,this.float32[w+1]=s,this.float32[w+2]=h,this.int16[E+6]=p,this.int16[E+7]=m,e}}De.prototype.bytesPerElement=16,rt("StructArrayLayout2ub2f2i16",De);class Qe extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,o)}emplace(e,i,o,s){const h=3*e;return this.uint16[h+0]=i,this.uint16[h+1]=o,this.uint16[h+2]=s,e}}Qe.prototype.bytesPerElement=6,rt("StructArrayLayout3ui6",Qe);class et extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s,h,p,m,x,w,E,P,D,B,N,q,H,Q){const ge=this.length;return this.resize(ge+1),this.emplace(ge,e,i,o,s,h,p,m,x,w,E,P,D,B,N,q,H,Q)}emplace(e,i,o,s,h,p,m,x,w,E,P,D,B,N,q,H,Q,ge){const re=24*e,de=12*e,Ie=48*e;return this.int16[re+0]=i,this.int16[re+1]=o,this.uint16[re+2]=s,this.uint16[re+3]=h,this.uint32[de+2]=p,this.uint32[de+3]=m,this.uint32[de+4]=x,this.uint16[re+10]=w,this.uint16[re+11]=E,this.uint16[re+12]=P,this.float32[de+7]=D,this.float32[de+8]=B,this.uint8[Ie+36]=N,this.uint8[Ie+37]=q,this.uint8[Ie+38]=H,this.uint32[de+10]=Q,this.int16[re+22]=ge,e}}et.prototype.bytesPerElement=48,rt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",et);class Be extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s,h,p,m,x,w,E,P,D,B,N,q,H,Q,ge,re,de,Ie,Ee,Ye,lt,Xe,qe,it,pt){const Je=this.length;return this.resize(Je+1),this.emplace(Je,e,i,o,s,h,p,m,x,w,E,P,D,B,N,q,H,Q,ge,re,de,Ie,Ee,Ye,lt,Xe,qe,it,pt)}emplace(e,i,o,s,h,p,m,x,w,E,P,D,B,N,q,H,Q,ge,re,de,Ie,Ee,Ye,lt,Xe,qe,it,pt,Je){const Pe=32*e,st=16*e;return this.int16[Pe+0]=i,this.int16[Pe+1]=o,this.int16[Pe+2]=s,this.int16[Pe+3]=h,this.int16[Pe+4]=p,this.int16[Pe+5]=m,this.int16[Pe+6]=x,this.int16[Pe+7]=w,this.uint16[Pe+8]=E,this.uint16[Pe+9]=P,this.uint16[Pe+10]=D,this.uint16[Pe+11]=B,this.uint16[Pe+12]=N,this.uint16[Pe+13]=q,this.uint16[Pe+14]=H,this.uint16[Pe+15]=Q,this.uint16[Pe+16]=ge,this.uint16[Pe+17]=re,this.uint16[Pe+18]=de,this.uint16[Pe+19]=Ie,this.uint16[Pe+20]=Ee,this.uint16[Pe+21]=Ye,this.uint16[Pe+22]=lt,this.uint32[st+12]=Xe,this.float32[st+13]=qe,this.float32[st+14]=it,this.uint16[Pe+30]=pt,this.uint16[Pe+31]=Je,e}}Be.prototype.bytesPerElement=64,rt("StructArrayLayout8i15ui1ul2f2ui64",Be);class je extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}je.prototype.bytesPerElement=4,rt("StructArrayLayout1f4",je);class at extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,o)}emplace(e,i,o,s){const h=3*e;return this.uint16[6*e+0]=i,this.float32[h+1]=o,this.float32[h+2]=s,e}}at.prototype.bytesPerElement=12,rt("StructArrayLayout1ui2f12",at);class Tt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,o)}emplace(e,i,o,s){const h=4*e;return this.uint32[2*e+0]=i,this.uint16[h+2]=o,this.uint16[h+3]=s,e}}Tt.prototype.bytesPerElement=8,rt("StructArrayLayout1ul2ui8",Tt);class Ue extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const s=2*e;return this.uint16[s+0]=i,this.uint16[s+1]=o,e}}Ue.prototype.bytesPerElement=4,rt("StructArrayLayout2ui4",Ue);class He extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}He.prototype.bytesPerElement=2,rt("StructArrayLayout1ui2",He);class wt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,s)}emplace(e,i,o,s,h){const p=4*e;return this.float32[p+0]=i,this.float32[p+1]=o,this.float32[p+2]=s,this.float32[p+3]=h,e}}wt.prototype.bytesPerElement=16,rt("StructArrayLayout4f16",wt);class Sr extends v{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ve(this.anchorPointX,this.anchorPointY)}}Sr.prototype.size=20;class Dt extends ye{get(e){return new Sr(this,e)}}rt("CollisionBoxArray",Dt);class jt extends v{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}jt.prototype.size=48;class Tr extends et{get(e){return new jt(this,e)}}rt("PlacedSymbolArray",Tr);class Ei extends v{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ei.prototype.size=64;class On extends Be{get(e){return new Ei(this,e)}}rt("SymbolInstanceArray",On);class Ir extends je{getoffsetX(e){return this.float32[1*e+0]}}rt("GlyphOffsetArray",Ir);class Yi extends j{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}rt("SymbolLineVertexArray",Yi);class Ni extends v{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Ni.prototype.size=12;class Ai extends at{get(e){return new Ni(this,e)}}rt("TextAnchorOffsetArray",Ai);class Pi extends v{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Pi.prototype.size=8;class jn extends Tt{get(e){return new Pi(this,e)}}rt("FeatureIndexArray",jn);class ka extends k{}class cl extends k{}class rs extends k{}class za extends G{}class ul extends Y{}class sc extends W{}class xi extends ee{}class Nn extends ce{}class oa extends J{}class is extends he{}class Mi extends we{}class ki extends De{}class ui extends Qe{}class kr extends Ue{}const ns=C([{name:"a_pos",components:2,type:"Int16"}],4),{members:lc}=ns;class ni{constructor(e=[]){this.segments=e}prepareSegment(e,i,o,s){let h=this.segments[this.segments.length-1];return e>ni.MAX_VERTEX_ARRAY_LENGTH&&rr(`Max vertices per segment is ${ni.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>ni.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==s)&&(h={vertexOffset:i.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},s!==void 0&&(h.sortKey=s),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,s){return new ni([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:s,vaos:{},sortKey:0}])}}function ou(r,e){return 256*(r=Nt(Math.floor(r),0,255))+Nt(Math.floor(e),0,255)}ni.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,rt("SegmentVector",ni);const hl=C([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var dl={exports:{}},aa={exports:{}};aa.exports=function(r,e){var i,o,s,h,p,m,x,w;for(o=r.length-(i=3&r.length),s=e,p=3432918353,m=461845907,w=0;w<o;)x=255&r.charCodeAt(w)|(255&r.charCodeAt(++w))<<8|(255&r.charCodeAt(++w))<<16|(255&r.charCodeAt(++w))<<24,++w,s=27492+(65535&(h=5*(65535&(s=(s^=x=(65535&(x=(x=(65535&x)*p+(((x>>>16)*p&65535)<<16)&4294967295)<<15|x>>>17))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(x=0,i){case 3:x^=(255&r.charCodeAt(w+2))<<16;case 2:x^=(255&r.charCodeAt(w+1))<<8;case 1:s^=x=(65535&(x=(x=(65535&(x^=255&r.charCodeAt(w)))*p+(((x>>>16)*p&65535)<<16)&4294967295)<<15|x>>>17))*m+(((x>>>16)*m&65535)<<16)&4294967295}return s^=r.length,s=2246822507*(65535&(s^=s>>>16))+((2246822507*(s>>>16)&65535)<<16)&4294967295,s=3266489909*(65535&(s^=s>>>13))+((3266489909*(s>>>16)&65535)<<16)&4294967295,(s^=s>>>16)>>>0};var au=aa.exports,cc={exports:{}};cc.exports=function(r,e){for(var i,o=r.length,s=e^o,h=0;o>=4;)i=1540483477*(65535&(i=255&r.charCodeAt(h)|(255&r.charCodeAt(++h))<<8|(255&r.charCodeAt(++h))<<16|(255&r.charCodeAt(++h))<<24))+((1540483477*(i>>>16)&65535)<<16),s=1540483477*(65535&s)+((1540483477*(s>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),o-=4,++h;switch(o){case 3:s^=(255&r.charCodeAt(h+2))<<16;case 2:s^=(255&r.charCodeAt(h+1))<<8;case 1:s=1540483477*(65535&(s^=255&r.charCodeAt(h)))+((1540483477*(s>>>16)&65535)<<16)}return s=1540483477*(65535&(s^=s>>>13))+((1540483477*(s>>>16)&65535)<<16),(s^=s>>>15)>>>0};var uc=au,hc=cc.exports;dl.exports=uc,dl.exports.murmur3=uc,dl.exports.murmur2=hc;var pl=le(dl.exports);class os{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,o,s){this.ids.push(Ep(e)),this.positions.push(i,o,s)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=Ep(e);let o=0,s=this.ids.length-1;for(;o<s;){const p=o+s>>1;this.ids[p]>=i?s=p:o=p+1}const h=[];for(;this.ids[o]===i;)h.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return h}static serialize(e,i){const o=new Float64Array(e.ids),s=new Uint32Array(e.positions);return mh(o,s,0,o.length-1),i&&i.push(o.buffer,s.buffer),{ids:o,positions:s}}static deserialize(e){const i=new os;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function Ep(r){const e=+r;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:pl(String(r))}function mh(r,e,i,o){for(;i<o;){const s=r[i+o>>1];let h=i-1,p=o+1;for(;;){do h++;while(r[h]<s);do p--;while(r[p]>s);if(h>=p)break;su(r,h,p),su(e,3*h,3*p),su(e,3*h+1,3*p+1),su(e,3*h+2,3*p+2)}p-i<o-p?(mh(r,e,i,p),i=p+1):(mh(r,e,p+1,o),o=p)}}function su(r,e,i){const o=r[e];r[e]=r[i],r[i]=o}rt("FeaturePositionMap",os);class Bs{constructor(e,i){this.gl=e.gl,this.location=i}}class lu extends Bs{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Ap extends Bs{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Pp extends Bs{constructor(e,i){super(e,i),this.current=Vt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const D_=new Float32Array(16);function gh(r){return[ou(255*r.r,255*r.g),ou(255*r.b,255*r.a)]}class dc{constructor(e,i,o){this.value=e,this.uniformNames=i.map(s=>`u_${s}`),this.type=o}setUniform(e,i,o){e.set(o.constantOr(this.value))}getBinding(e,i,o){return this.type==="color"?new Pp(e,i):new lu(e,i)}}class fl{constructor(e,i){this.uniformNames=i.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=e.tlbr}setUniform(e,i,o,s){const h=s==="u_pattern_to"?this.patternTo:s==="u_pattern_from"?this.patternFrom:s==="u_pixel_ratio_to"?this.pixelRatioTo:s==="u_pixel_ratio_from"?this.pixelRatioFrom:null;h&&e.set(h)}getBinding(e,i,o){return o.substr(0,9)==="u_pattern"?new Ap(e,i):new lu(e,i)}}class Da{constructor(e,i,o,s){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(h=>({name:`a_${h}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new s}populatePaintArray(e,i,o,s,h){const p=this.paintVertexArray.length,m=this.expression.evaluate(new _r(0),i,{},s,[],h);this.paintVertexArray.resize(e),this._setPaintValue(p,e,m)}updatePaintArray(e,i,o,s){const h=this.expression.evaluate({zoom:0},o,s);this._setPaintValue(e,i,h)}_setPaintValue(e,i,o){if(this.type==="color"){const s=gh(o);for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,s[0],s[1])}else{for(let s=e;s<i;s++)this.paintVertexArray.emplace(s,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class bo{constructor(e,i,o,s,h,p){this.expression=e,this.uniformNames=i.map(m=>`u_${m}_t`),this.type=o,this.useIntegerZoom=s,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=i.map(m=>({name:`a_${m}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,i,o,s,h){const p=this.expression.evaluate(new _r(this.zoom),i,{},s,[],h),m=this.expression.evaluate(new _r(this.zoom+1),i,{},s,[],h),x=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(x,e,p,m)}updatePaintArray(e,i,o,s){const h=this.expression.evaluate({zoom:this.zoom},o,s),p=this.expression.evaluate({zoom:this.zoom+1},o,s);this._setPaintValue(e,i,h,p)}_setPaintValue(e,i,o,s){if(this.type==="color"){const h=gh(o),p=gh(s);for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,h[0],h[1],p[0],p[1])}else{for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,o,s);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,s=Nt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(s)}getBinding(e,i,o){return new lu(e,i)}}class as{constructor(e,i,o,s,h,p){this.expression=e,this.type=i,this.useIntegerZoom=o,this.zoom=s,this.layerId=p,this.zoomInPaintVertexArray=new h,this.zoomOutPaintVertexArray=new h}populatePaintArray(e,i,o){const s=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(s,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,s,h){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],h)}_setPaintValues(e,i,o,s){if(!s||!o)return;const{min:h,mid:p,max:m}=o,x=s[h],w=s[p],E=s[m];if(x&&w&&E)for(let P=e;P<i;P++)this.zoomInPaintVertexArray.emplace(P,w.tl[0],w.tl[1],w.br[0],w.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],w.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,w.tl[0],w.tl[1],w.br[0],w.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],w.pixelRatio,E.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,hl.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,hl.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Mp{constructor(e,i,o){this.binders={},this._buffers=[];const s=[];for(const h in e.paint._values){if(!o(h))continue;const p=e.paint.get(h);if(!(p instanceof io&&wn(p.property.specification)))continue;const m=F_(h,e.type),x=p.value,w=p.property.specification.type,E=p.property.useIntegerZoom,P=p.property.specification["property-type"],D=P==="cross-faded"||P==="cross-faded-data-driven";if(x.kind==="constant")this.binders[h]=D?new fl(x.value,m):new dc(x.value,m,w),s.push(`/u_${h}`);else if(x.kind==="source"||D){const B=kp(h,w,"source");this.binders[h]=D?new as(x,w,E,i,B,e.id):new Da(x,m,w,B),s.push(`/a_${h}`)}else{const B=kp(h,w,"composite");this.binders[h]=new bo(x,m,w,E,i,B),s.push(`/z_${h}`)}}this.cacheKey=s.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Da||i instanceof bo?i.maxValue:0}populatePaintArrays(e,i,o,s,h){for(const p in this.binders){const m=this.binders[p];(m instanceof Da||m instanceof bo||m instanceof as)&&m.populatePaintArray(e,i,o,s,h)}}setConstantPatternPositions(e,i){for(const o in this.binders){const s=this.binders[o];s instanceof fl&&s.setConstantPatternPositions(e,i)}}updatePaintArrays(e,i,o,s,h){let p=!1;for(const m in e){const x=i.getPositions(m);for(const w of x){const E=o.feature(w.index);for(const P in this.binders){const D=this.binders[P];if((D instanceof Da||D instanceof bo||D instanceof as)&&D.expression.isStateDependent===!0){const B=s.paint.get(P);D.expression=B.value,D.updatePaintArray(w.start,w.end,E,e[m],h),p=!0}}}}return p}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof dc||o instanceof fl)&&e.push(...o.uniformNames.map(s=>`#define HAS_UNIFORM_${s}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Da||o instanceof bo)for(let s=0;s<o.paintVertexAttributes.length;s++)e.push(o.paintVertexAttributes[s].name);else if(o instanceof as)for(let s=0;s<hl.members.length;s++)e.push(hl.members[s].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof dc||o instanceof fl||o instanceof bo)for(const s of o.uniformNames)e.push(s)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const o=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof dc||h instanceof fl||h instanceof bo){for(const p of h.uniformNames)if(i[p]){const m=h.getBinding(e,i[p],p);o.push({name:p,property:s,binding:m})}}}return o}setUniforms(e,i,o,s){for(const{name:h,property:p,binding:m}of i)this.binders[p].setUniform(m,s,o.get(p),h)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const o=this.binders[i];if(e&&o instanceof as){const s=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;s&&this._buffers.push(s)}else(o instanceof Da||o instanceof bo)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof Da||o instanceof bo||o instanceof as)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Da||i instanceof bo||i instanceof as)&&i.destroy()}}}class Rs{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const s of e)this.programConfigurations[s.id]=new Mp(s,i,o);this.needsUpload=!1,this._featureMap=new os,this._bufferOffset=0}populatePaintArrays(e,i,o,s,h,p){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(e,i,s,h,p);i.id!==void 0&&this._featureMap.add(i.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,s){for(const h of o)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(e,this._featureMap,i,h,s)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function F_(r,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}function kp(r,e,i){const o={color:{source:W,composite:wt},number:{source:je,composite:W}},s=function(h){return{"line-pattern":{source:xi,composite:xi},"fill-pattern":{source:xi,composite:xi},"fill-extrusion-pattern":{source:xi,composite:xi}}[h]}(r);return s&&s[i]||o[e][i]}rt("ConstantBinder",dc),rt("CrossFadedConstantBinder",fl),rt("SourceExpressionBinder",Da),rt("CrossFadedCompositeBinder",as),rt("CompositeExpressionBinder",bo),rt("ProgramConfiguration",Mp,{omit:["_buffers"]}),rt("ProgramConfigurationSet",Rs);const Kr=8192,yh=Math.pow(2,14)-1,zp=-yh-1;function Os(r){const e=Kr/r.extent,i=r.loadGeometry();for(let o=0;o<i.length;o++){const s=i[o];for(let h=0;h<s.length;h++){const p=s[h],m=Math.round(p.x*e),x=Math.round(p.y*e);p.x=Nt(m,zp,yh),p.y=Nt(x,zp,yh),(m<p.x||m>p.x+1||x<p.y||x>p.y+1)&&rr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function js(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Os(r):[]}}function cu(r,e,i,o,s){r.emplaceBack(2*e+(o+1)/2,2*i+(s+1)/2)}class _h{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new cl,this.indexArray=new ui,this.segments=new ni,this.programConfigurations=new Rs(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o){const s=this.layers[0],h=[];let p=null,m=!1;s.type==="circle"&&(p=s.layout.get("circle-sort-key"),m=!p.isConstant());for(const{feature:x,id:w,index:E,sourceLayerIndex:P}of e){const D=this.layers[0]._featureFilter.needGeometry,B=js(x,D);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom),B,o))continue;const N=m?p.evaluate(B,{},o):void 0,q={id:w,properties:x.properties,type:x.type,sourceLayerIndex:P,index:E,geometry:D?B.geometry:Os(x),patterns:{},sortKey:N};h.push(q)}m&&h.sort((x,w)=>x.sortKey-w.sortKey);for(const x of h){const{geometry:w,index:E,sourceLayerIndex:P}=x,D=e[E].feature;this.addFeature(x,w,E,o),i.featureIndex.insert(D,w,E,P,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lc),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,s){for(const h of i)for(const p of h){const m=p.x,x=p.y;if(m<0||m>=Kr||x<0||x>=Kr)continue;const w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),E=w.vertexLength;cu(this.layoutVertexArray,m,x,-1,-1),cu(this.layoutVertexArray,m,x,1,-1),cu(this.layoutVertexArray,m,x,1,1),cu(this.layoutVertexArray,m,x,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+3,E+2),w.vertexLength+=4,w.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},s)}}function Dp(r,e){for(let i=0;i<r.length;i++)if(ml(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(ml(r,e[i]))return!0;return!!xh(r,e)}function L_(r,e,i){return!!ml(r,e)||!!vh(e,r,i)}function Fp(r,e){if(r.length===1)return Bp(e,r[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let s=0;s<o.length;s++)if(ml(r,o[s]))return!0}for(let i=0;i<r.length;i++)if(Bp(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(xh(r,e[i]))return!0;return!1}function B_(r,e,i){if(r.length>1){if(xh(r,e))return!0;for(let o=0;o<e.length;o++)if(vh(e[o],r,i))return!0}for(let o=0;o<r.length;o++)if(vh(r[o],e,i))return!0;return!1}function xh(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const o=r[i],s=r[i+1];for(let h=0;h<e.length-1;h++)if(R_(o,s,e[h],e[h+1]))return!0}return!1}function R_(r,e,i,o){return $t(r,i,o)!==$t(e,i,o)&&$t(r,e,i)!==$t(r,e,o)}function vh(r,e,i){const o=i*i;if(e.length===1)return r.distSqr(e[0])<o;for(let s=1;s<e.length;s++)if(Lp(r,e[s-1],e[s])<o)return!0;return!1}function Lp(r,e,i){const o=e.distSqr(i);if(o===0)return r.distSqr(e);const s=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/o;return r.distSqr(s<0?e:s>1?i:i.sub(e)._mult(s)._add(e))}function Bp(r,e){let i,o,s,h=!1;for(let p=0;p<r.length;p++){i=r[p];for(let m=0,x=i.length-1;m<i.length;x=m++)o=i[m],s=i[x],o.y>e.y!=s.y>e.y&&e.x<(s.x-o.x)*(e.y-o.y)/(s.y-o.y)+o.x&&(h=!h)}return h}function ml(r,e){let i=!1;for(let o=0,s=r.length-1;o<r.length;s=o++){const h=r[o],p=r[s];h.y>e.y!=p.y>e.y&&e.x<(p.x-h.x)*(e.y-h.y)/(p.y-h.y)+h.x&&(i=!i)}return i}function O_(r,e,i){const o=i[0],s=i[2];if(r.x<o.x&&e.x<o.x||r.x>s.x&&e.x>s.x||r.y<o.y&&e.y<o.y||r.y>s.y&&e.y>s.y)return!1;const h=$t(r,e,i[0]);return h!==$t(r,e,i[1])||h!==$t(r,e,i[2])||h!==$t(r,e,i[3])}function pc(r,e,i){const o=e.paint.get(r).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(r)}function uu(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function hu(r,e,i,o,s){if(!e[0]&&!e[1])return r;const h=ve.convert(e)._mult(s);i==="viewport"&&h._rotate(-o);const p=[];for(let m=0;m<r.length;m++)p.push(r[m].sub(h));return p}let Rp,Op;rt("CircleBucket",_h,{omit:["layers"]});var j_={get paint(){return Op=Op||new a({"circle-radius":new _t(be.paint_circle["circle-radius"]),"circle-color":new _t(be.paint_circle["circle-color"]),"circle-blur":new _t(be.paint_circle["circle-blur"]),"circle-opacity":new _t(be.paint_circle["circle-opacity"]),"circle-translate":new ht(be.paint_circle["circle-translate"]),"circle-translate-anchor":new ht(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ht(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ht(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new _t(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new _t(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new _t(be.paint_circle["circle-stroke-opacity"])})},get layout(){return Rp=Rp||new a({"circle-sort-key":new _t(be.layout_circle["circle-sort-key"])})}},Qi=1e-6,gl=typeof Float32Array<"u"?Float32Array:Array;function bh(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function jp(r,e,i){var o=e[0],s=e[1],h=e[2],p=e[3],m=e[4],x=e[5],w=e[6],E=e[7],P=e[8],D=e[9],B=e[10],N=e[11],q=e[12],H=e[13],Q=e[14],ge=e[15],re=i[0],de=i[1],Ie=i[2],Ee=i[3];return r[0]=re*o+de*m+Ie*P+Ee*q,r[1]=re*s+de*x+Ie*D+Ee*H,r[2]=re*h+de*w+Ie*B+Ee*Q,r[3]=re*p+de*E+Ie*N+Ee*ge,r[4]=(re=i[4])*o+(de=i[5])*m+(Ie=i[6])*P+(Ee=i[7])*q,r[5]=re*s+de*x+Ie*D+Ee*H,r[6]=re*h+de*w+Ie*B+Ee*Q,r[7]=re*p+de*E+Ie*N+Ee*ge,r[8]=(re=i[8])*o+(de=i[9])*m+(Ie=i[10])*P+(Ee=i[11])*q,r[9]=re*s+de*x+Ie*D+Ee*H,r[10]=re*h+de*w+Ie*B+Ee*Q,r[11]=re*p+de*E+Ie*N+Ee*ge,r[12]=(re=i[12])*o+(de=i[13])*m+(Ie=i[14])*P+(Ee=i[15])*q,r[13]=re*s+de*x+Ie*D+Ee*H,r[14]=re*h+de*w+Ie*B+Ee*Q,r[15]=re*p+de*E+Ie*N+Ee*ge,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var fc,N_=jp;function du(r,e,i){var o=e[0],s=e[1],h=e[2],p=e[3];return r[0]=i[0]*o+i[4]*s+i[8]*h+i[12]*p,r[1]=i[1]*o+i[5]*s+i[9]*h+i[13]*p,r[2]=i[2]*o+i[6]*s+i[10]*h+i[14]*p,r[3]=i[3]*o+i[7]*s+i[11]*h+i[15]*p,r}fc=new gl(4),gl!=Float32Array&&(fc[0]=0,fc[1]=0,fc[2]=0,fc[3]=0);class $_ extends d{constructor(e){super(e,j_)}createBucket(e){return new _h(e)}queryRadius(e){const i=e;return pc("circle-radius",this,i)+pc("circle-stroke-width",this,i)+uu(this.paint.get("circle-translate"))}queryIntersectsFeature(e,i,o,s,h,p,m,x){const w=hu(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,m),E=this.paint.get("circle-radius").evaluate(i,o)+this.paint.get("circle-stroke-width").evaluate(i,o),P=this.paint.get("circle-pitch-alignment")==="map",D=P?w:function(N,q){return N.map(H=>Np(H,q))}(w,x),B=P?E*m:E;for(const N of s)for(const q of N){const H=P?q:Np(q,x);let Q=B;const ge=du([],[q.x,q.y,0,1],x);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Q*=ge[3]/p.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Q*=p.cameraToCenterDistance/ge[3]),L_(D,H,Q))return!0}return!1}}function Np(r,e){const i=du([],[r.x,r.y,0,1],e);return new ve(i[0]/i[3],i[1]/i[3])}class $p extends _h{}let Vp;rt("HeatmapBucket",$p,{omit:["layers"]});var V_={get paint(){return Vp=Vp||new a({"heatmap-radius":new _t(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new _t(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ht(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new n(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ht(be.paint_heatmap["heatmap-opacity"])})}};function wh(r,{width:e,height:i},o,s){if(s){if(s instanceof Uint8ClampedArray)s=new Uint8Array(s.buffer);else if(s.length!==e*i*o)throw new RangeError(`mismatched image size. expected: ${s.length} but got: ${e*i*o}`)}else s=new Uint8Array(e*i*o);return r.width=e,r.height=i,r.data=s,r}function Up(r,{width:e,height:i},o){if(e===r.width&&i===r.height)return;const s=wh({},{width:e,height:i},o);Sh(r,s,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,i)},o),r.width=e,r.height=i,r.data=s.data}function Sh(r,e,i,o,s,h){if(s.width===0||s.height===0)return e;if(s.width>r.width||s.height>r.height||i.x>r.width-s.width||i.y>r.height-s.height)throw new RangeError("out of range source coordinates for image copy");if(s.width>e.width||s.height>e.height||o.x>e.width-s.width||o.y>e.height-s.height)throw new RangeError("out of range destination coordinates for image copy");const p=r.data,m=e.data;if(p===m)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<s.height;x++){const w=((i.y+x)*r.width+i.x)*h,E=((o.y+x)*e.width+o.x)*h;for(let P=0;P<s.width*h;P++)m[E+P]=p[w+P]}return e}class mc{constructor(e,i){wh(this,e,1,i)}resize(e){Up(this,e,1)}clone(){return new mc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,s,h){Sh(e,i,o,s,h,1)}}class $n{constructor(e,i){wh(this,e,4,i)}resize(e){Up(this,e,4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new $n({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,s,h){Sh(e,i,o,s,h,4)}}function qp(r){const e={},i=r.resolution||256,o=r.clips?r.clips.length:1,s=r.image||new $n({width:i,height:o});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const h=(p,m,x)=>{e[r.evaluationKey]=x;const w=r.expression.evaluate(e);s.data[p+m+0]=Math.floor(255*w.r/w.a),s.data[p+m+1]=Math.floor(255*w.g/w.a),s.data[p+m+2]=Math.floor(255*w.b/w.a),s.data[p+m+3]=Math.floor(255*w.a)};if(r.clips)for(let p=0,m=0;p<o;++p,m+=4*i)for(let x=0,w=0;x<i;x++,w+=4){const E=x/(i-1),{start:P,end:D}=r.clips[p];h(m,w,P*(1-E)+D*E)}else for(let p=0,m=0;p<i;p++,m+=4)h(0,m,p/(i-1));return s}rt("AlphaImage",mc),rt("RGBAImage",$n);class U_ extends d{createBucket(e){return new $p(e)}constructor(e){super(e,V_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=qp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Gp;var q_={get paint(){return Gp=Gp||new a({"hillshade-illumination-direction":new ht(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ht(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ht(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ht(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ht(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ht(be.paint_hillshade["hillshade-accent-color"])})}};class G_ extends d{constructor(e){super(e,q_)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Z_=C([{name:"a_pos",components:2,type:"Int16"}],4),{members:W_}=Z_;var Th={exports:{}};function pu(r,e,i){i=i||2;var o,s,h,p,m,x,w,E=e&&e.length,P=E?e[0]*i:r.length,D=Zp(r,0,P,i,!0),B=[];if(!D||D.next===D.prev)return B;if(E&&(D=function(q,H,Q,ge){var re,de,Ie,Ee=[];for(re=0,de=H.length;re<de;re++)(Ie=Zp(q,H[re]*ge,re<de-1?H[re+1]*ge:q.length,ge,!1))===Ie.next&&(Ie.steiner=!0),Ee.push(tx(Ie));for(Ee.sort(Y_),re=0;re<Ee.length;re++)Q=Q_(Ee[re],Q);return Q}(r,e,D,i)),r.length>80*i){o=h=r[0],s=p=r[1];for(var N=i;N<P;N+=i)(m=r[N])<o&&(o=m),(x=r[N+1])<s&&(s=x),m>h&&(h=m),x>p&&(p=x);w=(w=Math.max(h-o,p-s))!==0?32767/w:0}return gc(D,B,i,o,s,w,0),B}function Zp(r,e,i,o,s){var h,p;if(s===Eh(r,e,i,o)>0)for(h=e;h<i;h+=o)p=Xp(h,r[h],r[h+1],p);else for(h=i-o;h>=e;h-=o)p=Xp(h,r[h],r[h+1],p);return p&&fu(p,p.next)&&(_c(p),p=p.next),p}function Ns(r,e){if(!r)return r;e||(e=r);var i,o=r;do if(i=!1,o.steiner||!fu(o,o.next)&&Hr(o.prev,o,o.next)!==0)o=o.next;else{if(_c(o),(o=e=o.prev)===o.next)break;i=!0}while(i||o!==e);return e}function gc(r,e,i,o,s,h,p){if(r){!p&&h&&function(E,P,D,B){var N=E;do N.z===0&&(N.z=Ih(N.x,N.y,P,D,B)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==E);N.prevZ.nextZ=null,N.prevZ=null,function(q){var H,Q,ge,re,de,Ie,Ee,Ye,lt=1;do{for(Q=q,q=null,de=null,Ie=0;Q;){for(Ie++,ge=Q,Ee=0,H=0;H<lt&&(Ee++,ge=ge.nextZ);H++);for(Ye=lt;Ee>0||Ye>0&&ge;)Ee!==0&&(Ye===0||!ge||Q.z<=ge.z)?(re=Q,Q=Q.nextZ,Ee--):(re=ge,ge=ge.nextZ,Ye--),de?de.nextZ=re:q=re,re.prevZ=de,de=re;Q=ge}de.nextZ=null,lt*=2}while(Ie>1)}(N)}(r,o,s,h);for(var m,x,w=r;r.prev!==r.next;)if(m=r.prev,x=r.next,h?X_(r,o,s,h):H_(r))e.push(m.i/i|0),e.push(r.i/i|0),e.push(x.i/i|0),_c(r),r=x.next,w=x.next;else if((r=x)===w){p?p===1?gc(r=J_(Ns(r),e,i),e,i,o,s,h,2):p===2&&K_(r,e,i,o,s,h):gc(Ns(r),e,i,o,s,h,1);break}}}function H_(r){var e=r.prev,i=r,o=r.next;if(Hr(e,i,o)>=0)return!1;for(var s=e.x,h=i.x,p=o.x,m=e.y,x=i.y,w=o.y,E=s<h?s<p?s:p:h<p?h:p,P=m<x?m<w?m:w:x<w?x:w,D=s>h?s>p?s:p:h>p?h:p,B=m>x?m>w?m:w:x>w?x:w,N=o.next;N!==e;){if(N.x>=E&&N.x<=D&&N.y>=P&&N.y<=B&&yl(s,m,h,x,p,w,N.x,N.y)&&Hr(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function X_(r,e,i,o){var s=r.prev,h=r,p=r.next;if(Hr(s,h,p)>=0)return!1;for(var m=s.x,x=h.x,w=p.x,E=s.y,P=h.y,D=p.y,B=m<x?m<w?m:w:x<w?x:w,N=E<P?E<D?E:D:P<D?P:D,q=m>x?m>w?m:w:x>w?x:w,H=E>P?E>D?E:D:P>D?P:D,Q=Ih(B,N,e,i,o),ge=Ih(q,H,e,i,o),re=r.prevZ,de=r.nextZ;re&&re.z>=Q&&de&&de.z<=ge;){if(re.x>=B&&re.x<=q&&re.y>=N&&re.y<=H&&re!==s&&re!==p&&yl(m,E,x,P,w,D,re.x,re.y)&&Hr(re.prev,re,re.next)>=0||(re=re.prevZ,de.x>=B&&de.x<=q&&de.y>=N&&de.y<=H&&de!==s&&de!==p&&yl(m,E,x,P,w,D,de.x,de.y)&&Hr(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;re&&re.z>=Q;){if(re.x>=B&&re.x<=q&&re.y>=N&&re.y<=H&&re!==s&&re!==p&&yl(m,E,x,P,w,D,re.x,re.y)&&Hr(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;de&&de.z<=ge;){if(de.x>=B&&de.x<=q&&de.y>=N&&de.y<=H&&de!==s&&de!==p&&yl(m,E,x,P,w,D,de.x,de.y)&&Hr(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function J_(r,e,i){var o=r;do{var s=o.prev,h=o.next.next;!fu(s,h)&&Wp(s,o,o.next,h)&&yc(s,h)&&yc(h,s)&&(e.push(s.i/i|0),e.push(o.i/i|0),e.push(h.i/i|0),_c(o),_c(o.next),o=r=h),o=o.next}while(o!==r);return Ns(o)}function K_(r,e,i,o,s,h){var p=r;do{for(var m=p.next.next;m!==p.prev;){if(p.i!==m.i&&rx(p,m)){var x=Hp(p,m);return p=Ns(p,p.next),x=Ns(x,x.next),gc(p,e,i,o,s,h,0),void gc(x,e,i,o,s,h,0)}m=m.next}p=p.next}while(p!==r)}function Y_(r,e){return r.x-e.x}function Q_(r,e){var i=function(s,h){var p,m=h,x=s.x,w=s.y,E=-1/0;do{if(w<=m.y&&w>=m.next.y&&m.next.y!==m.y){var P=m.x+(w-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(P<=x&&P>E&&(E=P,p=m.x<m.next.x?m:m.next,P===x))return p}m=m.next}while(m!==h);if(!p)return null;var D,B=p,N=p.x,q=p.y,H=1/0;m=p;do x>=m.x&&m.x>=N&&x!==m.x&&yl(w<q?x:E,w,N,q,w<q?E:x,w,m.x,m.y)&&(D=Math.abs(w-m.y)/(x-m.x),yc(m,s)&&(D<H||D===H&&(m.x>p.x||m.x===p.x&&ex(p,m)))&&(p=m,H=D)),m=m.next;while(m!==B);return p}(r,e);if(!i)return e;var o=Hp(i,r);return Ns(o,o.next),Ns(i,i.next)}function ex(r,e){return Hr(r.prev,r,e.prev)<0&&Hr(e.next,r,r.next)<0}function Ih(r,e,i,o,s){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*s|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function tx(r){var e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function yl(r,e,i,o,s,h,p,m){return(s-p)*(e-m)>=(r-p)*(h-m)&&(r-p)*(o-m)>=(i-p)*(e-m)&&(i-p)*(h-m)>=(s-p)*(o-m)}function rx(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(i,o){var s=i;do{if(s.i!==i.i&&s.next.i!==i.i&&s.i!==o.i&&s.next.i!==o.i&&Wp(s,s.next,i,o))return!0;s=s.next}while(s!==i);return!1}(r,e)&&(yc(r,e)&&yc(e,r)&&function(i,o){var s=i,h=!1,p=(i.x+o.x)/2,m=(i.y+o.y)/2;do s.y>m!=s.next.y>m&&s.next.y!==s.y&&p<(s.next.x-s.x)*(m-s.y)/(s.next.y-s.y)+s.x&&(h=!h),s=s.next;while(s!==i);return h}(r,e)&&(Hr(r.prev,r,e.prev)||Hr(r,e.prev,e))||fu(r,e)&&Hr(r.prev,r,r.next)>0&&Hr(e.prev,e,e.next)>0)}function Hr(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function fu(r,e){return r.x===e.x&&r.y===e.y}function Wp(r,e,i,o){var s=gu(Hr(r,e,i)),h=gu(Hr(r,e,o)),p=gu(Hr(i,o,r)),m=gu(Hr(i,o,e));return s!==h&&p!==m||!(s!==0||!mu(r,i,e))||!(h!==0||!mu(r,o,e))||!(p!==0||!mu(i,r,o))||!(m!==0||!mu(i,e,o))}function mu(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function gu(r){return r>0?1:r<0?-1:0}function yc(r,e){return Hr(r.prev,r,r.next)<0?Hr(r,e,r.next)>=0&&Hr(r,r.prev,e)>=0:Hr(r,e,r.prev)<0||Hr(r,r.next,e)<0}function Hp(r,e){var i=new Ch(r.i,r.x,r.y),o=new Ch(e.i,e.x,e.y),s=r.next,h=e.prev;return r.next=e,e.prev=r,i.next=s,s.prev=i,o.next=i,i.prev=o,h.next=o,o.prev=h,o}function Xp(r,e,i,o){var s=new Ch(r,e,i);return o?(s.next=o.next,s.prev=o,o.next.prev=s,o.next=s):(s.prev=s,s.next=s),s}function _c(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Ch(r,e,i){this.i=r,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Eh(r,e,i,o){for(var s=0,h=e,p=i-o;h<i;h+=o)s+=(r[p]-r[h])*(r[h+1]+r[p+1]),p=h;return s}Th.exports=pu,Th.exports.default=pu,pu.deviation=function(r,e,i,o){var s=e&&e.length,h=Math.abs(Eh(r,0,s?e[0]*i:r.length,i));if(s)for(var p=0,m=e.length;p<m;p++)h-=Math.abs(Eh(r,e[p]*i,p<m-1?e[p+1]*i:r.length,i));var x=0;for(p=0;p<o.length;p+=3){var w=o[p]*i,E=o[p+1]*i,P=o[p+2]*i;x+=Math.abs((r[w]-r[P])*(r[E+1]-r[w+1])-(r[w]-r[E])*(r[P+1]-r[w+1]))}return h===0&&x===0?0:Math.abs((x-h)/h)},pu.flatten=function(r){for(var e=r[0][0].length,i={vertices:[],holes:[],dimensions:e},o=0,s=0;s<r.length;s++){for(var h=0;h<r[s].length;h++)for(var p=0;p<e;p++)i.vertices.push(r[s][h][p]);s>0&&i.holes.push(o+=r[s-1].length)}return i};var Jp=le(Th.exports);function Ah(r,e,i){const o=i.patternDependencies;let s=!1;for(const h of e){const p=h.paint.get(`${r}-pattern`);p.isConstant()||(s=!0);const m=p.constantOr(null);m&&(s=!0,o[m.to]=!0,o[m.from]=!0)}return s}function Ph(r,e,i,o,s){const h=s.patternDependencies;for(const p of e){const m=p.paint.get(`${r}-pattern`).value;if(m.kind!=="constant"){let x=m.evaluate({zoom:o-1},i,{},s.availableImages),w=m.evaluate({zoom:o},i,{},s.availableImages),E=m.evaluate({zoom:o+1},i,{},s.availableImages);x=x&&x.name?x.name:x,w=w&&w.name?w.name:w,E=E&&E.name?E.name:E,h[x]=!0,h[w]=!0,h[E]=!0,i.patterns[p.id]={min:x,mid:w,max:E}}}return i}class Mh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new rs,this.indexArray=new ui,this.indexArray2=new kr,this.programConfigurations=new Rs(e.layers,e.zoom),this.segments=new ni,this.segments2=new ni,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o){this.hasPattern=Ah("fill",this.layers,i);const s=this.layers[0].layout.get("fill-sort-key"),h=!s.isConstant(),p=[];for(const{feature:m,id:x,index:w,sourceLayerIndex:E}of e){const P=this.layers[0]._featureFilter.needGeometry,D=js(m,P);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom),D,o))continue;const B=h?s.evaluate(D,{},o,i.availableImages):void 0,N={id:x,properties:m.properties,type:m.type,sourceLayerIndex:E,index:w,geometry:P?D.geometry:Os(m),patterns:{},sortKey:B};p.push(N)}h&&p.sort((m,x)=>m.sortKey-x.sortKey);for(const m of p){const{geometry:x,index:w,sourceLayerIndex:E}=m;if(this.hasPattern){const P=Ph("fill",this.layers,m,this.zoom,i);this.patternFeatures.push(P)}else this.addFeature(m,x,w,o,{});i.featureIndex.insert(e[w].feature,x,w,E,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,o)}addFeatures(e,i,o){for(const s of this.patternFeatures)this.addFeature(s,s.geometry,s.index,i,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,W_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,s,h){for(const p of Uo(i,500)){let m=0;for(const B of p)m+=B.length;const x=this.segments.prepareSegment(m,this.layoutVertexArray,this.indexArray),w=x.vertexLength,E=[],P=[];for(const B of p){if(B.length===0)continue;B!==p[0]&&P.push(E.length/2);const N=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),q=N.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(q+B.length-1,q),E.push(B[0].x),E.push(B[0].y);for(let H=1;H<B.length;H++)this.layoutVertexArray.emplaceBack(B[H].x,B[H].y),this.indexArray2.emplaceBack(q+H-1,q+H),E.push(B[H].x),E.push(B[H].y);N.vertexLength+=B.length,N.primitiveLength+=B.length}const D=Jp(E,P);for(let B=0;B<D.length;B+=3)this.indexArray.emplaceBack(w+D[B],w+D[B+1],w+D[B+2]);x.vertexLength+=m,x.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,h,s)}}let Kp,Yp;rt("FillBucket",Mh,{omit:["layers","patternFeatures"]});var ix={get paint(){return Yp=Yp||new a({"fill-antialias":new ht(be.paint_fill["fill-antialias"]),"fill-opacity":new _t(be.paint_fill["fill-opacity"]),"fill-color":new _t(be.paint_fill["fill-color"]),"fill-outline-color":new _t(be.paint_fill["fill-outline-color"]),"fill-translate":new ht(be.paint_fill["fill-translate"]),"fill-translate-anchor":new ht(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new c(be.paint_fill["fill-pattern"])})},get layout(){return Kp=Kp||new a({"fill-sort-key":new _t(be.layout_fill["fill-sort-key"])})}};class nx extends d{constructor(e){super(e,ix)}recalculate(e,i){super.recalculate(e,i);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Mh(e)}queryRadius(){return uu(this.paint.get("fill-translate"))}queryIntersectsFeature(e,i,o,s,h,p,m){return Fp(hu(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,m),s)}isTileClipped(){return!0}}const ox=C([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ax=C([{name:"a_centroid",components:2,type:"Int16"}],4),{members:sx}=ox;var ss={},lx=Ae,Qp=_l;function _l(r,e,i,o,s){this.properties={},this.extent=i,this.type=0,this._pbf=r,this._geometry=-1,this._keys=o,this._values=s,r.readFields(cx,this,e)}function cx(r,e,i){r==1?e.id=i.readVarint():r==2?function(o,s){for(var h=o.readVarint()+o.pos;o.pos<h;){var p=s._keys[o.readVarint()],m=s._values[o.readVarint()];s.properties[p]=m}}(i,e):r==3?e.type=i.readVarint():r==4&&(e._geometry=i.pos)}function ux(r){for(var e,i,o=0,s=0,h=r.length,p=h-1;s<h;p=s++)o+=((i=r[p]).x-(e=r[s]).x)*(e.y+i.y);return o}_l.types=["Unknown","Point","LineString","Polygon"],_l.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,i=r.readVarint()+r.pos,o=1,s=0,h=0,p=0,m=[];r.pos<i;){if(s<=0){var x=r.readVarint();o=7&x,s=x>>3}if(s--,o===1||o===2)h+=r.readSVarint(),p+=r.readSVarint(),o===1&&(e&&m.push(e),e=[]),e.push(new lx(h,p));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&m.push(e),m},_l.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,i=1,o=0,s=0,h=0,p=1/0,m=-1/0,x=1/0,w=-1/0;r.pos<e;){if(o<=0){var E=r.readVarint();i=7&E,o=E>>3}if(o--,i===1||i===2)(s+=r.readSVarint())<p&&(p=s),s>m&&(m=s),(h+=r.readSVarint())<x&&(x=h),h>w&&(w=h);else if(i!==7)throw new Error("unknown command "+i)}return[p,x,m,w]},_l.prototype.toGeoJSON=function(r,e,i){var o,s,h=this.extent*Math.pow(2,i),p=this.extent*r,m=this.extent*e,x=this.loadGeometry(),w=_l.types[this.type];function E(B){for(var N=0;N<B.length;N++){var q=B[N];B[N]=[360*(q.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+m)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(o=0;o<x.length;o++)P[o]=x[o][0];E(x=P);break;case 2:for(o=0;o<x.length;o++)E(x[o]);break;case 3:for(x=function(B){var N=B.length;if(N<=1)return[B];for(var q,H,Q=[],ge=0;ge<N;ge++){var re=ux(B[ge]);re!==0&&(H===void 0&&(H=re<0),H===re<0?(q&&Q.push(q),q=[B[ge]]):q.push(B[ge]))}return q&&Q.push(q),Q}(x),o=0;o<x.length;o++)for(s=0;s<x[o].length;s++)E(x[o][s])}x.length===1?x=x[0]:w="Multi"+w;var D={type:"Feature",geometry:{type:w,coordinates:x},properties:this.properties};return"id"in this&&(D.id=this.id),D};var hx=Qp,ef=tf;function tf(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(dx,this,e),this.length=this._features.length}function dx(r,e,i){r===15?e.version=i.readVarint():r===1?e.name=i.readString():r===5?e.extent=i.readVarint():r===2?e._features.push(i.pos):r===3?e._keys.push(i.readString()):r===4&&e._values.push(function(o){for(var s=null,h=o.readVarint()+o.pos;o.pos<h;){var p=o.readVarint()>>3;s=p===1?o.readString():p===2?o.readFloat():p===3?o.readDouble():p===4?o.readVarint64():p===5?o.readVarint():p===6?o.readSVarint():p===7?o.readBoolean():null}return s}(i))}tf.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new hx(this._pbf,e,this.extent,this._keys,this._values)};var px=ef;function fx(r,e,i){if(r===3){var o=new px(i,i.readVarint()+i.pos);o.length&&(e[o.name]=o)}}ss.VectorTile=function(r,e){this.layers=r.readFields(fx,{},e)},ss.VectorTileFeature=Qp,ss.VectorTileLayer=ef;const mx=ss.VectorTileFeature.types,kh=Math.pow(2,13);function xc(r,e,i,o,s,h,p,m){r.emplaceBack(e,i,2*Math.floor(o*kh)+p,s*kh*2,h*kh*2,Math.round(m))}class zh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new za,this.centroidVertexArray=new ka,this.indexArray=new ui,this.programConfigurations=new Rs(e.layers,e.zoom),this.segments=new ni,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o){this.features=[],this.hasPattern=Ah("fill-extrusion",this.layers,i);for(const{feature:s,id:h,index:p,sourceLayerIndex:m}of e){const x=this.layers[0]._featureFilter.needGeometry,w=js(s,x);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom),w,o))continue;const E={id:h,sourceLayerIndex:m,index:p,geometry:x?w.geometry:Os(s),properties:s.properties,type:s.type,patterns:{}};this.hasPattern?this.features.push(Ph("fill-extrusion",this.layers,E,this.zoom,i)):this.addFeature(E,E.geometry,p,o,{}),i.featureIndex.insert(s,E.geometry,p,m,this.index,!0)}}addFeatures(e,i,o){for(const s of this.features){const{geometry:h}=s;this.addFeature(s,h,s.index,i,o)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sx),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,ax.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,i,o,s,h){const p={x:0,y:0,vertexCount:0};for(const m of Uo(i,500)){let x=0;for(const N of m)x+=N.length;let w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const N of m){if(N.length===0||yx(N))continue;let q=0;for(let H=0;H<N.length;H++){const Q=N[H];if(H>=1){const ge=N[H-1];if(!gx(Q,ge)){w.vertexLength+4>ni.MAX_VERTEX_ARRAY_LENGTH&&(w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const re=Q.sub(ge)._perp()._unit(),de=ge.dist(Q);q+de>32768&&(q=0),xc(this.layoutVertexArray,Q.x,Q.y,re.x,re.y,0,0,q),xc(this.layoutVertexArray,Q.x,Q.y,re.x,re.y,0,1,q),p.x+=2*Q.x,p.y+=2*Q.y,p.vertexCount+=2,q+=de,xc(this.layoutVertexArray,ge.x,ge.y,re.x,re.y,0,0,q),xc(this.layoutVertexArray,ge.x,ge.y,re.x,re.y,0,1,q),p.x+=2*ge.x,p.y+=2*ge.y,p.vertexCount+=2;const Ie=w.vertexLength;this.indexArray.emplaceBack(Ie,Ie+2,Ie+1),this.indexArray.emplaceBack(Ie+1,Ie+2,Ie+3),w.vertexLength+=4,w.primitiveLength+=2}}}}if(w.vertexLength+x>ni.MAX_VERTEX_ARRAY_LENGTH&&(w=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray)),mx[e.type]!=="Polygon")continue;const E=[],P=[],D=w.vertexLength;for(const N of m)if(N.length!==0){N!==m[0]&&P.push(E.length/2);for(let q=0;q<N.length;q++){const H=N[q];xc(this.layoutVertexArray,H.x,H.y,0,0,1,1,0),p.x+=H.x,p.y+=H.y,p.vertexCount+=1,E.push(H.x),E.push(H.y)}}const B=Jp(E,P);for(let N=0;N<B.length;N+=3)this.indexArray.emplaceBack(D+B[N],D+B[N+2],D+B[N+1]);w.primitiveLength+=B.length/3,w.vertexLength+=x}for(let m=0;m<p.vertexCount;m++)this.centroidVertexArray.emplaceBack(Math.floor(p.x/p.vertexCount),Math.floor(p.y/p.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,h,s)}}function gx(r,e){return r.x===e.x&&(r.x<0||r.x>Kr)||r.y===e.y&&(r.y<0||r.y>Kr)}function yx(r){return r.every(e=>e.x<0)||r.every(e=>e.x>Kr)||r.every(e=>e.y<0)||r.every(e=>e.y>Kr)}let rf;rt("FillExtrusionBucket",zh,{omit:["layers","features"]});var _x={get paint(){return rf=rf||new a({"fill-extrusion-opacity":new ht(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new _t(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ht(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ht(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new c(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new _t(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new _t(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ht(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class xx extends d{constructor(e){super(e,_x)}createBucket(e){return new zh(e)}queryRadius(){return uu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,i,o,s,h,p,m,x){const w=hu(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,m),E=this.paint.get("fill-extrusion-height").evaluate(i,o),P=this.paint.get("fill-extrusion-base").evaluate(i,o),D=function(N,q,H,Q){const ge=[];for(const re of N){const de=[re.x,re.y,0,1];du(de,de,q),ge.push(new ve(de[0]/de[3],de[1]/de[3]))}return ge}(w,x),B=function(N,q,H,Q){const ge=[],re=[],de=Q[8]*q,Ie=Q[9]*q,Ee=Q[10]*q,Ye=Q[11]*q,lt=Q[8]*H,Xe=Q[9]*H,qe=Q[10]*H,it=Q[11]*H;for(const pt of N){const Je=[],Pe=[];for(const st of pt){const nt=st.x,At=st.y,sr=Q[0]*nt+Q[4]*At+Q[12],lr=Q[1]*nt+Q[5]*At+Q[13],Yr=Q[2]*nt+Q[6]*At+Q[14],Un=Q[3]*nt+Q[7]*At+Q[15],$i=Yr+Ee,ai=Un+Ye,vi=sr+lt,Vi=lr+Xe,en=Yr+qe,Ui=Un+it,Qr=new ve((sr+de)/ai,(lr+Ie)/ai);Qr.z=$i/ai,Je.push(Qr);const hi=new ve(vi/Ui,Vi/Ui);hi.z=en/Ui,Pe.push(hi)}ge.push(Je),re.push(Pe)}return[ge,re]}(s,P,E,x);return function(N,q,H){let Q=1/0;Fp(H,q)&&(Q=nf(H,q[0]));for(let ge=0;ge<q.length;ge++){const re=q[ge],de=N[ge];for(let Ie=0;Ie<re.length-1;Ie++){const Ee=re[Ie],Ye=[Ee,re[Ie+1],de[Ie+1],de[Ie],Ee];Dp(H,Ye)&&(Q=Math.min(Q,nf(H,Ye)))}}return Q!==1/0&&Q}(B[0],B[1],D)}}function vc(r,e){return r.x*e.x+r.y*e.y}function nf(r,e){if(r.length===1){let i=0;const o=e[i++];let s;for(;!s||o.equals(s);)if(s=e[i++],!s)return 1/0;for(;i<e.length;i++){const h=e[i],p=r[0],m=s.sub(o),x=h.sub(o),w=p.sub(o),E=vc(m,m),P=vc(m,x),D=vc(x,x),B=vc(w,m),N=vc(w,x),q=E*D-P*P,H=(D*B-P*N)/q,Q=(E*N-P*B)/q,ge=o.z*(1-H-Q)+s.z*H+h.z*Q;if(isFinite(ge))return ge}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}const vx=C([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:bx}=vx,wx=C([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Sx}=wx,Tx=ss.VectorTileFeature.types,Ix=Math.cos(Math.PI/180*37.5),of=Math.pow(2,14)/.5;class Dh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new ul,this.layoutVertexArray2=new sc,this.indexArray=new ui,this.programConfigurations=new Rs(e.layers,e.zoom),this.segments=new ni,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o){this.hasPattern=Ah("line",this.layers,i);const s=this.layers[0].layout.get("line-sort-key"),h=!s.isConstant(),p=[];for(const{feature:m,id:x,index:w,sourceLayerIndex:E}of e){const P=this.layers[0]._featureFilter.needGeometry,D=js(m,P);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom),D,o))continue;const B=h?s.evaluate(D,{},o):void 0,N={id:x,properties:m.properties,type:m.type,sourceLayerIndex:E,index:w,geometry:P?D.geometry:Os(m),patterns:{},sortKey:B};p.push(N)}h&&p.sort((m,x)=>m.sortKey-x.sortKey);for(const m of p){const{geometry:x,index:w,sourceLayerIndex:E}=m;if(this.hasPattern){const P=Ph("line",this.layers,m,this.zoom,i);this.patternFeatures.push(P)}else this.addFeature(m,x,w,o,{});i.featureIndex.insert(e[w].feature,x,w,E,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,o)}addFeatures(e,i,o){for(const s of this.patternFeatures)this.addFeature(s,s.geometry,s.index,i,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Sx)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bx),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,s,h){const p=this.layers[0].layout,m=p.get("line-join").evaluate(e,{}),x=p.get("line-cap"),w=p.get("line-miter-limit"),E=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const P of i)this.addLine(P,e,m,x,w,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,h,s)}addLine(e,i,o,s,h,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Q=0;Q<e.length-1;Q++)this.totalDistance+=e[Q].dist(e[Q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const m=Tx[i.type]==="Polygon";let x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let w=0;for(;w<x-1&&e[w].equals(e[w+1]);)w++;if(x<(m?3:2))return;o==="bevel"&&(h=1.05);const E=this.overscaling<=16?15*Kr/(512*this.overscaling):0,P=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let D,B,N,q,H;this.e1=this.e2=-1,m&&(D=e[x-2],H=e[w].sub(D)._unit()._perp());for(let Q=w;Q<x;Q++){if(N=Q===x-1?m?e[w+1]:void 0:e[Q+1],N&&e[Q].equals(N))continue;H&&(q=H),D&&(B=D),D=e[Q],H=N?N.sub(D)._unit()._perp():q,q=q||H;let ge=q.add(H);ge.x===0&&ge.y===0||ge._unit();const re=q.x*H.x+q.y*H.y,de=ge.x*H.x+ge.y*H.y,Ie=de!==0?1/de:1/0,Ee=2*Math.sqrt(2-2*de),Ye=de<Ix&&B&&N,lt=q.x*H.y-q.y*H.x>0;if(Ye&&Q>w){const it=D.dist(B);if(it>2*E){const pt=D.sub(D.sub(B)._mult(E/it)._round());this.updateDistance(B,pt),this.addCurrentVertex(pt,q,0,0,P),B=pt}}const Xe=B&&N;let qe=Xe?o:m?"butt":s;if(Xe&&qe==="round"&&(Ie<p?qe="miter":Ie<=2&&(qe="fakeround")),qe==="miter"&&Ie>h&&(qe="bevel"),qe==="bevel"&&(Ie>2&&(qe="flipbevel"),Ie<h&&(qe="miter")),B&&this.updateDistance(B,D),qe==="miter")ge._mult(Ie),this.addCurrentVertex(D,ge,0,0,P);else if(qe==="flipbevel"){if(Ie>100)ge=H.mult(-1);else{const it=Ie*q.add(H).mag()/q.sub(H).mag();ge._perp()._mult(it*(lt?-1:1))}this.addCurrentVertex(D,ge,0,0,P),this.addCurrentVertex(D,ge.mult(-1),0,0,P)}else if(qe==="bevel"||qe==="fakeround"){const it=-Math.sqrt(Ie*Ie-1),pt=lt?it:0,Je=lt?0:it;if(B&&this.addCurrentVertex(D,q,pt,Je,P),qe==="fakeround"){const Pe=Math.round(180*Ee/Math.PI/20);for(let st=1;st<Pe;st++){let nt=st/Pe;if(nt!==.5){const sr=nt-.5;nt+=nt*sr*(nt-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*sr*sr+(.848013+re*(.215638*re-1.06021)))}const At=H.sub(q)._mult(nt)._add(q)._unit()._mult(lt?-1:1);this.addHalfVertex(D,At.x,At.y,!1,lt,0,P)}}N&&this.addCurrentVertex(D,H,-pt,-Je,P)}else if(qe==="butt")this.addCurrentVertex(D,ge,0,0,P);else if(qe==="square"){const it=B?1:-1;this.addCurrentVertex(D,ge,it,it,P)}else qe==="round"&&(B&&(this.addCurrentVertex(D,q,0,0,P),this.addCurrentVertex(D,q,1,1,P,!0)),N&&(this.addCurrentVertex(D,H,-1,-1,P,!0),this.addCurrentVertex(D,H,0,0,P)));if(Ye&&Q<x-1){const it=D.dist(N);if(it>2*E){const pt=D.add(N.sub(D)._mult(E/it)._round());this.updateDistance(D,pt),this.addCurrentVertex(pt,H,0,0,P),D=pt}}}}addCurrentVertex(e,i,o,s,h,p=!1){const m=i.y*s-i.x,x=-i.y-i.x*s;this.addHalfVertex(e,i.x+i.y*o,i.y-i.x*o,p,!1,o,h),this.addHalfVertex(e,m,x,p,!0,-s,h),this.distance>of/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,i,o,s,h,p))}addHalfVertex({x:e,y:i},o,s,h,p,m,x){const w=.5*(this.lineClips?this.scaledDistance*(of-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(i<<1)+(p?1:0),Math.round(63*o)+128,Math.round(63*s)+128,1+(m===0?0:m<0?-1:1)|(63&w)<<2,w>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),x.primitiveLength++),p?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}let af,sf;rt("LineBucket",Dh,{omit:["layers","patternFeatures"]});var lf={get paint(){return sf=sf||new a({"line-opacity":new _t(be.paint_line["line-opacity"]),"line-color":new _t(be.paint_line["line-color"]),"line-translate":new ht(be.paint_line["line-translate"]),"line-translate-anchor":new ht(be.paint_line["line-translate-anchor"]),"line-width":new _t(be.paint_line["line-width"]),"line-gap-width":new _t(be.paint_line["line-gap-width"]),"line-offset":new _t(be.paint_line["line-offset"]),"line-blur":new _t(be.paint_line["line-blur"]),"line-dasharray":new t(be.paint_line["line-dasharray"]),"line-pattern":new c(be.paint_line["line-pattern"]),"line-gradient":new n(be.paint_line["line-gradient"])})},get layout(){return af=af||new a({"line-cap":new ht(be.layout_line["line-cap"]),"line-join":new _t(be.layout_line["line-join"]),"line-miter-limit":new ht(be.layout_line["line-miter-limit"]),"line-round-limit":new ht(be.layout_line["line-round-limit"]),"line-sort-key":new _t(be.layout_line["line-sort-key"])})}};class Cx extends _t{possiblyEvaluate(e,i){return i=new _r(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,s){return i=Ot({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,s)}}let yu;class Ex extends d{constructor(e){super(e,lf),this.gradientVersion=0,yu||(yu=new Cx(lf.paint.properties["line-width"].specification),yu.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const i=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(i)&&i._styleExpression.expression instanceof ze,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,i){super.recalculate(e,i),this.paint._values["line-floorwidth"]=yu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Dh(e)}queryRadius(e){const i=e,o=cf(pc("line-width",this,i),pc("line-gap-width",this,i)),s=pc("line-offset",this,i);return o/2+Math.abs(s)+uu(this.paint.get("line-translate"))}queryIntersectsFeature(e,i,o,s,h,p,m){const x=hu(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,m),w=m/2*cf(this.paint.get("line-width").evaluate(i,o),this.paint.get("line-gap-width").evaluate(i,o)),E=this.paint.get("line-offset").evaluate(i,o);return E&&(s=function(P,D){const B=[];for(let N=0;N<P.length;N++){const q=P[N],H=[];for(let Q=0;Q<q.length;Q++){const ge=q[Q-1],re=q[Q],de=q[Q+1],Ie=Q===0?new ve(0,0):re.sub(ge)._unit()._perp(),Ee=Q===q.length-1?new ve(0,0):de.sub(re)._unit()._perp(),Ye=Ie._add(Ee)._unit(),lt=Ye.x*Ee.x+Ye.y*Ee.y;lt!==0&&Ye._mult(1/lt),H.push(Ye._mult(D)._add(re))}B.push(H)}return B}(s,E*m)),function(P,D,B){for(let N=0;N<D.length;N++){const q=D[N];if(P.length>=3){for(let H=0;H<q.length;H++)if(ml(P,q[H]))return!0}if(B_(P,q,B))return!0}return!1}(x,s,w)}isTileClipped(){return!0}}function cf(r,e){return e>0?e+2*r:r}const Ax=C([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Px=C([{name:"a_projected_pos",components:3,type:"Float32"}],4);C([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Mx=C([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);C([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const uf=C([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),kx=C([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function zx(r,e,i){return r.sections.forEach(o=>{o.text=function(s,h,p){const m=h.layout.get("text-transform").evaluate(p,{});return m==="uppercase"?s=s.toLocaleUpperCase():m==="lowercase"&&(s=s.toLocaleLowerCase()),na.applyArabicShaping&&(s=na.applyArabicShaping(s)),s}(o.text,e,i)}),r}C([{name:"triangle",components:3,type:"Uint16"}]),C([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),C([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),C([{type:"Float32",name:"offsetX"}]),C([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),C([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const bc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var oi=24,hf=ar,df=function(r,e,i,o,s){var h,p,m=8*s-o-1,x=(1<<m)-1,w=x>>1,E=-7,P=i?s-1:0,D=i?-1:1,B=r[e+P];for(P+=D,h=B&(1<<-E)-1,B>>=-E,E+=m;E>0;h=256*h+r[e+P],P+=D,E-=8);for(p=h&(1<<-E)-1,h>>=-E,E+=o;E>0;p=256*p+r[e+P],P+=D,E-=8);if(h===0)h=1-w;else{if(h===x)return p?NaN:1/0*(B?-1:1);p+=Math.pow(2,o),h-=w}return(B?-1:1)*p*Math.pow(2,h-o)},pf=function(r,e,i,o,s,h){var p,m,x,w=8*h-s-1,E=(1<<w)-1,P=E>>1,D=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=o?0:h-1,N=o?1:-1,q=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,p=E):(p=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-p))<1&&(p--,x*=2),(e+=p+P>=1?D/x:D*Math.pow(2,1-P))*x>=2&&(p++,x/=2),p+P>=E?(m=0,p=E):p+P>=1?(m=(e*x-1)*Math.pow(2,s),p+=P):(m=e*Math.pow(2,P-1)*Math.pow(2,s),p=0));s>=8;r[i+B]=255&m,B+=N,m/=256,s-=8);for(p=p<<s|m,w+=s;w>0;r[i+B]=255&p,B+=N,p/=256,w-=8);r[i+B-N]|=128*q};function ar(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}ar.Varint=0,ar.Fixed64=1,ar.Bytes=2,ar.Fixed32=5;var Fh=4294967296,ff=1/Fh,mf=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Fa(r){return r.type===ar.Bytes?r.readVarint()+r.pos:r.pos+1}function xl(r,e,i){return i?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function gf(r,e,i){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(var s=i.pos-1;s>=r;s--)i.buf[s+o]=i.buf[s]}function Dx(r,e){for(var i=0;i<r.length;i++)e.writeVarint(r[i])}function Fx(r,e){for(var i=0;i<r.length;i++)e.writeSVarint(r[i])}function Lx(r,e){for(var i=0;i<r.length;i++)e.writeFloat(r[i])}function Bx(r,e){for(var i=0;i<r.length;i++)e.writeDouble(r[i])}function Rx(r,e){for(var i=0;i<r.length;i++)e.writeBoolean(r[i])}function Ox(r,e){for(var i=0;i<r.length;i++)e.writeFixed32(r[i])}function jx(r,e){for(var i=0;i<r.length;i++)e.writeSFixed32(r[i])}function Nx(r,e){for(var i=0;i<r.length;i++)e.writeFixed64(r[i])}function $x(r,e){for(var i=0;i<r.length;i++)e.writeSFixed64(r[i])}function _u(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function vl(r,e,i){r[i]=e,r[i+1]=e>>>8,r[i+2]=e>>>16,r[i+3]=e>>>24}function yf(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}ar.prototype={destroy:function(){this.buf=null},readFields:function(r,e,i){for(i=i||this.length;this.pos<i;){var o=this.readVarint(),s=o>>3,h=this.pos;this.type=7&o,r(s,e,this),this.pos===h&&this.skip(o)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=_u(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=yf(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=_u(this.buf,this.pos)+_u(this.buf,this.pos+4)*Fh;return this.pos+=8,r},readSFixed64:function(){var r=_u(this.buf,this.pos)+yf(this.buf,this.pos+4)*Fh;return this.pos+=8,r},readFloat:function(){var r=df(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=df(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,i,o=this.buf;return e=127&(i=o[this.pos++]),i<128?e:(e|=(127&(i=o[this.pos++]))<<7,i<128?e:(e|=(127&(i=o[this.pos++]))<<14,i<128?e:(e|=(127&(i=o[this.pos++]))<<21,i<128?e:function(s,h,p){var m,x,w=p.buf;if(m=(112&(x=w[p.pos++]))>>4,x<128||(m|=(127&(x=w[p.pos++]))<<3,x<128)||(m|=(127&(x=w[p.pos++]))<<10,x<128)||(m|=(127&(x=w[p.pos++]))<<17,x<128)||(m|=(127&(x=w[p.pos++]))<<24,x<128)||(m|=(1&(x=w[p.pos++]))<<31,x<128))return xl(s,m,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=o[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&mf?function(i,o,s){return mf.decode(i.subarray(o,s))}(this.buf,e,r):function(i,o,s){for(var h="",p=o;p<s;){var m,x,w,E=i[p],P=null,D=E>239?4:E>223?3:E>191?2:1;if(p+D>s)break;D===1?E<128&&(P=E):D===2?(192&(m=i[p+1]))==128&&(P=(31&E)<<6|63&m)<=127&&(P=null):D===3?(x=i[p+2],(192&(m=i[p+1]))==128&&(192&x)==128&&((P=(15&E)<<12|(63&m)<<6|63&x)<=2047||P>=55296&&P<=57343)&&(P=null)):D===4&&(x=i[p+2],w=i[p+3],(192&(m=i[p+1]))==128&&(192&x)==128&&(192&w)==128&&((P=(15&E)<<18|(63&m)<<12|(63&x)<<6|63&w)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,D=1):P>65535&&(P-=65536,h+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),h+=String.fromCharCode(P),p+=D}return h}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==ar.Bytes)return r.push(this.readVarint(e));var i=Fa(this);for(r=r||[];this.pos<i;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==ar.Bytes)return r.push(this.readSVarint());var e=Fa(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==ar.Bytes)return r.push(this.readBoolean());var e=Fa(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==ar.Bytes)return r.push(this.readFloat());var e=Fa(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==ar.Bytes)return r.push(this.readDouble());var e=Fa(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==ar.Bytes)return r.push(this.readFixed32());var e=Fa(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==ar.Bytes)return r.push(this.readSFixed32());var e=Fa(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==ar.Bytes)return r.push(this.readFixed64());var e=Fa(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==ar.Bytes)return r.push(this.readSFixed64());var e=Fa(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===ar.Varint)for(;this.buf[this.pos++]>127;);else if(e===ar.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ar.Fixed32)this.pos+=4;else{if(e!==ar.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),vl(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),vl(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),vl(this.buf,-1&r,this.pos),vl(this.buf,Math.floor(r*ff),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),vl(this.buf,-1&r,this.pos),vl(this.buf,Math.floor(r*ff),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,i){var o,s;if(e>=0?(o=e%4294967296|0,s=e/4294967296|0):(s=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,s=s+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(h,p,m){m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,m.buf[m.pos]=127&(h>>>=7)}(o,0,i),function(h,p){var m=(7&h)<<4;p.buf[p.pos++]|=m|((h>>>=3)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h)))))}(s,i)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(o,s,h){for(var p,m,x=0;x<s.length;x++){if((p=s.charCodeAt(x))>55295&&p<57344){if(!m){p>56319||x+1===s.length?(o[h++]=239,o[h++]=191,o[h++]=189):m=p;continue}if(p<56320){o[h++]=239,o[h++]=191,o[h++]=189,m=p;continue}p=m-55296<<10|p-56320|65536,m=null}else m&&(o[h++]=239,o[h++]=191,o[h++]=189,m=null);p<128?o[h++]=p:(p<2048?o[h++]=p>>6|192:(p<65536?o[h++]=p>>12|224:(o[h++]=p>>18|240,o[h++]=p>>12&63|128),o[h++]=p>>6&63|128),o[h++]=63&p|128)}return h}(this.buf,r,this.pos);var i=this.pos-e;i>=128&&gf(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(r){this.realloc(4),pf(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),pf(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=r[i]},writeRawMessage:function(r,e){this.pos++;var i=this.pos;r(e,this);var o=this.pos-i;o>=128&&gf(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o},writeMessage:function(r,e,i){this.writeTag(r,ar.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,Dx,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,Fx,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,Rx,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,Lx,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,Bx,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,Ox,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,jx,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,Nx,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,$x,e)},writeBytesField:function(r,e){this.writeTag(r,ar.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,ar.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,ar.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,ar.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,ar.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,ar.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,ar.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,ar.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,ar.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,ar.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,!!e)}};var Lh=le(hf);const Bh=3;function Vx(r,e,i){r===1&&i.readMessage(Ux,e)}function Ux(r,e,i){if(r===3){const{id:o,bitmap:s,width:h,height:p,left:m,top:x,advance:w}=i.readMessage(qx,{});e.push({id:o,bitmap:new mc({width:h+2*Bh,height:p+2*Bh},s),metrics:{width:h,height:p,left:m,top:x,advance:w}})}}function qx(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}const _f=Bh;function xf(r){let e=0,i=0;for(const p of r)e+=p.w*p.h,i=Math.max(i,p.w);r.sort((p,m)=>m.h-p.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let s=0,h=0;for(const p of r)for(let m=o.length-1;m>=0;m--){const x=o[m];if(!(p.w>x.w||p.h>x.h)){if(p.x=x.x,p.y=x.y,h=Math.max(h,p.y+p.h),s=Math.max(s,p.x+p.w),p.w===x.w&&p.h===x.h){const w=o.pop();m<o.length&&(o[m]=w)}else p.h===x.h?(x.x+=p.w,x.w-=p.w):p.w===x.w?(x.y+=p.h,x.h-=p.h):(o.push({x:x.x+p.w,y:x.y,w:x.w-p.w,h:p.h}),x.y+=p.h,x.h-=p.h);break}}return{w:s,h,fill:e/(s*h)||0}}const dn=1;class Rh{constructor(e,{pixelRatio:i,version:o,stretchX:s,stretchY:h,content:p,textFitWidth:m,textFitHeight:x}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=s,this.stretchY=h,this.content=p,this.version=o,this.textFitWidth=m,this.textFitHeight=x}get tl(){return[this.paddedRect.x+dn,this.paddedRect.y+dn]}get br(){return[this.paddedRect.x+this.paddedRect.w-dn,this.paddedRect.y+this.paddedRect.h-dn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*dn)/this.pixelRatio,(this.paddedRect.h-2*dn)/this.pixelRatio]}}class vf{constructor(e,i){const o={},s={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,o,h),this.addImages(i,s,h);const{w:p,h:m}=xf(h),x=new $n({width:p||1,height:m||1});for(const w in e){const E=e[w],P=o[w].paddedRect;$n.copy(E.data,x,{x:0,y:0},{x:P.x+dn,y:P.y+dn},E.data)}for(const w in i){const E=i[w],P=s[w].paddedRect,D=P.x+dn,B=P.y+dn,N=E.data.width,q=E.data.height;$n.copy(E.data,x,{x:0,y:0},{x:D,y:B},E.data),$n.copy(E.data,x,{x:0,y:q-1},{x:D,y:B-1},{width:N,height:1}),$n.copy(E.data,x,{x:0,y:0},{x:D,y:B+q},{width:N,height:1}),$n.copy(E.data,x,{x:N-1,y:0},{x:D-1,y:B},{width:1,height:q}),$n.copy(E.data,x,{x:0,y:0},{x:D+N,y:B},{width:1,height:q})}this.image=x,this.iconPositions=o,this.patternPositions=s}addImages(e,i,o){for(const s in e){const h=e[s],p={x:0,y:0,w:h.data.width+2*dn,h:h.data.height+2*dn};o.push(p),i[s]=new Rh(p,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(s)}}patchUpdatedImages(e,i){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),i),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),i)}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[s,h]=e.tl;o.update(i.data,void 0,{x:s,y:h})}}var ls;rt("ImagePosition",Rh),rt("ImageAtlas",vf),A.ah=void 0,(ls=A.ah||(A.ah={}))[ls.none=0]="none",ls[ls.horizontal=1]="horizontal",ls[ls.vertical=2]="vertical",ls[ls.horizontalOnly=3]="horizontalOnly";const wc=-17;class Sc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const o=new Sc;return o.scale=e||1,o.fontStack=i,o}static forImage(e){const i=new Sc;return i.imageName=e,i}}class bl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const o=new bl;for(let s=0;s<e.sections.length;s++){const h=e.sections[s];h.image?o.addImageSection(h):o.addTextSection(h,i)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let i="";for(let o=0;o<e.length;o++){const s=e.charCodeAt(o+1)||null,h=e.charCodeAt(o-1)||null;i+=s&&ru(s)&&!bc[e[o+1]]||h&&ru(h)&&!bc[e[o-1]]||!bc[e[o]]?e[o]:bc[e[o]]}return i}(this.text)}trim(){let e=0;for(let o=0;o<this.text.length&&vu[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&vu[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const o=new bl;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Sc.forText(e.scale,e.fontStack||i));const o=this.sections.length-1;for(let s=0;s<e.text.length;++s)this.sectionIndex.push(o)}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void rr("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Sc.forImage(i)),this.sectionIndex.push(this.sections.length-1)):rr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function xu(r,e,i,o,s,h,p,m,x,w,E,P,D,B,N,q){const H=bl.fromFeature(r,s);let Q;P===A.ah.vertical&&H.verticalizePunctuation();const{processBidirectionalText:ge,processStyledBidirectionalText:re}=na;if(ge&&H.sections.length===1){Q=[];const Ee=ge(H.toString(),Oh(H,w,h,e,o,B,N));for(const Ye of Ee){const lt=new bl;lt.text=Ye,lt.sections=H.sections;for(let Xe=0;Xe<Ye.length;Xe++)lt.sectionIndex.push(0);Q.push(lt)}}else if(re){Q=[];const Ee=re(H.text,H.sectionIndex,Oh(H,w,h,e,o,B,N));for(const Ye of Ee){const lt=new bl;lt.text=Ye[0],lt.sectionIndex=Ye[1],lt.sections=H.sections,Q.push(lt)}}else Q=function(Ee,Ye){const lt=[],Xe=Ee.text;let qe=0;for(const it of Ye)lt.push(Ee.substring(qe,it)),qe=it;return qe<Xe.length&&lt.push(Ee.substring(qe,Xe.length)),lt}(H,Oh(H,w,h,e,o,B,N));const de=[],Ie={positionedLines:de,text:H.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:P,iconsInText:!1,verticalizable:!1};return function(Ee,Ye,lt,Xe,qe,it,pt,Je,Pe,st,nt,At){let sr=0,lr=wc,Yr=0,Un=0;const $i=Je==="right"?1:Je==="left"?0:.5;let ai=0;for(const Qr of qe){Qr.trim();const hi=Qr.getMaxScale(),tn=(hi-1)*oi,pn={positionedGlyphs:[],lineOffset:0};Ee.positionedLines[ai]=pn;const Di=pn.positionedGlyphs;let fn=0;if(!Qr.length()){lr+=it,++ai;continue}for(let Ur=0;Ur<Qr.length();Ur++){const Rt=Qr.getSection(Ur),ei=Qr.getSectionIndex(Ur),Fi=Qr.getCharCode(Ur);let si=0,no=null,wo=null,So=null,La=oi;const oo=!(Pe===A.ah.horizontal||!nt&&!nc(Fi)||nt&&(vu[Fi]||(vi=Fi,Ke.Arabic(vi)||Ke["Arabic Supplement"](vi)||Ke["Arabic Extended-A"](vi)||Ke["Arabic Presentation Forms-A"](vi)||Ke["Arabic Presentation Forms-B"](vi))));if(Rt.imageName){const Gn=Xe[Rt.imageName];if(!Gn)continue;So=Rt.imageName,Ee.iconsInText=Ee.iconsInText||!0,wo=Gn.paddedRect;const mn=Gn.displaySize;Rt.scale=Rt.scale*oi/At,no={width:mn[0],height:mn[1],left:dn,top:-_f,advance:oo?mn[1]:mn[0]},si=tn+(oi-mn[1]*Rt.scale),La=no.advance;const Ba=oo?mn[0]*Rt.scale-oi*hi:mn[1]*Rt.scale-oi*hi;Ba>0&&Ba>fn&&(fn=Ba)}else{const Gn=lt[Rt.fontStack],mn=Gn&&Gn[Fi];if(mn&&mn.rect)wo=mn.rect,no=mn.metrics;else{const Ba=Ye[Rt.fontStack],Ac=Ba&&Ba[Fi];if(!Ac)continue;no=Ac.metrics}si=(hi-Rt.scale)*oi}oo?(Ee.verticalizable=!0,Di.push({glyph:Fi,imageName:So,x:sr,y:lr+si,vertical:oo,scale:Rt.scale,fontStack:Rt.fontStack,sectionIndex:ei,metrics:no,rect:wo}),sr+=La*Rt.scale+st):(Di.push({glyph:Fi,imageName:So,x:sr,y:lr+si,vertical:oo,scale:Rt.scale,fontStack:Rt.fontStack,sectionIndex:ei,metrics:no,rect:wo}),sr+=no.advance*Rt.scale+st)}Di.length!==0&&(Yr=Math.max(sr-st,Yr),Wx(Di,0,Di.length-1,$i,fn)),sr=0;const qn=it*hi+fn;pn.lineOffset=Math.max(fn,tn),lr+=qn,Un=Math.max(qn,Un),++ai}var vi;const Vi=lr-wc,{horizontalAlign:en,verticalAlign:Ui}=jh(pt);(function(Qr,hi,tn,pn,Di,fn,qn,Ur,Rt){const ei=(hi-tn)*Di;let Fi=0;Fi=fn!==qn?-Ur*pn-wc:(-pn*Rt+.5)*qn;for(const si of Qr)for(const no of si.positionedGlyphs)no.x+=ei,no.y+=Fi})(Ee.positionedLines,$i,en,Ui,Yr,Un,it,Vi,qe.length),Ee.top+=-Ui*Vi,Ee.bottom=Ee.top+Vi,Ee.left+=-en*Yr,Ee.right=Ee.left+Yr}(Ie,e,i,o,Q,p,m,x,P,w,D,q),!function(Ee){for(const Ye of Ee)if(Ye.positionedGlyphs.length!==0)return!1;return!0}(de)&&Ie}const vu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Gx={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function bf(r,e,i,o,s,h){if(e.imageName){const p=o[e.imageName];return p?p.displaySize[0]*e.scale*oi/h+s:0}{const p=i[e.fontStack],m=p&&p[r];return m?m.metrics.advance*e.scale+s:0}}function wf(r,e,i,o){const s=Math.pow(r-e,2);return o?r<e?s/2:2*s:s+Math.abs(i)*i}function Zx(r,e,i){let o=0;return r===10&&(o-=1e4),i&&(o+=150),r!==40&&r!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Sf(r,e,i,o,s,h){let p=null,m=wf(e,i,s,h);for(const x of o){const w=wf(e-x.x,i,s,h)+x.badness;w<=m&&(p=x,m=w)}return{index:r,x:e,priorBreak:p,badness:m}}function Tf(r){return r?Tf(r.priorBreak).concat(r.index):[]}function Oh(r,e,i,o,s,h,p){if(h!=="point")return[];if(!r)return[];const m=[],x=function(D,B,N,q,H,Q){let ge=0;for(let re=0;re<D.length();re++){const de=D.getSection(re);ge+=bf(D.getCharCode(re),de,q,H,B,Q)}return ge/Math.max(1,Math.ceil(ge/N))}(r,e,i,o,s,p),w=r.text.indexOf("​")>=0;let E=0;for(let D=0;D<r.length();D++){const B=r.getSection(D),N=r.getCharCode(D);if(vu[N]||(E+=bf(N,B,o,s,e,p)),D<r.length()-1){const q=!((P=N)<11904||!(Ke["Bopomofo Extended"](P)||Ke.Bopomofo(P)||Ke["CJK Compatibility Forms"](P)||Ke["CJK Compatibility Ideographs"](P)||Ke["CJK Compatibility"](P)||Ke["CJK Radicals Supplement"](P)||Ke["CJK Strokes"](P)||Ke["CJK Symbols and Punctuation"](P)||Ke["CJK Unified Ideographs Extension A"](P)||Ke["CJK Unified Ideographs"](P)||Ke["Enclosed CJK Letters and Months"](P)||Ke["Halfwidth and Fullwidth Forms"](P)||Ke.Hiragana(P)||Ke["Ideographic Description Characters"](P)||Ke["Kangxi Radicals"](P)||Ke["Katakana Phonetic Extensions"](P)||Ke.Katakana(P)||Ke["Vertical Forms"](P)||Ke["Yi Radicals"](P)||Ke["Yi Syllables"](P)));(Gx[N]||q||B.imageName)&&m.push(Sf(D+1,E,x,m,Zx(N,r.getCharCode(D+1),q&&w),!1))}}var P;return Tf(Sf(r.length(),E,x,m,0,!0))}function jh(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Wx(r,e,i,o,s){if(!o&&!s)return;const h=r[i],p=(r[i].x+h.metrics.advance*h.scale)*o;for(let m=e;m<=i;m++)r[m].x-=p,r[m].y+=s}function Hx(r,e,i){const{horizontalAlign:o,verticalAlign:s}=jh(i),h=e[0]-r.displaySize[0]*o,p=e[1]-r.displaySize[1]*s;return{image:r,top:p,bottom:p+r.displaySize[1],left:h,right:h+r.displaySize[0]}}function If(r){var e,i;let o=r.left,s=r.top,h=r.right-o,p=r.bottom-s;const m=(e=r.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",x=(i=r.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",w=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(x==="proportional"){if(m==="stretchOnly"&&h/p<w||m==="proportional"){const E=Math.ceil(p*w);o*=E/h,h=E}}else if(m==="proportional"&&x==="stretchOnly"&&w!==0&&h/p>w){const E=Math.ceil(h/w);s*=E/p,p=E}return{x1:o,y1:s,x2:o+h,y2:s+p}}function Cf(r,e,i,o,s,h){const p=r.image;let m;if(p.content){const H=p.content,Q=p.pixelRatio||1;m=[H[0]/Q,H[1]/Q,p.displaySize[0]-H[2]/Q,p.displaySize[1]-H[3]/Q]}const x=e.left*h,w=e.right*h;let E,P,D,B;i==="width"||i==="both"?(B=s[0]+x-o[3],P=s[0]+w+o[1]):(B=s[0]+(x+w-p.displaySize[0])/2,P=B+p.displaySize[0]);const N=e.top*h,q=e.bottom*h;return i==="height"||i==="both"?(E=s[1]+N-o[0],D=s[1]+q+o[2]):(E=s[1]+(N+q-p.displaySize[1])/2,D=E+p.displaySize[1]),{image:p,top:E,right:P,bottom:D,left:B,collisionPadding:m}}const Tc=255,sa=128,cs=Tc*sa;function Ef(r,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new _r(r+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:s}=i;let h=0;for(;h<o.length&&o[h]<=r;)h++;h=Math.max(0,h-1);let p=h;for(;p<o.length&&o[p]<r+1;)p++;p=Math.min(o.length-1,p);const m=o[h],x=o[p];return i.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:x,interpolationType:s}:{kind:"camera",minZoom:m,maxZoom:x,minSize:i.evaluate(new _r(m)),maxSize:i.evaluate(new _r(x)),interpolationType:s}}}function Nh(r,e,i){let o="never";const s=r.get(e);return s?o=s:r.get(i)&&(o="always"),o}const Xx=ss.VectorTileFeature.types,Jx=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function bu(r,e,i,o,s,h,p,m,x,w,E,P,D){const B=m?Math.min(cs,Math.round(m[0])):0,N=m?Math.min(cs,Math.round(m[1])):0;r.emplaceBack(e,i,Math.round(32*o),Math.round(32*s),h,p,(B<<1)+(x?1:0),N,16*w,16*E,256*P,256*D)}function $h(r,e,i){r.emplaceBack(e.x,e.y,i),r.emplaceBack(e.x,e.y,i),r.emplaceBack(e.x,e.y,i),r.emplaceBack(e.x,e.y,i)}function Kx(r){for(const e of r.sections)if(oc(e.text))return!0;return!1}class Vh{constructor(e){this.layoutVertexArray=new Nn,this.indexArray=new ui,this.programConfigurations=e,this.segments=new ni,this.dynamicLayoutVertexArray=new oa,this.opacityVertexArray=new is,this.hasVisibleVertices=!1,this.placedSymbolArray=new Tr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,o,s){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ax.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Px.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Jx,!0),this.opacityVertexBuffer.itemSize=1),(o||s)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}rt("SymbolBuffers",Vh);class Uh{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new ni,this.collisionVertexArray=new ki}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Mx.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}rt("CollisionBuffers",Uh);class wl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=bh([]),this.placementViewportMatrix=bh([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ef(this.zoom,i["text-size"]),this.iconSizeData=Ef(this.zoom,i["icon-size"]);const o=this.layers[0].layout,s=o.get("symbol-sort-key"),h=o.get("symbol-z-order");this.canOverlap=Nh(o,"text-overlap","text-allow-overlap")!=="never"||Nh(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&!s.isConstant(),this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(p=>A.ah[p])),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID}createArrays(){this.text=new Vh(new Rs(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Vh(new Rs(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Ir,this.lineVertexArray=new Yi,this.symbolInstances=new On,this.textAnchorOffsets=new Ai}calculateGlyphDependencies(e,i,o,s,h){for(let p=0;p<e.length;p++)if(i[e.charCodeAt(p)]=!0,(o||s)&&h){const m=bc[e.charAt(p)];m&&(i[m.charCodeAt(0)]=!0)}}populate(e,i,o){const s=this.layers[0],h=s.layout,p=h.get("text-font"),m=h.get("text-field"),x=h.get("icon-image"),w=(m.value.kind!=="constant"||m.value.value instanceof Yt&&!m.value.value.isEmpty()||m.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),E=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,P=h.get("symbol-sort-key");if(this.features=[],!w&&!E)return;const D=i.iconDependencies,B=i.glyphDependencies,N=i.availableImages,q=new _r(this.zoom);for(const{feature:H,id:Q,index:ge,sourceLayerIndex:re}of e){const de=s._featureFilter.needGeometry,Ie=js(H,de);if(!s._featureFilter.filter(q,Ie,o))continue;let Ee,Ye;if(de||(Ie.geometry=Os(H)),w){const Xe=s.getValueAndResolveTokens("text-field",Ie,o,N),qe=Yt.factory(Xe),it=this.hasRTLText=this.hasRTLText||Kx(qe);(!it||na.getRTLTextPluginStatus()==="unavailable"||it&&na.isParsed())&&(Ee=zx(qe,s,Ie))}if(E){const Xe=s.getValueAndResolveTokens("icon-image",Ie,o,N);Ye=Xe instanceof Fr?Xe:Fr.fromString(Xe)}if(!Ee&&!Ye)continue;const lt=this.sortFeaturesByKey?P.evaluate(Ie,{},o):void 0;if(this.features.push({id:Q,text:Ee,icon:Ye,index:ge,sourceLayerIndex:re,geometry:Ie.geometry,properties:H.properties,type:Xx[H.type],sortKey:lt}),Ye&&(D[Ye.name]=!0),Ee){const Xe=p.evaluate(Ie,{},o).join(","),qe=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(A.ah.vertical)>=0;for(const it of Ee.sections)if(it.image)D[it.image.name]=!0;else{const pt=ic(Ee.toString()),Je=it.fontStack||Xe,Pe=B[Je]=B[Je]||{};this.calculateGlyphDependencies(it.text,Pe,qe,this.allowVerticalPlacement,pt)}}}h.get("symbol-placement")==="line"&&(this.features=function(H){const Q={},ge={},re=[];let de=0;function Ie(Xe){re.push(H[Xe]),de++}function Ee(Xe,qe,it){const pt=ge[Xe];return delete ge[Xe],ge[qe]=pt,re[pt].geometry[0].pop(),re[pt].geometry[0]=re[pt].geometry[0].concat(it[0]),pt}function Ye(Xe,qe,it){const pt=Q[qe];return delete Q[qe],Q[Xe]=pt,re[pt].geometry[0].shift(),re[pt].geometry[0]=it[0].concat(re[pt].geometry[0]),pt}function lt(Xe,qe,it){const pt=it?qe[0][qe[0].length-1]:qe[0][0];return`${Xe}:${pt.x}:${pt.y}`}for(let Xe=0;Xe<H.length;Xe++){const qe=H[Xe],it=qe.geometry,pt=qe.text?qe.text.toString():null;if(!pt){Ie(Xe);continue}const Je=lt(pt,it),Pe=lt(pt,it,!0);if(Je in ge&&Pe in Q&&ge[Je]!==Q[Pe]){const st=Ye(Je,Pe,it),nt=Ee(Je,Pe,re[st].geometry);delete Q[Je],delete ge[Pe],ge[lt(pt,re[nt].geometry,!0)]=nt,re[st].geometry=null}else Je in ge?Ee(Je,Pe,it):Pe in Q?Ye(Je,Pe,it):(Ie(Xe),Q[Je]=de-1,ge[Pe]=de-1)}return re.filter(Xe=>Xe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((H,Q)=>H.sortKey-Q.sortKey)}update(e,i,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,o),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0){let s=e.dist(i[e.segment+1]),h=e.dist(i[e.segment]);const p={};for(let m=e.segment+1;m<i.length;m++)p[m]={x:i[m].x,y:i[m].y,tileUnitDistanceFromAnchor:s},m<i.length-1&&(s+=i[m+1].dist(i[m]));for(let m=e.segment||0;m>=0;m--)p[m]={x:i[m].x,y:i[m].y,tileUnitDistanceFromAnchor:h},m>0&&(h+=i[m-1].dist(i[m]));for(let m=0;m<i.length;m++){const x=p[m];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,s,h,p,m,x,w,E,P,D){const B=e.indexArray,N=e.layoutVertexArray,q=e.segments.prepareSegment(4*i.length,N,B,this.canOverlap?p.sortKey:void 0),H=this.glyphOffsetArray.length,Q=q.vertexLength,ge=this.allowVerticalPlacement&&m===A.ah.vertical?Math.PI/2:0,re=p.text&&p.text.sections;for(let de=0;de<i.length;de++){const{tl:Ie,tr:Ee,bl:Ye,br:lt,tex:Xe,pixelOffsetTL:qe,pixelOffsetBR:it,minFontScaleX:pt,minFontScaleY:Je,glyphOffset:Pe,isSDF:st,sectionIndex:nt}=i[de],At=q.vertexLength,sr=Pe[1];bu(N,x.x,x.y,Ie.x,sr+Ie.y,Xe.x,Xe.y,o,st,qe.x,qe.y,pt,Je),bu(N,x.x,x.y,Ee.x,sr+Ee.y,Xe.x+Xe.w,Xe.y,o,st,it.x,qe.y,pt,Je),bu(N,x.x,x.y,Ye.x,sr+Ye.y,Xe.x,Xe.y+Xe.h,o,st,qe.x,it.y,pt,Je),bu(N,x.x,x.y,lt.x,sr+lt.y,Xe.x+Xe.w,Xe.y+Xe.h,o,st,it.x,it.y,pt,Je),$h(e.dynamicLayoutVertexArray,x,ge),B.emplaceBack(At,At+1,At+2),B.emplaceBack(At+1,At+2,At+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Pe[0]),de!==i.length-1&&nt===i[de+1].sectionIndex||e.programConfigurations.populatePaintArrays(N.length,p,p.index,{},D,re&&re[nt])}e.placedSymbolArray.emplaceBack(x.x,x.y,H,this.glyphOffsetArray.length-H,Q,w,E,x.segment,o?o[0]:0,o?o[1]:0,s[0],s[1],m,0,!1,0,P)}_addCollisionDebugVertex(e,i,o,s,h,p){return i.emplaceBack(0,0),e.emplaceBack(o.x,o.y,s,h,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(e,i,o,s,h,p,m){const x=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),w=x.vertexLength,E=h.layoutVertexArray,P=h.collisionVertexArray,D=m.anchorX,B=m.anchorY;this._addCollisionDebugVertex(E,P,p,D,B,new ve(e,i)),this._addCollisionDebugVertex(E,P,p,D,B,new ve(o,i)),this._addCollisionDebugVertex(E,P,p,D,B,new ve(o,s)),this._addCollisionDebugVertex(E,P,p,D,B,new ve(e,s)),x.vertexLength+=4;const N=h.indexArray;N.emplaceBack(w,w+1),N.emplaceBack(w+1,w+2),N.emplaceBack(w+2,w+3),N.emplaceBack(w+3,w),x.primitiveLength+=4}addDebugCollisionBoxes(e,i,o,s){for(let h=e;h<i;h++){const p=this.collisionBoxArray.get(h);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,s?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Uh(Mi,uf.members,kr),this.iconCollisionBox=new Uh(Mi,uf.members,kr);for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(e,i,o,s,h,p,m,x,w){const E={};for(let P=i;P<o;P++){const D=e.get(P);E.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.textFeatureIndex=D.featureIndex;break}for(let P=s;P<h;P++){const D=e.get(P);E.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.verticalTextFeatureIndex=D.featureIndex;break}for(let P=p;P<m;P++){const D=e.get(P);E.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.iconFeatureIndex=D.featureIndex;break}for(let P=x;P<w;P++){const D=e.get(P);E.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.verticalIconFeatureIndex=D.featureIndex;break}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),s=o.vertexStartIndex+4*o.numGlyphs;for(let h=o.vertexStartIndex;h<s;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),s=[],h=[],p=[];for(let m=0;m<this.symbolInstances.length;++m){p.push(m);const x=this.symbolInstances.get(m);s.push(0|Math.round(i*x.anchorX+o*x.anchorY)),h.push(x.featureIndex)}return p.sort((m,x)=>s[m]-s[x]||h[x]-h[m]),p}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((s,h,p)=>{s>=0&&p.indexOf(s)===h&&this.addIndicesForPlacedSymbol(this.text,s)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Af,Pf;rt("SymbolBucket",wl,{omit:["layers","collisionBoxArray","features","compareText"]}),wl.MAX_GLYPHS=65535,wl.addDynamicAttributes=$h;var qh={get paint(){return Pf=Pf||new a({"icon-opacity":new _t(be.paint_symbol["icon-opacity"]),"icon-color":new _t(be.paint_symbol["icon-color"]),"icon-halo-color":new _t(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new _t(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new _t(be.paint_symbol["icon-halo-blur"]),"icon-translate":new ht(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new ht(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new _t(be.paint_symbol["text-opacity"]),"text-color":new _t(be.paint_symbol["text-color"],{runtimeType:Nr,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new _t(be.paint_symbol["text-halo-color"]),"text-halo-width":new _t(be.paint_symbol["text-halo-width"]),"text-halo-blur":new _t(be.paint_symbol["text-halo-blur"]),"text-translate":new ht(be.paint_symbol["text-translate"]),"text-translate-anchor":new ht(be.paint_symbol["text-translate-anchor"])})},get layout(){return Af=Af||new a({"symbol-placement":new ht(be.layout_symbol["symbol-placement"]),"symbol-spacing":new ht(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ht(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new _t(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ht(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ht(be.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ht(be.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ht(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new ht(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ht(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new _t(be.layout_symbol["icon-size"]),"icon-text-fit":new ht(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ht(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new _t(be.layout_symbol["icon-image"]),"icon-rotate":new _t(be.layout_symbol["icon-rotate"]),"icon-padding":new _t(be.layout_symbol["icon-padding"]),"icon-keep-upright":new ht(be.layout_symbol["icon-keep-upright"]),"icon-offset":new _t(be.layout_symbol["icon-offset"]),"icon-anchor":new _t(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ht(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ht(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ht(be.layout_symbol["text-rotation-alignment"]),"text-field":new _t(be.layout_symbol["text-field"]),"text-font":new _t(be.layout_symbol["text-font"]),"text-size":new _t(be.layout_symbol["text-size"]),"text-max-width":new _t(be.layout_symbol["text-max-width"]),"text-line-height":new ht(be.layout_symbol["text-line-height"]),"text-letter-spacing":new _t(be.layout_symbol["text-letter-spacing"]),"text-justify":new _t(be.layout_symbol["text-justify"]),"text-radial-offset":new _t(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ht(be.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new _t(be.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new _t(be.layout_symbol["text-anchor"]),"text-max-angle":new ht(be.layout_symbol["text-max-angle"]),"text-writing-mode":new ht(be.layout_symbol["text-writing-mode"]),"text-rotate":new _t(be.layout_symbol["text-rotate"]),"text-padding":new ht(be.layout_symbol["text-padding"]),"text-keep-upright":new ht(be.layout_symbol["text-keep-upright"]),"text-transform":new _t(be.layout_symbol["text-transform"]),"text-offset":new _t(be.layout_symbol["text-offset"]),"text-allow-overlap":new ht(be.layout_symbol["text-allow-overlap"]),"text-overlap":new ht(be.layout_symbol["text-overlap"]),"text-ignore-placement":new ht(be.layout_symbol["text-ignore-placement"]),"text-optional":new ht(be.layout_symbol["text-optional"])})}};class Mf{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:vn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}rt("FormatSectionOverride",Mf,{omit:["defaultValue"]});class wu extends d{constructor(e){super(e,qh)}recalculate(e,i){if(super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const s=[];for(const h of o)s.indexOf(h)<0&&s.push(h);this.layout._values["text-writing-mode"]=s}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,i,o,s){const h=this.layout.get(e).evaluate(i,{},o,s),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||ji(p.value)||!h?h:function(m,x){return x.replace(/{([^{}]+)}/g,(w,E)=>m&&E in m?String(m[E]):"")}(i.properties,h)}createBucket(e){return new wl(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of qh.paint.overridableProperties){if(!wu.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new Mf(i),s=new Rr(o,i.property.specification);let h=null;h=i.value.kind==="constant"||i.value.kind==="source"?new ii("source",s):new cn("composite",s,i.value.zoomStops),this.paint._values[e]=new io(i.property,h,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&wu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),s=qh.paint.properties[i];let h=!1;const p=m=>{for(const x of m)if(s.overrides&&s.overrides.hasOverride(x))return void(h=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Yt)p(o.value.value.sections);else if(o.value.kind==="source"){const m=w=>{h||(w instanceof po&&dr(w.value)===bn?p(w.value.sections):w instanceof xa?p(w.sections):w.eachChild(m))},x=o.value;x._styleExpression&&m(x._styleExpression.expression)}return h}}let kf;var Yx={get paint(){return kf=kf||new a({"background-color":new ht(be.paint_background["background-color"]),"background-pattern":new t(be.paint_background["background-pattern"]),"background-opacity":new ht(be.paint_background["background-opacity"])})}};class Qx extends d{constructor(e){super(e,Yx)}}let zf;var ev={get paint(){return zf=zf||new a({"raster-opacity":new ht(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new ht(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ht(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ht(be.paint_raster["raster-brightness-max"]),"raster-saturation":new ht(be.paint_raster["raster-saturation"]),"raster-contrast":new ht(be.paint_raster["raster-contrast"]),"raster-resampling":new ht(be.paint_raster["raster-resampling"]),"raster-fade-duration":new ht(be.paint_raster["raster-fade-duration"])})}};class tv extends d{constructor(e){super(e,ev)}}class rv extends d{constructor(e){super(e,{}),this.onAdd=i=>{this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)},this.onRemove=i=>{this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class iv{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Gh=63710088e-1;class us{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new us(tt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,s=e.lat*i,h=Math.sin(o)*Math.sin(s)+Math.cos(o)*Math.cos(s)*Math.cos((e.lng-this.lng)*i);return Gh*Math.acos(Math.min(h,1))}static convert(e){if(e instanceof us)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new us(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new us(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Df=2*Math.PI*Gh;function Ff(r){return Df*Math.cos(r*Math.PI/180)}function Lf(r){return(180+r)/360}function Bf(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Rf(r,e){return r/Ff(e)}function Zh(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class Su{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=us.convert(e);return new Su(Lf(o.lng),Bf(o.lat),Rf(i,o.lat))}toLngLat(){return new us(360*this.x-180,Zh(this.y))}toAltitude(){return this.z*Ff(Zh(this.y))}meterInMercatorCoordinateUnits(){return 1/Df*(e=Zh(this.y),1/Math.cos(e*Math.PI/180));var e}}function Of(r,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[r*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class Wh{constructor(e,i,o){if(e<0||e>25||o<0||o>=Math.pow(2,e)||i<0||i>=Math.pow(2,e))throw new Error(`x=${i}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=i,this.y=o,this.key=Ic(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i,o){const s=(p=this.y,m=this.z,x=Of(256*(h=this.x),256*(p=Math.pow(2,m)-p-1),m),w=Of(256*(h+1),256*(p+1),m),x[0]+","+x[1]+","+w[0]+","+w[1]);var h,p,m,x,w;const E=function(P,D,B){let N,q="";for(let H=P;H>0;H--)N=1<<H-1,q+=(D&N?1:0)+(B&N?2:0);return q}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,E).replace(/{bbox-epsg-3857}/g,s)}isChildOf(e){const i=this.z-e.z;return i>0&&e.x===this.x>>i&&e.y===this.y>>i}getTilePoint(e){const i=Math.pow(2,this.z);return new ve((e.x*i-this.x)*Kr,(e.y*i-this.y)*Kr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class jf{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Ic(e,i.z,i.z,i.x,i.y)}}class Vn{constructor(e,i,o,s,h){if(e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=i,this.canonical=new Wh(o,+s,+h),this.key=Ic(i,e,o,s,h)}clone(){return new Vn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-e;return e>this.canonical.z?new Vn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Vn(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?Ic(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y):Ic(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Vn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,s=2*this.canonical.y;return[new Vn(i,this.wrap,i,o,s),new Vn(i,this.wrap,i,o+1,s),new Vn(i,this.wrap,i,o,s+1),new Vn(i,this.wrap,i,o+1,s+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Vn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Vn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new jf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Su(e.x-this.wrap,e.y))}}function Ic(r,e,i,o,s){(r*=2)<0&&(r=-1*r-1);const h=1<<i;return(h*h*r+h*s+o).toString(36)+i.toString(36)+e.toString(36)}rt("CanonicalTileID",Wh),rt("OverscaledTileID",Vn,{omit:["posMatrix"]});class Nf{constructor(e,i,o,s=1,h=1,p=1,m=0){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void rr(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;const x=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=s,this.greenFactor=h,this.blueFactor=p,this.baseShift=m;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let w=0;w<x;w++)this.data[this._idx(-1,w)]=this.data[this._idx(0,w)],this.data[this._idx(x,w)]=this.data[this._idx(x-1,w)],this.data[this._idx(w,-1)]=this.data[this._idx(w,0)],this.data[this._idx(w,x)]=this.data[this._idx(w,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let w=0;w<x;w++)for(let E=0;E<x;E++){const P=this.get(w,E);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(e,i){const o=new Uint8Array(this.data.buffer),s=4*this._idx(e,i);return this.unpack(o[s],o[s+1],o[s+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}unpack(e,i,o){return e*this.redFactor+i*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new $n({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let s=i*this.dim,h=i*this.dim+this.dim,p=o*this.dim,m=o*this.dim+this.dim;switch(i){case-1:s=h-1;break;case 1:h=s+1}switch(o){case-1:p=m-1;break;case 1:m=p+1}const x=-i*this.dim,w=-o*this.dim;for(let E=p;E<m;E++)for(let P=s;P<h;P++)this.data[this._idx(P,E)]=e.data[this._idx(P+x,E+w)]}}rt("DEMData",Nf);class $f{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Vf{constructor(e,i,o,s,h){this.type="Feature",this._vectorTileFeature=e,e._z=i,e._x=o,e._y=s,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&(e[i]=this[i]);return e}}class Uf{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ds(Kr,16,0),this.grid3D=new Ds(Kr,16,0),this.featureIndexArray=new jn,this.promoteId=i}insert(e,i,o,s,h,p){const m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,s,h);const x=p?this.grid3D:this.grid;for(let w=0;w<i.length;w++){const E=i[w],P=[1/0,1/0,-1/0,-1/0];for(let D=0;D<E.length;D++){const B=E[D];P[0]=Math.min(P[0],B.x),P[1]=Math.min(P[1],B.y),P[2]=Math.max(P[2],B.x),P[3]=Math.max(P[3],B.y)}P[0]<Kr&&P[1]<Kr&&P[2]>=0&&P[3]>=0&&x.insert(m,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ss.VectorTile(new Lh(this.rawTileData)).layers,this.sourceLayerCoder=new $f(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,i,o,s){this.loadVTLayers();const h=e.params||{},p=Kr/e.tileSize/e.scale,m=ks(h.filter),x=e.queryGeometry,w=e.queryPadding*p,E=Gf(x),P=this.grid.query(E.minX-w,E.minY-w,E.maxX+w,E.maxY+w),D=Gf(e.cameraQueryGeometry),B=this.grid3D.query(D.minX-w,D.minY-w,D.maxX+w,D.maxY+w,(H,Q,ge,re)=>function(de,Ie,Ee,Ye,lt){for(const qe of de)if(Ie<=qe.x&&Ee<=qe.y&&Ye>=qe.x&&lt>=qe.y)return!0;const Xe=[new ve(Ie,Ee),new ve(Ie,lt),new ve(Ye,lt),new ve(Ye,Ee)];if(de.length>2){for(const qe of Xe)if(ml(de,qe))return!0}for(let qe=0;qe<de.length-1;qe++)if(O_(de[qe],de[qe+1],Xe))return!0;return!1}(e.cameraQueryGeometry,H-w,Q-w,ge+w,re+w));for(const H of B)P.push(H);P.sort(nv);const N={};let q;for(let H=0;H<P.length;H++){const Q=P[H];if(Q===q)continue;q=Q;const ge=this.featureIndexArray.get(Q);let re=null;this.loadMatchingFeature(N,ge.bucketIndex,ge.sourceLayerIndex,ge.featureIndex,m,h.layers,h.availableImages,i,o,s,(de,Ie,Ee)=>(re||(re=Os(de)),Ie.queryIntersectsFeature(x,de,Ee,re,this.z,e.transform,p,e.pixelPosMatrix)))}return N}loadMatchingFeature(e,i,o,s,h,p,m,x,w,E,P){const D=this.bucketLayerIDs[i];if(p&&!function(H,Q){for(let ge=0;ge<H.length;ge++)if(Q.indexOf(H[ge])>=0)return!0;return!1}(p,D))return;const B=this.sourceLayerCoder.decode(o),N=this.vtLayers[B].feature(s);if(h.needGeometry){const H=js(N,!0);if(!h.filter(new _r(this.tileID.overscaledZ),H,this.tileID.canonical))return}else if(!h.filter(new _r(this.tileID.overscaledZ),N))return;const q=this.getId(N,B);for(let H=0;H<D.length;H++){const Q=D[H];if(p&&p.indexOf(Q)<0)continue;const ge=x[Q];if(!ge)continue;let re={};q&&E&&(re=E.getState(ge.sourceLayer||"_geojsonTileLayer",q));const de=Ot({},w[Q]);de.paint=qf(de.paint,ge.paint,N,re,m),de.layout=qf(de.layout,ge.layout,N,re,m);const Ie=!P||P(N,ge,re);if(!Ie)continue;const Ee=new Vf(N,this.z,this.x,this.y,q);Ee.layer=de;let Ye=e[Q];Ye===void 0&&(Ye=e[Q]=[]),Ye.push({featureIndex:s,feature:Ee,intersectionZ:Ie})}}lookupSymbolFeatures(e,i,o,s,h,p,m,x){const w={};this.loadVTLayers();const E=ks(h);for(const P of e)this.loadMatchingFeature(w,o,s,P,E,p,m,x,i);return w}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof o=="boolean"&&(o=Number(o))),o}}function qf(r,e,i,o,s){return Cr(r,(h,p)=>{const m=e instanceof ll?e.get(p):null;return m&&m.evaluate?m.evaluate(i,o,s):m})}function Gf(r){let e=1/0,i=1/0,o=-1/0,s=-1/0;for(const h of r)e=Math.min(e,h.x),i=Math.min(i,h.y),o=Math.max(o,h.x),s=Math.max(s,h.y);return{minX:e,minY:i,maxX:o,maxY:s}}function nv(r,e){return e-r}function Zf(r,e,i,o,s){const h=[];for(let p=0;p<r.length;p++){const m=r[p];let x;for(let w=0;w<m.length-1;w++){let E=m[w],P=m[w+1];E.x<e&&P.x<e||(E.x<e?E=new ve(e,E.y+(e-E.x)/(P.x-E.x)*(P.y-E.y))._round():P.x<e&&(P=new ve(e,E.y+(e-E.x)/(P.x-E.x)*(P.y-E.y))._round()),E.y<i&&P.y<i||(E.y<i?E=new ve(E.x+(i-E.y)/(P.y-E.y)*(P.x-E.x),i)._round():P.y<i&&(P=new ve(E.x+(i-E.y)/(P.y-E.y)*(P.x-E.x),i)._round()),E.x>=o&&P.x>=o||(E.x>=o?E=new ve(o,E.y+(o-E.x)/(P.x-E.x)*(P.y-E.y))._round():P.x>=o&&(P=new ve(o,E.y+(o-E.x)/(P.x-E.x)*(P.y-E.y))._round()),E.y>=s&&P.y>=s||(E.y>=s?E=new ve(E.x+(s-E.y)/(P.y-E.y)*(P.x-E.x),s)._round():P.y>=s&&(P=new ve(E.x+(s-E.y)/(P.y-E.y)*(P.x-E.x),s)._round()),x&&E.equals(x[x.length-1])||(x=[E],h.push(x)),x.push(P)))))}}return h}rt("FeatureIndex",Uf,{omit:["rawTileData","sourceLayerCoder"]});class hs extends ve{constructor(e,i,o,s){super(e,i),this.angle=o,s!==void 0&&(this.segment=s)}clone(){return new hs(this.x,this.y,this.angle,this.segment)}}function Wf(r,e,i,o,s){if(e.segment===void 0||i===0)return!0;let h=e,p=e.segment+1,m=0;for(;m>-i/2;){if(p--,p<0)return!1;m-=r[p].dist(h),h=r[p]}m+=r[p].dist(r[p+1]),p++;const x=[];let w=0;for(;m<i/2;){const E=r[p],P=r[p+1];if(!P)return!1;let D=r[p-1].angleTo(E)-E.angleTo(P);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:m,angleDelta:D}),w+=D;m-x[0].distance>o;)w-=x.shift().angleDelta;if(w>s)return!1;p++,m+=E.dist(P)}return!0}function Hf(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function Xf(r,e,i){return r?.6*e*i:0}function Jf(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function ov(r,e,i,o,s,h){const p=Xf(i,s,h),m=Jf(i,o)*h;let x=0;const w=Hf(r)/2;for(let E=0;E<r.length-1;E++){const P=r[E],D=r[E+1],B=P.dist(D);if(x+B>w){const N=(w-x)/B,q=gt.number(P.x,D.x,N),H=gt.number(P.y,D.y,N),Q=new hs(q,H,D.angleTo(P),E);return Q._round(),!p||Wf(r,Q,m,p,e)?Q:void 0}x+=B}}function av(r,e,i,o,s,h,p,m,x){const w=Xf(o,h,p),E=Jf(o,s),P=E*p,D=r[0].x===0||r[0].x===x||r[0].y===0||r[0].y===x;return e-P<e/4&&(e=P+e/4),Kf(r,D?e/2*m%e:(E/2+2*h)*p*m%e,e,w,i,P,D,!1,x)}function Kf(r,e,i,o,s,h,p,m,x){const w=h/2,E=Hf(r);let P=0,D=e-i,B=[];for(let N=0;N<r.length-1;N++){const q=r[N],H=r[N+1],Q=q.dist(H),ge=H.angleTo(q);for(;D+i<P+Q;){D+=i;const re=(D-P)/Q,de=gt.number(q.x,H.x,re),Ie=gt.number(q.y,H.y,re);if(de>=0&&de<x&&Ie>=0&&Ie<x&&D-w>=0&&D+w<=E){const Ee=new hs(de,Ie,ge,N);Ee._round(),o&&!Wf(r,Ee,h,o,s)||B.push(Ee)}}P+=Q}return m||B.length||p||(B=Kf(r,P/2,i,o,s,h,p,!0,x)),B}rt("Anchor",hs);const Sl=dn;function Yf(r,e,i,o){const s=[],h=r.image,p=h.pixelRatio,m=h.paddedRect.w-2*Sl,x=h.paddedRect.h-2*Sl;let w={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const E=h.stretchX||[[0,m]],P=h.stretchY||[[0,x]],D=(Pe,st)=>Pe+st[1]-st[0],B=E.reduce(D,0),N=P.reduce(D,0),q=m-B,H=x-N;let Q=0,ge=B,re=0,de=N,Ie=0,Ee=q,Ye=0,lt=H;if(h.content&&o){const Pe=h.content,st=Pe[2]-Pe[0],nt=Pe[3]-Pe[1];(h.textFitWidth||h.textFitHeight)&&(w=If(r)),Q=Tu(E,0,Pe[0]),re=Tu(P,0,Pe[1]),ge=Tu(E,Pe[0],Pe[2]),de=Tu(P,Pe[1],Pe[3]),Ie=Pe[0]-Q,Ye=Pe[1]-re,Ee=st-ge,lt=nt-de}const Xe=w.x1,qe=w.y1,it=w.x2-Xe,pt=w.y2-qe,Je=(Pe,st,nt,At)=>{const sr=Iu(Pe.stretch-Q,ge,it,Xe),lr=Cu(Pe.fixed-Ie,Ee,Pe.stretch,B),Yr=Iu(st.stretch-re,de,pt,qe),Un=Cu(st.fixed-Ye,lt,st.stretch,N),$i=Iu(nt.stretch-Q,ge,it,Xe),ai=Cu(nt.fixed-Ie,Ee,nt.stretch,B),vi=Iu(At.stretch-re,de,pt,qe),Vi=Cu(At.fixed-Ye,lt,At.stretch,N),en=new ve(sr,Yr),Ui=new ve($i,Yr),Qr=new ve($i,vi),hi=new ve(sr,vi),tn=new ve(lr/p,Un/p),pn=new ve(ai/p,Vi/p),Di=e*Math.PI/180;if(Di){const Ur=Math.sin(Di),Rt=Math.cos(Di),ei=[Rt,-Ur,Ur,Rt];en._matMult(ei),Ui._matMult(ei),hi._matMult(ei),Qr._matMult(ei)}const fn=Pe.stretch+Pe.fixed,qn=st.stretch+st.fixed;return{tl:en,tr:Ui,bl:hi,br:Qr,tex:{x:h.paddedRect.x+Sl+fn,y:h.paddedRect.y+Sl+qn,w:nt.stretch+nt.fixed-fn,h:At.stretch+At.fixed-qn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:tn,pixelOffsetBR:pn,minFontScaleX:Ee/p/it,minFontScaleY:lt/p/pt,isSDF:i}};if(o&&(h.stretchX||h.stretchY)){const Pe=Qf(E,q,B),st=Qf(P,H,N);for(let nt=0;nt<Pe.length-1;nt++){const At=Pe[nt],sr=Pe[nt+1];for(let lr=0;lr<st.length-1;lr++)s.push(Je(At,st[lr],sr,st[lr+1]))}}else s.push(Je({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:x+1}));return s}function Tu(r,e,i){let o=0;for(const s of r)o+=Math.max(e,Math.min(i,s[1]))-Math.max(e,Math.min(i,s[0]));return o}function Qf(r,e,i){const o=[{fixed:-Sl,stretch:0}];for(const[s,h]of r){const p=o[o.length-1];o.push({fixed:s-p.stretch,stretch:p.stretch}),o.push({fixed:s-p.stretch,stretch:p.stretch+(h-s)})}return o.push({fixed:e+Sl,stretch:i}),o}function Iu(r,e,i,o){return r/e*i+o}function Cu(r,e,i,o){return r-e*i/o}class Eu{constructor(e,i,o,s,h,p,m,x,w,E){var P;if(this.boxStartIndex=e.length,w){let D=p.top,B=p.bottom;const N=p.collisionPadding;N&&(D-=N[1],B+=N[3]);let q=B-D;q>0&&(q=Math.max(10,q),this.circleDiameter=q)}else{const D=!((P=p.image)===null||P===void 0)&&P.content&&(p.image.textFitWidth||p.image.textFitHeight)?If(p):{x1:p.left,y1:p.top,x2:p.right,y2:p.bottom};D.y1=D.y1*m-x[0],D.y2=D.y2*m+x[2],D.x1=D.x1*m-x[3],D.x2=D.x2*m+x[1];const B=p.collisionPadding;if(B&&(D.x1-=B[0]*m,D.y1-=B[1]*m,D.x2+=B[2]*m,D.y2+=B[3]*m),E){const N=new ve(D.x1,D.y1),q=new ve(D.x2,D.y1),H=new ve(D.x1,D.y2),Q=new ve(D.x2,D.y2),ge=E*Math.PI/180;N._rotate(ge),q._rotate(ge),H._rotate(ge),Q._rotate(ge),D.x1=Math.min(N.x,q.x,H.x,Q.x),D.x2=Math.max(N.x,q.x,H.x,Q.x),D.y1=Math.min(N.y,q.y,H.y,Q.y),D.y2=Math.max(N.y,q.y,H.y,Q.y)}e.emplaceBack(i.x,i.y,D.x1,D.y1,D.x2,D.y2,o,s,h)}this.boxEndIndex=e.length}}class sv{constructor(e=[],i=lv){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,s=i[e];for(;e>0;){const h=e-1>>1,p=i[h];if(o(s,p)>=0)break;i[e]=p,e=h}i[e]=s}_down(e){const{data:i,compare:o}=this,s=this.length>>1,h=i[e];for(;e<s;){let p=1+(e<<1),m=i[p];const x=p+1;if(x<this.length&&o(i[x],m)<0&&(p=x,m=i[x]),o(m,h)>=0)break;i[e]=m,e=p}i[e]=h}}function lv(r,e){return r<e?-1:r>e?1:0}function cv(r,e=1,i=!1){let o=1/0,s=1/0,h=-1/0,p=-1/0;const m=r[0];for(let B=0;B<m.length;B++){const N=m[B];(!B||N.x<o)&&(o=N.x),(!B||N.y<s)&&(s=N.y),(!B||N.x>h)&&(h=N.x),(!B||N.y>p)&&(p=N.y)}const x=Math.min(h-o,p-s);let w=x/2;const E=new sv([],uv);if(x===0)return new ve(o,s);for(let B=o;B<h;B+=x)for(let N=s;N<p;N+=x)E.push(new Tl(B+w,N+w,w,r));let P=function(B){let N=0,q=0,H=0;const Q=B[0];for(let ge=0,re=Q.length,de=re-1;ge<re;de=ge++){const Ie=Q[ge],Ee=Q[de],Ye=Ie.x*Ee.y-Ee.x*Ie.y;q+=(Ie.x+Ee.x)*Ye,H+=(Ie.y+Ee.y)*Ye,N+=3*Ye}return new Tl(q/N,H/N,0,B)}(r),D=E.length;for(;E.length;){const B=E.pop();(B.d>P.d||!P.d)&&(P=B,i&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,D)),B.max-P.d<=e||(w=B.h/2,E.push(new Tl(B.p.x-w,B.p.y-w,w,r)),E.push(new Tl(B.p.x+w,B.p.y-w,w,r)),E.push(new Tl(B.p.x-w,B.p.y+w,w,r)),E.push(new Tl(B.p.x+w,B.p.y+w,w,r)),D+=4)}return i&&(console.log(`num probes: ${D}`),console.log(`best distance: ${P.d}`)),P.p}function uv(r,e){return e.max-r.max}function Tl(r,e,i,o){this.p=new ve(r,e),this.h=i,this.d=function(s,h){let p=!1,m=1/0;for(let x=0;x<h.length;x++){const w=h[x];for(let E=0,P=w.length,D=P-1;E<P;D=E++){const B=w[E],N=w[D];B.y>s.y!=N.y>s.y&&s.x<(N.x-B.x)*(s.y-B.y)/(N.y-B.y)+B.x&&(p=!p),m=Math.min(m,Lp(s,B,N))}}return(p?1:-1)*Math.sqrt(m)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var zi;A.aq=void 0,(zi=A.aq||(A.aq={}))[zi.center=1]="center",zi[zi.left=2]="left",zi[zi.right=3]="right",zi[zi.top=4]="top",zi[zi.bottom=5]="bottom",zi[zi["top-left"]=6]="top-left",zi[zi["top-right"]=7]="top-right",zi[zi["bottom-left"]=8]="bottom-left",zi[zi["bottom-right"]=9]="bottom-right";const ds=7,Hh=Number.POSITIVE_INFINITY;function em(r,e){return e[1]!==Hh?function(i,o,s){let h=0,p=0;switch(o=Math.abs(o),s=Math.abs(s),i){case"top-right":case"top-left":case"top":p=s-ds;break;case"bottom-right":case"bottom-left":case"bottom":p=-s+ds}switch(i){case"top-right":case"bottom-right":case"right":h=-o;break;case"top-left":case"bottom-left":case"left":h=o}return[h,p]}(r,e[0],e[1]):function(i,o){let s=0,h=0;o<0&&(o=0);const p=o/Math.SQRT2;switch(i){case"top-right":case"top-left":h=p-ds;break;case"bottom-right":case"bottom-left":h=-p+ds;break;case"bottom":h=-o+ds;break;case"top":h=o-ds}switch(i){case"top-right":case"bottom-right":s=-p;break;case"top-left":case"bottom-left":s=p;break;case"left":s=o;break;case"right":s=-o}return[s,h]}(r,e[0])}function tm(r,e,i){var o;const s=r.layout,h=(o=s.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},i);if(h){const m=h.values,x=[];for(let w=0;w<m.length;w+=2){const E=x[w]=m[w],P=m[w+1].map(D=>D*oi);E.startsWith("top")?P[1]-=ds:E.startsWith("bottom")&&(P[1]+=ds),x[w+1]=P}return new Dr(x)}const p=s.get("text-variable-anchor");if(p){let m;m=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[s.get("text-radial-offset").evaluate(e,{},i)*oi,Hh]:s.get("text-offset").evaluate(e,{},i).map(w=>w*oi);const x=[];for(const w of p)x.push(w,em(w,m));return new Dr(x)}return null}function Xh(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function hv(r,e,i,o,s,h,p,m,x,w,E){let P=h.textMaxSize.evaluate(e,{});P===void 0&&(P=p);const D=r.layers[0].layout,B=D.get("icon-offset").evaluate(e,{},E),N=im(i.horizontal),q=p/24,H=r.tilePixelRatio*q,Q=r.tilePixelRatio*P/24,ge=r.tilePixelRatio*m,re=r.tilePixelRatio*D.get("symbol-spacing"),de=D.get("text-padding")*r.tilePixelRatio,Ie=function(Pe,st,nt,At=1){const sr=Pe.get("icon-padding").evaluate(st,{},nt),lr=sr&&sr.values;return[lr[0]*At,lr[1]*At,lr[2]*At,lr[3]*At]}(D,e,E,r.tilePixelRatio),Ee=D.get("text-max-angle")/180*Math.PI,Ye=D.get("text-rotation-alignment")!=="viewport"&&D.get("symbol-placement")!=="point",lt=D.get("icon-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",Xe=D.get("symbol-placement"),qe=re/2,it=D.get("icon-text-fit");let pt;o&&it!=="none"&&(r.allowVerticalPlacement&&i.vertical&&(pt=Cf(o,i.vertical,it,D.get("icon-text-fit-padding"),B,q)),N&&(o=Cf(o,N,it,D.get("icon-text-fit-padding"),B,q)));const Je=(Pe,st)=>{st.x<0||st.x>=Kr||st.y<0||st.y>=Kr||function(nt,At,sr,lr,Yr,Un,$i,ai,vi,Vi,en,Ui,Qr,hi,tn,pn,Di,fn,qn,Ur,Rt,ei,Fi,si,no){const wo=nt.addToLineVertexArray(At,sr);let So,La,oo,Gn,mn=0,Ba=0,Ac=0,sm=0,id=-1,nd=-1;const Ra={};let lm=pl("");if(nt.allowVerticalPlacement&&lr.vertical){const qi=ai.layout.get("text-rotate").evaluate(Rt,{},si)+90;oo=new Eu(vi,At,Vi,en,Ui,lr.vertical,Qr,hi,tn,qi),$i&&(Gn=new Eu(vi,At,Vi,en,Ui,$i,Di,fn,tn,qi))}if(Yr){const qi=ai.layout.get("icon-rotate").evaluate(Rt,{}),Zn=ai.layout.get("icon-text-fit")!=="none",$s=Yf(Yr,qi,Fi,Zn),Io=$i?Yf($i,qi,Fi,Zn):void 0;La=new Eu(vi,At,Vi,en,Ui,Yr,Di,fn,!1,qi),mn=4*$s.length;const Vs=nt.iconSizeData;let la=null;Vs.kind==="source"?(la=[sa*ai.layout.get("icon-size").evaluate(Rt,{})],la[0]>cs&&rr(`${nt.layerIds[0]}: Value for "icon-size" is >= ${Tc}. Reduce your "icon-size".`)):Vs.kind==="composite"&&(la=[sa*ei.compositeIconSizes[0].evaluate(Rt,{},si),sa*ei.compositeIconSizes[1].evaluate(Rt,{},si)],(la[0]>cs||la[1]>cs)&&rr(`${nt.layerIds[0]}: Value for "icon-size" is >= ${Tc}. Reduce your "icon-size".`)),nt.addSymbols(nt.icon,$s,la,Ur,qn,Rt,A.ah.none,At,wo.lineStartIndex,wo.lineLength,-1,si),id=nt.icon.placedSymbolArray.length-1,Io&&(Ba=4*Io.length,nt.addSymbols(nt.icon,Io,la,Ur,qn,Rt,A.ah.vertical,At,wo.lineStartIndex,wo.lineLength,-1,si),nd=nt.icon.placedSymbolArray.length-1)}const cm=Object.keys(lr.horizontal);for(const qi of cm){const Zn=lr.horizontal[qi];if(!So){lm=pl(Zn.text);const Io=ai.layout.get("text-rotate").evaluate(Rt,{},si);So=new Eu(vi,At,Vi,en,Ui,Zn,Qr,hi,tn,Io)}const $s=Zn.positionedLines.length===1;if(Ac+=rm(nt,At,Zn,Un,ai,tn,Rt,pn,wo,lr.vertical?A.ah.horizontal:A.ah.horizontalOnly,$s?cm:[qi],Ra,id,ei,si),$s)break}lr.vertical&&(sm+=rm(nt,At,lr.vertical,Un,ai,tn,Rt,pn,wo,A.ah.vertical,["vertical"],Ra,nd,ei,si));const fv=So?So.boxStartIndex:nt.collisionBoxArray.length,mv=So?So.boxEndIndex:nt.collisionBoxArray.length,gv=oo?oo.boxStartIndex:nt.collisionBoxArray.length,yv=oo?oo.boxEndIndex:nt.collisionBoxArray.length,_v=La?La.boxStartIndex:nt.collisionBoxArray.length,xv=La?La.boxEndIndex:nt.collisionBoxArray.length,vv=Gn?Gn.boxStartIndex:nt.collisionBoxArray.length,bv=Gn?Gn.boxEndIndex:nt.collisionBoxArray.length;let To=-1;const Pu=(qi,Zn)=>qi&&qi.circleDiameter?Math.max(qi.circleDiameter,Zn):Zn;To=Pu(So,To),To=Pu(oo,To),To=Pu(La,To),To=Pu(Gn,To);const um=To>-1?1:0;um&&(To*=no/oi),nt.glyphOffsetArray.length>=wl.MAX_GLYPHS&&rr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Rt.sortKey!==void 0&&nt.addToSortKeyRanges(nt.symbolInstances.length,Rt.sortKey);const wv=tm(ai,Rt,si),[Sv,Tv]=function(qi,Zn){const $s=qi.length,Io=Zn?.values;if(Io?.length>0)for(let Vs=0;Vs<Io.length;Vs+=2){const la=Io[Vs+1];qi.emplaceBack(A.aq[Io[Vs]],la[0],la[1])}return[$s,qi.length]}(nt.textAnchorOffsets,wv);nt.symbolInstances.emplaceBack(At.x,At.y,Ra.right>=0?Ra.right:-1,Ra.center>=0?Ra.center:-1,Ra.left>=0?Ra.left:-1,Ra.vertical||-1,id,nd,lm,fv,mv,gv,yv,_v,xv,vv,bv,Vi,Ac,sm,mn,Ba,um,0,Qr,To,Sv,Tv)}(r,st,Pe,i,o,s,pt,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,H,[de,de,de,de],Ye,x,ge,Ie,lt,B,e,h,w,E,p)};if(Xe==="line")for(const Pe of Zf(e.geometry,0,0,Kr,Kr)){const st=av(Pe,re,Ee,i.vertical||N,o,24,Q,r.overscaling,Kr);for(const nt of st)N&&dv(r,N.text,qe,nt)||Je(Pe,nt)}else if(Xe==="line-center"){for(const Pe of e.geometry)if(Pe.length>1){const st=ov(Pe,Ee,i.vertical||N,o,24,Q);st&&Je(Pe,st)}}else if(e.type==="Polygon")for(const Pe of Uo(e.geometry,0)){const st=cv(Pe,16);Je(Pe[0],new hs(st.x,st.y,0))}else if(e.type==="LineString")for(const Pe of e.geometry)Je(Pe,new hs(Pe[0].x,Pe[0].y,0));else if(e.type==="Point")for(const Pe of e.geometry)for(const st of Pe)Je([st],new hs(st.x,st.y,0))}function rm(r,e,i,o,s,h,p,m,x,w,E,P,D,B,N){const q=function(ge,re,de,Ie,Ee,Ye,lt,Xe){const qe=Ie.layout.get("text-rotate").evaluate(Ye,{})*Math.PI/180,it=[];for(const pt of re.positionedLines)for(const Je of pt.positionedGlyphs){if(!Je.rect)continue;const Pe=Je.rect||{};let st=_f+1,nt=!0,At=1,sr=0;const lr=(Ee||Xe)&&Je.vertical,Yr=Je.metrics.advance*Je.scale/2;if(Xe&&re.verticalizable&&(sr=pt.lineOffset/2-(Je.imageName?-(oi-Je.metrics.width*Je.scale)/2:(Je.scale-1)*oi)),Je.imageName){const Ur=lt[Je.imageName];nt=Ur.sdf,At=Ur.pixelRatio,st=dn/At}const Un=Ee?[Je.x+Yr,Je.y]:[0,0];let $i=Ee?[0,0]:[Je.x+Yr+de[0],Je.y+de[1]-sr],ai=[0,0];lr&&(ai=$i,$i=[0,0]);const vi=Je.metrics.isDoubleResolution?2:1,Vi=(Je.metrics.left-st)*Je.scale-Yr+$i[0],en=(-Je.metrics.top-st)*Je.scale+$i[1],Ui=Vi+Pe.w/vi*Je.scale/At,Qr=en+Pe.h/vi*Je.scale/At,hi=new ve(Vi,en),tn=new ve(Ui,en),pn=new ve(Vi,Qr),Di=new ve(Ui,Qr);if(lr){const Ur=new ve(-Yr,Yr-wc),Rt=-Math.PI/2,ei=oi/2-Yr,Fi=new ve(5-wc-ei,-(Je.imageName?ei:0)),si=new ve(...ai);hi._rotateAround(Rt,Ur)._add(Fi)._add(si),tn._rotateAround(Rt,Ur)._add(Fi)._add(si),pn._rotateAround(Rt,Ur)._add(Fi)._add(si),Di._rotateAround(Rt,Ur)._add(Fi)._add(si)}if(qe){const Ur=Math.sin(qe),Rt=Math.cos(qe),ei=[Rt,-Ur,Ur,Rt];hi._matMult(ei),tn._matMult(ei),pn._matMult(ei),Di._matMult(ei)}const fn=new ve(0,0),qn=new ve(0,0);it.push({tl:hi,tr:tn,bl:pn,br:Di,tex:Pe,writingMode:re.writingMode,glyphOffset:Un,sectionIndex:Je.sectionIndex,isSDF:nt,pixelOffsetTL:fn,pixelOffsetBR:qn,minFontScaleX:0,minFontScaleY:0})}return it}(0,i,m,s,h,p,o,r.allowVerticalPlacement),H=r.textSizeData;let Q=null;H.kind==="source"?(Q=[sa*s.layout.get("text-size").evaluate(p,{})],Q[0]>cs&&rr(`${r.layerIds[0]}: Value for "text-size" is >= ${Tc}. Reduce your "text-size".`)):H.kind==="composite"&&(Q=[sa*B.compositeTextSizes[0].evaluate(p,{},N),sa*B.compositeTextSizes[1].evaluate(p,{},N)],(Q[0]>cs||Q[1]>cs)&&rr(`${r.layerIds[0]}: Value for "text-size" is >= ${Tc}. Reduce your "text-size".`)),r.addSymbols(r.text,q,Q,m,h,p,w,e,x.lineStartIndex,x.lineLength,D,N);for(const ge of E)P[ge]=r.text.placedSymbolArray.length-1;return 4*q.length}function im(r){for(const e in r)return r[e];return null}function dv(r,e,i,o){const s=r.compareText;if(e in s){const h=s[e];for(let p=h.length-1;p>=0;p--)if(o.dist(h[p])<i)return!0}else s[e]=[];return s[e].push(o),!1}const nm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Jh{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const s=o>>4;if(s!==1)throw new Error(`Got v${s} data when expected v1.`);const h=nm[15&o];if(!h)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[m]=new Uint32Array(e,4,1);return new Jh(m,p,h,e)}constructor(e,i=64,o=Float64Array,s){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const h=nm.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,m=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-m%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${o}.`);s&&s instanceof ArrayBuffer?(this.data=s,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+m+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Kh(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:m}=this,x=[0,h.length-1,0],w=[];for(;x.length;){const E=x.pop()||0,P=x.pop()||0,D=x.pop()||0;if(P-D<=m){for(let H=D;H<=P;H++){const Q=p[2*H],ge=p[2*H+1];Q>=e&&Q<=o&&ge>=i&&ge<=s&&w.push(h[H])}continue}const B=D+P>>1,N=p[2*B],q=p[2*B+1];N>=e&&N<=o&&q>=i&&q<=s&&w.push(h[B]),(E===0?e<=N:i<=q)&&(x.push(D),x.push(B-1),x.push(1-E)),(E===0?o>=N:s>=q)&&(x.push(B+1),x.push(P),x.push(1-E))}return w}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:s,coords:h,nodeSize:p}=this,m=[0,s.length-1,0],x=[],w=o*o;for(;m.length;){const E=m.pop()||0,P=m.pop()||0,D=m.pop()||0;if(P-D<=p){for(let H=D;H<=P;H++)am(h[2*H],h[2*H+1],e,i)<=w&&x.push(s[H]);continue}const B=D+P>>1,N=h[2*B],q=h[2*B+1];am(N,q,e,i)<=w&&x.push(s[B]),(E===0?e-o<=N:i-o<=q)&&(m.push(D),m.push(B-1),m.push(1-E)),(E===0?e+o>=N:i+o>=q)&&(m.push(B+1),m.push(P),m.push(1-E))}return x}}function Kh(r,e,i,o,s,h){if(s-o<=i)return;const p=o+s>>1;om(r,e,p,o,s,h),Kh(r,e,i,o,p-1,1-h),Kh(r,e,i,p+1,s,1-h)}function om(r,e,i,o,s,h){for(;s>o;){if(s-o>600){const w=s-o+1,E=i-o+1,P=Math.log(w),D=.5*Math.exp(2*P/3),B=.5*Math.sqrt(P*D*(w-D)/w)*(E-w/2<0?-1:1);om(r,e,i,Math.max(o,Math.floor(i-E*D/w+B)),Math.min(s,Math.floor(i+(w-E)*D/w+B)),h)}const p=e[2*i+h];let m=o,x=s;for(Cc(r,e,o,i),e[2*s+h]>p&&Cc(r,e,o,s);m<x;){for(Cc(r,e,m,x),m++,x--;e[2*m+h]<p;)m++;for(;e[2*x+h]>p;)x--}e[2*o+h]===p?Cc(r,e,o,x):(x++,Cc(r,e,x,s)),x<=i&&(o=x+1),i<=x&&(s=x-1)}}function Cc(r,e,i,o){Yh(r,i,o),Yh(e,2*i,2*o),Yh(e,2*i+1,2*o+1)}function Yh(r,e,i){const o=r[e];r[e]=r[i],r[i]=o}function am(r,e,i,o){const s=r-i,h=e-o;return s*s+h*h}var Qh;A.be=void 0,(Qh=A.be||(A.be={})).create="create",Qh.load="load",Qh.fullLoad="fullLoad";let Au=null,Ec=[];const ed=1e3/60,td="loadTime",rd="fullLoadTime",pv={mark(r){performance.mark(r)},frame(r){const e=r;Au!=null&&Ec.push(e-Au),Au=e},clearMetrics(){Au=null,Ec=[],performance.clearMeasures(td),performance.clearMeasures(rd);for(const r in A.be)performance.clearMarks(A.be[r])},getPerformanceMetrics(){performance.measure(td,A.be.create,A.be.load),performance.measure(rd,A.be.create,A.be.fullLoad);const r=performance.getEntriesByName(td)[0].duration,e=performance.getEntriesByName(rd)[0].duration,i=Ec.length,o=1/(Ec.reduce((h,p)=>h+p,0)/i/1e3),s=Ec.filter(h=>h>ed).reduce((h,p)=>h+(p-ed)/ed,0);return{loadTime:r,fullLoadTime:e,fps:o,percentDroppedFrames:s/(i+s)*100,totalFrames:i}}};A.$=ni,A.A=gl,A.B=function(r){if(di==null){const e=r.navigator?r.navigator.userAgent:null;di=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return di},A.C=class{constructor(r,e){this.target=r,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new iv(()=>this.process()),this.subscription=function(i,o,s,h){return i.addEventListener(o,s,!1),{unsubscribe:()=>{i.removeEventListener(o,s,!1)}}}(this.target,"message",i=>this.receive(i)),this.globalScope=ti(self)?r:window}registerMessageHandler(r,e){this.messageHandlers[r]=e}sendAsync(r,e){return new Promise((i,o)=>{const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[s]={resolve:i,reject:o},e&&e.signal.addEventListener("abort",()=>{delete this.resolveRejects[s];const m={id:s,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(m)},{once:!0});const h=[],p=Object.assign(Object.assign({},r),{id:s,sourceMapId:this.mapId,origin:location.origin,data:Fs(r.data,h)});this.target.postMessage(p,{transfer:h})})}receive(r){const e=r.data,i=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[i];const o=this.abortControllers[i];return delete this.abortControllers[i],void(o&&o.abort())}if(ti(self)||e.mustQueue)return this.tasks[i]=e,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,e)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),e=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(r,e)}processTask(r,e){return u(this,void 0,void 0,function*(){if(e.type==="<response>"){const s=this.resolveRejects[r];return delete this.resolveRejects[r],s?void(e.error?s.reject(ro(e.error)):s.resolve(ro(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const i=ro(e.data),o=new AbortController;this.abortControllers[r]=o;try{const s=yield this.messageHandlers[e.type](e.sourceMapId,i,o);this.completeTask(r,null,s)}catch(s){this.completeTask(r,s)}})}completeTask(r,e,i){const o=[];delete this.abortControllers[r];const s={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Fs(e):null,data:Fs(i,o)};this.target.postMessage(s,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},A.D=ht,A.E=zo,A.F=function(){var r=new gl(16);return gl!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},A.G=jr,A.H=function(r,e,i){var o,s,h,p,m,x,w,E,P,D,B,N,q=i[0],H=i[1],Q=i[2];return e===r?(r[12]=e[0]*q+e[4]*H+e[8]*Q+e[12],r[13]=e[1]*q+e[5]*H+e[9]*Q+e[13],r[14]=e[2]*q+e[6]*H+e[10]*Q+e[14],r[15]=e[3]*q+e[7]*H+e[11]*Q+e[15]):(s=e[1],h=e[2],p=e[3],m=e[4],x=e[5],w=e[6],E=e[7],P=e[8],D=e[9],B=e[10],N=e[11],r[0]=o=e[0],r[1]=s,r[2]=h,r[3]=p,r[4]=m,r[5]=x,r[6]=w,r[7]=E,r[8]=P,r[9]=D,r[10]=B,r[11]=N,r[12]=o*q+m*H+P*Q+e[12],r[13]=s*q+x*H+D*Q+e[13],r[14]=h*q+w*H+B*Q+e[14],r[15]=p*q+E*H+N*Q+e[15]),r},A.I=Rh,A.J=function(r,e,i){var o=i[0],s=i[1],h=i[2];return r[0]=e[0]*o,r[1]=e[1]*o,r[2]=e[2]*o,r[3]=e[3]*o,r[4]=e[4]*s,r[5]=e[5]*s,r[6]=e[6]*s,r[7]=e[7]*s,r[8]=e[8]*h,r[9]=e[9]*h,r[10]=e[10]*h,r[11]=e[11]*h,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},A.K=jp,A.L=function(r,e){const i={};for(let o=0;o<e.length;o++){const s=e[o];s in r&&(i[s]=r[s])}return i},A.M=us,A.N=Lf,A.O=Bf,A.P=ve,A.Q=Vn,A.R=$n,A.S=zt,A.T=ts,A.U=tr,A.V=bi,A.W=Kr,A.X=C,A.Y=Su,A.Z=class extends U{},A._=u,A.a=Zi,A.a$=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},A.a0=Wh,A.a1=Re,A.a2=r=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(i=>{e.onloadstart=()=>{i(e)};for(const o of r){const s=window.document.createElement("source");Mt(o)||(e.crossOrigin="Anonymous"),s.src=o,e.appendChild(s)}})},A.a3=function(){return cr++},A.a4=Dt,A.a5=wl,A.a6=ks,A.a7=js,A.a8=_r,A.a9=Vf,A.aA=function(r){if(r.type==="custom")return new rv(r);switch(r.type){case"background":return new Qx(r);case"circle":return new $_(r);case"fill":return new nx(r);case"fill-extrusion":return new xx(r);case"heatmap":return new U_(r);case"hillshade":return new G_(r);case"line":return new Ex(r);case"raster":return new tv(r);case"symbol":return new wu(r)}},A.aB=Ft,A.aC=function(r,e){if(!r)return[{command:"setStyle",args:[e]}];let i=[];try{if(!Kt(r.version,e.version))return[{command:"setStyle",args:[e]}];Kt(r.center,e.center)||i.push({command:"setCenter",args:[e.center]}),Kt(r.zoom,e.zoom)||i.push({command:"setZoom",args:[e.zoom]}),Kt(r.bearing,e.bearing)||i.push({command:"setBearing",args:[e.bearing]}),Kt(r.pitch,e.pitch)||i.push({command:"setPitch",args:[e.pitch]}),Kt(r.sprite,e.sprite)||i.push({command:"setSprite",args:[e.sprite]}),Kt(r.glyphs,e.glyphs)||i.push({command:"setGlyphs",args:[e.glyphs]}),Kt(r.transition,e.transition)||i.push({command:"setTransition",args:[e.transition]}),Kt(r.light,e.light)||i.push({command:"setLight",args:[e.light]}),Kt(r.terrain,e.terrain)||i.push({command:"setTerrain",args:[e.terrain]}),Kt(r.sky,e.sky)||i.push({command:"setSky",args:[e.sky]});const o={},s=[];(function(p,m,x,w){let E;for(E in m=m||{},p=p||{})Object.prototype.hasOwnProperty.call(p,E)&&(Object.prototype.hasOwnProperty.call(m,E)||Do(E,x,w));for(E in m)Object.prototype.hasOwnProperty.call(m,E)&&(Object.prototype.hasOwnProperty.call(p,E)?Kt(p[E],m[E])||(p[E].type==="geojson"&&m[E].type==="geojson"&&kn(p,m,E)?qt(x,{command:"setGeoJSONSourceData",args:[E,m[E].data]}):Fo(E,m,x,w)):Mn(E,m,x))})(r.sources,e.sources,s,o);const h=[];r.layers&&r.layers.forEach(p=>{"source"in p&&o[p.source]?i.push({command:"removeLayer",args:[p.id]}):h.push(p)}),i=i.concat(s),function(p,m,x){m=m||[];const w=(p=p||[]).map(Hi),E=m.map(Hi),P=p.reduce(Lo,{}),D=m.reduce(Lo,{}),B=w.slice(),N=Object.create(null);let q,H,Q,ge,re;for(let de=0,Ie=0;de<w.length;de++)q=w[de],Object.prototype.hasOwnProperty.call(D,q)?Ie++:(qt(x,{command:"removeLayer",args:[q]}),B.splice(B.indexOf(q,Ie),1));for(let de=0,Ie=0;de<E.length;de++)q=E[E.length-1-de],B[B.length-1-de]!==q&&(Object.prototype.hasOwnProperty.call(P,q)?(qt(x,{command:"removeLayer",args:[q]}),B.splice(B.lastIndexOf(q,B.length-Ie),1)):Ie++,ge=B[B.length-de],qt(x,{command:"addLayer",args:[D[q],ge]}),B.splice(B.length-de,0,q),N[q]=!0);for(let de=0;de<E.length;de++)if(q=E[de],H=P[q],Q=D[q],!N[q]&&!Kt(H,Q))if(Kt(H.source,Q.source)&&Kt(H["source-layer"],Q["source-layer"])&&Kt(H.type,Q.type)){for(re in xn(H.layout,Q.layout,x,q,null,"setLayoutProperty"),xn(H.paint,Q.paint,x,q,null,"setPaintProperty"),Kt(H.filter,Q.filter)||qt(x,{command:"setFilter",args:[q,Q.filter]}),Kt(H.minzoom,Q.minzoom)&&Kt(H.maxzoom,Q.maxzoom)||qt(x,{command:"setLayerZoomRange",args:[q,Q.minzoom,Q.maxzoom]}),H)Object.prototype.hasOwnProperty.call(H,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?xn(H[re],Q[re],x,q,re.slice(6),"setPaintProperty"):Kt(H[re],Q[re])||qt(x,{command:"setLayerProperty",args:[q,re,Q[re]]}));for(re in Q)Object.prototype.hasOwnProperty.call(Q,re)&&!Object.prototype.hasOwnProperty.call(H,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?xn(H[re],Q[re],x,q,re.slice(6),"setPaintProperty"):Kt(H[re],Q[re])||qt(x,{command:"setLayerProperty",args:[q,re,Q[re]]}))}else qt(x,{command:"removeLayer",args:[q]}),ge=B[B.lastIndexOf(q)+1],qt(x,{command:"addLayer",args:[Q,ge]})}(h,e.layers,i)}catch(o){console.warn("Unable to compute style diff:",o),i=[{command:"setStyle",args:[e]}]}return i},A.aD=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},A.aE=function r(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let o=0;o<e.length;o++)if(!r(e[o],i[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&i!==null){if(typeof i!="object"||Object.keys(e).length!==Object.keys(i).length)return!1;for(const o in e)if(!r(e[o],i[o]))return!1;return!0}return e===i},A.aF=Cr,A.aG=li,A.aH=class extends Bs{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},A.aI=lu,A.aJ=class extends Bs{constructor(r,e){super(r,e),this.current=D_}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},A.aK=Ap,A.aL=class extends Bs{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},A.aM=class extends Bs{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},A.aN=Pp,A.aO=function(r,e,i,o,s,h,p){var m=1/(e-i),x=1/(o-s),w=1/(h-p);return r[0]=-2*m,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*w,r[11]=0,r[12]=(e+i)*m,r[13]=(s+o)*x,r[14]=(p+h)*w,r[15]=1,r},A.aP=Vt,A.aQ=N_,A.aR=class extends Ce{},A.aS=kx,A.aT=class extends Qe{},A.aU=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},A.aV=qp,A.aW=ka,A.aX=class extends He{},A.aY=ui,A.aZ=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15]},A.a_=function(r,e){var i=r[0],o=r[1],s=r[2],h=r[3],p=r[4],m=r[5],x=r[6],w=r[7],E=r[8],P=r[9],D=r[10],B=r[11],N=r[12],q=r[13],H=r[14],Q=r[15],ge=e[0],re=e[1],de=e[2],Ie=e[3],Ee=e[4],Ye=e[5],lt=e[6],Xe=e[7],qe=e[8],it=e[9],pt=e[10],Je=e[11],Pe=e[12],st=e[13],nt=e[14],At=e[15];return Math.abs(i-ge)<=Qi*Math.max(1,Math.abs(i),Math.abs(ge))&&Math.abs(o-re)<=Qi*Math.max(1,Math.abs(o),Math.abs(re))&&Math.abs(s-de)<=Qi*Math.max(1,Math.abs(s),Math.abs(de))&&Math.abs(h-Ie)<=Qi*Math.max(1,Math.abs(h),Math.abs(Ie))&&Math.abs(p-Ee)<=Qi*Math.max(1,Math.abs(p),Math.abs(Ee))&&Math.abs(m-Ye)<=Qi*Math.max(1,Math.abs(m),Math.abs(Ye))&&Math.abs(x-lt)<=Qi*Math.max(1,Math.abs(x),Math.abs(lt))&&Math.abs(w-Xe)<=Qi*Math.max(1,Math.abs(w),Math.abs(Xe))&&Math.abs(E-qe)<=Qi*Math.max(1,Math.abs(E),Math.abs(qe))&&Math.abs(P-it)<=Qi*Math.max(1,Math.abs(P),Math.abs(it))&&Math.abs(D-pt)<=Qi*Math.max(1,Math.abs(D),Math.abs(pt))&&Math.abs(B-Je)<=Qi*Math.max(1,Math.abs(B),Math.abs(Je))&&Math.abs(N-Pe)<=Qi*Math.max(1,Math.abs(N),Math.abs(Pe))&&Math.abs(q-st)<=Qi*Math.max(1,Math.abs(q),Math.abs(st))&&Math.abs(H-nt)<=Qi*Math.max(1,Math.abs(H),Math.abs(nt))&&Math.abs(Q-At)<=Qi*Math.max(1,Math.abs(Q),Math.abs(At))},A.aa=function(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,s,h)=>{const p=s||h;return e[o]=!p||p.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e},A.ab=function(r,e){const i=[];for(const o in r)o in e||i.push(o);return i},A.ac=Nt,A.ad=function(r,e,i){var o=Math.sin(i),s=Math.cos(i),h=e[0],p=e[1],m=e[2],x=e[3],w=e[4],E=e[5],P=e[6],D=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=h*s+w*o,r[1]=p*s+E*o,r[2]=m*s+P*o,r[3]=x*s+D*o,r[4]=w*s-h*o,r[5]=E*s-p*o,r[6]=P*s-m*o,r[7]=D*s-x*o,r},A.ae=function(r){var e=new gl(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},A.af=du,A.ag=function(r,e){let i=0,o=0;if(r.kind==="constant")o=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:s,minZoom:h,maxZoom:p}=r,m=s?Nt(Wt.interpolationFactor(s,e,h,p),0,1):0;r.kind==="camera"?o=gt.number(r.minSize,r.maxSize,m):i=m}return{uSizeT:i,uSize:o}},A.ai=function(r,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:s}){return r.kind==="source"?o/sa:r.kind==="composite"?gt.number(o/sa,s/sa,i):e},A.aj=$h,A.ak=function(r,e,i,o){const s=e.y-r.y,h=e.x-r.x,p=o.y-i.y,m=o.x-i.x,x=p*h-m*s;if(x===0)return null;const w=(m*(r.y-i.y)-p*(r.x-i.x))/x;return new ve(r.x+w*h,r.y+w*s)},A.al=Zf,A.am=Dp,A.an=bh,A.ao=function(r){let e=1/0,i=1/0,o=-1/0,s=-1/0;for(const h of r)e=Math.min(e,h.x),i=Math.min(i,h.y),o=Math.max(o,h.x),s=Math.max(s,h.y);return[e,i,o,s]},A.ap=oi,A.ar=Nh,A.as=function(r,e){var i=e[0],o=e[1],s=e[2],h=e[3],p=e[4],m=e[5],x=e[6],w=e[7],E=e[8],P=e[9],D=e[10],B=e[11],N=e[12],q=e[13],H=e[14],Q=e[15],ge=i*m-o*p,re=i*x-s*p,de=i*w-h*p,Ie=o*x-s*m,Ee=o*w-h*m,Ye=s*w-h*x,lt=E*q-P*N,Xe=E*H-D*N,qe=E*Q-B*N,it=P*H-D*q,pt=P*Q-B*q,Je=D*Q-B*H,Pe=ge*Je-re*pt+de*it+Ie*qe-Ee*Xe+Ye*lt;return Pe?(r[0]=(m*Je-x*pt+w*it)*(Pe=1/Pe),r[1]=(s*pt-o*Je-h*it)*Pe,r[2]=(q*Ye-H*Ee+Q*Ie)*Pe,r[3]=(D*Ee-P*Ye-B*Ie)*Pe,r[4]=(x*qe-p*Je-w*Xe)*Pe,r[5]=(i*Je-s*qe+h*Xe)*Pe,r[6]=(H*de-N*Ye-Q*re)*Pe,r[7]=(E*Ye-D*de+B*re)*Pe,r[8]=(p*pt-m*qe+w*lt)*Pe,r[9]=(o*qe-i*pt-h*lt)*Pe,r[10]=(N*Ee-q*de+Q*ge)*Pe,r[11]=(P*de-E*Ee-B*ge)*Pe,r[12]=(m*Xe-p*it-x*lt)*Pe,r[13]=(i*it-o*Xe+s*lt)*Pe,r[14]=(q*re-N*Ie-H*ge)*Pe,r[15]=(E*Ie-P*re+D*ge)*Pe,r):null},A.at=Xh,A.au=jh,A.av=Jh,A.aw=function(){const r={},e=be.$version;for(const i in be.$root){const o=be.$root[i];if(o.required){let s=null;s=i==="version"?e:o.type==="array"?[]:{},s!=null&&(r[i]=s)}}return r},A.ax=eu,A.ay=Wi,A.az=function(r){r=r.slice();const e=Object.create(null);for(let i=0;i<r.length;i++)e[r[i].id]=r[i];for(let i=0;i<r.length;i++)"ref"in r[i]&&(r[i]=fa(r[i],e[r[i].ref]));return r},A.b=pi,A.b0=function(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r[3]=e[3]*i[3],r},A.b1=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]},A.b2=tt,A.b3=jf,A.b4=Rf,A.b5=function(r,e,i,o,s){var h,p=1/Math.tan(e/2);return r[0]=p/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=p,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,s!=null&&s!==1/0?(r[10]=(s+o)*(h=1/(o-s)),r[14]=2*s*o*h):(r[10]=-1,r[14]=-2*o),r},A.b6=function(r,e,i){var o=Math.sin(i),s=Math.cos(i),h=e[4],p=e[5],m=e[6],x=e[7],w=e[8],E=e[9],P=e[10],D=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=h*s+w*o,r[5]=p*s+E*o,r[6]=m*s+P*o,r[7]=x*s+D*o,r[8]=w*s-h*o,r[9]=E*s-p*o,r[10]=P*s-m*o,r[11]=D*s-x*o,r},A.b7=bt,A.b8=Pt,A.b9=function(r){return r*Math.PI/180},A.bA=Ji,A.bB=na,A.ba=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},A.bb=class extends j{},A.bc=Gh,A.bd=pv,A.bf=nn,A.bg=function(r,e){Zi.REGISTERED_PROTOCOLS[r]=e},A.bh=function(r){delete Zi.REGISTERED_PROTOCOLS[r]},A.bi=function(r,e){const i={};for(let s=0;s<r.length;s++){const h=e&&e[r[s].id]||eo(r[s]);e&&(e[r[s].id]=h);let p=i[h];p||(p=i[h]=[]),p.push(r[s])}const o=[];for(const s in i)o.push(i[s]);return o},A.bj=rt,A.bk=$f,A.bl=Uf,A.bm=vf,A.bn=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=Kr/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const e=r.bucket.layers[0],i=e.layout,o=e._unevaluatedLayout._values,s={layoutIconSize:o["icon-size"].possiblyEvaluate(new _r(r.bucket.zoom+1),r.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new _r(r.bucket.zoom+1),r.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new _r(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:w,maxZoom:E}=r.bucket.textSizeData;s.compositeTextSizes=[o["text-size"].possiblyEvaluate(new _r(w),r.canonical),o["text-size"].possiblyEvaluate(new _r(E),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:w,maxZoom:E}=r.bucket.iconSizeData;s.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new _r(w),r.canonical),o["icon-size"].possiblyEvaluate(new _r(E),r.canonical)]}const h=i.get("text-line-height")*oi,p=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",m=i.get("text-keep-upright"),x=i.get("text-size");for(const w of r.bucket.features){const E=i.get("text-font").evaluate(w,{},r.canonical).join(","),P=x.evaluate(w,{},r.canonical),D=s.layoutTextSize.evaluate(w,{},r.canonical),B=s.layoutIconSize.evaluate(w,{},r.canonical),N={horizontal:{},vertical:void 0},q=w.text;let H,Q=[0,0];if(q){const de=q.toString(),Ie=i.get("text-letter-spacing").evaluate(w,{},r.canonical)*oi,Ee=fh(de)?Ie:0,Ye=i.get("text-anchor").evaluate(w,{},r.canonical),lt=tm(e,w,r.canonical);if(!lt){const Je=i.get("text-radial-offset").evaluate(w,{},r.canonical);Q=Je?em(Ye,[Je*oi,Hh]):i.get("text-offset").evaluate(w,{},r.canonical).map(Pe=>Pe*oi)}let Xe=p?"center":i.get("text-justify").evaluate(w,{},r.canonical);const qe=i.get("symbol-placement"),it=qe==="point"?i.get("text-max-width").evaluate(w,{},r.canonical)*oi:0,pt=()=>{r.bucket.allowVerticalPlacement&&ic(de)&&(N.vertical=xu(q,r.glyphMap,r.glyphPositions,r.imagePositions,E,it,h,Ye,"left",Ee,Q,A.ah.vertical,!0,qe,D,P))};if(!p&&lt){const Je=new Set;if(Xe==="auto")for(let st=0;st<lt.values.length;st+=2)Je.add(Xh(lt.values[st]));else Je.add(Xe);let Pe=!1;for(const st of Je)if(!N.horizontal[st])if(Pe)N.horizontal[st]=N.horizontal[0];else{const nt=xu(q,r.glyphMap,r.glyphPositions,r.imagePositions,E,it,h,"center",st,Ee,Q,A.ah.horizontal,!1,qe,D,P);nt&&(N.horizontal[st]=nt,Pe=nt.positionedLines.length===1)}pt()}else{Xe==="auto"&&(Xe=Xh(Ye));const Je=xu(q,r.glyphMap,r.glyphPositions,r.imagePositions,E,it,h,Ye,Xe,Ee,Q,A.ah.horizontal,!1,qe,D,P);Je&&(N.horizontal[Xe]=Je),pt(),ic(de)&&p&&m&&(N.vertical=xu(q,r.glyphMap,r.glyphPositions,r.imagePositions,E,it,h,Ye,Xe,Ee,Q,A.ah.vertical,!1,qe,D,P))}}let ge=!1;if(w.icon&&w.icon.name){const de=r.imageMap[w.icon.name];de&&(H=Hx(r.imagePositions[w.icon.name],i.get("icon-offset").evaluate(w,{},r.canonical),i.get("icon-anchor").evaluate(w,{},r.canonical)),ge=!!de.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=ge:r.bucket.sdfIcons!==ge&&rr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(de.pixelRatio!==r.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const re=im(N.horizontal)||N.vertical;r.bucket.iconsInText=!!re&&re.iconsInText,(re||H)&&hv(r.bucket,w,N,H,r.imageMap,s,D,B,Q,ge,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},A.bo=Dh,A.bp=Mh,A.bq=zh,A.br=ss,A.bs=Lh,A.bt=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},A.bu=function(r,e,i,o,s){return u(this,void 0,void 0,function*(){if(tr())try{return yield bi(r,e,i,o,s)}catch{}return function(h,p,m,x,w){const E=h.width,P=h.height;Ar&&nr||(Ar=new OffscreenCanvas(E,P),nr=Ar.getContext("2d",{willReadFrequently:!0})),Ar.width=E,Ar.height=P,nr.drawImage(h,0,0,E,P);const D=nr.getImageData(p,m,x,w);return nr.clearRect(0,0,E,P),D.data}(r,e,i,o,s)})},A.bv=Nf,A.bw=le,A.bx=Ae,A.by=hf,A.bz=function(r){return r.message===Xr},A.c=ur,A.d=r=>u(void 0,void 0,void 0,function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(e)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),A.e=Ot,A.f=r=>new Promise((e,i)=>{const o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=yn})},o.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const s=new Blob([new Uint8Array(r)],{type:"image/png"});o.src=r.byteLength?URL.createObjectURL(s):yn}),A.g=ri,A.h=(r,e)=>qr(Ot(r,{type:"json"}),e),A.i=ti,A.j=vr,A.k=Hn,A.l=(r,e)=>qr(Ot(r,{type:"arrayBuffer"}),e),A.m=qr,A.n=function(r){return new Lh(r).readFields(Vx,[])},A.o=mc,A.p=xf,A.q=a,A.r=ph,A.s=Mt,A.t=rc,A.u=Ke,A.v=be,A.w=rr,A.x=zs,A.y=function([r,e,i]){return e+=90,e*=Math.PI/180,i*=Math.PI/180,{x:r*Math.cos(e)*Math.sin(i),y:r*Math.sin(e)*Math.sin(i),z:r*Math.cos(i)}},A.z=gt}),R("worker",["./shared"],function(A){class u{constructor(F){this.keyCache={},F&&this.replace(F)}replace(F){this._layerConfigs={},this._layers={},this.update(F,[])}update(F,L){for(const X of F){this._layerConfigs[X.id]=X;const ie=this._layers[X.id]=A.aA(X);ie._featureFilter=A.a6(ie.filter),this.keyCache[X.id]&&delete this.keyCache[X.id]}for(const X of L)delete this.keyCache[X],delete this._layerConfigs[X],delete this._layers[X];this.familiesBySource={};const $=A.bi(Object.values(this._layerConfigs),this.keyCache);for(const X of $){const ie=X.map(Se=>this._layers[Se.id]),ue=ie[0];if(ue.visibility==="none")continue;const pe=ue.source||"";let te=this.familiesBySource[pe];te||(te=this.familiesBySource[pe]={});const _e=ue.sourceLayer||"_geojsonTileLayer";let Me=te[_e];Me||(Me=te[_e]=[]),Me.push(ie)}}}class le{constructor(F){const L={},$=[];for(const pe in F){const te=F[pe],_e=L[pe]={};for(const Me in te){const Se=te[+Me];if(!Se||Se.bitmap.width===0||Se.bitmap.height===0)continue;const Te={x:0,y:0,w:Se.bitmap.width+2,h:Se.bitmap.height+2};$.push(Te),_e[Me]={rect:Te,metrics:Se.metrics}}}const{w:X,h:ie}=A.p($),ue=new A.o({width:X||1,height:ie||1});for(const pe in F){const te=F[pe];for(const _e in te){const Me=te[+_e];if(!Me||Me.bitmap.width===0||Me.bitmap.height===0)continue;const Se=L[pe][_e].rect;A.o.copy(Me.bitmap,ue,{x:0,y:0},{x:Se.x+1,y:Se.y+1},Me.bitmap)}}this.image=ue,this.positions=L}}A.bj("GlyphAtlas",le);class Ae{constructor(F){this.tileID=new A.Q(F.tileID.overscaledZ,F.tileID.wrap,F.tileID.canonical.z,F.tileID.canonical.x,F.tileID.canonical.y),this.uid=F.uid,this.zoom=F.zoom,this.pixelRatio=F.pixelRatio,this.tileSize=F.tileSize,this.source=F.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=F.showCollisionBoxes,this.collectResourceTiming=!!F.collectResourceTiming,this.returnDependencies=!!F.returnDependencies,this.promoteId=F.promoteId,this.inFlightDependencies=[]}parse(F,L,$,X){return A._(this,void 0,void 0,function*(){this.status="parsing",this.data=F,this.collisionBoxArray=new A.a4;const ie=new A.bk(Object.keys(F.layers).sort()),ue=new A.bl(this.tileID,this.promoteId);ue.bucketLayerIDs=[];const pe={},te={featureIndex:ue,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:$},_e=L.familiesBySource[this.source];for(const mt in _e){const br=F.layers[mt];if(!br)continue;br.version===1&&A.w(`Vector tile source "${this.source}" layer "${mt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Gr=ie.encode(mt),Si=[];for(let Ti=0;Ti<br.length;Ti++){const Zr=br.feature(Ti),Xn=ue.getId(Zr,mt);Si.push({feature:Zr,id:Xn,index:Ti,sourceLayerIndex:Gr})}for(const Ti of _e[mt]){const Zr=Ti[0];Zr.source!==this.source&&A.w(`layer.source = ${Zr.source} does not equal this.source = ${this.source}`),Zr.minzoom&&this.zoom<Math.floor(Zr.minzoom)||Zr.maxzoom&&this.zoom>=Zr.maxzoom||Zr.visibility!=="none"&&(Ne(Ti,this.zoom,$),(pe[Zr.id]=Zr.createBucket({index:ue.bucketLayerIDs.length,layers:Ti,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Gr,sourceID:this.source})).populate(Si,te,this.tileID.canonical),ue.bucketLayerIDs.push(Ti.map(Xn=>Xn.id)))}}const Me=A.aF(te.glyphDependencies,mt=>Object.keys(mt).map(Number));this.inFlightDependencies.forEach(mt=>mt?.abort()),this.inFlightDependencies=[];let Se=Promise.resolve({});if(Object.keys(Me).length){const mt=new AbortController;this.inFlightDependencies.push(mt),Se=X.sendAsync({type:"GG",data:{stacks:Me,source:this.source,tileID:this.tileID,type:"glyphs"}},mt)}const Te=Object.keys(te.iconDependencies);let dt=Promise.resolve({});if(Te.length){const mt=new AbortController;this.inFlightDependencies.push(mt),dt=X.sendAsync({type:"GI",data:{icons:Te,source:this.source,tileID:this.tileID,type:"icons"}},mt)}const ut=Object.keys(te.patternDependencies);let Et=Promise.resolve({});if(ut.length){const mt=new AbortController;this.inFlightDependencies.push(mt),Et=X.sendAsync({type:"GI",data:{icons:ut,source:this.source,tileID:this.tileID,type:"patterns"}},mt)}const[vt,Bt,Gt]=yield Promise.all([Se,dt,Et]),hr=new le(vt),$r=new A.bm(Bt,Gt);for(const mt in pe){const br=pe[mt];br instanceof A.a5?(Ne(br.layers,this.zoom,$),A.bn({bucket:br,glyphMap:vt,glyphPositions:hr.positions,imageMap:Bt,imagePositions:$r.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):br.hasPattern&&(br instanceof A.bo||br instanceof A.bp||br instanceof A.bq)&&(Ne(br.layers,this.zoom,$),br.addFeatures(te,this.tileID.canonical,$r.patternPositions))}return this.status="done",{buckets:Object.values(pe).filter(mt=>!mt.isEmpty()),featureIndex:ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:hr.image,imageAtlas:$r,glyphMap:this.returnDependencies?vt:null,iconMap:this.returnDependencies?Bt:null,glyphPositions:this.returnDependencies?hr.positions:null}})}}function Ne(Z,F,L){const $=new A.a8(F);for(const X of Z)X.recalculate($,L)}class ve{constructor(F,L,$){this.actor=F,this.layerIndex=L,this.availableImages=$,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(F,L){return A._(this,void 0,void 0,function*(){const $=yield A.l(F.request,L);try{return{vectorTile:new A.br.VectorTile(new A.bs($.data)),rawData:$.data,cacheControl:$.cacheControl,expires:$.expires}}catch(X){const ie=new Uint8Array($.data);let ue=`Unable to parse the tile at ${F.request.url}, `;throw ue+=ie[0]===31&&ie[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${X.messge}`,new Error(ue)}})}loadTile(F){return A._(this,void 0,void 0,function*(){const L=F.uid,$=!!(F&&F.request&&F.request.collectResourceTiming)&&new A.bt(F.request),X=new Ae(F);this.loading[L]=X;const ie=new AbortController;X.abort=ie;try{const ue=yield this.loadVectorTile(F,ie);if(delete this.loading[L],!ue)return null;const pe=ue.rawData,te={};ue.expires&&(te.expires=ue.expires),ue.cacheControl&&(te.cacheControl=ue.cacheControl);const _e={};if($){const Se=$.finish();Se&&(_e.resourceTiming=JSON.parse(JSON.stringify(Se)))}X.vectorTile=ue.vectorTile;const Me=X.parse(ue.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[L]=X,this.fetching[L]={rawTileData:pe,cacheControl:te,resourceTiming:_e};try{const Se=yield Me;return A.e({rawTileData:pe.slice(0)},Se,te,_e)}finally{delete this.fetching[L]}}catch(ue){throw delete this.loading[L],X.status="done",this.loaded[L]=X,ue}})}reloadTile(F){return A._(this,void 0,void 0,function*(){const L=F.uid;if(!this.loaded||!this.loaded[L])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const $=this.loaded[L];if($.showCollisionBoxes=F.showCollisionBoxes,$.status==="parsing"){const X=yield $.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor);let ie;if(this.fetching[L]){const{rawTileData:ue,cacheControl:pe,resourceTiming:te}=this.fetching[L];delete this.fetching[L],ie=A.e({rawTileData:ue.slice(0)},X,pe,te)}else ie=X;return ie}if($.status==="done"&&$.vectorTile)return $.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(F){return A._(this,void 0,void 0,function*(){const L=this.loading,$=F.uid;L&&L[$]&&L[$].abort&&(L[$].abort.abort(),delete L[$])})}removeTile(F){return A._(this,void 0,void 0,function*(){this.loaded&&this.loaded[F.uid]&&delete this.loaded[F.uid]})}}class se{constructor(){this.loaded={}}loadTile(F){return A._(this,void 0,void 0,function*(){const{uid:L,encoding:$,rawImageData:X,redFactor:ie,greenFactor:ue,blueFactor:pe,baseShift:te}=F,_e=X.width+2,Me=X.height+2,Se=A.b(X)?new A.R({width:_e,height:Me},yield A.bu(X,-1,-1,_e,Me)):X,Te=new A.bv(L,Se,$,ie,ue,pe,te);return this.loaded=this.loaded||{},this.loaded[L]=Te,Te})}removeTile(F){const L=this.loaded,$=F.uid;L&&L[$]&&delete L[$]}}function Ge(Z,F){if(Z.length!==0){yt(Z[0],F);for(var L=1;L<Z.length;L++)yt(Z[L],!F)}}function yt(Z,F){for(var L=0,$=0,X=0,ie=Z.length,ue=ie-1;X<ie;ue=X++){var pe=(Z[X][0]-Z[ue][0])*(Z[ue][1]+Z[X][1]),te=L+pe;$+=Math.abs(L)>=Math.abs(pe)?L-te+pe:pe-te+L,L=te}L+$>=0!=!!F&&Z.reverse()}var Fe=A.bw(function Z(F,L){var $,X=F&&F.type;if(X==="FeatureCollection")for($=0;$<F.features.length;$++)Z(F.features[$],L);else if(X==="GeometryCollection")for($=0;$<F.geometries.length;$++)Z(F.geometries[$],L);else if(X==="Feature")Z(F.geometry,L);else if(X==="Polygon")Ge(F.coordinates,L);else if(X==="MultiPolygon")for($=0;$<F.coordinates.length;$++)Ge(F.coordinates[$],L);return F});const ot=A.br.VectorTileFeature.prototype.toGeoJSON;var zt={exports:{}},tr=A.bx,bt=A.br.VectorTileFeature,Pt=Nt;function Nt(Z,F){this.options=F||{},this.features=Z,this.length=Z.length}function tt(Z,F){this.id=typeof Z.id=="number"?Z.id:void 0,this.type=Z.type,this.rawGeometry=Z.type===1?[Z.geometry]:Z.geometry,this.properties=Z.tags,this.extent=F||4096}Nt.prototype.feature=function(Z){return new tt(this.features[Z],this.options.extent)},tt.prototype.loadGeometry=function(){var Z=this.rawGeometry;this.geometry=[];for(var F=0;F<Z.length;F++){for(var L=Z[F],$=[],X=0;X<L.length;X++)$.push(new tr(L[X][0],L[X][1]));this.geometry.push($)}return this.geometry},tt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Z=this.geometry,F=1/0,L=-1/0,$=1/0,X=-1/0,ie=0;ie<Z.length;ie++)for(var ue=Z[ie],pe=0;pe<ue.length;pe++){var te=ue[pe];F=Math.min(F,te.x),L=Math.max(L,te.x),$=Math.min($,te.y),X=Math.max(X,te.y)}return[F,$,L,X]},tt.prototype.toGeoJSON=bt.prototype.toGeoJSON;var Ot=A.by,cr=Pt;function Cr(Z){var F=new Ot;return function(L,$){for(var X in L.layers)$.writeMessage(3,li,L.layers[X])}(Z,F),F.finish()}function li(Z,F){var L;F.writeVarintField(15,Z.version||1),F.writeStringField(1,Z.name||""),F.writeVarintField(5,Z.extent||4096);var $={keys:[],values:[],keycache:{},valuecache:{}};for(L=0;L<Z.length;L++)$.feature=Z.feature(L),F.writeMessage(2,Ft,$);var X=$.keys;for(L=0;L<X.length;L++)F.writeStringField(3,X[L]);var ie=$.values;for(L=0;L<ie.length;L++)F.writeMessage(4,di,ie[L])}function Ft(Z,F){var L=Z.feature;L.id!==void 0&&F.writeVarintField(1,L.id),F.writeMessage(2,Er,Z),F.writeVarintField(3,L.type),F.writeMessage(4,ti,L)}function Er(Z,F){var L=Z.feature,$=Z.keys,X=Z.values,ie=Z.keycache,ue=Z.valuecache;for(var pe in L.properties){var te=L.properties[pe],_e=ie[pe];if(te!==null){_e===void 0&&($.push(pe),ie[pe]=_e=$.length-1),F.writeVarint(_e);var Me=typeof te;Me!=="string"&&Me!=="boolean"&&Me!=="number"&&(te=JSON.stringify(te));var Se=Me+":"+te,Te=ue[Se];Te===void 0&&(X.push(te),ue[Se]=Te=X.length-1),F.writeVarint(Te)}}}function rr(Z,F){return(F<<3)+(7&Z)}function $t(Z){return Z<<1^Z>>31}function ti(Z,F){for(var L=Z.loadGeometry(),$=Z.type,X=0,ie=0,ue=L.length,pe=0;pe<ue;pe++){var te=L[pe],_e=1;$===1&&(_e=te.length),F.writeVarint(rr(1,_e));for(var Me=$===3?te.length-1:te.length,Se=0;Se<Me;Se++){Se===1&&$!==1&&F.writeVarint(rr(2,Me-1));var Te=te[Se].x-X,dt=te[Se].y-ie;F.writeVarint($t(Te)),F.writeVarint($t(dt)),X+=Te,ie+=dt}$===3&&F.writeVarint(rr(7,1))}}function di(Z,F){var L=typeof Z;L==="string"?F.writeStringField(1,Z):L==="boolean"?F.writeBooleanField(7,Z):L==="number"&&(Z%1!=0?F.writeDoubleField(3,Z):Z<0?F.writeSVarintField(6,Z):F.writeVarintField(5,Z))}zt.exports=Cr,zt.exports.fromVectorTileJs=Cr,zt.exports.fromGeojsonVt=function(Z,F){F=F||{};var L={};for(var $ in Z)L[$]=new cr(Z[$].features,F),L[$].name=$,L[$].version=F.version,L[$].extent=F.extent;return Cr({layers:L})},zt.exports.GeoJSONWrapper=cr;var pi=A.bw(zt.exports);const yn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Z=>Z},bi=Math.fround||(Ar=new Float32Array(1),Z=>(Ar[0]=+Z,Ar[0]));var Ar;const nr=3,Xr=5,ur=6;class Zi{constructor(F){this.options=Object.assign(Object.create(yn),F),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(F){const{log:L,minZoom:$,maxZoom:X}=this.options;L&&console.time("total time");const ie=`prepare ${F.length} points`;L&&console.time(ie),this.points=F;const ue=[];for(let te=0;te<F.length;te++){const _e=F[te];if(!_e.geometry)continue;const[Me,Se]=_e.geometry.coordinates,Te=bi(nn(Me)),dt=bi(Wi(Se));ue.push(Te,dt,1/0,te,-1,1),this.options.reduce&&ue.push(0)}let pe=this.trees[X+1]=this._createTree(ue);L&&console.timeEnd(ie);for(let te=X;te>=$;te--){const _e=+Date.now();pe=this.trees[te]=this._createTree(this._cluster(pe,te)),L&&console.log("z%d: %d clusters in %dms",te,pe.numItems,+Date.now()-_e)}return L&&console.timeEnd("total time"),this}getClusters(F,L){let $=((F[0]+180)%360+360)%360-180;const X=Math.max(-90,Math.min(90,F[1]));let ie=F[2]===180?180:((F[2]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,F[3]));if(F[2]-F[0]>=360)$=-180,ie=180;else if($>ie){const Se=this.getClusters([$,X,180,ue],L),Te=this.getClusters([-180,X,ie,ue],L);return Se.concat(Te)}const pe=this.trees[this._limitZoom(L)],te=pe.range(nn($),Wi(ue),nn(ie),Wi(X)),_e=pe.data,Me=[];for(const Se of te){const Te=this.stride*Se;Me.push(_e[Te+Xr]>1?ri(_e,Te,this.clusterProps):this.points[_e[Te+nr]])}return Me}getChildren(F){const L=this._getOriginId(F),$=this._getOriginZoom(F),X="No cluster with the specified id.",ie=this.trees[$];if(!ie)throw new Error(X);const ue=ie.data;if(L*this.stride>=ue.length)throw new Error(X);const pe=this.options.radius/(this.options.extent*Math.pow(2,$-1)),te=ie.within(ue[L*this.stride],ue[L*this.stride+1],pe),_e=[];for(const Me of te){const Se=Me*this.stride;ue[Se+4]===F&&_e.push(ue[Se+Xr]>1?ri(ue,Se,this.clusterProps):this.points[ue[Se+nr]])}if(_e.length===0)throw new Error(X);return _e}getLeaves(F,L,$){const X=[];return this._appendLeaves(X,F,L=L||10,$=$||0,0),X}getTile(F,L,$){const X=this.trees[this._limitZoom(F)],ie=Math.pow(2,F),{extent:ue,radius:pe}=this.options,te=pe/ue,_e=($-te)/ie,Me=($+1+te)/ie,Se={features:[]};return this._addTileFeatures(X.range((L-te)/ie,_e,(L+1+te)/ie,Me),X.data,L,$,ie,Se),L===0&&this._addTileFeatures(X.range(1-te/ie,_e,1,Me),X.data,ie,$,ie,Se),L===ie-1&&this._addTileFeatures(X.range(0,_e,te/ie,Me),X.data,-1,$,ie,Se),Se.features.length?Se:null}getClusterExpansionZoom(F){let L=this._getOriginZoom(F)-1;for(;L<=this.options.maxZoom;){const $=this.getChildren(F);if(L++,$.length!==1)break;F=$[0].properties.cluster_id}return L}_appendLeaves(F,L,$,X,ie){const ue=this.getChildren(L);for(const pe of ue){const te=pe.properties;if(te&&te.cluster?ie+te.point_count<=X?ie+=te.point_count:ie=this._appendLeaves(F,te.cluster_id,$,X,ie):ie<X?ie++:F.push(pe),F.length===$)break}return ie}_createTree(F){const L=new A.av(F.length/this.stride|0,this.options.nodeSize,Float32Array);for(let $=0;$<F.length;$+=this.stride)L.add(F[$],F[$+1]);return L.finish(),L.data=F,L}_addTileFeatures(F,L,$,X,ie,ue){for(const pe of F){const te=pe*this.stride,_e=L[te+Xr]>1;let Me,Se,Te;if(_e)Me=jr(L,te,this.clusterProps),Se=L[te],Te=L[te+1];else{const Et=this.points[L[te+nr]];Me=Et.properties;const[vt,Bt]=Et.geometry.coordinates;Se=nn(vt),Te=Wi(Bt)}const dt={type:1,geometry:[[Math.round(this.options.extent*(Se*ie-$)),Math.round(this.options.extent*(Te*ie-X))]],tags:Me};let ut;ut=_e||this.options.generateId?L[te+nr]:this.points[L[te+nr]].id,ut!==void 0&&(dt.id=ut),ue.features.push(dt)}}_limitZoom(F){return Math.max(this.options.minZoom,Math.min(Math.floor(+F),this.options.maxZoom+1))}_cluster(F,L){const{radius:$,extent:X,reduce:ie,minPoints:ue}=this.options,pe=$/(X*Math.pow(2,L)),te=F.data,_e=[],Me=this.stride;for(let Se=0;Se<te.length;Se+=Me){if(te[Se+2]<=L)continue;te[Se+2]=L;const Te=te[Se],dt=te[Se+1],ut=F.within(te[Se],te[Se+1],pe),Et=te[Se+Xr];let vt=Et;for(const Bt of ut){const Gt=Bt*Me;te[Gt+2]>L&&(vt+=te[Gt+Xr])}if(vt>Et&&vt>=ue){let Bt,Gt=Te*Et,hr=dt*Et,$r=-1;const mt=((Se/Me|0)<<5)+(L+1)+this.points.length;for(const br of ut){const Gr=br*Me;if(te[Gr+2]<=L)continue;te[Gr+2]=L;const Si=te[Gr+Xr];Gt+=te[Gr]*Si,hr+=te[Gr+1]*Si,te[Gr+4]=mt,ie&&(Bt||(Bt=this._map(te,Se,!0),$r=this.clusterProps.length,this.clusterProps.push(Bt)),ie(Bt,this._map(te,Gr)))}te[Se+4]=mt,_e.push(Gt/vt,hr/vt,1/0,mt,-1,vt),ie&&_e.push($r)}else{for(let Bt=0;Bt<Me;Bt++)_e.push(te[Se+Bt]);if(vt>1)for(const Bt of ut){const Gt=Bt*Me;if(!(te[Gt+2]<=L)){te[Gt+2]=L;for(let hr=0;hr<Me;hr++)_e.push(te[Gt+hr])}}}}return _e}_getOriginId(F){return F-this.points.length>>5}_getOriginZoom(F){return(F-this.points.length)%32}_map(F,L,$){if(F[L+Xr]>1){const ue=this.clusterProps[F[L+ur]];return $?Object.assign({},ue):ue}const X=this.points[F[L+nr]].properties,ie=this.options.map(X);return $&&ie===X?Object.assign({},ie):ie}}function ri(Z,F,L){return{type:"Feature",id:Z[F+nr],properties:jr(Z,F,L),geometry:{type:"Point",coordinates:[($=Z[F],360*($-.5)),qr(Z[F+1])]}};var $}function jr(Z,F,L){const $=Z[F+Xr],X=$>=1e4?`${Math.round($/1e3)}k`:$>=1e3?Math.round($/100)/10+"k":$,ie=Z[F+ur],ue=ie===-1?{}:Object.assign({},L[ie]);return Object.assign(ue,{cluster:!0,cluster_id:Z[F+nr],point_count:$,point_count_abbreviated:X})}function nn(Z){return Z/360+.5}function Wi(Z){const F=Math.sin(Z*Math.PI/180),L=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return L<0?0:L>1?1:L}function qr(Z){const F=(180-360*Z)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function Mt(Z,F,L,$){for(var X,ie=$,ue=L-F>>1,pe=L-F,te=Z[F],_e=Z[F+1],Me=Z[L],Se=Z[L+1],Te=F+3;Te<L;Te+=3){var dt=pa(Z[Te],Z[Te+1],te,_e,Me,Se);if(dt>ie)X=Te,ie=dt;else if(dt===ie){var ut=Math.abs(Te-ue);ut<pe&&(X=Te,pe=ut)}}ie>$&&(X-F>3&&Mt(Z,F,X,$),Z[X+2]=ie,L-X>3&&Mt(Z,X,L,$))}function pa(Z,F,L,$,X,ie){var ue=X-L,pe=ie-$;if(ue!==0||pe!==0){var te=((Z-L)*ue+(F-$)*pe)/(ue*ue+pe*pe);te>1?(L=X,$=ie):te>0&&(L+=ue*te,$+=pe*te)}return(ue=Z-L)*ue+(pe=F-$)*pe}function _n(Z,F,L,$){var X={id:Z===void 0?null:Z,type:F,geometry:L,tags:$,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ie){var ue=ie.geometry,pe=ie.type;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")Hn(ie,ue);else if(pe==="Polygon"||pe==="MultiLineString")for(var te=0;te<ue.length;te++)Hn(ie,ue[te]);else if(pe==="MultiPolygon")for(te=0;te<ue.length;te++)for(var _e=0;_e<ue[te].length;_e++)Hn(ie,ue[te][_e])}(X),X}function Hn(Z,F){for(var L=0;L<F.length;L+=3)Z.minX=Math.min(Z.minX,F[L]),Z.minY=Math.min(Z.minY,F[L+1]),Z.maxX=Math.max(Z.maxX,F[L]),Z.maxY=Math.max(Z.maxY,F[L+1])}function vr(Z,F,L,$){if(F.geometry){var X=F.geometry.coordinates,ie=F.geometry.type,ue=Math.pow(L.tolerance/((1<<L.maxZoom)*L.extent),2),pe=[],te=F.id;if(L.promoteId?te=F.properties[L.promoteId]:L.generateId&&(te=$||0),ie==="Point")zo(X,pe);else if(ie==="MultiPoint")for(var _e=0;_e<X.length;_e++)zo(X[_e],pe);else if(ie==="LineString")be(X,pe,ue,!1);else if(ie==="MultiLineString"){if(L.lineMetrics){for(_e=0;_e<X.length;_e++)be(X[_e],pe=[],ue,!1),Z.push(_n(te,"LineString",pe,F.properties));return}Pn(X,pe,ue,!1)}else if(ie==="Polygon")Pn(X,pe,ue,!0);else{if(ie!=="MultiPolygon"){if(ie==="GeometryCollection"){for(_e=0;_e<F.geometry.geometries.length;_e++)vr(Z,{id:te,geometry:F.geometry.geometries[_e],properties:F.properties},L,$);return}throw new Error("Input data is not a valid GeoJSON object.")}for(_e=0;_e<X.length;_e++){var Me=[];Pn(X[_e],Me,ue,!0),pe.push(Me)}}Z.push(_n(te,ie,pe,F.properties))}}function zo(Z,F){F.push(fa(Z[0])),F.push(Kt(Z[1])),F.push(0)}function be(Z,F,L,$){for(var X,ie,ue=0,pe=0;pe<Z.length;pe++){var te=fa(Z[pe][0]),_e=Kt(Z[pe][1]);F.push(te),F.push(_e),F.push(0),pe>0&&(ue+=$?(X*_e-te*ie)/2:Math.sqrt(Math.pow(te-X,2)+Math.pow(_e-ie,2))),X=te,ie=_e}var Me=F.length-3;F[2]=1,Mt(F,0,Me,L),F[Me+2]=1,F.size=Math.abs(ue),F.start=0,F.end=F.size}function Pn(Z,F,L,$){for(var X=0;X<Z.length;X++){var ie=[];be(Z[X],ie,L,$),F.push(ie)}}function fa(Z){return Z/360+.5}function Kt(Z){var F=Math.sin(Z*Math.PI/180),L=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return L<0?0:L>1?1:L}function qt(Z,F,L,$,X,ie,ue,pe){if($/=F,ie>=(L/=F)&&ue<$)return Z;if(ue<L||ie>=$)return null;for(var te=[],_e=0;_e<Z.length;_e++){var Me=Z[_e],Se=Me.geometry,Te=Me.type,dt=X===0?Me.minX:Me.minY,ut=X===0?Me.maxX:Me.maxY;if(dt>=L&&ut<$)te.push(Me);else if(!(ut<L||dt>=$)){var Et=[];if(Te==="Point"||Te==="MultiPoint")Mn(Se,Et,L,$,X);else if(Te==="LineString")Do(Se,Et,L,$,X,!1,pe.lineMetrics);else if(Te==="MultiLineString")kn(Se,Et,L,$,X,!1);else if(Te==="Polygon")kn(Se,Et,L,$,X,!0);else if(Te==="MultiPolygon")for(var vt=0;vt<Se.length;vt++){var Bt=[];kn(Se[vt],Bt,L,$,X,!0),Bt.length&&Et.push(Bt)}if(Et.length){if(pe.lineMetrics&&Te==="LineString"){for(vt=0;vt<Et.length;vt++)te.push(_n(Me.id,Te,Et[vt],Me.tags));continue}Te!=="LineString"&&Te!=="MultiLineString"||(Et.length===1?(Te="LineString",Et=Et[0]):Te="MultiLineString"),Te!=="Point"&&Te!=="MultiPoint"||(Te=Et.length===3?"Point":"MultiPoint"),te.push(_n(Me.id,Te,Et,Me.tags))}}}return te.length?te:null}function Mn(Z,F,L,$,X){for(var ie=0;ie<Z.length;ie+=3){var ue=Z[ie+X];ue>=L&&ue<=$&&(F.push(Z[ie]),F.push(Z[ie+1]),F.push(Z[ie+2]))}}function Do(Z,F,L,$,X,ie,ue){for(var pe,te,_e=Fo(Z),Me=X===0?Hi:Lo,Se=Z.start,Te=0;Te<Z.length-3;Te+=3){var dt=Z[Te],ut=Z[Te+1],Et=Z[Te+2],vt=Z[Te+3],Bt=Z[Te+4],Gt=X===0?dt:ut,hr=X===0?vt:Bt,$r=!1;ue&&(pe=Math.sqrt(Math.pow(dt-vt,2)+Math.pow(ut-Bt,2))),Gt<L?hr>L&&(te=Me(_e,dt,ut,vt,Bt,L),ue&&(_e.start=Se+pe*te)):Gt>$?hr<$&&(te=Me(_e,dt,ut,vt,Bt,$),ue&&(_e.start=Se+pe*te)):xn(_e,dt,ut,Et),hr<L&&Gt>=L&&(te=Me(_e,dt,ut,vt,Bt,L),$r=!0),hr>$&&Gt<=$&&(te=Me(_e,dt,ut,vt,Bt,$),$r=!0),!ie&&$r&&(ue&&(_e.end=Se+pe*te),F.push(_e),_e=Fo(Z)),ue&&(Se+=pe)}var mt=Z.length-3;dt=Z[mt],ut=Z[mt+1],Et=Z[mt+2],(Gt=X===0?dt:ut)>=L&&Gt<=$&&xn(_e,dt,ut,Et),mt=_e.length-3,ie&&mt>=3&&(_e[mt]!==_e[0]||_e[mt+1]!==_e[1])&&xn(_e,_e[0],_e[1],_e[2]),_e.length&&F.push(_e)}function Fo(Z){var F=[];return F.size=Z.size,F.start=Z.start,F.end=Z.end,F}function kn(Z,F,L,$,X,ie){for(var ue=0;ue<Z.length;ue++)Do(Z[ue],F,L,$,X,ie,!1)}function xn(Z,F,L,$){Z.push(F),Z.push(L),Z.push($)}function Hi(Z,F,L,$,X,ie){var ue=(ie-F)/($-F);return Z.push(ie),Z.push(L+(X-L)*ue),Z.push(1),ue}function Lo(Z,F,L,$,X,ie){var ue=(ie-L)/(X-L);return Z.push(F+($-F)*ue),Z.push(ie),Z.push(1),ue}function Re(Z,F){for(var L=[],$=0;$<Z.length;$++){var X,ie=Z[$],ue=ie.type;if(ue==="Point"||ue==="MultiPoint"||ue==="LineString")X=ci(ie.geometry,F);else if(ue==="MultiLineString"||ue==="Polygon"){X=[];for(var pe=0;pe<ie.geometry.length;pe++)X.push(ci(ie.geometry[pe],F))}else if(ue==="MultiPolygon")for(X=[],pe=0;pe<ie.geometry.length;pe++){for(var te=[],_e=0;_e<ie.geometry[pe].length;_e++)te.push(ci(ie.geometry[pe][_e],F));X.push(te)}L.push(_n(ie.id,ue,X,ie.tags))}return L}function ci(Z,F){var L=[];L.size=Z.size,Z.start!==void 0&&(L.start=Z.start,L.end=Z.end);for(var $=0;$<Z.length;$+=3)L.push(Z[$]+F,Z[$+1],Z[$+2]);return L}function Jr(Z,F){if(Z.transformed)return Z;var L,$,X,ie=1<<Z.z,ue=Z.x,pe=Z.y;for(L=0;L<Z.features.length;L++){var te=Z.features[L],_e=te.geometry,Me=te.type;if(te.geometry=[],Me===1)for($=0;$<_e.length;$+=2)te.geometry.push(zn(_e[$],_e[$+1],F,ie,ue,pe));else for($=0;$<_e.length;$++){var Se=[];for(X=0;X<_e[$].length;X+=2)Se.push(zn(_e[$][X],_e[$][X+1],F,ie,ue,pe));te.geometry.push(Se)}}return Z.transformed=!0,Z}function zn(Z,F,L,$,X,ie){return[Math.round(L*(Z*$-X)),Math.round(L*(F*$-ie))]}function vn(Z,F,L,$,X){for(var ie=F===X.maxZoom?0:X.tolerance/((1<<F)*X.extent),ue={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:L,y:$,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},pe=0;pe<Z.length;pe++){ue.numFeatures++,Le(ue,Z[pe],ie,X);var te=Z[pe].minX,_e=Z[pe].minY,Me=Z[pe].maxX,Se=Z[pe].maxY;te<ue.minX&&(ue.minX=te),_e<ue.minY&&(ue.minY=_e),Me>ue.maxX&&(ue.maxX=Me),Se>ue.maxY&&(ue.maxY=Se)}return ue}function Le(Z,F,L,$){var X=F.geometry,ie=F.type,ue=[];if(ie==="Point"||ie==="MultiPoint")for(var pe=0;pe<X.length;pe+=3)ue.push(X[pe]),ue.push(X[pe+1]),Z.numPoints++,Z.numSimplified++;else if(ie==="LineString")kt(ue,X,Z,L,!1,!1);else if(ie==="MultiLineString"||ie==="Polygon")for(pe=0;pe<X.length;pe++)kt(ue,X[pe],Z,L,ie==="Polygon",pe===0);else if(ie==="MultiPolygon")for(var te=0;te<X.length;te++){var _e=X[te];for(pe=0;pe<_e.length;pe++)kt(ue,_e[pe],Z,L,!0,pe===0)}if(ue.length){var Me=F.tags||null;if(ie==="LineString"&&$.lineMetrics){for(var Se in Me={},F.tags)Me[Se]=F.tags[Se];Me.mapbox_clip_start=X.start/X.size,Me.mapbox_clip_end=X.end/X.size}var Te={geometry:ue,type:ie==="Polygon"||ie==="MultiPolygon"?3:ie==="LineString"||ie==="MultiLineString"?2:1,tags:Me};F.id!==null&&(Te.id=F.id),Z.features.push(Te)}}function kt(Z,F,L,$,X,ie){var ue=$*$;if($>0&&F.size<(X?ue:$))L.numPoints+=F.length/3;else{for(var pe=[],te=0;te<F.length;te+=3)($===0||F[te+2]>ue)&&(L.numSimplified++,pe.push(F[te]),pe.push(F[te+1])),L.numPoints++;X&&function(_e,Me){for(var Se=0,Te=0,dt=_e.length,ut=dt-2;Te<dt;ut=Te,Te+=2)Se+=(_e[Te]-_e[ut])*(_e[Te+1]+_e[ut+1]);if(Se>0===Me)for(Te=0,dt=_e.length;Te<dt/2;Te+=2){var Et=_e[Te],vt=_e[Te+1];_e[Te]=_e[dt-2-Te],_e[Te+1]=_e[dt-1-Te],_e[dt-2-Te]=Et,_e[dt-1-Te]=vt}}(pe,ie),Z.push(pe)}}function It(Z,F){var L=(F=this.options=function(X,ie){for(var ue in ie)X[ue]=ie[ue];return X}(Object.create(this.options),F)).debug;if(L&&console.time("preprocess data"),F.maxZoom<0||F.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(F.promoteId&&F.generateId)throw new Error("promoteId and generateId cannot be used together.");var $=function(X,ie){var ue=[];if(X.type==="FeatureCollection")for(var pe=0;pe<X.features.length;pe++)vr(ue,X.features[pe],ie,pe);else vr(ue,X.type==="Feature"?X:{geometry:X},ie);return ue}(Z,F);this.tiles={},this.tileCoords=[],L&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",F.indexMaxZoom,F.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),$=function(X,ie){var ue=ie.buffer/ie.extent,pe=X,te=qt(X,1,-1-ue,ue,0,-1,2,ie),_e=qt(X,1,1-ue,2+ue,0,-1,2,ie);return(te||_e)&&(pe=qt(X,1,-ue,1+ue,0,-1,2,ie)||[],te&&(pe=Re(te,1).concat(pe)),_e&&(pe=pe.concat(Re(_e,-1)))),pe}($,F),$.length&&this.splitTile($,0,0,0),L&&($.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Nr(Z,F,L){return 32*((1<<Z)*L+F)+Z}function fi(Z,F){return F?Z.properties[F]:Z.id}function Ct(Z,F){if(Z==null)return!0;if(Z.type==="Feature")return fi(Z,F)!=null;if(Z.type==="FeatureCollection"){const L=new Set;for(const $ of Z.features){const X=fi($,F);if(X==null||L.has(X))return!1;L.add(X)}return!0}return!1}function wi(Z,F){const L=new Map;if(Z!=null)if(Z.type==="Feature")L.set(fi(Z,F),Z);else for(const $ of Z.features)L.set(fi($,F),$);return L}It.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},It.prototype.splitTile=function(Z,F,L,$,X,ie,ue){for(var pe=[Z,F,L,$],te=this.options,_e=te.debug;pe.length;){$=pe.pop(),L=pe.pop(),F=pe.pop(),Z=pe.pop();var Me=1<<F,Se=Nr(F,L,$),Te=this.tiles[Se];if(!Te&&(_e>1&&console.time("creation"),Te=this.tiles[Se]=vn(Z,F,L,$,te),this.tileCoords.push({z:F,x:L,y:$}),_e)){_e>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",F,L,$,Te.numFeatures,Te.numPoints,Te.numSimplified),console.timeEnd("creation"));var dt="z"+F;this.stats[dt]=(this.stats[dt]||0)+1,this.total++}if(Te.source=Z,X){if(F===te.maxZoom||F===X)continue;var ut=1<<X-F;if(L!==Math.floor(ie/ut)||$!==Math.floor(ue/ut))continue}else if(F===te.indexMaxZoom||Te.numPoints<=te.indexMaxPoints)continue;if(Te.source=null,Z.length!==0){_e>1&&console.time("clipping");var Et,vt,Bt,Gt,hr,$r,mt=.5*te.buffer/te.extent,br=.5-mt,Gr=.5+mt,Si=1+mt;Et=vt=Bt=Gt=null,hr=qt(Z,Me,L-mt,L+Gr,0,Te.minX,Te.maxX,te),$r=qt(Z,Me,L+br,L+Si,0,Te.minX,Te.maxX,te),Z=null,hr&&(Et=qt(hr,Me,$-mt,$+Gr,1,Te.minY,Te.maxY,te),vt=qt(hr,Me,$+br,$+Si,1,Te.minY,Te.maxY,te),hr=null),$r&&(Bt=qt($r,Me,$-mt,$+Gr,1,Te.minY,Te.maxY,te),Gt=qt($r,Me,$+br,$+Si,1,Te.minY,Te.maxY,te),$r=null),_e>1&&console.timeEnd("clipping"),pe.push(Et||[],F+1,2*L,2*$),pe.push(vt||[],F+1,2*L,2*$+1),pe.push(Bt||[],F+1,2*L+1,2*$),pe.push(Gt||[],F+1,2*L+1,2*$+1)}}},It.prototype.getTile=function(Z,F,L){var $=this.options,X=$.extent,ie=$.debug;if(Z<0||Z>24)return null;var ue=1<<Z,pe=Nr(Z,F=(F%ue+ue)%ue,L);if(this.tiles[pe])return Jr(this.tiles[pe],X);ie>1&&console.log("drilling down to z%d-%d-%d",Z,F,L);for(var te,_e=Z,Me=F,Se=L;!te&&_e>0;)_e--,Me=Math.floor(Me/2),Se=Math.floor(Se/2),te=this.tiles[Nr(_e,Me,Se)];return te&&te.source?(ie>1&&console.log("found parent tile z%d-%d-%d",_e,Me,Se),ie>1&&console.time("drilling down"),this.splitTile(te.source,_e,Me,Se,Z,F,L),ie>1&&console.timeEnd("drilling down"),this.tiles[pe]?Jr(this.tiles[pe],X):null):null};class bn extends ve{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(F,L){return A._(this,void 0,void 0,function*(){const $=F.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const X=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!X)return null;const ie=new class{constructor(pe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=A.W,this.length=pe.length,this._features=pe}feature(pe){return new class{constructor(te){this._feature=te,this.extent=A.W,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(this._feature.type===1){const te=[];for(const _e of this._feature.geometry)te.push([new A.P(_e[0],_e[1])]);return te}{const te=[];for(const _e of this._feature.geometry){const Me=[];for(const Se of _e)Me.push(new A.P(Se[0],Se[1]));te.push(Me)}return te}}toGeoJSON(te,_e,Me){return ot.call(this,te,_e,Me)}}(this._features[pe])}}(X.features);let ue=pi(ie);return ue.byteOffset===0&&ue.byteLength===ue.buffer.byteLength||(ue=new Uint8Array(ue)),{vectorTile:ie,rawData:ue.buffer}})}loadData(F){return A._(this,void 0,void 0,function*(){var L;(L=this._pendingRequest)===null||L===void 0||L.abort();const $=!!(F&&F.request&&F.request.collectResourceTiming)&&new A.bt(F.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(F,this._pendingRequest),this._geoJSONIndex=F.cluster?new Zi(function({superclusterOptions:ie,clusterProperties:ue}){if(!ue||!ie)return ie;const pe={},te={},_e={accumulated:null,zoom:0},Me={properties:null},Se=Object.keys(ue);for(const Te of Se){const[dt,ut]=ue[Te],Et=A.bA(ut),vt=A.bA(typeof dt=="string"?[dt,["accumulated"],["get",Te]]:dt);pe[Te]=Et.value,te[Te]=vt.value}return ie.map=Te=>{Me.properties=Te;const dt={};for(const ut of Se)dt[ut]=pe[ut].evaluate(_e,Me);return dt},ie.reduce=(Te,dt)=>{Me.properties=dt;for(const ut of Se)_e.accumulated=Te[ut],Te[ut]=te[ut].evaluate(_e,Me)},ie}(F)).load((yield this._pendingData).features):new It(yield this._pendingData,F.geojsonVtOptions),this.loaded={};const X={};if($){const ie=$.finish();ie&&(X.resourceTiming={},X.resourceTiming[F.source]=JSON.parse(JSON.stringify(ie)))}return X}catch(X){if(delete this._pendingRequest,A.bz(X))return{abandoned:!0};throw X}})}getData(){return A._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(F){const L=this.loaded;return L&&L[F.uid]?super.reloadTile(F):this.loadTile(F)}loadAndProcessGeoJSON(F,L){return A._(this,void 0,void 0,function*(){let $=yield this.loadGeoJSON(F,L);if(delete this._pendingRequest,typeof $!="object")throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`);if(Fe($,!0),F.filter){const X=A.bA(F.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(X.result==="error")throw new Error(X.value.map(ue=>`${ue.key}: ${ue.message}`).join(", "));$={type:"FeatureCollection",features:$.features.filter(ue=>X.value.evaluate({zoom:0},ue))}}return $})}loadGeoJSON(F,L){return A._(this,void 0,void 0,function*(){const{promoteId:$}=F;if(F.request){const X=yield A.h(F.request,L);return this._dataUpdateable=Ct(X.data,$)?wi(X.data,$):void 0,X.data}if(typeof F.data=="string")try{const X=JSON.parse(F.data);return this._dataUpdateable=Ct(X,$)?wi(X,$):void 0,X}catch{throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`)}if(!F.dataDiff)throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${F.source}`);return function(X,ie,ue){var pe,te,_e,Me;if(ie.removeAll&&X.clear(),ie.remove)for(const Se of ie.remove)X.delete(Se);if(ie.add)for(const Se of ie.add){const Te=fi(Se,ue);Te!=null&&X.set(Te,Se)}if(ie.update)for(const Se of ie.update){let Te=X.get(Se.id);if(Te==null)continue;const dt=!Se.removeAllProperties&&(((pe=Se.removeProperties)===null||pe===void 0?void 0:pe.length)>0||((te=Se.addOrUpdateProperties)===null||te===void 0?void 0:te.length)>0);if((Se.newGeometry||Se.removeAllProperties||dt)&&(Te=Object.assign({},Te),X.set(Se.id,Te),dt&&(Te.properties=Object.assign({},Te.properties))),Se.newGeometry&&(Te.geometry=Se.newGeometry),Se.removeAllProperties)Te.properties={};else if(((_e=Se.removeProperties)===null||_e===void 0?void 0:_e.length)>0)for(const ut of Se.removeProperties)Object.prototype.hasOwnProperty.call(Te.properties,ut)&&delete Te.properties[ut];if(((Me=Se.addOrUpdateProperties)===null||Me===void 0?void 0:Me.length)>0)for(const{key:ut,value:Et}of Se.addOrUpdateProperties)Te.properties[ut]=Et}}(this._dataUpdateable,F.dataDiff,$),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(F){return A._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(F){return this._geoJSONIndex.getClusterExpansionZoom(F.clusterId)}getClusterChildren(F){return this._geoJSONIndex.getChildren(F.clusterId)}getClusterLeaves(F){return this._geoJSONIndex.getLeaves(F.clusterId,F.limit,F.offset)}}class zr{constructor(F){this.self=F,this.actor=new A.C(F),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(L,$)=>{if(this.externalWorkerSourceTypes[L])throw new Error(`Worker source with name "${L}" already registered.`);this.externalWorkerSourceTypes[L]=$},this.self.addProtocol=A.bg,this.self.removeProtocol=A.bh,this.self.registerRTLTextPlugin=L=>{if(A.bB.isParsed())throw new Error("RTL text plugin already registered.");A.bB.setMethods(L)},this.actor.registerMessageHandler("LDT",(L,$)=>this._getDEMWorkerSource(L,$.source).loadTile($)),this.actor.registerMessageHandler("RDT",(L,$)=>A._(this,void 0,void 0,function*(){this._getDEMWorkerSource(L,$.source).removeTile($)})),this.actor.registerMessageHandler("GCEZ",(L,$)=>A._(this,void 0,void 0,function*(){return this._getWorkerSource(L,$.type,$.source).getClusterExpansionZoom($)})),this.actor.registerMessageHandler("GCC",(L,$)=>A._(this,void 0,void 0,function*(){return this._getWorkerSource(L,$.type,$.source).getClusterChildren($)})),this.actor.registerMessageHandler("GCL",(L,$)=>A._(this,void 0,void 0,function*(){return this._getWorkerSource(L,$.type,$.source).getClusterLeaves($)})),this.actor.registerMessageHandler("LD",(L,$)=>this._getWorkerSource(L,$.type,$.source).loadData($)),this.actor.registerMessageHandler("GD",(L,$)=>this._getWorkerSource(L,$.type,$.source).getData()),this.actor.registerMessageHandler("LT",(L,$)=>this._getWorkerSource(L,$.type,$.source).loadTile($)),this.actor.registerMessageHandler("RT",(L,$)=>this._getWorkerSource(L,$.type,$.source).reloadTile($)),this.actor.registerMessageHandler("AT",(L,$)=>this._getWorkerSource(L,$.type,$.source).abortTile($)),this.actor.registerMessageHandler("RMT",(L,$)=>this._getWorkerSource(L,$.type,$.source).removeTile($)),this.actor.registerMessageHandler("RS",(L,$)=>A._(this,void 0,void 0,function*(){if(!this.workerSources[L]||!this.workerSources[L][$.type]||!this.workerSources[L][$.type][$.source])return;const X=this.workerSources[L][$.type][$.source];delete this.workerSources[L][$.type][$.source],X.removeSource!==void 0&&X.removeSource($)})),this.actor.registerMessageHandler("RM",L=>A._(this,void 0,void 0,function*(){delete this.layerIndexes[L],delete this.availableImages[L],delete this.workerSources[L],delete this.demWorkerSources[L]})),this.actor.registerMessageHandler("SR",(L,$)=>A._(this,void 0,void 0,function*(){this.referrer=$})),this.actor.registerMessageHandler("SRPS",(L,$)=>this._syncRTLPluginState(L,$)),this.actor.registerMessageHandler("IS",(L,$)=>A._(this,void 0,void 0,function*(){this.self.importScripts($)})),this.actor.registerMessageHandler("SI",(L,$)=>this._setImages(L,$)),this.actor.registerMessageHandler("UL",(L,$)=>A._(this,void 0,void 0,function*(){this._getLayerIndex(L).update($.layers,$.removedIds)})),this.actor.registerMessageHandler("SL",(L,$)=>A._(this,void 0,void 0,function*(){this._getLayerIndex(L).replace($)}))}_setImages(F,L){return A._(this,void 0,void 0,function*(){this.availableImages[F]=L;for(const $ in this.workerSources[F]){const X=this.workerSources[F][$];for(const ie in X)X[ie].availableImages=L}})}_syncRTLPluginState(F,L){return A._(this,void 0,void 0,function*(){if(A.bB.isParsed())return A.bB.getState();if(L.pluginStatus!=="loading")return A.bB.setState(L),L;const $=L.pluginURL;if(this.self.importScripts($),A.bB.isParsed()){const X={pluginStatus:"loaded",pluginURL:$};return A.bB.setState(X),X}throw A.bB.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${$}`)})}_getAvailableImages(F){let L=this.availableImages[F];return L||(L=[]),L}_getLayerIndex(F){let L=this.layerIndexes[F];return L||(L=this.layerIndexes[F]=new u),L}_getWorkerSource(F,L,$){if(this.workerSources[F]||(this.workerSources[F]={}),this.workerSources[F][L]||(this.workerSources[F][L]={}),!this.workerSources[F][L][$]){const X={sendAsync:(ie,ue)=>(ie.targetMapId=F,this.actor.sendAsync(ie,ue))};switch(L){case"vector":this.workerSources[F][L][$]=new ve(X,this._getLayerIndex(F),this._getAvailableImages(F));break;case"geojson":this.workerSources[F][L][$]=new bn(X,this._getLayerIndex(F),this._getAvailableImages(F));break;default:this.workerSources[F][L][$]=new this.externalWorkerSourceTypes[L](X,this._getLayerIndex(F),this._getAvailableImages(F))}}return this.workerSources[F][L][$]}_getDEMWorkerSource(F,L){return this.demWorkerSources[F]||(this.demWorkerSources[F]={}),this.demWorkerSources[F][L]||(this.demWorkerSources[F][L]=new se),this.demWorkerSources[F][L]}}return A.i(self)&&(self.worker=new zr(self)),zr}),R("index",["exports","./shared"],function(A,u){var le="4.3.2";let Ae,Ne;const ve={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:c=>new Promise((t,n)=>{const a=requestAnimationFrame(t);c.signal.addEventListener("abort",()=>{cancelAnimationFrame(a),n(u.c())})}),getImageData(c,t=0){return this.getImageCanvasContext(c).getImageData(-t,-t,c.width+2*t,c.height+2*t)},getImageCanvasContext(c){const t=window.document.createElement("canvas"),n=t.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return t.width=c.width,t.height=c.height,n.drawImage(c,0,0,c.width,c.height),n},resolveURL:c=>(Ae||(Ae=document.createElement("a")),Ae.href=c,Ae.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Ne==null&&(Ne=matchMedia("(prefers-reduced-motion: reduce)")),Ne.matches)}};class se{static testProp(t){if(!se.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in se.docStyle)return t[n];return t[0]}static create(t,n,a){const l=window.document.createElement(t);return n!==void 0&&(l.className=n),a&&a.appendChild(l),l}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){se.docStyle&&se.selectProp&&(se.userSelect=se.docStyle[se.selectProp],se.docStyle[se.selectProp]="none")}static enableDrag(){se.docStyle&&se.selectProp&&(se.docStyle[se.selectProp]=se.userSelect)}static setTransform(t,n){t.style[se.transformProp]=n}static addEventListener(t,n,a,l={}){t.addEventListener(n,a,"passive"in l?l:l.capture)}static removeEventListener(t,n,a,l={}){t.removeEventListener(n,a,"passive"in l?l:l.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",se.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",se.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",se.suppressClickInternal,!0)},0)}static getScale(t){const n=t.getBoundingClientRect();return{x:n.width/t.offsetWidth||1,y:n.height/t.offsetHeight||1,boundingClientRect:n}}static getPoint(t,n,a){const l=n.boundingClientRect;return new u.P((a.clientX-l.left)/n.x-t.clientLeft,(a.clientY-l.top)/n.y-t.clientTop)}static mousePos(t,n){const a=se.getScale(t);return se.getPoint(t,a,n)}static touchPos(t,n){const a=[],l=se.getScale(t);for(let d=0;d<n.length;d++)a.push(se.getPoint(t,l,n[d]));return a}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}se.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,se.selectProp=se.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),se.transformProp=se.testProp(["transform","WebkitTransform"]);const Ge={supported:!1,testSupport:function(c){!ot&&Fe&&(zt?tr(c):yt=c)}};let yt,Fe,ot=!1,zt=!1;function tr(c){const t=c.createTexture();c.bindTexture(c.TEXTURE_2D,t);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,Fe),c.isContextLost())return;Ge.supported=!0}catch{}c.deleteTexture(t),ot=!0}var bt;typeof document<"u"&&(Fe=document.createElement("img"),Fe.onload=()=>{yt&&tr(yt),yt=null,zt=!0},Fe.onerror=()=>{ot=!0,yt=null},Fe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(c){let t,n,a,l;c.resetRequestQueue=()=>{t=[],n=0,a=0,l={}},c.addThrottleControl=b=>{const C=a++;return l[C]=b,C},c.removeThrottleControl=b=>{delete l[b],_()},c.getImage=(b,C,z=!0)=>new Promise((k,j)=>{Ge.supported&&(b.headers||(b.headers={}),b.headers.accept="image/webp,*/*"),u.e(b,{type:"image"}),t.push({abortController:C,requestParameters:b,supportImageRefresh:z,state:"queued",onError:U=>{j(U)},onSuccess:U=>{k(U)}}),_()});const d=b=>u._(this,void 0,void 0,function*(){b.state="running";const{requestParameters:C,supportImageRefresh:z,onError:k,onSuccess:j,abortController:U}=b,G=z===!1&&!u.i(self)&&!u.g(C.url)&&(!C.headers||Object.keys(C.headers).reduce((ee,ce)=>ee&&ce==="accept",!0));n++;const Y=G?v(C,U):u.m(C,U);try{const ee=yield Y;delete b.abortController,b.state="completed",ee.data instanceof HTMLImageElement||u.b(ee.data)?j(ee):ee.data&&j({data:yield(W=ee.data,typeof createImageBitmap=="function"?u.d(W):u.f(W)),cacheControl:ee.cacheControl,expires:ee.expires})}catch(ee){delete b.abortController,k(ee)}finally{n--,_()}var W}),_=()=>{const b=(()=>{for(const C of Object.keys(l))if(l[C]())return!0;return!1})()?u.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:u.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=n;C<b&&t.length>0;C++){const z=t.shift();z.abortController.signal.aborted?C--:d(z)}},v=(b,C)=>new Promise((z,k)=>{const j=new Image,U=b.url,G=b.credentials;G&&G==="include"?j.crossOrigin="use-credentials":(G&&G==="same-origin"||!u.s(U))&&(j.crossOrigin="anonymous"),C.signal.addEventListener("abort",()=>{j.src="",k(u.c())}),j.fetchPriority="high",j.onload=()=>{j.onerror=j.onload=null,z({data:j})},j.onerror=()=>{j.onerror=j.onload=null,C.signal.aborted||k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},j.src=U})}(bt||(bt={})),bt.resetRequestQueue();class Pt{constructor(t){this._transformRequestFn=t}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Nt(c){var t=new u.A(3);return t[0]=c[0],t[1]=c[1],t[2]=c[2],t}var tt,Ot=function(c,t,n){return c[0]=t[0]-n[0],c[1]=t[1]-n[1],c[2]=t[2]-n[2],c};tt=new u.A(3),u.A!=Float32Array&&(tt[0]=0,tt[1]=0,tt[2]=0);var cr=function(c){var t=c[0],n=c[1];return t*t+n*n};function Cr(c){const t=[];if(typeof c=="string")t.push({id:"default",url:c});else if(c&&c.length>0){const n=[];for(const{id:a,url:l}of c){const d=`${a}${l}`;n.indexOf(d)===-1&&(n.push(d),t.push({id:a,url:l}))}}return t}function li(c,t,n){const a=c.split("?");return a[0]+=`${t}${n}`,a.join("?")}(function(){var c=new u.A(2);u.A!=Float32Array&&(c[0]=0,c[1]=0)})();class Ft{constructor(t,n,a,l){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(n,l)}update(t,n,a){const{width:l,height:d}=t,_=!(this.size&&this.size[0]===l&&this.size[1]===d||a),{context:v}=this,{gl:b}=v;if(this.useMipmap=!!(n&&n.useMipmap),b.bindTexture(b.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!n||n.premultiply!==!1)),_)this.size=[l,d],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||u.b(t)?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,t):b.texImage2D(b.TEXTURE_2D,0,this.format,l,d,0,this.format,b.UNSIGNED_BYTE,t.data);else{const{x:C,y:z}=a||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||u.b(t)?b.texSubImage2D(b.TEXTURE_2D,0,C,z,b.RGBA,b.UNSIGNED_BYTE,t):b.texSubImage2D(b.TEXTURE_2D,0,C,z,l,d,b.RGBA,b.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&b.generateMipmap(b.TEXTURE_2D)}bind(t,n,a){const{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_2D,this.texture),a!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=d.LINEAR),t!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,a||t),this.filter=t),n!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function Er(c){const{userImage:t}=c;return!!(t&&t.render&&t.render())&&(c.data.replace(new Uint8Array(t.data.buffer)),!0)}class rr extends u.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,promiseResolve:a}of this.requestors)a(this._getImagesForIds(n));this.requestors=[]}}getImage(t){const n=this.images[t];if(n&&!n.data&&n.spriteData){const a=n.spriteData;n.data=new u.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),n.spriteData=null}return n}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let a=!0;const l=n.data||n.spriteData;return this._validateStretch(n.stretchX,l&&l.width)||(this.fire(new u.j(new Error(`Image "${t}" has invalid "stretchX" value`))),a=!1),this._validateStretch(n.stretchY,l&&l.height)||(this.fire(new u.j(new Error(`Image "${t}" has invalid "stretchY" value`))),a=!1),this._validateContent(n.content,n)||(this.fire(new u.j(new Error(`Image "${t}" has invalid "content" value`))),a=!1),a}_validateStretch(t,n){if(!t)return!0;let a=0;for(const l of t){if(l[0]<a||l[1]<l[0]||n<l[1])return!1;a=l[1]}return!0}_validateContent(t,n){if(!t)return!0;if(t.length!==4)return!1;const a=n.spriteData,l=a&&a.width||n.data.width,d=a&&a.height||n.data.height;return!(t[0]<0||l<t[0]||t[1]<0||d<t[1]||t[2]<0||l<t[2]||t[3]<0||d<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,n,a=!0){const l=this.getImage(t);if(a&&(l.data.width!==n.data.width||l.data.height!==n.data.height))throw new Error(`size mismatch between old image (${l.data.width}x${l.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=l.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((n,a)=>{let l=!0;if(!this.isLoaded())for(const d of t)this.images[d]||(l=!1);this.isLoaded()||l?n(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:n})})}_getImagesForIds(t){const n={};for(const a of t){let l=this.getImage(a);l||(this.fire(new u.k("styleimagemissing",{id:a})),l=this.getImage(a)),l?n[a]={data:l.data.clone(),pixelRatio:l.pixelRatio,sdf:l.sdf,version:l.version,stretchX:l.stretchX,stretchY:l.stretchY,content:l.content,textFitWidth:l.textFitWidth,textFitHeight:l.textFitHeight,hasRenderCallback:!!(l.userImage&&l.userImage.render)}:u.w(`Image "${a}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],a=this.getImage(t);if(!a)return null;if(n&&n.position.version===a.version)return n.position;if(n)n.position.version=a.version;else{const l={w:a.data.width+2,h:a.data.height+2,x:0,y:0},d=new u.I(l,a);this.patterns[t]={bin:l,position:d}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ft(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const d in this.patterns)t.push(this.patterns[d].bin);const{w:n,h:a}=u.p(t),l=this.atlasImage;l.resize({width:n||1,height:a||1});for(const d in this.patterns){const{bin:_}=this.patterns[d],v=_.x+1,b=_.y+1,C=this.getImage(d).data,z=C.width,k=C.height;u.R.copy(C,l,{x:0,y:0},{x:v,y:b},{width:z,height:k}),u.R.copy(C,l,{x:0,y:k-1},{x:v,y:b-1},{width:z,height:1}),u.R.copy(C,l,{x:0,y:0},{x:v,y:b+k},{width:z,height:1}),u.R.copy(C,l,{x:z-1,y:0},{x:v-1,y:b},{width:1,height:k}),u.R.copy(C,l,{x:0,y:0},{x:v+z,y:b},{width:1,height:k})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const a=this.getImage(n);a||u.w(`Image with ID: "${n}" was not found`),Er(a)&&this.updateImage(n,a)}}}const $t=1e20;function ti(c,t,n,a,l,d,_,v,b){for(let C=t;C<t+a;C++)di(c,n*d+C,d,l,_,v,b);for(let C=n;C<n+l;C++)di(c,C*d+t,1,a,_,v,b)}function di(c,t,n,a,l,d,_){d[0]=0,_[0]=-$t,_[1]=$t,l[0]=c[t];for(let v=1,b=0,C=0;v<a;v++){l[v]=c[t+v*n];const z=v*v;do{const k=d[b];C=(l[v]-l[k]+z-k*k)/(v-k)/2}while(C<=_[b]&&--b>-1);b++,d[b]=v,_[b]=C,_[b+1]=$t}for(let v=0,b=0;v<a;v++){for(;_[b+1]<v;)b++;const C=d[b],z=v-C;c[t+v*n]=l[C]+z*z}}class pi{constructor(t,n){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return u._(this,void 0,void 0,function*(){const n=[];for(const d in t)for(const _ of t[d])n.push(this._getAndCacheGlyphsPromise(d,_));const a=yield Promise.all(n),l={};for(const{stack:d,id:_,glyph:v}of a)l[d]||(l[d]={}),l[d][_]=v&&{id:v.id,bitmap:v.bitmap.clone(),metrics:v.metrics};return l})}_getAndCacheGlyphsPromise(t,n){return u._(this,void 0,void 0,function*(){let a=this.entries[t];a||(a=this.entries[t]={glyphs:{},requests:{},ranges:{}});let l=a.glyphs[n];if(l!==void 0)return{stack:t,id:n,glyph:l};if(l=this._tinySDF(a,t,n),l)return a.glyphs[n]=l,{stack:t,id:n,glyph:l};const d=Math.floor(n/256);if(256*d>65535)throw new Error("glyphs > 65535 not supported");if(a.ranges[d])return{stack:t,id:n,glyph:l};if(!this.url)throw new Error("glyphsUrl is not set");if(!a.requests[d]){const v=pi.loadGlyphRange(t,d,this.url,this.requestManager);a.requests[d]=v}const _=yield a.requests[d];for(const v in _)this._doesCharSupportLocalGlyph(+v)||(a.glyphs[+v]=_[+v]);return a.ranges[d]=!0,{stack:t,id:n,glyph:_[n]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(u.u["CJK Unified Ideographs"](t)||u.u["Hangul Syllables"](t)||u.u.Hiragana(t)||u.u.Katakana(t))}_tinySDF(t,n,a){const l=this.localIdeographFontFamily;if(!l||!this._doesCharSupportLocalGlyph(a))return;let d=t.tinySDF;if(!d){let v="400";/bold/i.test(n)?v="900":/medium/i.test(n)?v="500":/light/i.test(n)&&(v="200"),d=t.tinySDF=new pi.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:l,fontWeight:v})}const _=d.draw(String.fromCharCode(a));return{id:a,bitmap:new u.o({width:_.width||60,height:_.height||60},_.data),metrics:{width:_.glyphWidth/2||24,height:_.glyphHeight/2||24,left:_.glyphLeft/2+.5||0,top:_.glyphTop/2-27.5||-8,advance:_.glyphAdvance/2||24,isDoubleResolution:!0}}}}pi.loadGlyphRange=function(c,t,n,a){return u._(this,void 0,void 0,function*(){const l=256*t,d=l+255,_=a.transformRequest(n.replace("{fontstack}",c).replace("{range}",`${l}-${d}`),"Glyphs"),v=yield u.l(_,new AbortController);if(!v||!v.data)throw new Error(`Could not load glyph range. range: ${t}, ${l}-${d}`);const b={};for(const C of u.n(v.data))b[C.id]=C;return b})},pi.TinySDF=class{constructor({fontSize:c=24,buffer:t=3,radius:n=8,cutoff:a=.25,fontFamily:l="sans-serif",fontWeight:d="normal",fontStyle:_="normal"}={}){this.buffer=t,this.cutoff=a,this.radius=n;const v=this.size=c+4*t,b=this._createCanvas(v),C=this.ctx=b.getContext("2d",{willReadFrequently:!0});C.font=`${_} ${d} ${c}px ${l}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(c){const t=document.createElement("canvas");return t.width=t.height=c,t}draw(c){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:l,actualBoundingBoxRight:d}=this.ctx.measureText(c),_=Math.ceil(n),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-l))),b=Math.min(this.size-this.buffer,_+Math.ceil(a)),C=v+2*this.buffer,z=b+2*this.buffer,k=Math.max(C*z,0),j=new Uint8ClampedArray(k),U={data:j,width:C,height:z,glyphWidth:v,glyphHeight:b,glyphTop:_,glyphLeft:0,glyphAdvance:t};if(v===0||b===0)return U;const{ctx:G,buffer:Y,gridInner:W,gridOuter:ee}=this;G.clearRect(Y,Y,v,b),G.fillText(c,Y,Y+_);const ce=G.getImageData(Y,Y,v,b);ee.fill($t,0,k),W.fill(0,0,k);for(let J=0;J<b;J++)for(let he=0;he<v;he++){const ye=ce.data[4*(J*v+he)+3]/255;if(ye===0)continue;const we=(J+Y)*C+he+Y;if(ye===1)ee[we]=0,W[we]=$t;else{const Ce=.5-ye;ee[we]=Ce>0?Ce*Ce:0,W[we]=Ce<0?Ce*Ce:0}}ti(ee,0,0,C,z,C,this.f,this.v,this.z),ti(W,Y,Y,v,b,C,this.f,this.v,this.z);for(let J=0;J<k;J++){const he=Math.sqrt(ee[J])-Math.sqrt(W[J]);j[J]=Math.round(255-255*(he/this.radius+this.cutoff))}return U}};class yn{constructor(){this.specification=u.v.light.position}possiblyEvaluate(t,n){return u.y(t.expression.evaluate(n))}interpolate(t,n,a){return{x:u.z.number(t.x,n.x,a),y:u.z.number(t.y,n.y,a),z:u.z.number(t.z,n.z,a)}}}let bi;class Ar extends u.E{constructor(t){super(),bi=bi||new u.q({anchor:new u.D(u.v.light.anchor),position:new yn,color:new u.D(u.v.light.color),intensity:new u.D(u.v.light.intensity)}),this._transitionable=new u.T(bi),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(u.r,t,n))for(const a in t){const l=t[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),l):this._transitionable.setValue(a,l)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,a){return(!a||a.validate!==!1)&&u.t(this,t.call(u.x,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:u.v}))}}class nr{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const a=t.join(",")+String(n);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(t,n)),this.dashEntry[a]}getDashRanges(t,n,a){const l=[];let d=t.length%2==1?-t[t.length-1]*a:0,_=t[0]*a,v=!0;l.push({left:d,right:_,isDash:v,zeroLength:t[0]===0});let b=t[0];for(let C=1;C<t.length;C++){v=!v;const z=t[C];d=b*a,b+=z,_=b*a,l.push({left:d,right:_,isDash:v,zeroLength:z===0})}return l}addRoundDash(t,n,a){const l=n/2;for(let d=-a;d<=a;d++){const _=this.width*(this.nextRow+a+d);let v=0,b=t[v];for(let C=0;C<this.width;C++){C/b.right>1&&(b=t[++v]);const z=Math.abs(C-b.left),k=Math.abs(C-b.right),j=Math.min(z,k);let U;const G=d/a*(l+1);if(b.isDash){const Y=l-Math.abs(G);U=Math.sqrt(j*j+Y*Y)}else U=l-Math.sqrt(j*j+G*G);this.data[_+C]=Math.max(0,Math.min(255,U+128))}}}addRegularDash(t){for(let v=t.length-1;v>=0;--v){const b=t[v],C=t[v+1];b.zeroLength?t.splice(v,1):C&&C.isDash===b.isDash&&(C.left=b.left,t.splice(v,1))}const n=t[0],a=t[t.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const l=this.width*this.nextRow;let d=0,_=t[d];for(let v=0;v<this.width;v++){v/_.right>1&&(_=t[++d]);const b=Math.abs(v-_.left),C=Math.abs(v-_.right),z=Math.min(b,C);this.data[l+v]=Math.max(0,Math.min(255,(_.isDash?z:-z)+128))}}addDash(t,n){const a=n?7:0,l=2*a+1;if(this.nextRow+l>this.height)return u.w("LineAtlas out of space"),null;let d=0;for(let v=0;v<t.length;v++)d+=t[v];if(d!==0){const v=this.width/d,b=this.getDashRanges(t,this.width,v);n?this.addRoundDash(b,v,a):this.addRegularDash(b)}const _={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:d};return this.nextRow+=l,this.dirty=!0,_}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const Xr="maplibre_preloaded_worker_pool";class ur{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<ur.workerCount;)this.workers.push(new Worker(u.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Xr]}numActive(){return Object.keys(this.active).length}}const Zi=Math.floor(ve.hardwareConcurrency/2);let ri,jr;function nn(){return ri||(ri=new ur),ri}ur.workerCount=u.B(globalThis)?Math.max(Math.min(Zi,3),1):1;class Wi{constructor(t,n){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=n;const a=this.workerPool.acquire(n);for(let l=0;l<a.length;l++){const d=new u.C(a[l],n);d.name=`Worker ${l}`,this.actors.push(d)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n){const a=[];for(const l of this.actors)a.push(l.sendAsync({type:t,data:n}));return Promise.all(a)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,n){for(const a of this.actors)a.registerMessageHandler(t,n)}}function qr(){return jr||(jr=new Wi(nn(),u.G),jr.registerMessageHandler("GR",(c,t,n)=>u.m(t,n))),jr}function Mt(c,t){const n=u.F();return u.H(n,n,[1,1,0]),u.J(n,n,[.5*c.width,.5*c.height,1]),u.K(n,n,c.calculatePosMatrix(t.toUnwrapped()))}function pa(c,t,n,a,l,d){const _=function(k,j,U){if(k)for(const G of k){const Y=j[G];if(Y&&Y.source===U&&Y.type==="fill-extrusion")return!0}else for(const G in j){const Y=j[G];if(Y.source===U&&Y.type==="fill-extrusion")return!0}return!1}(l&&l.layers,t,c.id),v=d.maxPitchScaleFactor(),b=c.tilesIn(a,v,_);b.sort(_n);const C=[];for(const k of b)C.push({wrappedTileID:k.tileID.wrapped().key,queryResults:k.tile.queryRenderedFeatures(t,n,c._state,k.queryGeometry,k.cameraQueryGeometry,k.scale,l,d,v,Mt(c.transform,k.tileID))});const z=function(k){const j={},U={};for(const G of k){const Y=G.queryResults,W=G.wrappedTileID,ee=U[W]=U[W]||{};for(const ce in Y){const J=Y[ce],he=ee[ce]=ee[ce]||{},ye=j[ce]=j[ce]||[];for(const we of J)he[we.featureIndex]||(he[we.featureIndex]=!0,ye.push(we))}}return j}(C);for(const k in z)z[k].forEach(j=>{const U=j.feature,G=c.getFeatureState(U.layer["source-layer"],U.id);U.source=U.layer.source,U.layer["source-layer"]&&(U.sourceLayer=U.layer["source-layer"]),U.state=G});return z}function _n(c,t){const n=c.tileID,a=t.tileID;return n.overscaledZ-a.overscaledZ||n.canonical.y-a.canonical.y||n.wrap-a.wrap||n.canonical.x-a.canonical.x}function Hn(c,t,n){return u._(this,void 0,void 0,function*(){let a=c;if(c.url?a=(yield u.h(t.transformRequest(c.url,"Source"),n)).data:yield ve.frameAsync(n),!a)return null;const l=u.L(u.e(a,c),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in a&&a.vector_layers&&(l.vectorLayerIds=a.vector_layers.map(d=>d.id)),l})}class vr{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof u.M?new u.M(t.lng,t.lat):u.M.convert(t),this}setSouthWest(t){return this._sw=t instanceof u.M?new u.M(t.lng,t.lat):u.M.convert(t),this}extend(t){const n=this._sw,a=this._ne;let l,d;if(t instanceof u.M)l=t,d=t;else{if(!(t instanceof vr))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(vr.convert(t)):this.extend(u.M.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(u.M.convert(t)):this;if(l=t._sw,d=t._ne,!l||!d)return this}return n||a?(n.lng=Math.min(l.lng,n.lng),n.lat=Math.min(l.lat,n.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new u.M(l.lng,l.lat),this._ne=new u.M(d.lng,d.lat)),this}getCenter(){return new u.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u.M(this.getWest(),this.getNorth())}getSouthEast(){return new u.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:a}=u.M.convert(t);let l=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&l}static convert(t){return t instanceof vr?t:t&&new vr(t)}static fromLngLat(t,n=0){const a=360*n/40075017,l=a/Math.cos(Math.PI/180*t.lat);return new vr(new u.M(t.lng-l,t.lat-a),new u.M(t.lng+l,t.lat+a))}}class zo{constructor(t,n,a){this.bounds=vr.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=a||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),a=Math.floor(u.N(this.bounds.getWest())*n),l=Math.floor(u.O(this.bounds.getNorth())*n),d=Math.ceil(u.N(this.bounds.getEast())*n),_=Math.ceil(u.O(this.bounds.getSouth())*n);return t.x>=a&&t.x<d&&t.y>=l&&t.y<_}}class be extends u.E{constructor(t,n,a,l){if(super(),this.id=t,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.e(this,u.L(n,["url","scheme","tileSize","promoteId"])),this._options=u.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(l)}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Hn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(u.e(this,t),t.bounds&&(this.tileBounds=new zo(t.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new u.j(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return u.e({},this._options)}loadTile(t){return u._(this,void 0,void 0,function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a={request:this.map._requestManager.transformRequest(n,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.request.collectResourceTiming=this._collectResourceTiming;let l="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((d,_)=>{t.reloadPromise={resolve:d,reject:_}})}else t.actor=this.dispatcher.getActor(),l="LT";t.abortController=new AbortController;try{const d=yield t.actor.sendAsync({type:l,data:a},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,d)}catch(d){if(delete t.abortController,t.aborted)return;if(d&&d.status!==404)throw d;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,n){if(n&&n.resourceTiming&&(t.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&t.setExpiryData(n),t.loadVectorData(n,this.map.painter),t.reloadPromise){const a=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(a.resolve).catch(a.reject)}}abortTile(t){return u._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return u._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Pn extends u.E{constructor(t,n,a,l){super(),this.id=t,this.dispatcher=a,this.setEventedParent(l),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.e({type:"raster"},n),u.e(this,u.L(n,["url","scheme","tileSize"]))}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Hn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(u.e(this,t),t.bounds&&(this.tileBounds=new zo(t.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new u.j(t))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return u.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return u._(this,void 0,void 0,function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const a=yield bt.getImage(this.map._requestManager.transformRequest(n,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(a&&a.data){this.map._refreshExpiredTiles&&a.cacheControl&&a.expires&&t.setExpiryData({cacheControl:a.cacheControl,expires:a.expires});const l=this.map.painter.context,d=l.gl,_=a.data;t.texture=this.map.painter.getTileTexture(_.width),t.texture?t.texture.update(_,{useMipmap:!0}):(t.texture=new Ft(l,_,d.RGBA,{useMipmap:!0}),t.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),l.extTextureFilterAnisotropic&&d.texParameterf(d.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax)),t.state="loaded"}}catch(a){if(delete t.abortController,t.aborted)t.state="unloaded";else if(a)throw t.state="errored",a}})}abortTile(t){return u._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return u._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class fa extends Pn{constructor(t,n,a,l){super(t,n,a,l),this.type="raster-dem",this.maxzoom=22,this._options=u.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(t){return u._(this,void 0,void 0,function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a=this.map._requestManager.transformRequest(n,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const l=yield bt.getImage(a,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(l&&l.data){const d=l.data;this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&t.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const _=u.b(d)&&u.S()?d:yield this.readImageNow(d),v={type:this.type,uid:t.uid,source:this.id,rawImageData:_,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const b=yield t.actor.sendAsync({type:"LDT",data:v});t.dem=b,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(l){if(delete t.abortController,t.aborted)t.state="unloaded";else if(l)throw t.state="errored",l}})}readImageNow(t){return u._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&u.U()){const n=t.width+2,a=t.height+2;try{return new u.R({width:n,height:a},yield u.V(t,-1,-1,n,a))}catch{}}return ve.getImageData(t,1)})}_getNeighboringTiles(t){const n=t.canonical,a=Math.pow(2,n.z),l=(n.x-1+a)%a,d=n.x===0?t.wrap-1:t.wrap,_=(n.x+1+a)%a,v=n.x+1===a?t.wrap+1:t.wrap,b={};return b[new u.Q(t.overscaledZ,d,n.z,l,n.y).key]={backfilled:!1},b[new u.Q(t.overscaledZ,v,n.z,_,n.y).key]={backfilled:!1},n.y>0&&(b[new u.Q(t.overscaledZ,d,n.z,l,n.y-1).key]={backfilled:!1},b[new u.Q(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},b[new u.Q(t.overscaledZ,v,n.z,_,n.y-1).key]={backfilled:!1}),n.y+1<a&&(b[new u.Q(t.overscaledZ,d,n.z,l,n.y+1).key]={backfilled:!1},b[new u.Q(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},b[new u.Q(t.overscaledZ,v,n.z,_,n.y+1).key]={backfilled:!1}),b}unloadTile(t){return u._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class Kt extends u.E{constructor(t,n,a,l){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(l),this._data=n.data,this._options=u.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const d=u.W/this.tileSize;this.workerOptions=u.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*d,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*d,extent:u.W,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:u.W,radius:(n.clusterRadius||50)*d,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return u._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return u._(this,void 0,void 0,function*(){const t=u.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,n,a){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:n,offset:a}})}_updateWorkerData(t){return u._(this,void 0,void 0,function*(){const n=u.e({type:this.type},this.workerOptions);t?n.dataDiff=t:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(ve.resolveURL(this._data),"Source"),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new u.k("dataloading",{dataType:"source"}));try{const a=yield this.actor.sendAsync({type:"LD",data:n});if(this._pendingLoads--,this._removed||a.abandoned)return void this.fire(new u.k("dataabort",{dataType:"source"}));let l=null;a.resourceTiming&&a.resourceTiming[this.id]&&(l=a.resourceTiming[this.id].slice(0));const d={dataType:"source"};this._collectResourceTiming&&l&&l.length>0&&u.e(d,{resourceTiming:l}),this.fire(new u.k("data",Object.assign(Object.assign({},d),{sourceDataType:"metadata"}))),this.fire(new u.k("data",Object.assign(Object.assign({},d),{sourceDataType:"content"})))}catch(a){if(this._pendingLoads--,this._removed)return void this.fire(new u.k("dataabort",{dataType:"source"}));this.fire(new u.j(a))}})}loaded(){return this._pendingLoads===0}loadTile(t){return u._(this,void 0,void 0,function*(){const n=t.actor?"RT":"LT";t.actor=this.actor;const a={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const l=yield this.actor.sendAsync({type:n,data:a},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(l,this.map.painter,n==="RT")})}abortTile(t){return u._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return u._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return u.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var qt=u.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Mn extends u.E{constructor(t,n,a,l){super(),this.id=t,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(l),this.options=n}load(t){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield bt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,t&&(this.coordinates=t),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,this.fire(new u.j(n))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const n=t.map(u.Y.fromLngLat);this.tileID=function(l){let d=1/0,_=1/0,v=-1/0,b=-1/0;for(const j of l)d=Math.min(d,j.x),_=Math.min(_,j.y),v=Math.max(v,j.x),b=Math.max(b,j.y);const C=Math.max(v-d,b-_),z=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),k=Math.pow(2,z);return new u.a0(z,Math.floor((d+v)/2*k),Math.floor((_+b)/2*k))}(n),this.minzoom=this.maxzoom=this.tileID.z;const a=n.map(l=>this.tileID.getTilePoint(l)._round());return this._boundsArray=new u.Z,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,u.W,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,u.W),this._boundsArray.emplaceBack(a[2].x,a[2].y,u.W,u.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,qt.members)),this.boundsSegments||(this.boundsSegments=u.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Ft(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const l in this.tiles){const d=this.tiles[l];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,a=!0)}a&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return u._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Do extends Mn{constructor(t,n,a,l){super(t,n,a,l),this.roundZoom=!0,this.type="video",this.options=n}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const n of t.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{const n=yield u.a2(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new u.j(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new u.j(new u.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,qt.members)),this.boundsSegments||(this.boundsSegments=u.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new Ft(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const l in this.tiles){const d=this.tiles[l];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,a=!0)}a&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Fo extends Mn{constructor(t,n,a,l){super(t,n,a,l),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(d=>!Array.isArray(d)||d.length!==2||d.some(_=>typeof _!="number"))||this.fire(new u.j(new u.a1(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.j(new u.a1(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new u.j(new u.a1(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new u.j(new u.a1(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.j(new u.a1(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return u._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,a=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,qt.members)),this.boundsSegments||(this.boundsSegments=u.$.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ft(n,this.canvas,a.RGBA,{premultiply:!0});let l=!1;for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,l=!0)}l&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const kn={},xn=c=>{switch(c){case"geojson":return Kt;case"image":return Mn;case"raster":return Pn;case"raster-dem":return fa;case"vector":return be;case"video":return Do;case"canvas":return Fo}return kn[c]},Hi="RTLPluginLoaded";class Lo extends u.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=qr()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(n=>{throw this.status="error",n})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return u._(this,arguments,void 0,function*(n,a=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ve.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!a)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return u._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new u.k(Hi))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Re=null;function ci(){return Re||(Re=new Lo),Re}class Jr{constructor(t,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=u.a3(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const n=t+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,n,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(l,d){const _={};if(!d)return _;for(const v of l){const b=v.layerIds.map(C=>d.getLayer(C)).filter(Boolean);if(b.length!==0){v.layers=b,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(C=>b.filter(z=>z.id===C)[0]));for(const C of b)_[C.id]=v}}return _}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const d=this.buckets[l];if(d instanceof u.a5){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const d=this.buckets[l];if(d instanceof u.a5&&d.hasRTLText){this.hasRTLText=!0,ci().lazyLoad();break}}this.queryPadding=0;for(const l in this.buckets){const d=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(l).queryRadius(d))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new u.a4}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const a in this.buckets){const l=this.buckets[a];l.uploadPending()&&l.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ft(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ft(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,a,l,d,_,v,b,C,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:l,cameraQueryGeometry:d,scale:_,tileSize:this.tileSize,pixelPosMatrix:z,transform:b,params:v,queryPadding:this.queryPadding*C},t,n,a):{}}querySourceFeatures(t,n){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const l=a.loadVTLayers(),d=n&&n.sourceLayer?n.sourceLayer:"",_=l._geojsonTileLayer||l[d];if(!_)return;const v=u.a6(n&&n.filter),{z:b,x:C,y:z}=this.tileID.canonical,k={z:b,x:C,y:z};for(let j=0;j<_.length;j++){const U=_.feature(j);if(v.needGeometry){const W=u.a7(U,!0);if(!v.filter(new u.a8(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!v.filter(new u.a8(this.tileID.overscaledZ),U))continue;const G=a.getId(U,d),Y=new u.a9(U,b,C,z,G);Y.tile=k,t.push(Y)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const a=u.aa(t.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const a=Date.now();let l=!1;if(this.expirationTime>a)l=!1;else if(n)if(this.expirationTime<n)l=!0;else{const d=this.expirationTime-n;d?this.expirationTime=a+Math.max(d,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const l in this.buckets){if(!n.style.hasLayer(l))continue;const d=this.buckets[l],_=d.layers[0].sourceLayer||"_geojsonTileLayer",v=a[_],b=t[_];if(!v||!b||Object.keys(b).length===0)continue;d.update(b,v,this.imageAtlas&&this.imageAtlas.patternPositions||{});const C=n&&n.style&&n.style.getLayer(l);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ve.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=ve.now()+t}setDependencies(t,n){const a={};for(const l of n)a[l]=!0;this.dependencies[t]=a}hasDependency(t,n){for(const a of t){const l=this.dependencies[a];if(l){for(const d of n)if(l[d])return!0}}return!1}}class zn{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,a){const l=t.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const d={value:n,timeout:void 0};if(a!==void 0&&(d.timeout=setTimeout(()=>{this.remove(t,d)},a)),this.data[l].push(d),this.order.push(l),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const a=t.wrapped().key,l=n===void 0?0:this.data[a].indexOf(n),d=this.data[a][l];return this.data[a].splice(l,1),d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const a in this.data)for(const l of this.data[a])t(l.value)||n.push(l);for(const a of n)this.remove(a.value.tileID,a)}}class vn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,a){const l=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][l]=this.stateChanges[t][l]||{},u.e(this.stateChanges[t][l],a),this.deletedStates[t]===null){this.deletedStates[t]={};for(const d in this.state[t])d!==l&&(this.deletedStates[t][d]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][l]===null){this.deletedStates[t][l]={};for(const d in this.state[t][l])a[d]||(this.deletedStates[t][l][d]=null)}else for(const d in a)this.deletedStates[t]&&this.deletedStates[t][l]&&this.deletedStates[t][l][d]===null&&delete this.deletedStates[t][l][d]}removeFeatureState(t,n,a){if(this.deletedStates[t]===null)return;const l=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},a&&n!==void 0)this.deletedStates[t][l]!==null&&(this.deletedStates[t][l]=this.deletedStates[t][l]||{},this.deletedStates[t][l][a]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][l])for(a in this.deletedStates[t][l]={},this.stateChanges[t][l])this.deletedStates[t][l][a]=null;else this.deletedStates[t][l]=null;else this.deletedStates[t]=null}getState(t,n){const a=String(n),l=u.e({},(this.state[t]||{})[a],(this.stateChanges[t]||{})[a]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const d=this.deletedStates[t][n];if(d===null)return{};for(const _ in d)delete l[_]}return l}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const a={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const d={};for(const _ in this.stateChanges[l])this.state[l][_]||(this.state[l][_]={}),u.e(this.state[l][_],this.stateChanges[l][_]),d[_]=this.state[l][_];a[l]=d}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const d={};if(this.deletedStates[l]===null)for(const _ in this.state[l])d[_]={},this.state[l][_]={};else for(const _ in this.deletedStates[l]){if(this.deletedStates[l][_]===null)this.state[l][_]={};else for(const v of Object.keys(this.deletedStates[l][_]))delete this.state[l][_][v];d[_]=this.state[l][_]}a[l]=a[l]||{},u.e(a[l],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const l in t)t[l].setFeatureState(a,n)}}class Le extends u.E{constructor(t,n,a){super(),this.id=t,this.dispatcher=a,this.on("data",l=>this._dataHandler(l)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((l,d,_,v)=>{const b=new(xn(d.type))(l,d,_,v);if(b.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${b.id}`);return b})(t,n,a,this),this._tiles={},this._cache=new zn(0,l=>this._unloadTile(l)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new vn,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n,a){return u._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,n,a)}catch(l){t.state="errored",l.status!==404?this._source.fire(new u.j(l,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new u.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const a=this._tiles[n];a.upload(t),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(kt).map(t=>t.key)}getRenderableIds(t){const n=[];for(const a in this._tiles)this._isIdRenderable(a,t)&&n.push(this._tiles[a]);return t?n.sort((a,l)=>{const d=a.tileID,_=l.tileID,v=new u.P(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),b=new u.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-_.overscaledZ||b.y-v.y||b.x-v.x}).map(a=>a.tileID.key):n.map(a=>a.tileID).sort(kt).map(a=>a.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,n){return u._(this,void 0,void 0,function*(){const a=this._tiles[t];a&&(a.state!=="loading"&&(a.state=n),yield this._loadTile(a,t,n))})}_tileLoaded(t,n,a){t.timeAdded=ve.now(),a==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new u.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const n=this.getRenderableIds();for(let l=0;l<n.length;l++){const d=n[l];if(t.neighboringTiles&&t.neighboringTiles[d]){const _=this.getTileByID(d);a(t,_),a(_,t)}}function a(l,d){l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0;let _=d.tileID.canonical.x-l.tileID.canonical.x;const v=d.tileID.canonical.y-l.tileID.canonical.y,b=Math.pow(2,l.tileID.canonical.z),C=d.tileID.key;_===0&&v===0||Math.abs(v)>1||(Math.abs(_)>1&&(Math.abs(_+b)===1?_+=b:Math.abs(_-b)===1&&(_-=b)),d.dem&&l.dem&&(l.dem.backfillBorder(d.dem,_,v),l.neighboringTiles&&l.neighboringTiles[C]&&(l.neighboringTiles[C].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,a,l){for(const d in this._tiles){let _=this._tiles[d];if(l[d]||!_.hasData()||_.tileID.overscaledZ<=n||_.tileID.overscaledZ>a)continue;let v=_.tileID;for(;_&&_.tileID.overscaledZ>n+1;){const C=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[C.key],_&&_.hasData()&&(v=C)}let b=v;for(;b.overscaledZ>n;)if(b=b.scaledTo(b.overscaledZ-1),t[b.key]){l[v.key]=v;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const a=this._loadedParentTiles[t.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=t.overscaledZ-1;a>=n;a--){const l=t.scaledTo(a),d=this._getLoadedTile(l);if(d)return d}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,a=Math.ceil(t.height/this._source.tileSize)+1,l=Math.floor(n*a*(this._maxTileCacheZoomLevels===null?u.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,l):l;this._cache.setMaxSize(d)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const a={};for(const l in this._tiles){const d=this._tiles[l];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),a[d.tileID.key]=d}this._tiles=a;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(l,this._tiles[l])}}_updateCoveredAndRetainedTiles(t,n,a,l,d,_){const v={},b={},C=Object.keys(t),z=ve.now();for(const k of C){const j=t[k],U=this._tiles[k];if(!U||U.fadeEndTime!==0&&U.fadeEndTime<=z)continue;const G=this.findLoadedParent(j,n),Y=this.findLoadedSibling(j),W=G||Y||null;W&&(this._addTile(W.tileID),v[W.tileID.key]=W.tileID),b[k]=j}this._retainLoadedChildren(b,l,a,t);for(const k in v)t[k]||(this._coveredTiles[k]=!0,t[k]=v[k]);if(_){const k={},j={};for(const U of d)this._tiles[U.key].hasData()?k[U.key]=U:j[U.key]=U;for(const U in j){const G=j[U].children(this._source.maxzoom);this._tiles[G[0].key]&&this._tiles[G[1].key]&&this._tiles[G[2].key]&&this._tiles[G[3].key]&&(k[G[0].key]=t[G[0].key]=G[0],k[G[1].key]=t[G[1].key]=G[1],k[G[2].key]=t[G[2].key]=G[2],k[G[3].key]=t[G[3].key]=G[3],delete j[U])}for(const U in j){const G=j[U],Y=this.findLoadedParent(G,this._source.minzoom),W=this.findLoadedSibling(G),ee=Y||W||null;if(ee){k[ee.tileID.key]=t[ee.tileID.key]=ee.tileID;for(const ce in k)k[ce].isChildOf(ee.tileID)&&delete k[ce]}}for(const U in this._tiles)k[U]||(this._coveredTiles[U]=!0)}}update(t,n){if(!this._sourceLoaded||this._paused)return;let a;this.transform=t,this.terrain=n,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new u.Q(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y)):(a=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(a=a.filter(z=>this._source.hasTile(z)))):a=[];const l=t.coveringZoomLevel(this._source),d=Math.max(l-Le.maxOverzooming,this._source.minzoom),_=Math.max(l+Le.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const z={};for(const k of a)if(k.canonical.z>this._source.minzoom){const j=k.scaledTo(k.canonical.z-1);z[j.key]=j;const U=k.scaledTo(Math.max(this._source.minzoom,Math.min(k.canonical.z,5)));z[U.key]=U}a=a.concat(Object.values(z))}const v=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,v&&this.fire(new u.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const b=this._updateRetainedTiles(a,l);It(this._source.type)&&this._updateCoveredAndRetainedTiles(b,d,_,l,a,n);for(const z in b)this._tiles[z].clearFadeHold();const C=u.ab(this._tiles,b);for(const z of C){const k=this._tiles[z];k.hasSymbolBuckets&&!k.holdingForFade()?k.setHoldDuration(this.map._fadeDuration):k.hasSymbolBuckets&&!k.symbolFadeFinished()||this._removeTile(z)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){var a;const l={},d={},_=Math.max(n-Le.maxOverzooming,this._source.minzoom),v=Math.max(n+Le.maxUnderzooming,this._source.minzoom),b={};for(const C of t){const z=this._addTile(C);l[C.key]=C,z.hasData()||n<this._source.maxzoom&&(b[C.key]=C)}this._retainLoadedChildren(b,n,v,l);for(const C of t){let z=this._tiles[C.key];if(z.hasData())continue;if(n+1>this._source.maxzoom){const j=C.children(this._source.maxzoom)[0],U=this.getTile(j);if(U&&U.hasData()){l[j.key]=j;continue}}else{const j=C.children(this._source.maxzoom);if(l[j[0].key]&&l[j[1].key]&&l[j[2].key]&&l[j[3].key])continue}let k=z.wasRequested();for(let j=C.overscaledZ-1;j>=_;--j){const U=C.scaledTo(j);if(d[U.key])break;if(d[U.key]=!0,z=this.getTile(U),!z&&k&&(z=this._addTile(U)),z){const G=z.hasData();if((G||!(!((a=this.map)===null||a===void 0)&&a.cancelPendingTileRequestsWhileZooming)||k)&&(l[U.key]=U),k=z.wasRequested(),G)break}}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let a,l=this._tiles[t].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){a=this._loadedParentTiles[l.key];break}n.push(l.key);const d=l.scaledTo(l.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;l=d}for(const d of n)this._loadedParentTiles[d]=a}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const n=this._tiles[t].tileID,a=this._getLoadedTile(n);this._loadedSiblingTiles[n.key]=a}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const a=n;return n||(n=new Jr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,t.key,n.state)),n.uses++,this._tiles[t.key]=n,a||this._source.fire(new u.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const a=n.getExpiryTimeout();a&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},a))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(t){const n=t.sourceDataType;t.dataType==="source"&&n==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&n==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,n,a){const l=[],d=this.transform;if(!d)return l;const _=a?d.getCameraQueryGeometry(t):t,v=t.map(G=>d.pointCoordinate(G,this.terrain)),b=_.map(G=>d.pointCoordinate(G,this.terrain)),C=this.getIds();let z=1/0,k=1/0,j=-1/0,U=-1/0;for(const G of b)z=Math.min(z,G.x),k=Math.min(k,G.y),j=Math.max(j,G.x),U=Math.max(U,G.y);for(let G=0;G<C.length;G++){const Y=this._tiles[C[G]];if(Y.holdingForFade())continue;const W=Y.tileID,ee=Math.pow(2,d.zoom-Y.tileID.overscaledZ),ce=n*Y.queryPadding*u.W/Y.tileSize/ee,J=[W.getTilePoint(new u.Y(z,k)),W.getTilePoint(new u.Y(j,U))];if(J[0].x-ce<u.W&&J[0].y-ce<u.W&&J[1].x+ce>=0&&J[1].y+ce>=0){const he=v.map(we=>W.getTilePoint(we)),ye=b.map(we=>W.getTilePoint(we));l.push({tile:Y,tileID:W,queryGeometry:he,cameraQueryGeometry:ye,scale:ee})}}return l}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(a=>this._tiles[a].tileID);for(const a of n)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(It(this._source.type)){const t=ve.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=t)return!0}return!1}setFeatureState(t,n,a){this._state.updateState(t=t||"_geojsonTileLayer",n,a)}removeFeatureState(t,n,a){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,a)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,a){const l=this._tiles[t];l&&l.setDependencies(n,a)}reloadTilesForDependencies(t,n){for(const a in this._tiles)this._tiles[a].hasDependency(t,n)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(t,n))}}function kt(c,t){const n=Math.abs(2*c.wrap)-+(c.wrap<0),a=Math.abs(2*t.wrap)-+(t.wrap<0);return c.overscaledZ-t.overscaledZ||a-n||t.canonical.y-c.canonical.y||t.canonical.x-c.canonical.x}function It(c){return c==="raster"||c==="image"||c==="video"}Le.maxOverzooming=10,Le.maxUnderzooming=3;class Nr{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=u.ac(t,0,1);let n=1,a=this._distances[n];const l=t*this.paddedLength+this.padding;for(;a<l&&n<this._distances.length;)a=this._distances[++n];const d=n-1,_=this._distances[d],v=a-_,b=v>0?(l-_)/v:0;return this.points[d].mult(1-b).add(this.points[n].mult(b))}}function fi(c,t){let n=!0;return c==="always"||c!=="never"&&t!=="never"||(n=!1),n}class Ct{constructor(t,n,a){const l=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(t/a),this.yCellCount=Math.ceil(n/a);for(let _=0;_<this.xCellCount*this.yCellCount;_++)l.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,a,l,d){this._forEachCell(n,a,l,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(d)}insertCircle(t,n,a,l){this._forEachCell(n-l,a-l,n+l,a+l,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(a),this.circles.push(l)}_insertBoxCell(t,n,a,l,d,_){this.boxCells[d].push(_)}_insertCircleCell(t,n,a,l,d,_){this.circleCells[d].push(_)}_query(t,n,a,l,d,_,v){if(a<0||t>this.width||l<0||n>this.height)return[];const b=[];if(t<=0&&n<=0&&this.width<=a&&this.height<=l){if(d)return[{key:null,x1:t,y1:n,x2:a,y2:l}];for(let C=0;C<this.boxKeys.length;C++)b.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const z=this.circles[3*C],k=this.circles[3*C+1],j=this.circles[3*C+2];b.push({key:this.circleKeys[C],x1:z-j,y1:k-j,x2:z+j,y2:k+j})}}else this._forEachCell(t,n,a,l,this._queryCell,b,{hitTest:d,overlapMode:_,seenUids:{box:{},circle:{}}},v);return b}query(t,n,a,l){return this._query(t,n,a,l,!1,null)}hitTest(t,n,a,l,d,_){return this._query(t,n,a,l,!0,d,_).length>0}hitTestCircle(t,n,a,l,d){const _=t-a,v=t+a,b=n-a,C=n+a;if(v<0||_>this.width||C<0||b>this.height)return!1;const z=[];return this._forEachCell(_,b,v,C,this._queryCellCircle,z,{hitTest:!0,overlapMode:l,circle:{x:t,y:n,radius:a},seenUids:{box:{},circle:{}}},d),z.length>0}_queryCell(t,n,a,l,d,_,v,b){const{seenUids:C,hitTest:z,overlapMode:k}=v,j=this.boxCells[d];if(j!==null){const G=this.bboxes;for(const Y of j)if(!C.box[Y]){C.box[Y]=!0;const W=4*Y,ee=this.boxKeys[Y];if(t<=G[W+2]&&n<=G[W+3]&&a>=G[W+0]&&l>=G[W+1]&&(!b||b(ee))&&(!z||!fi(k,ee.overlapMode))&&(_.push({key:ee,x1:G[W],y1:G[W+1],x2:G[W+2],y2:G[W+3]}),z))return!0}}const U=this.circleCells[d];if(U!==null){const G=this.circles;for(const Y of U)if(!C.circle[Y]){C.circle[Y]=!0;const W=3*Y,ee=this.circleKeys[Y];if(this._circleAndRectCollide(G[W],G[W+1],G[W+2],t,n,a,l)&&(!b||b(ee))&&(!z||!fi(k,ee.overlapMode))){const ce=G[W],J=G[W+1],he=G[W+2];if(_.push({key:ee,x1:ce-he,y1:J-he,x2:ce+he,y2:J+he}),z)return!0}}}return!1}_queryCellCircle(t,n,a,l,d,_,v,b){const{circle:C,seenUids:z,overlapMode:k}=v,j=this.boxCells[d];if(j!==null){const G=this.bboxes;for(const Y of j)if(!z.box[Y]){z.box[Y]=!0;const W=4*Y,ee=this.boxKeys[Y];if(this._circleAndRectCollide(C.x,C.y,C.radius,G[W+0],G[W+1],G[W+2],G[W+3])&&(!b||b(ee))&&!fi(k,ee.overlapMode))return _.push(!0),!0}}const U=this.circleCells[d];if(U!==null){const G=this.circles;for(const Y of U)if(!z.circle[Y]){z.circle[Y]=!0;const W=3*Y,ee=this.circleKeys[Y];if(this._circlesCollide(G[W],G[W+1],G[W+2],C.x,C.y,C.radius)&&(!b||b(ee))&&!fi(k,ee.overlapMode))return _.push(!0),!0}}}_forEachCell(t,n,a,l,d,_,v,b){const C=this._convertToXCellCoord(t),z=this._convertToYCellCoord(n),k=this._convertToXCellCoord(a),j=this._convertToYCellCoord(l);for(let U=C;U<=k;U++)for(let G=z;G<=j;G++)if(d.call(this,t,n,a,l,this.xCellCount*G+U,_,v,b))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,a,l,d,_){const v=l-t,b=d-n,C=a+_;return C*C>v*v+b*b}_circleAndRectCollide(t,n,a,l,d,_,v){const b=(_-l)/2,C=Math.abs(t-(l+b));if(C>b+a)return!1;const z=(v-d)/2,k=Math.abs(n-(d+z));if(k>z+a)return!1;if(C<=b||k<=z)return!0;const j=C-b,U=k-z;return j*j+U*U<=a*a}}function wi(c,t,n,a,l){const d=u.F();return t?(u.J(d,d,[1/l,1/l,1]),n||u.ad(d,d,a.angle)):u.K(d,a.labelPlaneMatrix,c),d}function bn(c,t,n,a,l){if(t){const d=u.ae(c);return u.J(d,d,[l,l,1]),n||u.ad(d,d,-a.angle),d}return a.glCoordMatrix}function zr(c,t,n){let a;n?(a=[c.x,c.y,n(c.x,c.y),1],u.af(a,a,t)):(a=[c.x,c.y,0,1],function(d,_,v){const b=_[0],C=_[1];d[0]=v[0]*b+v[4]*C+v[12],d[1]=v[1]*b+v[5]*C+v[13],d[3]=v[3]*b+v[7]*C+v[15]}(a,a,t));const l=a[3];return{point:new u.P(a[0]/l,a[1]/l),signedDistanceFromCamera:l,isOccluded:!1}}function Z(c,t){return .5+c/t*.5}function F(c,t){return c.x>=-t[0]&&c.x<=t[0]&&c.y>=-t[1]&&c.y<=t[1]}function L(c,t,n,a,l,d,_,v,b,C,z,k,j,U,G){const Y=a?c.textSizeData:c.iconSizeData,W=u.ag(Y,n.transform.zoom),ee=[256/n.width*2+1,256/n.height*2+1],ce=a?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;ce.clear();const J=c.lineVertexArray,he=a?c.text.placedSymbolArray:c.icon.placedSymbolArray,ye=n.transform.width/n.transform.height;let we=!1;for(let Ce=0;Ce<he.length;Ce++){const De=he.get(Ce);if(De.hidden||De.writingMode===u.ah.vertical&&!we){dt(De.numGlyphs,ce);continue}we=!1;const Qe=zr(new u.P(De.anchorX,De.anchorY),t,G);if(!F(Qe.point,ee)){dt(De.numGlyphs,ce);continue}const et=Z(n.transform.cameraToCenterDistance,Qe.signedDistanceFromCamera),Be=u.ai(Y,W,De),je=_?Be/et:Be*et,at={getElevation:G,labelPlaneMatrix:l,lineVertexArray:J,pitchWithMap:_,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:C,tileAnchorPoint:new u.P(De.anchorX,De.anchorY),unwrappedTileID:z,width:k,height:j,translation:U},Tt=ie(at,De,je,!1,v,t,d,c.glyphOffsetArray,ce,ye,b);we=Tt.useVertical,(Tt.notEnoughRoom||we||Tt.needsFlipping&&ie(at,De,je,!0,v,t,d,c.glyphOffsetArray,ce,ye,b).notEnoughRoom)&&dt(De.numGlyphs,ce)}a?c.text.dynamicLayoutVertexBuffer.updateData(ce):c.icon.dynamicLayoutVertexBuffer.updateData(ce)}function $(c,t,n,a,l,d,_,v){const b=d.glyphStartIndex+d.numGlyphs,C=d.lineStartIndex,z=d.lineStartIndex+d.lineLength,k=t.getoffsetX(d.glyphStartIndex),j=t.getoffsetX(b-1),U=Se(c*k,n,a,l,d.segment,C,z,v,_);if(!U)return null;const G=Se(c*j,n,a,l,d.segment,C,z,v,_);return G?v.projectionCache.anyProjectionOccluded?null:{first:U,last:G}:null}function X(c,t,n,a){return c===u.ah.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*a?{useVertical:!0}:(c===u.ah.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function ie(c,t,n,a,l,d,_,v,b,C,z){const k=n/24,j=t.lineOffsetX*k,U=t.lineOffsetY*k;let G;if(t.numGlyphs>1){const Y=t.glyphStartIndex+t.numGlyphs,W=t.lineStartIndex,ee=t.lineStartIndex+t.lineLength,ce=$(k,v,j,U,a,t,z,c);if(!ce)return{notEnoughRoom:!0};const J=zr(ce.first.point,_,c.getElevation).point,he=zr(ce.last.point,_,c.getElevation).point;if(l&&!a){const ye=X(t.writingMode,J,he,C);if(ye)return ye}G=[ce.first];for(let ye=t.glyphStartIndex+1;ye<Y-1;ye++)G.push(Se(k*v.getoffsetX(ye),j,U,a,t.segment,W,ee,c,z));G.push(ce.last)}else{if(l&&!a){const W=zr(c.tileAnchorPoint,d,c.getElevation).point,ee=t.lineStartIndex+t.segment+1,ce=new u.P(c.lineVertexArray.getx(ee),c.lineVertexArray.gety(ee)),J=zr(ce,d,c.getElevation),he=J.signedDistanceFromCamera>0?J.point:function(we,Ce,De,Qe,et,Be){return ue(we,Ce,De,1,et,Be)}(c.tileAnchorPoint,ce,W,0,d,c),ye=X(t.writingMode,W,he,C);if(ye)return ye}const Y=Se(k*v.getoffsetX(t.glyphStartIndex),j,U,a,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,c,z);if(!Y||c.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};G=[Y]}for(const Y of G)u.aj(b,Y.point,Y.angle);return{}}function ue(c,t,n,a,l,d){const _=c.add(c.sub(t)._unit()),v=l!==void 0?zr(_,l,d.getElevation).point:te(_.x,_.y,d).point,b=n.sub(v);return n.add(b._mult(a/b.mag()))}function pe(c,t,n){const a=t.projectionCache;if(a.projections[c])return a.projections[c];const l=new u.P(t.lineVertexArray.getx(c),t.lineVertexArray.gety(c)),d=te(l.x,l.y,t);if(d.signedDistanceFromCamera>0)return a.projections[c]=d.point,a.anyProjectionOccluded=a.anyProjectionOccluded||d.isOccluded,d.point;const _=c-n.direction;return function(v,b,C,z,k){return ue(v,b,C,z,void 0,k)}(n.distanceFromAnchor===0?t.tileAnchorPoint:new u.P(t.lineVertexArray.getx(_),t.lineVertexArray.gety(_)),l,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,t)}function te(c,t,n){const a=c+n.translation[0],l=t+n.translation[1];let d;return!n.pitchWithMap&&n.projection.useSpecialProjectionForSymbols?(d=n.projection.projectTileCoordinates(a,l,n.unwrappedTileID,n.getElevation),d.point.x=(.5*d.point.x+.5)*n.width,d.point.y=(.5*-d.point.y+.5)*n.height):(d=zr(new u.P(a,l),n.labelPlaneMatrix,n.getElevation),d.isOccluded=!1),d}function _e(c,t,n){return c._unit()._perp()._mult(t*n)}function Me(c,t,n,a,l,d,_,v,b){if(v.projectionCache.offsets[c])return v.projectionCache.offsets[c];const C=n.add(t);if(c+b.direction<a||c+b.direction>=l)return v.projectionCache.offsets[c]=C,C;const z=pe(c+b.direction,v,b),k=_e(z.sub(n),_,b.direction),j=n.add(k),U=z.add(k);return v.projectionCache.offsets[c]=u.ak(d,C,j,U)||C,v.projectionCache.offsets[c]}function Se(c,t,n,a,l,d,_,v,b){const C=a?c-t:c+t;let z=C>0?1:-1,k=0;a&&(z*=-1,k=Math.PI),z<0&&(k+=Math.PI);let j,U=z>0?d+l:d+l+1;v.projectionCache.cachedAnchorPoint?j=v.projectionCache.cachedAnchorPoint:(j=te(v.tileAnchorPoint.x,v.tileAnchorPoint.y,v).point,v.projectionCache.cachedAnchorPoint=j);let G,Y,W=j,ee=j,ce=0,J=0;const he=Math.abs(C),ye=[];let we;for(;ce+J<=he;){if(U+=z,U<d||U>=_)return null;ce+=J,ee=W,Y=G;const Qe={absOffsetX:he,direction:z,distanceFromAnchor:ce,previousVertex:ee};if(W=pe(U,v,Qe),n===0)ye.push(ee),we=W.sub(ee);else{let et;const Be=W.sub(ee);et=Be.mag()===0?_e(pe(U+z,v,Qe).sub(W),n,z):_e(Be,n,z),Y||(Y=ee.add(et)),G=Me(U,et,W,d,_,Y,n,v,Qe),ye.push(Y),we=G.sub(Y)}J=we.mag()}const Ce=we._mult((he-ce)/J)._add(Y||ee),De=k+Math.atan2(W.y-ee.y,W.x-ee.x);return ye.push(Ce),{point:Ce,angle:b?De:0,path:ye}}const Te=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function dt(c,t){for(let n=0;n<c;n++){const a=t.length;t.resize(a+4),t.float32.set(Te,3*a)}}const ut=100;class Et{constructor(t,n,a=new Ct(t.width+200,t.height+200,25),l=new Ct(t.width+200,t.height+200,25)){this.transform=t,this.mapProjection=n,this.grid=a,this.ignoredGrid=l,this.pitchFactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ut,this.screenBottomBoundary=t.height+ut,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,a,l,d,_,v,b,C,z,k){const j=t.anchorPointX+b[0],U=t.anchorPointY+b[1],G=this.projectAndGetPerspectiveRatio(l,j,U,d,z),Y=this._projectCollisionBox(t,a,l,d,_,v,b,G,z,k),[W,ee,ce,J]=Y.box;return this.mapProjection.useSpecialProjectionForSymbols&&(_?Y.allPointsOccluded:this.mapProjection.isOccluded(j,U,d))||G.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(W,ee,ce,J)||n!=="always"&&this.grid.hitTest(W,ee,ce,J,n,C)?{box:[W,ee,ce,J],placeable:!1,offscreen:!1}:{box:[W,ee,ce,J],placeable:!0,offscreen:this.isOffscreen(W,ee,ce,J)}}placeCollisionCircles(t,n,a,l,d,_,v,b,C,z,k,j,U,G,Y,W){const ee=[],ce=new u.P(n.anchorX,n.anchorY),J=this.getPerspectiveRatio(_,ce.x,ce.y,v,W),he=(k?d/J:d*J)/u.ap,ye={getElevation:W,labelPlaneMatrix:b,lineVertexArray:a,pitchWithMap:k,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ce,unwrappedTileID:v,width:this.transform.width,height:this.transform.height,translation:Y},we=$(he,l,n.lineOffsetX*he,n.lineOffsetY*he,!1,n,!1,ye);let Ce=!1,De=!1,Qe=!0;if(we){const et=.5*U*J+G,Be=new u.P(-100,-100),je=new u.P(this.screenRightBoundary,this.screenBottomBoundary),at=new Nr,Tt=we.first,Ue=we.last;let He=[];for(let Dt=Tt.path.length-1;Dt>=1;Dt--)He.push(Tt.path[Dt]);for(let Dt=1;Dt<Ue.path.length;Dt++)He.push(Ue.path[Dt]);const wt=2.5*et;if(C){const Dt=this.projectPathToScreenSpace(He,ye,C);He=Dt.some(jt=>jt.signedDistanceFromCamera<=0)?[]:Dt.map(jt=>jt.point)}let Sr=[];if(He.length>0){const Dt=He[0].clone(),jt=He[0].clone();for(let Tr=1;Tr<He.length;Tr++)Dt.x=Math.min(Dt.x,He[Tr].x),Dt.y=Math.min(Dt.y,He[Tr].y),jt.x=Math.max(jt.x,He[Tr].x),jt.y=Math.max(jt.y,He[Tr].y);Sr=Dt.x>=Be.x&&jt.x<=je.x&&Dt.y>=Be.y&&jt.y<=je.y?[He]:jt.x<Be.x||Dt.x>je.x||jt.y<Be.y||Dt.y>je.y?[]:u.al([He],Be.x,Be.y,je.x,je.y)}for(const Dt of Sr){at.reset(Dt,.25*et);let jt=0;jt=at.length<=.5*et?1:Math.ceil(at.paddedLength/wt)+1;for(let Tr=0;Tr<jt;Tr++){const Ei=Tr/Math.max(jt-1,1),On=at.lerp(Ei),Ir=On.x+ut,Yi=On.y+ut;ee.push(Ir,Yi,et,0);const Ni=Ir-et,Ai=Yi-et,Pi=Ir+et,jn=Yi+et;if(Qe=Qe&&this.isOffscreen(Ni,Ai,Pi,jn),De=De||this.isInsideGrid(Ni,Ai,Pi,jn),t!=="always"&&this.grid.hitTestCircle(Ir,Yi,et,t,j)&&(Ce=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Ce}}}}return{circles:!z&&Ce||!De||J<this.perspectiveRatioCutoff?[]:ee,offscreen:Qe,collisionDetected:Ce}}projectPathToScreenSpace(t,n,a){return t.map(l=>zr(l,a,n.getElevation))}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let a=1/0,l=1/0,d=-1/0,_=-1/0;for(const z of t){const k=new u.P(z.x+ut,z.y+ut);a=Math.min(a,k.x),l=Math.min(l,k.y),d=Math.max(d,k.x),_=Math.max(_,k.y),n.push(k)}const v=this.grid.query(a,l,d,_).concat(this.ignoredGrid.query(a,l,d,_)),b={},C={};for(const z of v){const k=z.key;if(b[k.bucketInstanceId]===void 0&&(b[k.bucketInstanceId]={}),b[k.bucketInstanceId][k.featureIndex])continue;const j=[new u.P(z.x1,z.y1),new u.P(z.x2,z.y1),new u.P(z.x2,z.y2),new u.P(z.x1,z.y2)];u.am(n,j)&&(b[k.bucketInstanceId][k.featureIndex]=!0,C[k.bucketInstanceId]===void 0&&(C[k.bucketInstanceId]=[]),C[k.bucketInstanceId].push(k.featureIndex))}return C}insertCollisionBox(t,n,a,l,d,_){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:l,featureIndex:d,collisionGroupID:_,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,a,l,d,_){const v=a?this.ignoredGrid:this.grid,b={bucketInstanceId:l,featureIndex:d,collisionGroupID:_,overlapMode:n};for(let C=0;C<t.length;C+=4)v.insertCircle(b,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,n,a,l,d){const _=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(n,a,l,d):zr(new u.P(n,a),t,d);return{point:new u.P((_.point.x+1)/2*this.transform.width+ut,(1-_.point.y)/2*this.transform.height+ut),perspectiveRatio:.5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5,isOccluded:_.isOccluded,signedDistanceFromCamera:_.signedDistanceFromCamera}}getPerspectiveRatio(t,n,a,l,d){const _=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(n,a,l,d):zr(new u.P(n,a),t,d);return .5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5}isOffscreen(t,n,a,l){return a<ut||t>=this.screenRightBoundary||l<ut||n>this.screenBottomBoundary}isInsideGrid(t,n,a,l){return a>=0&&t<this.gridRightBoundary&&l>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=u.an([]);return u.H(t,t,[-100,-100,0]),t}_projectCollisionBox(t,n,a,l,d,_,v,b,C,z){const k=n*b.perspectiveRatio;let j=new u.P(1,0),U=new u.P(0,1);const G=new u.P(t.anchorPointX+v[0],t.anchorPointY+v[1]);if(_&&!d){const et=this.projectAndGetPerspectiveRatio(a,G.x+1,G.y,l,C).point.sub(b.point).unit(),Be=Math.atan(et.y/et.x)+(et.x<0?Math.PI:0),je=Math.sin(Be),at=Math.cos(Be);j=new u.P(at,je),U=new u.P(-je,at)}else if(!_&&d){const et=-this.transform.angle,Be=Math.sin(et),je=Math.cos(et);j=new u.P(je,Be),U=new u.P(-Be,je)}let Y=b.point,W=k;if(d){Y=G;const et=this.transform.zoom-Math.floor(this.transform.zoom);W=Math.pow(2,-et),W*=this.mapProjection.getPitchedTextCorrection(this.transform,G,l),z||(W*=u.ac(.5+b.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}z&&(Y=Y.add(j.mult(z.x*W)).add(U.mult(z.y*W)));const ee=t.x1*W,ce=t.x2*W,J=(ee+ce)/2,he=t.y1*W,ye=t.y2*W,we=(he+ye)/2,Ce=[{offsetX:ee,offsetY:he},{offsetX:J,offsetY:he},{offsetX:ce,offsetY:he},{offsetX:ce,offsetY:we},{offsetX:ce,offsetY:ye},{offsetX:J,offsetY:ye},{offsetX:ee,offsetY:ye},{offsetX:ee,offsetY:we}];let De=[];for(const{offsetX:et,offsetY:Be}of Ce)De.push(new u.P(Y.x+j.x*et+U.x*Be,Y.y+j.y*et+U.y*Be));let Qe=!1;if(d){const et=De.map(Be=>this.projectAndGetPerspectiveRatio(a,Be.x,Be.y,l,C));Qe=et.some(Be=>!Be.isOccluded),De=et.map(Be=>Be.point)}else Qe=!0;return{box:u.ao(De),allPointsOccluded:!Qe}}}function vt(c,t,n){return t*(u.W/(c.tileSize*Math.pow(2,n-c.tileID.overscaledZ)))}class Bt{constructor(t,n,a,l){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):l&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class Gt{constructor(t,n,a,l,d){this.text=new Bt(t?t.text:null,n,a,d),this.icon=new Bt(t?t.icon:null,n,l,d)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class hr{constructor(t,n,a){this.text=t,this.icon=n,this.skipFade=a}}class $r{constructor(){this.invProjMatrix=u.F(),this.viewportMatrix=u.F(),this.circles=[]}}class mt{constructor(t,n,a,l,d){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=a,this.bucketIndex=l,this.tileID=d}}class br{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:a=>a.collisionGroupID===n}}return this.collisionGroups[t]}}function Gr(c,t,n,a,l){const{horizontalAlign:d,verticalAlign:_}=u.au(c);return new u.P(-(d-.5)*t+a[0]*l,-(_-.5)*n+a[1]*l)}class Si{constructor(t,n,a,l,d,_){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new Et(this.transform,n),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new br(d),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const n=this.terrain;return n?(a,l)=>n.getElevation(t,a,l):null}getBucketParts(t,n,a,l){const d=a.getBucket(n),_=a.latestFeatureIndex;if(!d||!_||n.id!==d.layerIds[0])return;const v=a.collisionBoxArray,b=d.layers[0].layout,C=d.layers[0].paint,z=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),k=a.tileSize/u.W,j=a.tileID.toUnwrapped(),U=this.transform.calculatePosMatrix(j),G=b.get("text-pitch-alignment")==="map",Y=b.get("text-rotation-alignment")==="map",W=vt(a,1,this.transform.zoom),ee=this.collisionIndex.mapProjection.translatePosition(this.transform,a,C.get("text-translate"),C.get("text-translate-anchor")),ce=this.collisionIndex.mapProjection.translatePosition(this.transform,a,C.get("icon-translate"),C.get("icon-translate-anchor")),J=wi(U,G,Y,this.transform,W);let he=null;if(G){const we=bn(U,G,Y,this.transform,W);he=u.K([],this.transform.labelPlaneMatrix,we)}this.retainedQueryData[d.bucketInstanceId]=new mt(d.bucketInstanceId,_,d.sourceLayerIndex,d.index,a.tileID);const ye={bucket:d,layout:b,translationText:ee,translationIcon:ce,posMatrix:U,unwrappedTileID:j,textLabelPlaneMatrix:J,labelToScreenMatrix:he,scale:z,textPixelRatio:k,holdingForFade:a.holdingForFade(),collisionBoxArray:v,partiallyEvaluatedTextSize:u.ag(d.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(l)for(const we of d.sortKeyRanges){const{sortKey:Ce,symbolInstanceStart:De,symbolInstanceEnd:Qe}=we;t.push({sortKey:Ce,symbolInstanceStart:De,symbolInstanceEnd:Qe,parameters:ye})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:ye})}attemptAnchorPlacement(t,n,a,l,d,_,v,b,C,z,k,j,U,G,Y,W,ee,ce,J){const he=u.aq[t.textAnchor],ye=[t.textOffset0,t.textOffset1],we=Gr(he,a,l,ye,d),Ce=this.collisionIndex.placeCollisionBox(n,j,b,C,z,v,_,W,k.predicate,J,we);if((!ce||this.collisionIndex.placeCollisionBox(ce,j,b,C,z,v,_,ee,k.predicate,J,we).placeable)&&Ce.placeable){let De;if(this.prevPlacement&&this.prevPlacement.variableOffsets[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID].text&&(De=this.prevPlacement.variableOffsets[U.crossTileID].anchor),U.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[U.crossTileID]={textOffset:ye,width:a,height:l,anchor:he,textBoxScale:d,prevAnchor:De},this.markUsedJustification(G,he,U,Y),G.allowVerticalPlacement&&(this.markUsedOrientation(G,Y,U),this.placedOrientations[U.crossTileID]=Y),{shift:we,placedGlyphBoxes:Ce}}}placeLayerBucketPart(t,n,a){const{bucket:l,layout:d,translationText:_,translationIcon:v,posMatrix:b,unwrappedTileID:C,textLabelPlaneMatrix:z,labelToScreenMatrix:k,textPixelRatio:j,holdingForFade:U,collisionBoxArray:G,partiallyEvaluatedTextSize:Y,collisionGroup:W}=t.parameters,ee=d.get("text-optional"),ce=d.get("icon-optional"),J=u.ar(d,"text-overlap","text-allow-overlap"),he=J==="always",ye=u.ar(d,"icon-overlap","icon-allow-overlap"),we=ye==="always",Ce=d.get("text-rotation-alignment")==="map",De=d.get("text-pitch-alignment")==="map",Qe=d.get("icon-text-fit")!=="none",et=d.get("symbol-z-order")==="viewport-y",Be=he&&(we||!l.hasIconData()||ce),je=we&&(he||!l.hasTextData()||ee);!l.collisionArrays&&G&&l.deserializeCollisionBoxes(G);const at=this._getTerrainElevationFunc(this.retainedQueryData[l.bucketInstanceId].tileID),Tt=(Ue,He,wt)=>{var Sr,Dt;if(n[Ue.crossTileID])return;if(U)return void(this.placements[Ue.crossTileID]=new hr(!1,!1,!1));let jt=!1,Tr=!1,Ei=!0,On=null,Ir={box:null,placeable:!1,offscreen:null},Yi={box:null,placeable:!1,offscreen:null},Ni=null,Ai=null,Pi=null,jn=0,ka=0,cl=0;He.textFeatureIndex?jn=He.textFeatureIndex:Ue.useRuntimeCollisionCircles&&(jn=Ue.featureIndex),He.verticalTextFeatureIndex&&(ka=He.verticalTextFeatureIndex);const rs=He.textBox;if(rs){const xi=Mi=>{let ki=u.ah.horizontal;if(l.allowVerticalPlacement&&!Mi&&this.prevPlacement){const ui=this.prevPlacement.placedOrientations[Ue.crossTileID];ui&&(this.placedOrientations[Ue.crossTileID]=ui,ki=ui,this.markUsedOrientation(l,ki,Ue))}return ki},Nn=(Mi,ki)=>{if(l.allowVerticalPlacement&&Ue.numVerticalGlyphVertices>0&&He.verticalTextBox){for(const ui of l.writingModes)if(ui===u.ah.vertical?(Ir=ki(),Yi=Ir):Ir=Mi(),Ir&&Ir.placeable)break}else Ir=Mi()},oa=Ue.textAnchorOffsetStartIndex,is=Ue.textAnchorOffsetEndIndex;if(is===oa){const Mi=(ki,ui)=>{const kr=this.collisionIndex.placeCollisionBox(ki,J,j,b,C,De,Ce,_,W.predicate,at);return kr&&kr.placeable&&(this.markUsedOrientation(l,ui,Ue),this.placedOrientations[Ue.crossTileID]=ui),kr};Nn(()=>Mi(rs,u.ah.horizontal),()=>{const ki=He.verticalTextBox;return l.allowVerticalPlacement&&Ue.numVerticalGlyphVertices>0&&ki?Mi(ki,u.ah.vertical):{box:null,offscreen:null}}),xi(Ir&&Ir.placeable)}else{let Mi=u.aq[(Dt=(Sr=this.prevPlacement)===null||Sr===void 0?void 0:Sr.variableOffsets[Ue.crossTileID])===null||Dt===void 0?void 0:Dt.anchor];const ki=(kr,ns,lc)=>{const ni=kr.x2-kr.x1,ou=kr.y2-kr.y1,hl=Ue.textBoxScale,dl=Qe&&ye==="never"?ns:null;let aa=null,au=J==="never"?1:2,cc="never";Mi&&au++;for(let uc=0;uc<au;uc++){for(let hc=oa;hc<is;hc++){const pl=l.textAnchorOffsets.get(hc);if(Mi&&pl.textAnchor!==Mi)continue;const os=this.attemptAnchorPlacement(pl,kr,ni,ou,hl,Ce,De,j,b,C,W,cc,Ue,l,lc,_,v,dl,at);if(os&&(aa=os.placedGlyphBoxes,aa&&aa.placeable))return jt=!0,On=os.shift,aa}Mi?Mi=null:cc=J}return a&&!aa&&(aa={box:this.collisionIndex.placeCollisionBox(rs,"always",j,b,C,De,Ce,_,W.predicate,at,new u.P(0,0)).box,offscreen:!1,placeable:!1}),aa};Nn(()=>ki(rs,He.iconBox,u.ah.horizontal),()=>{const kr=He.verticalTextBox;return l.allowVerticalPlacement&&(!Ir||!Ir.placeable)&&Ue.numVerticalGlyphVertices>0&&kr?ki(kr,He.verticalIconBox,u.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Ir&&(jt=Ir.placeable,Ei=Ir.offscreen);const ui=xi(Ir&&Ir.placeable);if(!jt&&this.prevPlacement){const kr=this.prevPlacement.variableOffsets[Ue.crossTileID];kr&&(this.variableOffsets[Ue.crossTileID]=kr,this.markUsedJustification(l,kr.anchor,Ue,ui))}}}if(Ni=Ir,jt=Ni&&Ni.placeable,Ei=Ni&&Ni.offscreen,Ue.useRuntimeCollisionCircles){const xi=l.text.placedSymbolArray.get(Ue.centerJustifiedTextSymbolIndex),Nn=u.ai(l.textSizeData,Y,xi),oa=d.get("text-padding");Ai=this.collisionIndex.placeCollisionCircles(J,xi,l.lineVertexArray,l.glyphOffsetArray,Nn,b,C,z,k,a,De,W.predicate,Ue.collisionCircleDiameter,oa,_,at),Ai.circles.length&&Ai.collisionDetected&&!a&&u.w("Collisions detected, but collision boxes are not shown"),jt=he||Ai.circles.length>0&&!Ai.collisionDetected,Ei=Ei&&Ai.offscreen}if(He.iconFeatureIndex&&(cl=He.iconFeatureIndex),He.iconBox){const xi=Nn=>this.collisionIndex.placeCollisionBox(Nn,ye,j,b,C,De,Ce,v,W.predicate,at,Qe&&On?On:void 0);Yi&&Yi.placeable&&He.verticalIconBox?(Pi=xi(He.verticalIconBox),Tr=Pi.placeable):(Pi=xi(He.iconBox),Tr=Pi.placeable),Ei=Ei&&Pi.offscreen}const za=ee||Ue.numHorizontalGlyphVertices===0&&Ue.numVerticalGlyphVertices===0,ul=ce||Ue.numIconVertices===0;za||ul?ul?za||(Tr=Tr&&jt):jt=Tr&&jt:Tr=jt=Tr&&jt;const sc=Tr&&Pi.placeable;if(jt&&Ni.placeable&&this.collisionIndex.insertCollisionBox(Ni.box,J,d.get("text-ignore-placement"),l.bucketInstanceId,Yi&&Yi.placeable&&ka?ka:jn,W.ID),sc&&this.collisionIndex.insertCollisionBox(Pi.box,ye,d.get("icon-ignore-placement"),l.bucketInstanceId,cl,W.ID),Ai&&jt&&this.collisionIndex.insertCollisionCircles(Ai.circles,J,d.get("text-ignore-placement"),l.bucketInstanceId,jn,W.ID),a&&this.storeCollisionData(l.bucketInstanceId,wt,He,Ni,Pi,Ai),Ue.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(l.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ue.crossTileID]=new hr(jt||Be,Tr||je,Ei||l.justReloaded),n[Ue.crossTileID]=!0};if(et){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ue=l.getSortedSymbolIndexes(this.transform.angle);for(let He=Ue.length-1;He>=0;--He){const wt=Ue[He];Tt(l.symbolInstances.get(wt),l.collisionArrays[wt],wt)}}else for(let Ue=t.symbolInstanceStart;Ue<t.symbolInstanceEnd;Ue++)Tt(l.symbolInstances.get(Ue),l.collisionArrays[Ue],Ue);if(a&&l.bucketInstanceId in this.collisionCircleArrays){const Ue=this.collisionCircleArrays[l.bucketInstanceId];u.as(Ue.invProjMatrix,b),Ue.viewportMatrix=this.collisionIndex.getViewportMatrix()}l.justReloaded=!1}storeCollisionData(t,n,a,l,d,_){if(a.textBox||a.iconBox){let v,b;this.collisionBoxArrays.has(t)?v=this.collisionBoxArrays.get(t):(v=new Map,this.collisionBoxArrays.set(t,v)),v.has(n)?b=v.get(n):(b={text:null,icon:null},v.set(n,b)),a.textBox&&(b.text=l.box),a.iconBox&&(b.icon=d.box)}if(_){let v=this.collisionCircleArrays[t];v===void 0&&(v=this.collisionCircleArrays[t]=new $r);for(let b=0;b<_.circles.length;b+=4)v.circles.push(_.circles[b+0]),v.circles.push(_.circles[b+1]),v.circles.push(_.circles[b+2]),v.circles.push(_.collisionDetected?1:0)}}markUsedJustification(t,n,a,l){let d;d=l===u.ah.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[u.at(n)];const _=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const v of _)v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=d>=0&&v!==d?0:a.crossTileID)}markUsedOrientation(t,n,a){const l=n===u.ah.horizontal||n===u.ah.horizontalOnly?n:0,d=n===u.ah.vertical?n:0,_=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const v of _)t.text.placedSymbolArray.get(v).placedOrientation=l;a.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=d)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let a=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const l=n?n.symbolFadeChange(t):1,d=n?n.opacities:{},_=n?n.variableOffsets:{},v=n?n.placedOrientations:{};for(const b in this.placements){const C=this.placements[b],z=d[b];z?(this.opacities[b]=new Gt(z,l,C.text,C.icon),a=a||C.text!==z.text.placed||C.icon!==z.icon.placed):(this.opacities[b]=new Gt(null,l,C.text,C.icon,C.skipFade),a=a||C.text||C.icon)}for(const b in d){const C=d[b];if(!this.opacities[b]){const z=new Gt(C,l,!1,!1);z.isHidden()||(this.opacities[b]=z,a=a||C.text.placed||C.icon.placed)}}for(const b in _)this.variableOffsets[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.variableOffsets[b]=_[b]);for(const b in v)this.placedOrientations[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.placedOrientations[b]=v[b]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const a={};for(const l of n){const d=l.getBucket(t);d&&l.latestFeatureIndex&&t.id===d.layerIds[0]&&this.updateBucketOpacities(d,l.tileID,a,l.collisionBoxArray)}}updateBucketOpacities(t,n,a,l){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const d=t.layers[0],_=d.layout,v=new Gt(null,0,!1,!1,!0),b=_.get("text-allow-overlap"),C=_.get("icon-allow-overlap"),z=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),k=_.get("text-rotation-alignment")==="map",j=_.get("text-pitch-alignment")==="map",U=_.get("icon-text-fit")!=="none",G=new Gt(null,0,b&&(C||!t.hasIconData()||_.get("icon-optional")),C&&(b||!t.hasTextData()||_.get("text-optional")),!0);!t.collisionArrays&&l&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(l);const Y=(ee,ce,J)=>{for(let he=0;he<ce/4;he++)ee.opacityVertexArray.emplaceBack(J);ee.hasVisibleVertices=ee.hasVisibleVertices||J!==Bo},W=this.collisionBoxArrays.get(t.bucketInstanceId);for(let ee=0;ee<t.symbolInstances.length;ee++){const ce=t.symbolInstances.get(ee),{numHorizontalGlyphVertices:J,numVerticalGlyphVertices:he,crossTileID:ye}=ce;let we=this.opacities[ye];a[ye]?we=v:we||(we=G,this.opacities[ye]=we),a[ye]=!0;const Ce=ce.numIconVertices>0,De=this.placedOrientations[ce.crossTileID],Qe=De===u.ah.vertical,et=De===u.ah.horizontal||De===u.ah.horizontalOnly;if(J>0||he>0){const je=mi(we.text);Y(t.text,J,Qe?Bo:je),Y(t.text,he,et?Bo:je);const at=we.text.isHidden();[ce.rightJustifiedTextSymbolIndex,ce.centerJustifiedTextSymbolIndex,ce.leftJustifiedTextSymbolIndex].forEach(He=>{He>=0&&(t.text.placedSymbolArray.get(He).hidden=at||Qe?1:0)}),ce.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(ce.verticalPlacedTextSymbolIndex).hidden=at||et?1:0);const Tt=this.variableOffsets[ce.crossTileID];Tt&&this.markUsedJustification(t,Tt.anchor,ce,De);const Ue=this.placedOrientations[ce.crossTileID];Ue&&(this.markUsedJustification(t,"left",ce,Ue),this.markUsedOrientation(t,Ue,ce))}if(Ce){const je=mi(we.icon),at=!(U&&ce.verticalPlacedIconSymbolIndex&&Qe);ce.placedIconSymbolIndex>=0&&(Y(t.icon,ce.numIconVertices,at?je:Bo),t.icon.placedSymbolArray.get(ce.placedIconSymbolIndex).hidden=we.icon.isHidden()),ce.verticalPlacedIconSymbolIndex>=0&&(Y(t.icon,ce.numVerticalIconVertices,at?Bo:je),t.icon.placedSymbolArray.get(ce.verticalPlacedIconSymbolIndex).hidden=we.icon.isHidden())}const Be=W&&W.has(ee)?W.get(ee):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const je=t.collisionArrays[ee];if(je){let at=new u.P(0,0);if(je.textBox||je.verticalTextBox){let Tt=!0;if(z){const Ue=this.variableOffsets[ye];Ue?(at=Gr(Ue.anchor,Ue.width,Ue.height,Ue.textOffset,Ue.textBoxScale),k&&at._rotate(j?this.transform.angle:-this.transform.angle)):Tt=!1}if(je.textBox||je.verticalTextBox){let Ue;je.textBox&&(Ue=Qe),je.verticalTextBox&&(Ue=et),Ti(t.textCollisionBox.collisionVertexArray,we.text.placed,!Tt||Ue,Be.text,at.x,at.y)}}if(je.iconBox||je.verticalIconBox){const Tt=!!(!et&&je.verticalIconBox);let Ue;je.iconBox&&(Ue=Tt),je.verticalIconBox&&(Ue=!Tt),Ti(t.iconCollisionBox.collisionVertexArray,we.icon.placed,Ue,Be.icon,U?at.x:0,U?at.y:0)}}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const ee=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ee.invProjMatrix,t.placementViewportMatrix=ee.viewportMatrix,t.collisionCircleArray=ee.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const a=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*a>t}setStale(){this.stale=!0}}function Ti(c,t,n,a,l,d){a&&a.length!==0||(a=[0,0,0,0]);const _=a[0]-ut,v=a[1]-ut,b=a[2]-ut,C=a[3]-ut;c.emplaceBack(t?1:0,n?1:0,l||0,d||0,_,v),c.emplaceBack(t?1:0,n?1:0,l||0,d||0,b,v),c.emplaceBack(t?1:0,n?1:0,l||0,d||0,b,C),c.emplaceBack(t?1:0,n?1:0,l||0,d||0,_,C)}const Zr=Math.pow(2,25),Xn=Math.pow(2,24),ql=Math.pow(2,17),Vt=Math.pow(2,16),ma=Math.pow(2,9),ga=Math.pow(2,8),Yt=Math.pow(2,1);function mi(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const t=c.placed?1:0,n=Math.floor(127*c.opacity);return n*Zr+t*Xn+n*ql+t*Vt+n*ma+t*ga+n*Yt+t}const Bo=0;function Dr(){return{isOccluded:(c,t,n)=>!1,getPitchedTextCorrection:(c,t,n)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(c,t,n,a){throw new Error("Not implemented.")},translatePosition:(c,t,n,a)=>function(l,d,_,v,b=!1){if(!_[0]&&!_[1])return[0,0];const C=b?v==="map"?l.angle:0:v==="viewport"?-l.angle:0;if(C){const z=Math.sin(C),k=Math.cos(C);_=[_[0]*k-_[1]*z,_[0]*z+_[1]*k]}return[b?_[0]:vt(d,_[0],l.zoom),b?_[1]:vt(d,_[1],l.zoom)]}(c,t,n,a),getCircleRadiusCorrection:c=>1}}class Fr{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,a,l,d){const _=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(_,l,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,_.sort((v,b)=>v.sortKey-b.sortKey));this._currentPartIndex<_.length;)if(n.placeLayerBucketPart(_[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,d())return!0;return!1}}class ya{constructor(t,n,a,l,d,_,v,b){this.placement=new Si(t,Dr(),n,_,v,b),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=l,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(t,n,a){const l=ve.now(),d=()=>!this._forceFullPlacement&&ve.now()-l>2;for(;this._currentPlacementIndex>=0;){const _=n[t[this._currentPlacementIndex]],v=this.placement.collisionIndex.transform.zoom;if(_.type==="symbol"&&(!_.minzoom||_.minzoom<=v)&&(!_.maxzoom||_.maxzoom>v)){if(this._inProgressLayer||(this._inProgressLayer=new Fr(_)),this._inProgressLayer.continuePlacement(a[_.source],this.placement,this._showCollisionBoxes,_,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const gi=512/u.W/2;class dr{constructor(t,n,a){this.tileID=t,this.bucketInstanceId=a,this._symbolsByKey={};const l=new Map;for(let d=0;d<n.length;d++){const _=n.get(d),v=_.key,b=l.get(v);b?b.push(_):l.set(v,[_])}for(const[d,_]of l){const v={positions:_.map(b=>({x:Math.floor(b.anchorX*gi),y:Math.floor(b.anchorY*gi)})),crossTileIDs:_.map(b=>b.crossTileID)};if(v.positions.length>128){const b=new u.av(v.positions.length,16,Uint16Array);for(const{x:C,y:z}of v.positions)b.add(C,z);b.finish(),delete v.positions,v.index=b}this._symbolsByKey[d]=v}}getScaledCoordinates(t,n){const{x:a,y:l,z:d}=this.tileID.canonical,{x:_,y:v,z:b}=n.canonical,C=gi/Math.pow(2,b-d),z=(v*u.W+t.anchorY)*C,k=l*u.W*gi;return{x:Math.floor((_*u.W+t.anchorX)*C-a*u.W*gi),y:Math.floor(z-k)}}findMatches(t,n,a){const l=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let d=0;d<t.length;d++){const _=t.get(d);if(_.crossTileID)continue;const v=this._symbolsByKey[_.key];if(!v)continue;const b=this.getScaledCoordinates(_,n);if(v.index){const C=v.index.range(b.x-l,b.y-l,b.x+l,b.y+l).sort();for(const z of C){const k=v.crossTileIDs[z];if(!a[k]){a[k]=!0,_.crossTileID=k;break}}}else if(v.positions)for(let C=0;C<v.positions.length;C++){const z=v.positions[C],k=v.crossTileIDs[C];if(Math.abs(z.x-b.x)<=l&&Math.abs(z.y-b.y)<=l&&!a[k]){a[k]=!0,_.crossTileID=k;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Ro{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class po{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const a in this.indexes){const l=this.indexes[a],d={};for(const _ in l){const v=l[_];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+n),d[v.tileID.key]=v}this.indexes[a]=d}this.lng=t}addBucket(t,n,a){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let d=0;d<n.symbolInstances.length;d++)n.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const l=this.usedCrossTileIDs[t.overscaledZ];for(const d in this.indexes){const _=this.indexes[d];if(Number(d)>t.overscaledZ)for(const v in _){const b=_[v];b.tileID.isChildOf(t)&&b.findMatches(n.symbolInstances,t,l)}else{const v=_[t.scaledTo(Number(d)).key];v&&v.findMatches(n.symbolInstances,t,l)}}for(let d=0;d<n.symbolInstances.length;d++){const _=n.symbolInstances.get(d);_.crossTileID||(_.crossTileID=a.generate(),l[_.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new dr(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const a of n.getCrossTileIDsLists())for(const l of a)delete this.usedCrossTileIDs[t][l]}removeStaleBuckets(t){let n=!1;for(const a in this.indexes){const l=this.indexes[a];for(const d in l)t[l[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,l[d]),delete l[d],n=!0)}return n}}class Pr{constructor(){this.layerIndexes={},this.crossTileIDs=new Ro,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,a){let l=this.layerIndexes[t.id];l===void 0&&(l=this.layerIndexes[t.id]=new po);let d=!1;const _={};l.handleWrapJump(a);for(const v of n){const b=v.getBucket(t);b&&t.id===b.layerIds[0]&&(b.bucketInstanceId||(b.bucketInstanceId=++this.maxBucketInstanceId),l.addBucket(v.tileID,b,this.crossTileIDs)&&(d=!0),_[b.bucketInstanceId]=!0)}return l.removeStaleBuckets(_)&&(d=!0),d}pruneUnusedLayers(t){const n={};t.forEach(a=>{n[a]=!0});for(const a in this.layerIndexes)n[a]||delete this.layerIndexes[a]}}const fo=(c,t)=>u.t(c,t&&t.filter(n=>n.identifier!=="source.canvas")),Xi=u.aw();class Oo extends u.E{constructor(t,n={}){super(),this._rtlPluginLoaded=()=>{for(const a in this.sourceCaches){const l=this.sourceCaches[a].getSource().type;l!=="vector"&&l!=="geojson"||this.sourceCaches[a].reload()}},this.map=t,this.dispatcher=new Wi(nn(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(a,l)=>this.getGlyphs(a,l)),this.dispatcher.registerMessageHandler("GI",(a,l)=>this.getImages(a,l)),this.imageManager=new rr,this.imageManager.setEventedParent(this),this.glyphManager=new pi(t._requestManager,n.localIdeographFontFamily),this.lineAtlas=new nr(256,512),this.crossTileSymbolIndex=new Pr,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",u.ay()),ci().on(Hi,this._rtlPluginLoaded),this.on("data",a=>{if(a.dataType!=="source"||a.sourceDataType!=="metadata")return;const l=this.sourceCaches[a.sourceId];if(!l)return;const d=l.getSource();if(d&&d.vectorLayerIds)for(const _ in this._layers){const v=this._layers[_];v.source===d.id&&this._validateLayer(v)}})}loadURL(t,n={},a){this.fire(new u.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const l=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController,u.h(l,this._loadStyleRequest).then(d=>{this._loadStyleRequest=null,this._load(d.data,n,a)}).catch(d=>{this._loadStyleRequest=null,d&&this.fire(new u.j(d))})}loadJSON(t,n={},a){this.fire(new u.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ve.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(t,n,a)}).catch(()=>{})}loadEmpty(){this.fire(new u.k("dataloading",{dataType:"style"})),this._load(Xi,{validate:!1})}_load(t,n,a){var l;const d=n.transformStyle?n.transformStyle(a,t):t;if(!n.validate||!fo(this,u.x(d))){this._loaded=!0,this.stylesheet=d;for(const _ in d.sources)this.addSource(_,d.sources[_],{validate:!1});d.sprite?this._loadSprite(d.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(d.glyphs),this._createLayers(),this.light=new Ar(this.stylesheet.light),this.map.setTerrain((l=this.stylesheet.terrain)!==null&&l!==void 0?l:null),this.fire(new u.k("data",{dataType:"style"})),this.fire(new u.k("style.load"))}}_createLayers(){const t=u.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of t){const a=u.aA(n);a.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=a}}_loadSprite(t,n=!1,a=void 0){let l;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(d,_,v,b){return u._(this,void 0,void 0,function*(){const C=Cr(d),z=v>1?"@2x":"",k={},j={};for(const{id:U,url:G}of C){const Y=_.transformRequest(li(G,z,".json"),"SpriteJSON");k[U]=u.h(Y,b);const W=_.transformRequest(li(G,z,".png"),"SpriteImage");j[U]=bt.getImage(W,b)}return yield Promise.all([...Object.values(k),...Object.values(j)]),function(U,G){return u._(this,void 0,void 0,function*(){const Y={};for(const W in U){Y[W]={};const ee=ve.getImageCanvasContext((yield G[W]).data),ce=(yield U[W]).data;for(const J in ce){const{width:he,height:ye,x:we,y:Ce,sdf:De,pixelRatio:Qe,stretchX:et,stretchY:Be,content:je,textFitWidth:at,textFitHeight:Tt}=ce[J];Y[W][J]={data:null,pixelRatio:Qe,sdf:De,stretchX:et,stretchY:Be,content:je,textFitWidth:at,textFitHeight:Tt,spriteData:{width:he,height:ye,x:we,y:Ce,context:ee}}}}return Y})}(k,j)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(d=>{if(this._spriteRequest=null,d)for(const _ in d){this._spritesImagesIds[_]=[];const v=this._spritesImagesIds[_]?this._spritesImagesIds[_].filter(b=>!(b in d)):[];for(const b of v)this.imageManager.removeImage(b),this._changedImages[b]=!0;for(const b in d[_]){const C=_==="default"?b:`${_}:${b}`;this._spritesImagesIds[_].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,d[_][b],!1):this.imageManager.addImage(C,d[_][b]),n&&(this._changedImages[C]=!0)}}}).catch(d=>{this._spriteRequest=null,l=d,this.fire(new u.j(l))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"})),a&&a(l)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}_validateLayer(t){const n=this.sourceCaches[t.source];if(!n)return;const a=t.sourceLayer;if(!a)return;const l=n.getSource();(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(a)===-1)&&this.fire(new u.j(new Error(`Source layer "${a}" does not exist on source "${l.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const n=this._serializedAllLayers();if(!t||t.length===0)return Object.values(n);const a=[];for(const l of t)n[l]&&a.push(n[l]);return a}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const n=Object.keys(this._layers);for(const a of n){const l=this._layers[a];l.type!=="custom"&&(t[a]=l.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(n){const l=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(l.length||d.length)&&this._updateWorkerLayers(l,d);for(const _ in this._updatedSources){const v=this._updatedSources[_];if(v==="reload")this._reloadSource(_);else{if(v!=="clear")throw new Error(`Invalid action ${v}`);this._clearSource(_)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const _ in this._updatedPaintProps)this._layers[_].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const a={};for(const l in this.sourceCaches){const d=this.sourceCaches[l];a[l]=d.used,d.used=!1}for(const l of this._order){const d=this._layers[l];d.recalculate(t,this._availableImages),!d.isHidden(t.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(const l in a){const d=this.sourceCaches[l];!!a[l]!=!!d.used&&d.fire(new u.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:l}))}this.light.recalculate(t),this.z=t.zoom,n&&this.fire(new u.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,n={}){var a;this._checkLoaded();const l=this.serialize();if(t=n.transformStyle?n.transformStyle(l,t):t,((a=n.validate)===null||a===void 0||a)&&fo(this,u.x(t)))return!1;(t=u.aB(t)).layers=u.az(t.layers);const d=u.aC(l,t),_=this._getOperationsToPerform(d);if(_.unimplemented.length>0)throw new Error(`Unimplemented: ${_.unimplemented.join(", ")}.`);if(_.operations.length===0)return!1;for(const v of _.operations)v();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const n=[],a=[];for(const l of t)switch(l.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":n.push(()=>this.addLayer.apply(this,l.args));break;case"removeLayer":n.push(()=>this.removeLayer.apply(this,l.args));break;case"setPaintProperty":n.push(()=>this.setPaintProperty.apply(this,l.args));break;case"setLayoutProperty":n.push(()=>this.setLayoutProperty.apply(this,l.args));break;case"setFilter":n.push(()=>this.setFilter.apply(this,l.args));break;case"addSource":n.push(()=>this.addSource.apply(this,l.args));break;case"removeSource":n.push(()=>this.removeSource.apply(this,l.args));break;case"setLayerZoomRange":n.push(()=>this.setLayerZoomRange.apply(this,l.args));break;case"setLight":n.push(()=>this.setLight.apply(this,l.args));break;case"setGeoJSONSourceData":n.push(()=>this.setGeoJSONSourceData.apply(this,l.args));break;case"setGlyphs":n.push(()=>this.setGlyphs.apply(this,l.args));break;case"setSprite":n.push(()=>this.setSprite.apply(this,l.args));break;case"setTerrain":n.push(()=>this.map.setTerrain.apply(this,l.args));break;case"setTransition":n.push(()=>{});break;default:a.push(l.command)}return{operations:n,unimplemented:a}}addImage(t,n){if(this.getImage(t))return this.fire(new u.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new u.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,a={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(u.x.source,`sources.${t}`,n,null,a))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const l=this.sourceCaches[t]=new Le(t,n,this.dispatcher);l.style=this,l.setEventedParent(this,()=>({isSourceLoaded:l.loaded(),source:l.serialize(),sourceId:t})),l.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===t)return this.fire(new u.j(new Error(`Source "${t}" cannot be removed while layer "${a}" is using it.`)));const n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new u.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const a=this.sourceCaches[t].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(n),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,n,a={}){this._checkLoaded();const l=t.id;if(this.getLayer(l))return void this.fire(new u.j(new Error(`Layer "${l}" already exists on this map.`)));let d;if(t.type==="custom"){if(fo(this,u.aD(t)))return;d=u.aA(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(l,t.source),t=u.aB(t),t=u.e(t,{source:l})),this._validate(u.x.layer,`layers.${l}`,t,{arrayIndex:-1},a))return;d=u.aA(t),this._validateLayer(d),d.setEventedParent(this,{layer:{id:l}})}const _=n?this._order.indexOf(n):this._order.length;if(n&&_===-1)this.fire(new u.j(new Error(`Cannot add layer "${l}" before non-existing layer "${n}".`)));else{if(this._order.splice(_,0,l),this._layerOrderChanged=!0,this._layers[l]=d,this._removedLayers[l]&&d.source&&d.type!=="custom"){const v=this._removedLayers[l];delete this._removedLayers[l],v.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new u.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const a=this._order.indexOf(t);this._order.splice(a,1);const l=n?this._order.indexOf(n):this._order.length;n&&l===-1?this.fire(new u.j(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(l,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new u.j(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const a=this._order.indexOf(t);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,a){this._checkLoaded();const l=this.getLayer(t);l?l.minzoom===n&&l.maxzoom===a||(n!=null&&(l.minzoom=n),a!=null&&(l.maxzoom=a),this._updateLayer(l)):this.fire(new u.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,a={}){this._checkLoaded();const l=this.getLayer(t);if(l){if(!u.aE(l.filter,n))return n==null?(l.filter=void 0,void this._updateLayer(l)):void(this._validate(u.x.filter,`layers.${l.id}.filter`,n,null,a)||(l.filter=u.aB(n),this._updateLayer(l)))}else this.fire(new u.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return u.aB(this.getLayer(t).filter)}setLayoutProperty(t,n,a,l={}){this._checkLoaded();const d=this.getLayer(t);d?u.aE(d.getLayoutProperty(n),a)||(d.setLayoutProperty(n,a,l),this._updateLayer(d)):this.fire(new u.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const a=this.getLayer(t);if(a)return a.getLayoutProperty(n);this.fire(new u.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,a,l={}){this._checkLoaded();const d=this.getLayer(t);d?u.aE(d.getPaintProperty(n),a)||(d.setPaintProperty(n,a,l)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new u.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const a=t.source,l=t.sourceLayer,d=this.sourceCaches[a];if(d===void 0)return void this.fire(new u.j(new Error(`The source '${a}' does not exist in the map's style.`)));const _=d.getSource().type;_==="geojson"&&l?this.fire(new u.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):_!=="vector"||l?(t.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),d.setFeatureState(l,t.id,n)):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const a=t.source,l=this.sourceCaches[a];if(l===void 0)return void this.fire(new u.j(new Error(`The source '${a}' does not exist in the map's style.`)));const d=l.getSource().type,_=d==="vector"?t.sourceLayer:void 0;d!=="vector"||_?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new u.j(new Error("A feature id is required to remove its specific state property."))):l.removeFeatureState(_,t.id,n):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,a=t.sourceLayer,l=this.sourceCaches[n];if(l!==void 0)return l.getSource().type!=="vector"||a?(t.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),l.getFeatureState(a,t.id)):void this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return u.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=u.aF(this.sourceCaches,d=>d.serialize()),n=this._serializeByIds(this._order),a=this.map.getTerrain()||void 0,l=this.stylesheet;return u.aG({version:l.version,name:l.name,metadata:l.metadata,light:l.light,center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,sprite:l.sprite,glyphs:l.glyphs,transition:l.transition,sources:t,layers:n,terrain:a},d=>d!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=_=>this._layers[_].type==="fill-extrusion",a={},l=[];for(let _=this._order.length-1;_>=0;_--){const v=this._order[_];if(n(v)){a[v]=_;for(const b of t){const C=b[v];if(C)for(const z of C)l.push(z)}}}l.sort((_,v)=>v.intersectionZ-_.intersectionZ);const d=[];for(let _=this._order.length-1;_>=0;_--){const v=this._order[_];if(n(v))for(let b=l.length-1;b>=0;b--){const C=l[b].feature;if(a[C.layer.id]<_)break;d.push(C),l.pop()}else for(const b of t){const C=b[v];if(C)for(const z of C)d.push(z.feature)}}return d}queryRenderedFeatures(t,n,a){n&&n.filter&&this._validate(u.x.filter,"queryRenderedFeatures.filter",n.filter,null,n);const l={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new u.j(new Error("parameters.layers must be an Array."))),[];for(const v of n.layers){const b=this._layers[v];if(!b)return this.fire(new u.j(new Error(`The layer '${v}' does not exist in the map's style and cannot be queried for features.`))),[];l[b.source]=!0}}const d=[];n.availableImages=this._availableImages;const _=this._serializedAllLayers();for(const v in this.sourceCaches)n.layers&&!l[v]||d.push(pa(this.sourceCaches[v],this._layers,_,t,n,a));return this.placement&&d.push(function(v,b,C,z,k,j,U){const G={},Y=j.queryRenderedSymbols(z),W=[];for(const ee of Object.keys(Y).map(Number))W.push(U[ee]);W.sort(_n);for(const ee of W){const ce=ee.featureIndex.lookupSymbolFeatures(Y[ee.bucketInstanceId],b,ee.bucketIndex,ee.sourceLayerIndex,k.filter,k.layers,k.availableImages,v);for(const J in ce){const he=G[J]=G[J]||[],ye=ce[J];ye.sort((we,Ce)=>{const De=ee.featureSortOrder;if(De){const Qe=De.indexOf(we.featureIndex);return De.indexOf(Ce.featureIndex)-Qe}return Ce.featureIndex-we.featureIndex});for(const we of ye)he.push(we)}}for(const ee in G)G[ee].forEach(ce=>{const J=ce.feature,he=C[v[ee].source].getFeatureState(J.layer["source-layer"],J.id);J.source=J.layer.source,J.layer["source-layer"]&&(J.sourceLayer=J.layer["source-layer"]),J.state=he});return G}(this._layers,_,this.sourceCaches,t,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(t,n){n&&n.filter&&this._validate(u.x.filter,"querySourceFeatures.filter",n.filter,null,n);const a=this.sourceCaches[t];return a?function(l,d){const _=l.getRenderableIds().map(C=>l.getTileByID(C)),v=[],b={};for(let C=0;C<_.length;C++){const z=_[C],k=z.tileID.canonical.key;b[k]||(b[k]=!0,z.querySourceFeatures(v,d))}return v}(a,n):[]}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const a=this.light.getLight();let l=!1;for(const _ in t)if(!u.aE(t[_],a[_])){l=!0;break}if(!l)return;const d={now:ve.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(d)}_validate(t,n,a,l,d={}){return(!d||d.validate!==!1)&&fo(this,t.call(u.x,u.e({key:n,style:this.serialize(),value:a,styleSpec:u.v},l)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ci().off(Hi,this._rtlPluginLoaded);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const a=this.sourceCaches[n];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const n in this.sourceCaches)this.sourceCaches[n].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,n,a,l,d=!1){let _=!1,v=!1;const b={};for(const C of this._order){const z=this._layers[C];if(z.type!=="symbol")continue;if(!b[z.source]){const j=this.sourceCaches[z.source];b[z.source]=j.getRenderableIds(!0).map(U=>j.getTileByID(U)).sort((U,G)=>G.tileID.overscaledZ-U.tileID.overscaledZ||(U.tileID.isLessThan(G.tileID)?-1:1))}const k=this.crossTileSymbolIndex.addLayer(z,b[z.source],t.center.lng);_=_||k}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((d=d||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ve.now(),t.zoom))&&(this.pauseablePlacement=new ya(t,this.map.terrain,this._order,d,n,a,l,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,b),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ve.now()),v=!0),_&&this.pauseablePlacement.placement.setStale()),v||_)for(const C of this._order){const z=this._layers[C];z.type==="symbol"&&this.placement.updateLayerOpacities(z,b[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ve.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,n){return u._(this,void 0,void 0,function*(){const a=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const l=this.sourceCaches[n.source];return l&&l.setDependencies(n.tileID.key,n.type,n.icons),a})}getGlyphs(t,n){return u._(this,void 0,void 0,function*(){const a=yield this.glyphManager.getGlyphs(n.stacks),l=this.sourceCaches[n.source];return l&&l.setDependencies(n.tileID.key,n.type,[""]),a})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,n={}){this._checkLoaded(),t&&this._validate(u.x.glyphs,"glyphs",t,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,n,a={},l){this._checkLoaded();const d=[{id:t,url:n}],_=[...Cr(this.stylesheet.sprite),...d];this._validate(u.x.sprite,"sprite",_,null,a)||(this.stylesheet.sprite=_,this._loadSprite(d,!0,l))}removeSprite(t){this._checkLoaded();const n=Cr(this.stylesheet.sprite);if(n.find(a=>a.id===t)){if(this._spritesImagesIds[t])for(const a of this._spritesImagesIds[t])this.imageManager.removeImage(a),this._changedImages[a]=!0;n.splice(n.findIndex(a=>a.id===t),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}else this.fire(new u.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Cr(this.stylesheet.sprite)}setSprite(t,n={},a){this._checkLoaded(),t&&this._validate(u.x.sprite,"sprite",t,null,n)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,a):(this._unloadSprite(),a&&a(null)))}}var on=u.X([{name:"a_pos",type:"Int16",components:2}]),Na="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const jo={prelude:Zt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Zt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Zt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Zt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Zt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Zt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Zt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Zt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Zt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Zt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Zt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Zt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Zt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Zt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Zt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Zt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Zt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Zt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Zt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Zt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Zt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Zt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Zt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Zt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Zt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Zt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Zt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Na),terrainDepth:Zt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Na),terrainCoords:Zt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Na)};function Zt(c,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=t.match(/attribute ([\w]+) ([\w]+)/g),l=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=d?d.concat(l):l,v={};return{fragmentSource:c=c.replace(n,(b,C,z,k,j)=>(v[j]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${j}
varying ${z} ${k} ${j};
#else
uniform ${z} ${k} u_${j};
#endif
`:`
#ifdef HAS_UNIFORM_u_${j}
    ${z} ${k} ${j} = u_${j};
#endif
`)),vertexSource:t=t.replace(n,(b,C,z,k,j)=>{const U=k==="float"?"vec2":"vec4",G=j.match(/color/)?"color":U;return v[j]?C==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${z} ${U} a_${j};
varying ${z} ${k} ${j};
#else
uniform ${z} ${k} u_${j};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${z} ${k} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${G}(a_${j}, u_${j}_t);
#else
    ${z} ${k} ${j} = u_${j};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${z} ${U} a_${j};
#else
uniform ${z} ${k} u_${j};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${z} ${k} ${j} = a_${j};
#else
    ${z} ${k} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${z} ${k} ${j} = unpack_mix_${G}(a_${j}, u_${j}_t);
#else
    ${z} ${k} ${j} = u_${j};
#endif
`}),staticAttributes:a,staticUniforms:_}}class $a{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,a,l,d,_,v,b,C){this.context=t;let z=this.boundPaintVertexBuffers.length!==l.length;for(let k=0;!z&&k<l.length;k++)this.boundPaintVertexBuffers[k]!==l[k]&&(z=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==a||z||this.boundIndexBuffer!==d||this.boundVertexOffset!==_||this.boundDynamicVertexBuffer!==v||this.boundDynamicVertexBuffer2!==b||this.boundDynamicVertexBuffer3!==C?this.freshBind(n,a,l,d,_,v,b,C):(t.bindVertexArray.set(this.vao),v&&v.bind(),d&&d.dynamicDraw&&d.bind(),b&&b.bind(),C&&C.bind())}freshBind(t,n,a,l,d,_,v,b){const C=t.numAttributes,z=this.context,k=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=l,this.boundVertexOffset=d,this.boundDynamicVertexBuffer=_,this.boundDynamicVertexBuffer2=v,this.boundDynamicVertexBuffer3=b,n.enableAttributes(k,t);for(const j of a)j.enableAttributes(k,t);_&&_.enableAttributes(k,t),v&&v.enableAttributes(k,t),b&&b.enableAttributes(k,t),n.bind(),n.setVertexAttribPointers(k,t,d);for(const j of a)j.bind(),j.setVertexAttribPointers(k,t,d);_&&(_.bind(),_.setVertexAttribPointers(k,t,d)),l&&l.bind(),v&&(v.bind(),v.setVertexAttribPointers(k,t,d)),b&&(b.bind(),b.setVertexAttribPointers(k,t,d)),z.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Dn(c){const t=[];for(let n=0;n<c.length;n++){if(c[n]===null)continue;const a=c[n].split(" ");t.push(a.pop())}return t}class y{constructor(t,n,a,l,d,_){const v=t.gl;this.program=v.createProgram();const b=Dn(n.staticAttributes),C=a?a.getBinderAttributes():[],z=b.concat(C),k=jo.prelude.staticUniforms?Dn(jo.prelude.staticUniforms):[],j=n.staticUniforms?Dn(n.staticUniforms):[],U=a?a.getBinderUniforms():[],G=k.concat(j).concat(U),Y=[];for(const we of G)Y.indexOf(we)<0&&Y.push(we);const W=a?a.defines():[];d&&W.push("#define OVERDRAW_INSPECTOR;"),_&&W.push("#define TERRAIN3D;");const ee=W.concat(jo.prelude.fragmentSource,n.fragmentSource).join(`
`),ce=W.concat(jo.prelude.vertexSource,n.vertexSource).join(`
`),J=v.createShader(v.FRAGMENT_SHADER);if(v.isContextLost())return void(this.failedToCreate=!0);if(v.shaderSource(J,ee),v.compileShader(J),!v.getShaderParameter(J,v.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${v.getShaderInfoLog(J)}`);v.attachShader(this.program,J);const he=v.createShader(v.VERTEX_SHADER);if(v.isContextLost())return void(this.failedToCreate=!0);if(v.shaderSource(he,ce),v.compileShader(he),!v.getShaderParameter(he,v.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${v.getShaderInfoLog(he)}`);v.attachShader(this.program,he),this.attributes={};const ye={};this.numAttributes=z.length;for(let we=0;we<this.numAttributes;we++)z[we]&&(v.bindAttribLocation(this.program,we,z[we]),this.attributes[z[we]]=we);if(v.linkProgram(this.program),!v.getProgramParameter(this.program,v.LINK_STATUS))throw new Error(`Program failed to link: ${v.getProgramInfoLog(this.program)}`);v.deleteShader(he),v.deleteShader(J);for(let we=0;we<Y.length;we++){const Ce=Y[we];if(Ce&&!ye[Ce]){const De=v.getUniformLocation(this.program,Ce);De&&(ye[Ce]=De)}}this.fixedUniforms=l(t,ye),this.terrainUniforms=((we,Ce)=>({u_depth:new u.aH(we,Ce.u_depth),u_terrain:new u.aH(we,Ce.u_terrain),u_terrain_dim:new u.aI(we,Ce.u_terrain_dim),u_terrain_matrix:new u.aJ(we,Ce.u_terrain_matrix),u_terrain_unpack:new u.aK(we,Ce.u_terrain_unpack),u_terrain_exaggeration:new u.aI(we,Ce.u_terrain_exaggeration)}))(t,ye),this.binderUniforms=a?a.getUniforms(t,ye):[]}draw(t,n,a,l,d,_,v,b,C,z,k,j,U,G,Y,W,ee,ce){const J=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(a),t.setStencilMode(l),t.setColorMode(d),t.setCullFace(_),b){t.activeTexture.set(J.TEXTURE2),J.bindTexture(J.TEXTURE_2D,b.depthTexture),t.activeTexture.set(J.TEXTURE3),J.bindTexture(J.TEXTURE_2D,b.texture);for(const ye in this.terrainUniforms)this.terrainUniforms[ye].set(b[ye])}for(const ye in this.fixedUniforms)this.fixedUniforms[ye].set(v[ye]);Y&&Y.setUniforms(t,this.binderUniforms,U,{zoom:G});let he=0;switch(n){case J.LINES:he=2;break;case J.TRIANGLES:he=3;break;case J.LINE_STRIP:he=1}for(const ye of j.get()){const we=ye.vaos||(ye.vaos={});(we[C]||(we[C]=new $a)).bind(t,this,z,Y?Y.getPaintVertexBuffers():[],k,ye.vertexOffset,W,ee,ce),J.drawElements(n,ye.primitiveLength*he,J.UNSIGNED_SHORT,ye.primitiveOffset*he*2)}}}function S(c,t,n){const a=1/vt(n,1,t.transform.tileZoom),l=Math.pow(2,n.tileID.overscaledZ),d=n.tileSize*Math.pow(2,t.transform.tileZoom)/l,_=d*(n.tileID.canonical.x+n.tileID.wrap*l),v=d*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[a,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[_>>16,v>>16],u_pixel_coord_lower:[65535&_,65535&v]}}const O=(c,t,n,a)=>{const l=t.style.light,d=l.properties.get("position"),_=[d.x,d.y,d.z],v=function(){var C=new u.A(9);return u.A!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[5]=0,C[6]=0,C[7]=0),C[0]=1,C[4]=1,C[8]=1,C}();l.properties.get("anchor")==="viewport"&&function(C,z){var k=Math.sin(z),j=Math.cos(z);C[0]=j,C[1]=k,C[2]=0,C[3]=-k,C[4]=j,C[5]=0,C[6]=0,C[7]=0,C[8]=1}(v,-t.transform.angle),function(C,z,k){var j=z[0],U=z[1],G=z[2];C[0]=j*k[0]+U*k[3]+G*k[6],C[1]=j*k[1]+U*k[4]+G*k[7],C[2]=j*k[2]+U*k[5]+G*k[8]}(_,_,v);const b=l.properties.get("color");return{u_matrix:c,u_lightpos:_,u_lightintensity:l.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_vertical_gradient:+n,u_opacity:a}},K=(c,t,n,a,l,d,_)=>u.e(O(c,t,n,a),S(d,t,_),{u_height_factor:-Math.pow(2,l.overscaledZ)/_.tileSize/8}),ne=c=>({u_matrix:c}),ae=(c,t,n,a)=>u.e(ne(c),S(n,t,a)),fe=(c,t)=>({u_matrix:c,u_world:t}),ze=(c,t,n,a,l)=>u.e(ae(c,t,n,a),{u_world:l}),Oe=(c,t,n,a)=>{const l=c.transform;let d,_;if(a.paint.get("circle-pitch-alignment")==="map"){const v=vt(n,1,l.zoom);d=!0,_=[v,v]}else d=!1,_=l.pixelsToGLUnits;return{u_camera_to_center_distance:l.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:c.translatePosMatrix(t.posMatrix,n,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+d,u_device_pixel_ratio:c.pixelRatio,u_extrude_scale:_}},We=(c,t,n)=>({u_matrix:c,u_inv_matrix:t,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}),Ze=(c,t,n=1)=>({u_matrix:c,u_color:t,u_overlay:0,u_overlay_scale:n}),$e=c=>({u_matrix:c}),xt=(c,t,n,a)=>({u_matrix:c,u_extrude_scale:vt(t,1,n),u_intensity:a});function pr(c,t){const n=Math.pow(2,t.canonical.z),a=t.canonical.y;return[new u.Y(0,a/n).toLngLat().lat,new u.Y(0,(a+1)/n).toLngLat().lat]}const gt=(c,t,n,a)=>{const l=c.transform;return{u_matrix:Vr(c,t,n,a),u_ratio:1/vt(t,1,l.zoom),u_device_pixel_ratio:c.pixelRatio,u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]]}},Wt=(c,t,n,a,l)=>u.e(gt(c,t,n,l),{u_image:0,u_image_height:a}),ke=(c,t,n,a,l)=>{const d=c.transform,_=Qt(t,d);return{u_matrix:Vr(c,t,n,l),u_texsize:t.imageAtlasTexture.size,u_ratio:1/vt(t,1,d.zoom),u_device_pixel_ratio:c.pixelRatio,u_image:0,u_scale:[_,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},ct=(c,t,n,a,l,d)=>{const _=c.lineAtlas,v=Qt(t,c.transform),b=n.layout.get("line-cap")==="round",C=_.getDash(a.from,b),z=_.getDash(a.to,b),k=C.width*l.fromScale,j=z.width*l.toScale;return u.e(gt(c,t,n,d),{u_patternscale_a:[v/k,-C.height/2],u_patternscale_b:[v/j,-z.height/2],u_sdfgamma:_.width/(256*Math.min(k,j)*c.pixelRatio)/2,u_image:0,u_tex_y_a:C.y,u_tex_y_b:z.y,u_mix:l.t})};function Qt(c,t){return 1/vt(c,1,t.tileZoom)}function Vr(c,t,n,a){return c.translatePosMatrix(a?a.posMatrix:t.tileID.posMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const gr=(c,t,n,a,l)=>{return{u_matrix:c,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(_=l.paint.get("raster-saturation"),_>0?1-1/(1.001-_):-_),u_contrast_factor:(d=l.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:bs(l.paint.get("raster-hue-rotate"))};var d,_};function bs(c){c*=Math.PI/180;const t=Math.sin(c),n=Math.cos(c);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const Js=(c,t,n,a,l,d,_,v,b,C,z,k,j,U)=>{const G=_.transform;return{u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:G.cameraToCenterDistance,u_pitch:G.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:G.width/G.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:b,u_coord_matrix:C,u_is_text:+k,u_pitch_with_map:+a,u_is_along_line:l,u_is_variable_anchor:d,u_texsize:j,u_texture:0,u_translation:z,u_pitched_scale:U}},fr=(c,t,n,a,l,d,_,v,b,C,z,k,j,U,G)=>{const Y=_.transform;return u.e(Js(c,t,n,a,l,d,_,v,b,C,z,k,j,G),{u_gamma_scale:a?Math.cos(Y._pitch)*Y.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:+U})},Ks=(c,t,n,a,l,d,_,v,b,C,z,k,j,U)=>u.e(fr(c,t,n,a,l,d,_,v,b,C,z,!0,k,!0,U),{u_texsize_icon:j,u_texture_icon:1}),Gl=(c,t,n)=>({u_matrix:c,u_opacity:t,u_color:n}),Fn=(c,t,n,a,l,d)=>u.e(function(_,v,b,C){const z=b.imageManager.getPattern(_.from.toString()),k=b.imageManager.getPattern(_.to.toString()),{width:j,height:U}=b.imageManager.getPixelSize(),G=Math.pow(2,C.tileID.overscaledZ),Y=C.tileSize*Math.pow(2,b.transform.tileZoom)/G,W=Y*(C.tileID.canonical.x+C.tileID.wrap*G),ee=Y*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:k.tl,u_pattern_br_b:k.br,u_texsize:[j,U],u_mix:v.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:k.displaySize,u_scale_a:v.fromScale,u_scale_b:v.toScale,u_tile_units_to_pixels:1/vt(C,1,b.transform.tileZoom),u_pixel_coord_upper:[W>>16,ee>>16],u_pixel_coord_lower:[65535&W,65535&ee]}}(a,d,n,l),{u_matrix:c,u_opacity:t}),_a={fillExtrusion:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix),u_lightpos:new u.aL(c,t.u_lightpos),u_lightintensity:new u.aI(c,t.u_lightintensity),u_lightcolor:new u.aL(c,t.u_lightcolor),u_vertical_gradient:new u.aI(c,t.u_vertical_gradient),u_opacity:new u.aI(c,t.u_opacity)}),fillExtrusionPattern:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix),u_lightpos:new u.aL(c,t.u_lightpos),u_lightintensity:new u.aI(c,t.u_lightintensity),u_lightcolor:new u.aL(c,t.u_lightcolor),u_vertical_gradient:new u.aI(c,t.u_vertical_gradient),u_height_factor:new u.aI(c,t.u_height_factor),u_image:new u.aH(c,t.u_image),u_texsize:new u.aM(c,t.u_texsize),u_pixel_coord_upper:new u.aM(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.aM(c,t.u_pixel_coord_lower),u_scale:new u.aL(c,t.u_scale),u_fade:new u.aI(c,t.u_fade),u_opacity:new u.aI(c,t.u_opacity)}),fill:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix)}),fillPattern:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix),u_image:new u.aH(c,t.u_image),u_texsize:new u.aM(c,t.u_texsize),u_pixel_coord_upper:new u.aM(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.aM(c,t.u_pixel_coord_lower),u_scale:new u.aL(c,t.u_scale),u_fade:new u.aI(c,t.u_fade)}),fillOutline:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix),u_world:new u.aM(c,t.u_world)}),fillOutlinePattern:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix),u_world:new u.aM(c,t.u_world),u_image:new u.aH(c,t.u_image),u_texsize:new u.aM(c,t.u_texsize),u_pixel_coord_upper:new u.aM(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.aM(c,t.u_pixel_coord_lower),u_scale:new u.aL(c,t.u_scale),u_fade:new u.aI(c,t.u_fade)}),circle:(c,t)=>({u_camera_to_center_distance:new u.aI(c,t.u_camera_to_center_distance),u_scale_with_map:new u.aH(c,t.u_scale_with_map),u_pitch_with_map:new u.aH(c,t.u_pitch_with_map),u_extrude_scale:new u.aM(c,t.u_extrude_scale),u_device_pixel_ratio:new u.aI(c,t.u_device_pixel_ratio),u_matrix:new u.aJ(c,t.u_matrix)}),collisionBox:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix),u_pixel_extrude_scale:new u.aM(c,t.u_pixel_extrude_scale)}),collisionCircle:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix),u_inv_matrix:new u.aJ(c,t.u_inv_matrix),u_camera_to_center_distance:new u.aI(c,t.u_camera_to_center_distance),u_viewport_size:new u.aM(c,t.u_viewport_size)}),debug:(c,t)=>({u_color:new u.aN(c,t.u_color),u_matrix:new u.aJ(c,t.u_matrix),u_overlay:new u.aH(c,t.u_overlay),u_overlay_scale:new u.aI(c,t.u_overlay_scale)}),clippingMask:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix)}),heatmap:(c,t)=>({u_extrude_scale:new u.aI(c,t.u_extrude_scale),u_intensity:new u.aI(c,t.u_intensity),u_matrix:new u.aJ(c,t.u_matrix)}),heatmapTexture:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix),u_world:new u.aM(c,t.u_world),u_image:new u.aH(c,t.u_image),u_color_ramp:new u.aH(c,t.u_color_ramp),u_opacity:new u.aI(c,t.u_opacity)}),hillshade:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix),u_image:new u.aH(c,t.u_image),u_latrange:new u.aM(c,t.u_latrange),u_light:new u.aM(c,t.u_light),u_shadow:new u.aN(c,t.u_shadow),u_highlight:new u.aN(c,t.u_highlight),u_accent:new u.aN(c,t.u_accent)}),hillshadePrepare:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix),u_image:new u.aH(c,t.u_image),u_dimension:new u.aM(c,t.u_dimension),u_zoom:new u.aI(c,t.u_zoom),u_unpack:new u.aK(c,t.u_unpack)}),line:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix),u_ratio:new u.aI(c,t.u_ratio),u_device_pixel_ratio:new u.aI(c,t.u_device_pixel_ratio),u_units_to_pixels:new u.aM(c,t.u_units_to_pixels)}),lineGradient:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix),u_ratio:new u.aI(c,t.u_ratio),u_device_pixel_ratio:new u.aI(c,t.u_device_pixel_ratio),u_units_to_pixels:new u.aM(c,t.u_units_to_pixels),u_image:new u.aH(c,t.u_image),u_image_height:new u.aI(c,t.u_image_height)}),linePattern:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix),u_texsize:new u.aM(c,t.u_texsize),u_ratio:new u.aI(c,t.u_ratio),u_device_pixel_ratio:new u.aI(c,t.u_device_pixel_ratio),u_image:new u.aH(c,t.u_image),u_units_to_pixels:new u.aM(c,t.u_units_to_pixels),u_scale:new u.aL(c,t.u_scale),u_fade:new u.aI(c,t.u_fade)}),lineSDF:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix),u_ratio:new u.aI(c,t.u_ratio),u_device_pixel_ratio:new u.aI(c,t.u_device_pixel_ratio),u_units_to_pixels:new u.aM(c,t.u_units_to_pixels),u_patternscale_a:new u.aM(c,t.u_patternscale_a),u_patternscale_b:new u.aM(c,t.u_patternscale_b),u_sdfgamma:new u.aI(c,t.u_sdfgamma),u_image:new u.aH(c,t.u_image),u_tex_y_a:new u.aI(c,t.u_tex_y_a),u_tex_y_b:new u.aI(c,t.u_tex_y_b),u_mix:new u.aI(c,t.u_mix)}),raster:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix),u_tl_parent:new u.aM(c,t.u_tl_parent),u_scale_parent:new u.aI(c,t.u_scale_parent),u_buffer_scale:new u.aI(c,t.u_buffer_scale),u_fade_t:new u.aI(c,t.u_fade_t),u_opacity:new u.aI(c,t.u_opacity),u_image0:new u.aH(c,t.u_image0),u_image1:new u.aH(c,t.u_image1),u_brightness_low:new u.aI(c,t.u_brightness_low),u_brightness_high:new u.aI(c,t.u_brightness_high),u_saturation_factor:new u.aI(c,t.u_saturation_factor),u_contrast_factor:new u.aI(c,t.u_contrast_factor),u_spin_weights:new u.aL(c,t.u_spin_weights)}),symbolIcon:(c,t)=>({u_is_size_zoom_constant:new u.aH(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aH(c,t.u_is_size_feature_constant),u_size_t:new u.aI(c,t.u_size_t),u_size:new u.aI(c,t.u_size),u_camera_to_center_distance:new u.aI(c,t.u_camera_to_center_distance),u_pitch:new u.aI(c,t.u_pitch),u_rotate_symbol:new u.aH(c,t.u_rotate_symbol),u_aspect_ratio:new u.aI(c,t.u_aspect_ratio),u_fade_change:new u.aI(c,t.u_fade_change),u_matrix:new u.aJ(c,t.u_matrix),u_label_plane_matrix:new u.aJ(c,t.u_label_plane_matrix),u_coord_matrix:new u.aJ(c,t.u_coord_matrix),u_is_text:new u.aH(c,t.u_is_text),u_pitch_with_map:new u.aH(c,t.u_pitch_with_map),u_is_along_line:new u.aH(c,t.u_is_along_line),u_is_variable_anchor:new u.aH(c,t.u_is_variable_anchor),u_texsize:new u.aM(c,t.u_texsize),u_texture:new u.aH(c,t.u_texture),u_translation:new u.aM(c,t.u_translation),u_pitched_scale:new u.aI(c,t.u_pitched_scale)}),symbolSDF:(c,t)=>({u_is_size_zoom_constant:new u.aH(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aH(c,t.u_is_size_feature_constant),u_size_t:new u.aI(c,t.u_size_t),u_size:new u.aI(c,t.u_size),u_camera_to_center_distance:new u.aI(c,t.u_camera_to_center_distance),u_pitch:new u.aI(c,t.u_pitch),u_rotate_symbol:new u.aH(c,t.u_rotate_symbol),u_aspect_ratio:new u.aI(c,t.u_aspect_ratio),u_fade_change:new u.aI(c,t.u_fade_change),u_matrix:new u.aJ(c,t.u_matrix),u_label_plane_matrix:new u.aJ(c,t.u_label_plane_matrix),u_coord_matrix:new u.aJ(c,t.u_coord_matrix),u_is_text:new u.aH(c,t.u_is_text),u_pitch_with_map:new u.aH(c,t.u_pitch_with_map),u_is_along_line:new u.aH(c,t.u_is_along_line),u_is_variable_anchor:new u.aH(c,t.u_is_variable_anchor),u_texsize:new u.aM(c,t.u_texsize),u_texture:new u.aH(c,t.u_texture),u_gamma_scale:new u.aI(c,t.u_gamma_scale),u_device_pixel_ratio:new u.aI(c,t.u_device_pixel_ratio),u_is_halo:new u.aH(c,t.u_is_halo),u_translation:new u.aM(c,t.u_translation),u_pitched_scale:new u.aI(c,t.u_pitched_scale)}),symbolTextAndIcon:(c,t)=>({u_is_size_zoom_constant:new u.aH(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aH(c,t.u_is_size_feature_constant),u_size_t:new u.aI(c,t.u_size_t),u_size:new u.aI(c,t.u_size),u_camera_to_center_distance:new u.aI(c,t.u_camera_to_center_distance),u_pitch:new u.aI(c,t.u_pitch),u_rotate_symbol:new u.aH(c,t.u_rotate_symbol),u_aspect_ratio:new u.aI(c,t.u_aspect_ratio),u_fade_change:new u.aI(c,t.u_fade_change),u_matrix:new u.aJ(c,t.u_matrix),u_label_plane_matrix:new u.aJ(c,t.u_label_plane_matrix),u_coord_matrix:new u.aJ(c,t.u_coord_matrix),u_is_text:new u.aH(c,t.u_is_text),u_pitch_with_map:new u.aH(c,t.u_pitch_with_map),u_is_along_line:new u.aH(c,t.u_is_along_line),u_is_variable_anchor:new u.aH(c,t.u_is_variable_anchor),u_texsize:new u.aM(c,t.u_texsize),u_texsize_icon:new u.aM(c,t.u_texsize_icon),u_texture:new u.aH(c,t.u_texture),u_texture_icon:new u.aH(c,t.u_texture_icon),u_gamma_scale:new u.aI(c,t.u_gamma_scale),u_device_pixel_ratio:new u.aI(c,t.u_device_pixel_ratio),u_is_halo:new u.aH(c,t.u_is_halo),u_translation:new u.aM(c,t.u_translation),u_pitched_scale:new u.aI(c,t.u_pitched_scale)}),background:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix),u_opacity:new u.aI(c,t.u_opacity),u_color:new u.aN(c,t.u_color)}),backgroundPattern:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix),u_opacity:new u.aI(c,t.u_opacity),u_image:new u.aH(c,t.u_image),u_pattern_tl_a:new u.aM(c,t.u_pattern_tl_a),u_pattern_br_a:new u.aM(c,t.u_pattern_br_a),u_pattern_tl_b:new u.aM(c,t.u_pattern_tl_b),u_pattern_br_b:new u.aM(c,t.u_pattern_br_b),u_texsize:new u.aM(c,t.u_texsize),u_mix:new u.aI(c,t.u_mix),u_pattern_size_a:new u.aM(c,t.u_pattern_size_a),u_pattern_size_b:new u.aM(c,t.u_pattern_size_b),u_scale_a:new u.aI(c,t.u_scale_a),u_scale_b:new u.aI(c,t.u_scale_b),u_pixel_coord_upper:new u.aM(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.aM(c,t.u_pixel_coord_lower),u_tile_units_to_pixels:new u.aI(c,t.u_tile_units_to_pixels)}),terrain:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix),u_texture:new u.aH(c,t.u_texture),u_ele_delta:new u.aI(c,t.u_ele_delta)}),terrainDepth:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix),u_ele_delta:new u.aI(c,t.u_ele_delta)}),terrainCoords:(c,t)=>({u_matrix:new u.aJ(c,t.u_matrix),u_texture:new u.aH(c,t.u_texture),u_terrain_coords_id:new u.aI(c,t.u_terrain_coords_id),u_ele_delta:new u.aI(c,t.u_ele_delta)})};class Va{constructor(t,n,a){this.context=t;const l=t.gl;this.buffer=l.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),l.bufferData(l.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?l.DYNAMIC_DRAW:l.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const xa={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class va{constructor(t,n,a,l){this.length=n.length,this.attributes=a,this.itemSize=n.bytesPerElement,this.dynamicDraw=l,this.context=t;const d=t.gl;this.buffer=d.createBuffer(),t.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let a=0;a<this.attributes.length;a++){const l=n.attributes[this.attributes[a].name];l!==void 0&&t.enableVertexAttribArray(l)}}setVertexAttribPointers(t,n,a){for(let l=0;l<this.attributes.length;l++){const d=this.attributes[l],_=n.attributes[d.name];_!==void 0&&t.vertexAttribPointer(_,d.components,t[xa[d.type]],!1,this.itemSize,d.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const No=new WeakMap;function Ii(c){var t;if(No.has(c))return No.get(c);{const n=(t=c.getParameter(c.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return No.set(c,n),n}}class Ht{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ws extends Ht{getDefault(){return u.aP.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ba extends Ht{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class $o extends Ht{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ys extends Ht{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class wa extends Ht{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Zl extends Ht{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Vo extends Ht{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Ua extends Ht{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class qa extends Ht{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class Qs extends Ht{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class an extends Ht{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class Ga extends Ht{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Ss extends Ht{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class el extends Ht{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ts extends Ht{getDefault(){return u.aP.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Sa extends Ht{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Jn extends Ht{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class Is extends Ht{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Wl extends Ht{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class mo extends Ht{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Cs extends Ht{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Ta extends Ht{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Hl extends Ht{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Uo extends Ht{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ia extends Ht{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Es extends Ht{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Za extends Ht{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Wa extends Ht{getDefault(){return null}set(t){var n;if(t===this.current&&!this.dirty)return;const a=this.gl;Ii(a)?a.bindVertexArray(t):(n=a.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class qo extends Ht{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class As extends Ht{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class tl extends Ht{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Go extends Ht{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class Ln extends Go{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ps extends Go{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ha extends Go{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ca{constructor(t,n,a,l,d){this.context=t,this.width=n,this.height=a;const _=t.gl,v=this.framebuffer=_.createFramebuffer();if(this.colorAttachment=new Ln(t,v),l)this.depthAttachment=d?new Ha(t,v):new Ps(t,v);else if(d)throw new Error("Stencil cannot be set without depth");if(_.checkFramebufferStatus(_.FRAMEBUFFER)!==_.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}t.deleteFramebuffer(this.framebuffer)}}class or{constructor(t,n,a){this.blendFunction=t,this.blendColor=n,this.mask=a}}or.Replace=[1,0],or.disabled=new or(or.Replace,u.aP.transparent,[!1,!1,!1,!1]),or.unblended=new or(or.Replace,u.aP.transparent,[!0,!0,!0,!0]),or.alphaBlended=new or([1,771],u.aP.transparent,[!0,!0,!0,!0]);class sn{constructor(t){var n,a;if(this.gl=t,this.clearColor=new ws(this),this.clearDepth=new ba(this),this.clearStencil=new $o(this),this.colorMask=new Ys(this),this.depthMask=new wa(this),this.stencilMask=new Zl(this),this.stencilFunc=new Vo(this),this.stencilOp=new Ua(this),this.stencilTest=new qa(this),this.depthRange=new Qs(this),this.depthTest=new an(this),this.depthFunc=new Ga(this),this.blend=new Ss(this),this.blendFunc=new el(this),this.blendColor=new Ts(this),this.blendEquation=new Sa(this),this.cullFace=new Jn(this),this.cullFaceSide=new Is(this),this.frontFace=new Wl(this),this.program=new mo(this),this.activeTexture=new Cs(this),this.viewport=new Ta(this),this.bindFramebuffer=new Hl(this),this.bindRenderbuffer=new Uo(this),this.bindTexture=new Ia(this),this.bindVertexBuffer=new Es(this),this.bindElementBuffer=new Za(this),this.bindVertexArray=new Wa(this),this.pixelStoreUnpack=new qo(this),this.pixelStoreUnpackPremultiplyAlpha=new As(this),this.pixelStoreUnpackFlipY=new tl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Ii(t)){this.HALF_FLOAT=t.HALF_FLOAT;const l=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=t.RGBA16F)!==null&&n!==void 0?n:l?.RGBA16F_EXT,this.RGB16F=(a=t.RGB16F)!==null&&a!==void 0?a:l?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const l=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=l?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new Va(this,t,n)}createVertexBuffer(t,n,a){return new va(this,t,n,a)}createRenderbuffer(t,n,a){const l=this.gl,d=l.createRenderbuffer();return this.bindRenderbuffer.set(d),l.renderbufferStorage(l.RENDERBUFFER,t,n,a),this.bindRenderbuffer.set(null),d}createFramebuffer(t,n,a,l){return new Ca(this,t,n,a,l)}clear({color:t,depth:n,stencil:a}){const l=this.gl;let d=0;t&&(d|=l.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(d|=l.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),a!==void 0&&(d|=l.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),l.clear(d)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){u.aE(t.blendFunction,or.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Ii(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var n;return Ii(this.gl)?this.gl.deleteVertexArray(t):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class St{constructor(t,n,a){this.func=t,this.mask=n,this.range=a}}St.ReadOnly=!1,St.ReadWrite=!0,St.disabled=new St(519,St.ReadOnly,[0,1]);const Kn=7680;class er{constructor(t,n,a,l,d,_){this.test=t,this.ref=n,this.mask=a,this.fail=l,this.depthFail=d,this.pass=_}}er.disabled=new er({func:519,mask:0},0,0,Kn,Kn,Kn);class yr{constructor(t,n,a){this.enable=t,this.mode=n,this.frontFace=a}}let go;function Zo(c,t,n,a,l){const d=c.context,_=d.gl,v=c.useProgram("collisionBox"),b=[];let C=0,z=0;for(let ee=0;ee<a.length;ee++){const ce=a[ee],J=t.getTile(ce).getBucket(n);if(!J)continue;const he=l?J.textCollisionBox:J.iconCollisionBox,ye=J.collisionCircleArray;if(ye.length>0){const we=u.F();u.aQ(we,J.placementInvProjMatrix,c.transform.glCoordMatrix),u.aQ(we,we,J.placementViewportMatrix),b.push({circleArray:ye,circleOffset:z,transform:ce.posMatrix,invTransform:we,coord:ce}),C+=ye.length/4,z=C}he&&v.draw(d,_.LINES,St.disabled,er.disabled,c.colorModeForRenderPass(),yr.disabled,{u_matrix:ce.posMatrix,u_pixel_extrude_scale:[1/(k=c.transform).width,1/k.height]},c.style.map.terrain&&c.style.map.terrain.getTerrainData(ce),n.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,null,c.transform.zoom,null,null,he.collisionVertexBuffer)}var k;if(!l||!b.length)return;const j=c.useProgram("collisionCircle"),U=new u.aR;U.resize(4*C),U._trim();let G=0;for(const ee of b)for(let ce=0;ce<ee.circleArray.length/4;ce++){const J=4*ce,he=ee.circleArray[J+0],ye=ee.circleArray[J+1],we=ee.circleArray[J+2],Ce=ee.circleArray[J+3];U.emplace(G++,he,ye,we,Ce,0),U.emplace(G++,he,ye,we,Ce,1),U.emplace(G++,he,ye,we,Ce,2),U.emplace(G++,he,ye,we,Ce,3)}(!go||go.length<2*C)&&(go=function(ee){const ce=2*ee,J=new u.aT;J.resize(ce),J._trim();for(let he=0;he<ce;he++){const ye=6*he;J.uint16[ye+0]=4*he+0,J.uint16[ye+1]=4*he+1,J.uint16[ye+2]=4*he+2,J.uint16[ye+3]=4*he+2,J.uint16[ye+4]=4*he+3,J.uint16[ye+5]=4*he+0}return J}(C));const Y=d.createIndexBuffer(go,!0),W=d.createVertexBuffer(U,u.aS.members,!0);for(const ee of b){const ce=We(ee.transform,ee.invTransform,c.transform);j.draw(d,_.TRIANGLES,St.disabled,er.disabled,c.colorModeForRenderPass(),yr.disabled,ce,c.style.map.terrain&&c.style.map.terrain.getTerrainData(ee.coord),n.id,W,Y,u.$.simpleSegment(0,2*ee.circleOffset,ee.circleArray.length,ee.circleArray.length/2),null,c.transform.zoom,null,null,null)}W.destroy(),Y.destroy()}yr.disabled=new yr(!1,1029,2305),yr.backCCW=new yr(!0,1029,2305);const Xa=u.an(new Float32Array(16));function rl(c,t,n,a,l,d){const{horizontalAlign:_,verticalAlign:v}=u.au(c);return new u.P((-(_-.5)*t/l+a[0])*d,(-(v-.5)*n/l+a[1])*d)}function il(c,t,n,a,l,d){const _=t.tileAnchorPoint.add(new u.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let v=a.mult(d);return n||(v=v.rotate(-l)),zr(_.add(v),t.labelPlaneMatrix,t.getElevation).point}if(n){const v=te(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(c),b=Math.atan(v.y/v.x)+(v.x<0?Math.PI:0);return c.add(a.rotate(b))}return c.add(a)}function Ja(c,t,n,a,l,d,_,v,b,C,z,k,j,U){const G=c.text.placedSymbolArray,Y=c.text.dynamicLayoutVertexArray,W=c.icon.dynamicLayoutVertexArray,ee={};Y.clear();for(let ce=0;ce<G.length;ce++){const J=G.get(ce),he=J.hidden||!J.crossTileID||c.allowVerticalPlacement&&!J.placedOrientation?null:a[J.crossTileID];if(he){const ye=new u.P(J.anchorX,J.anchorY),we={getElevation:U,width:l.width,height:l.height,labelPlaneMatrix:d,lineVertexArray:null,pitchWithMap:n,projection:z,projectionCache:null,tileAnchorPoint:ye,translation:k,unwrappedTileID:j},Ce=n?zr(ye,_,U):te(ye.x,ye.y,we),De=Z(l.cameraToCenterDistance,Ce.signedDistanceFromCamera);let Qe=u.ai(c.textSizeData,b,J)*De/u.ap;n&&(Qe*=c.tilePixelRatio/v);const{width:et,height:Be,anchor:je,textOffset:at,textBoxScale:Tt}=he,Ue=rl(je,et,Be,at,Tt,Qe),He=z.getPitchedTextCorrection(l,ye.add(new u.P(k[0],k[1])),j),wt=il(Ce.point,we,t,Ue,l.angle,He),Sr=c.allowVerticalPlacement&&J.placedOrientation===u.ah.vertical?Math.PI/2:0;for(let Dt=0;Dt<J.numGlyphs;Dt++)u.aj(Y,wt,Sr);C&&J.associatedIconIndex>=0&&(ee[J.associatedIconIndex]={shiftedAnchor:wt,angle:Sr})}else dt(J.numGlyphs,Y)}if(C){W.clear();const ce=c.icon.placedSymbolArray;for(let J=0;J<ce.length;J++){const he=ce.get(J);if(he.hidden)dt(he.numGlyphs,W);else{const ye=ee[J];if(ye)for(let we=0;we<he.numGlyphs;we++)u.aj(W,ye.shiftedAnchor,ye.angle);else dt(he.numGlyphs,W)}}c.icon.dynamicLayoutVertexBuffer.updateData(W)}c.text.dynamicLayoutVertexBuffer.updateData(Y)}function Ea(c,t,n){return n.iconsInText&&t?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function Wo(c,t,n,a,l,d,_,v,b,C,z,k){const j=c.context,U=j.gl,G=c.transform,Y=Dr(),W=v==="map",ee=b==="map",ce=v!=="viewport"&&n.layout.get("symbol-placement")!=="point",J=W&&!ee&&!ce,he=!ee&&ce,ye=!n.layout.get("symbol-sort-key").isConstant();let we=!1;const Ce=c.depthModeForSublayer(0,St.ReadOnly),De=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Qe=[],et=Y.getCircleRadiusCorrection(G);for(const Be of a){const je=t.getTile(Be),at=je.getBucket(n);if(!at)continue;const Tt=l?at.text:at.icon;if(!Tt||!Tt.segments.get().length||!Tt.hasVisibleVertices)continue;const Ue=Tt.programConfigurations.get(n.id),He=l||at.sdfIcons,wt=l?at.textSizeData:at.iconSizeData,Sr=ee||G.pitch!==0,Dt=c.useProgram(Ea(He,l,at),Ue),jt=u.ag(wt,G.zoom),Tr=c.style.map.terrain&&c.style.map.terrain.getTerrainData(Be);let Ei,On,Ir,Yi,Ni=[0,0],Ai=null;if(l)On=je.glyphAtlasTexture,Ir=U.LINEAR,Ei=je.glyphAtlasTexture.size,at.iconsInText&&(Ni=je.imageAtlasTexture.size,Ai=je.imageAtlasTexture,Yi=Sr||c.options.rotating||c.options.zooming||wt.kind==="composite"||wt.kind==="camera"?U.LINEAR:U.NEAREST);else{const kr=n.layout.get("icon-size").constantOr(0)!==1||at.iconsNeedLinear;On=je.imageAtlasTexture,Ir=He||c.options.rotating||c.options.zooming||kr||Sr?U.LINEAR:U.NEAREST,Ei=je.imageAtlasTexture.size}const Pi=vt(je,1,c.transform.zoom),jn=he?Be.posMatrix:Xa,ka=wi(jn,ee,W,c.transform,Pi),cl=bn(jn,ee,W,c.transform,Pi),rs=bn(Be.posMatrix,ee,W,c.transform,Pi),za=Y.translatePosition(c.transform,je,d,_),ul=De&&at.hasTextData(),sc=n.layout.get("icon-text-fit")!=="none"&&ul&&at.hasIconData();if(ce){const kr=c.style.map.terrain?(lc,ni)=>c.style.map.terrain.getElevation(Be,lc,ni):null,ns=n.layout.get("text-rotation-alignment")==="map";L(at,Be.posMatrix,c,l,ka,rs,ee,C,ns,Y,Be.toUnwrapped(),G.width,G.height,za,kr)}const xi=Be.posMatrix,Nn=l&&De||sc,oa=ce||Nn?Xa:ka,is=cl,Mi=He&&n.paint.get(l?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ki;ki=He?at.iconsInText?Ks(wt.kind,jt,J,ee,ce,Nn,c,xi,oa,is,za,Ei,Ni,et):fr(wt.kind,jt,J,ee,ce,Nn,c,xi,oa,is,za,l,Ei,!0,et):Js(wt.kind,jt,J,ee,ce,Nn,c,xi,oa,is,za,l,Ei,et);const ui={program:Dt,buffers:Tt,uniformValues:ki,atlasTexture:On,atlasTextureIcon:Ai,atlasInterpolation:Ir,atlasInterpolationIcon:Yi,isSDF:He,hasHalo:Mi};if(ye&&at.canOverlap){we=!0;const kr=Tt.segments.get();for(const ns of kr)Qe.push({segments:new u.$([ns]),sortKey:ns.sortKey,state:ui,terrainData:Tr})}else Qe.push({segments:Tt.segments,sortKey:0,state:ui,terrainData:Tr})}we&&Qe.sort((Be,je)=>Be.sortKey-je.sortKey);for(const Be of Qe){const je=Be.state;if(j.activeTexture.set(U.TEXTURE0),je.atlasTexture.bind(je.atlasInterpolation,U.CLAMP_TO_EDGE),je.atlasTextureIcon&&(j.activeTexture.set(U.TEXTURE1),je.atlasTextureIcon&&je.atlasTextureIcon.bind(je.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),je.isSDF){const at=je.uniformValues;je.hasHalo&&(at.u_is_halo=1,yo(je.buffers,Be.segments,n,c,je.program,Ce,z,k,at,Be.terrainData)),at.u_is_halo=0}yo(je.buffers,Be.segments,n,c,je.program,Ce,z,k,je.uniformValues,Be.terrainData)}}function yo(c,t,n,a,l,d,_,v,b,C){const z=a.context;l.draw(z,z.gl.TRIANGLES,d,_,v,yr.disabled,b,C,n.id,c.layoutVertexBuffer,c.indexBuffer,t,n.paint,a.transform.zoom,c.programConfigurations.get(n.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function Ri(c,t,n,a,l){if(!n||!a||!a.imageAtlas)return;const d=a.imageAtlas.patternPositions;let _=d[n.to.toString()],v=d[n.from.toString()];if(!_&&v&&(_=v),!v&&_&&(v=_),!_||!v){const b=l.getPaintProperty(t);_=d[b],v=d[b]}_&&v&&c.setConstantPatternPositions(_,v)}function _o(c,t,n,a,l,d,_){const v=c.context.gl,b="fill-pattern",C=n.paint.get(b),z=C&&C.constantOr(1),k=n.getCrossfadeParameters();let j,U,G,Y,W;_?(U=z&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=v.LINES):(U=z?"fillPattern":"fill",j=v.TRIANGLES);const ee=C.constantOr(null);for(const ce of a){const J=t.getTile(ce);if(z&&!J.patternsLoaded())continue;const he=J.getBucket(n);if(!he)continue;const ye=he.programConfigurations.get(n.id),we=c.useProgram(U,ye),Ce=c.style.map.terrain&&c.style.map.terrain.getTerrainData(ce);z&&(c.context.activeTexture.set(v.TEXTURE0),J.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),ye.updatePaintBuffers(k)),Ri(ye,b,ee,J,n);const De=Ce?ce:null,Qe=c.translatePosMatrix(De?De.posMatrix:ce.posMatrix,J,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(_){Y=he.indexBuffer2,W=he.segments2;const et=[v.drawingBufferWidth,v.drawingBufferHeight];G=U==="fillOutlinePattern"&&z?ze(Qe,c,k,J,et):fe(Qe,et)}else Y=he.indexBuffer,W=he.segments,G=z?ae(Qe,c,k,J):ne(Qe);we.draw(c.context,j,l,c.stencilModeForClipping(ce),d,yr.disabled,G,Ce,n.id,he.layoutVertexBuffer,Y,W,n.paint,c.transform.zoom,ye)}}function Lr(c,t,n,a,l,d,_){const v=c.context,b=v.gl,C="fill-extrusion-pattern",z=n.paint.get(C),k=z.constantOr(1),j=n.getCrossfadeParameters(),U=n.paint.get("fill-extrusion-opacity"),G=z.constantOr(null);for(const Y of a){const W=t.getTile(Y),ee=W.getBucket(n);if(!ee)continue;const ce=c.style.map.terrain&&c.style.map.terrain.getTerrainData(Y),J=ee.programConfigurations.get(n.id),he=c.useProgram(k?"fillExtrusionPattern":"fillExtrusion",J);k&&(c.context.activeTexture.set(b.TEXTURE0),W.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),J.updatePaintBuffers(j)),Ri(J,C,G,W,n);const ye=c.translatePosMatrix(Y.posMatrix,W,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),we=n.paint.get("fill-extrusion-vertical-gradient"),Ce=k?K(ye,c,we,U,Y,j,W):O(ye,c,we,U);he.draw(v,v.gl.TRIANGLES,l,d,_,yr.backCCW,Ce,ce,n.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,n.paint,c.transform.zoom,J,c.style.map.terrain&&ee.centroidVertexBuffer)}}function nl(c,t,n,a,l,d,_){const v=c.context,b=v.gl,C=n.fbo;if(!C)return;const z=c.useProgram("hillshade"),k=c.style.map.terrain&&c.style.map.terrain.getTerrainData(t);v.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,C.colorAttachment.get()),z.draw(v,b.TRIANGLES,l,d,_,yr.disabled,((j,U,G,Y)=>{const W=G.paint.get("hillshade-shadow-color"),ee=G.paint.get("hillshade-highlight-color"),ce=G.paint.get("hillshade-accent-color");let J=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);G.paint.get("hillshade-illumination-anchor")==="viewport"&&(J-=j.transform.angle);const he=!j.options.moving;return{u_matrix:Y?Y.posMatrix:j.transform.calculatePosMatrix(U.tileID.toUnwrapped(),he),u_image:0,u_latrange:pr(0,U.tileID),u_light:[G.paint.get("hillshade-exaggeration"),J],u_shadow:W,u_highlight:ee,u_accent:ce}})(c,n,a,k?t:null),k,a.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}function Yn(c,t,n,a,l,d){const _=c.context,v=_.gl,b=t.dem;if(b&&b.data){const C=b.dim,z=b.stride,k=b.getPixels();if(_.activeTexture.set(v.TEXTURE1),_.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||c.getTileTexture(z),t.demTexture){const U=t.demTexture;U.update(k,{premultiply:!1}),U.bind(v.NEAREST,v.CLAMP_TO_EDGE)}else t.demTexture=new Ft(_,k,v.RGBA,{premultiply:!1}),t.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);_.activeTexture.set(v.TEXTURE0);let j=t.fbo;if(!j){const U=new Ft(_,{width:C,height:C,data:null},v.RGBA);U.bind(v.LINEAR,v.CLAMP_TO_EDGE),j=t.fbo=_.createFramebuffer(C,C,!0,!1),j.colorAttachment.set(U.texture)}_.bindFramebuffer.set(j.framebuffer),_.viewport.set([0,0,C,C]),c.useProgram("hillshadePrepare").draw(_,v.TRIANGLES,a,l,d,yr.disabled,((U,G)=>{const Y=G.stride,W=u.F();return u.aO(W,0,u.W,-u.W,0,0,1),u.H(W,W,[0,-u.W,0]),{u_matrix:W,u_image:1,u_dimension:[Y,Y],u_zoom:U.overscaledZ,u_unpack:G.getUnpackVector()}})(t.tileID,b),null,n.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Ka(c,t,n,a,l,d){const _=a.paint.get("raster-fade-duration");if(!d&&_>0){const v=ve.now(),b=(v-c.timeAdded)/_,C=t?(v-t.timeAdded)/_:-1,z=n.getSource(),k=l.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),j=!t||Math.abs(t.tileID.overscaledZ-k)>Math.abs(c.tileID.overscaledZ-k),U=j&&c.refreshedUponExpiration?1:u.ac(j?b:1-C,0,1);return c.refreshedUponExpiration&&b>=1&&(c.refreshedUponExpiration=!1),t?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}const xo=new u.aP(1,0,0,1),vo=new u.aP(0,1,0,1),Ho=new u.aP(0,0,1,1),Xo=new u.aP(1,0,1,1),Aa=new u.aP(0,1,1,1);function Ya(c,t,n,a){wn(c,0,t+n/2,c.transform.width,n,a)}function ln(c,t,n,a){wn(c,t-n/2,0,n,c.transform.height,a)}function wn(c,t,n,a,l,d){const _=c.context,v=_.gl;v.enable(v.SCISSOR_TEST),v.scissor(t*c.pixelRatio,n*c.pixelRatio,a*c.pixelRatio,l*c.pixelRatio),_.clear({color:d}),v.disable(v.SCISSOR_TEST)}function ol(c,t,n){const a=c.context,l=a.gl,d=n.posMatrix,_=c.useProgram("debug"),v=St.disabled,b=er.disabled,C=c.colorModeForRenderPass(),z="$debug",k=c.style.map.terrain&&c.style.map.terrain.getTerrainData(n);a.activeTexture.set(l.TEXTURE0);const j=t.getTileByID(n.key).latestRawTileData,U=Math.floor((j&&j.byteLength||0)/1024),G=t.getTile(n).tileSize,Y=512/Math.min(G,512)*(n.overscaledZ/c.transform.zoom)*.5;let W=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(W+=` => ${n.overscaledZ}`),function(ee,ce){ee.initDebugOverlayCanvas();const J=ee.debugOverlayCanvas,he=ee.context.gl,ye=ee.debugOverlayCanvas.getContext("2d");ye.clearRect(0,0,J.width,J.height),ye.shadowColor="white",ye.shadowBlur=2,ye.lineWidth=1.5,ye.strokeStyle="white",ye.textBaseline="top",ye.font="bold 36px Open Sans, sans-serif",ye.fillText(ce,5,5),ye.strokeText(ce,5,5),ee.debugOverlayTexture.update(J),ee.debugOverlayTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE)}(c,`${W} ${U}kB`),_.draw(a,l.TRIANGLES,v,b,or.alphaBlended,yr.disabled,Ze(d,u.aP.transparent,Y),null,z,c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments),_.draw(a,l.LINE_STRIP,v,b,C,yr.disabled,Ze(d,u.aP.red),k,z,c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments)}function me(c,t,n){const a=c.context,l=a.gl,d=c.colorModeForRenderPass(),_=new St(l.LEQUAL,St.ReadWrite,c.depthRangeFor3D),v=c.useProgram("terrain"),b=t.getTerrainMesh();a.bindFramebuffer.set(null),a.viewport.set([0,0,c.width,c.height]);for(const C of n){const z=c.renderToTexture.getTexture(C),k=t.getTerrainData(C.tileID);a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,z.texture);const j={u_matrix:c.transform.calculatePosMatrix(C.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(c.transform.zoom)};v.draw(a,l.TRIANGLES,_,er.disabled,d,yr.backCCW,j,k,"terrain",b.vertexBuffer,b.indexBuffer,b.segments)}}class xe{constructor(t,n){this.context=new sn(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Le.maxUnderzooming+Le.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Pr}resize(t,n,a){if(this.width=Math.floor(t*a),this.height=Math.floor(n*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const l of this.style._order)this.style._layers[l].resize()}setup(){const t=this.context,n=new u.aW;n.emplaceBack(0,0),n.emplaceBack(u.W,0),n.emplaceBack(0,u.W),n.emplaceBack(u.W,u.W),this.tileExtentBuffer=t.createVertexBuffer(n,on.members),this.tileExtentSegments=u.$.simpleSegment(0,0,4,2);const a=new u.aW;a.emplaceBack(0,0),a.emplaceBack(u.W,0),a.emplaceBack(0,u.W),a.emplaceBack(u.W,u.W),this.debugBuffer=t.createVertexBuffer(a,on.members),this.debugSegments=u.$.simpleSegment(0,0,4,5);const l=new u.Z;l.emplaceBack(0,0,0,0),l.emplaceBack(u.W,0,u.W,0),l.emplaceBack(0,u.W,0,u.W),l.emplaceBack(u.W,u.W,u.W,u.W),this.rasterBoundsBuffer=t.createVertexBuffer(l,qt.members),this.rasterBoundsSegments=u.$.simpleSegment(0,0,4,2);const d=new u.aW;d.emplaceBack(0,0),d.emplaceBack(1,0),d.emplaceBack(0,1),d.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(d,on.members),this.viewportSegments=u.$.simpleSegment(0,0,4,2);const _=new u.aX;_.emplaceBack(0),_.emplaceBack(1),_.emplaceBack(3),_.emplaceBack(2),_.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(_);const v=new u.aY;v.emplaceBack(0,1,2),v.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(v);const b=this.context.gl;this.stencilClearMode=new er({func:b.ALWAYS,mask:0},0,255,b.ZERO,b.ZERO,b.ZERO)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=u.F();u.aO(a,0,this.width,this.height,0,0,1),u.J(a,a,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,n.TRIANGLES,St.disabled,this.stencilClearMode,or.disabled,yr.disabled,$e(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source;const a=this.context,l=a.gl;this.nextStencilID+n.length>256&&this.clearStencil(),a.setColorMode(or.disabled),a.setDepthMode(St.disabled);const d=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const _ of n){const v=this._tileClippingMaskIDs[_.key]=this.nextStencilID++,b=this.style.map.terrain&&this.style.map.terrain.getTerrainData(_);d.draw(a,l.TRIANGLES,St.disabled,new er({func:l.ALWAYS,mask:0},v,255,l.KEEP,l.KEEP,l.REPLACE),or.disabled,yr.disabled,$e(_.posMatrix),b,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new er({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new er({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,a=t.sort((_,v)=>v.overscaledZ-_.overscaledZ),l=a[a.length-1].overscaledZ,d=a[0].overscaledZ-l+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const _={};for(let v=0;v<d;v++)_[v+l]=new er({func:n.GEQUAL,mask:255},v+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=d,[_,a]}return[{[l]:er.disabled},a]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new or([t.CONSTANT_COLOR,t.ONE],new u.aP(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?or.unblended:or.alphaBlended}depthModeForSublayer(t,n,a){if(!this.opaquePassEnabledForLayer())return St.disabled;const l=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new St(a||this.context.gl.LEQUAL,n,[l,l])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(ve.now()),this.imageManager.beginFrame();const a=this.style._order,l=this.style.sourceCaches,d={},_={},v={};for(const b in l){const C=l[b];C.used&&C.prepare(this.context),d[b]=C.getVisibleCoordinates(),_[b]=d[b].slice().reverse(),v[b]=C.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let b=0;b<a.length;b++)if(this.style._layers[a[b]].is3D()){this.opaquePassCutoff=b;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const b of a){const C=this.style._layers[b];if(!C.hasOffscreenPass()||C.isHidden(this.transform.zoom))continue;const z=_[C.source];(C.type==="custom"||z.length)&&this.renderLayer(this,l[C.source],C,z)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?u.aP.black:u.aP.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const b=this.style._layers[a[this.currentLayer]],C=l[b.source],z=d[b.source];this._renderTileClippingMasks(b,z),this.renderLayer(this,C,b,z)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const b=this.style._layers[a[this.currentLayer]],C=l[b.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(b))continue;const z=(b.type==="symbol"?v:_)[b.source];this._renderTileClippingMasks(b,d[b.source]),this.renderLayer(this,C,b,z)}if(this.options.showTileBoundaries){const b=function(C,z){let k=null;const j=Object.values(C._layers).flatMap(W=>W.source&&!W.isHidden(z)?[C.sourceCaches[W.source]]:[]),U=j.filter(W=>W.getSource().type==="vector"),G=j.filter(W=>W.getSource().type!=="vector"),Y=W=>{(!k||k.getSource().maxzoom<W.getSource().maxzoom)&&(k=W)};return U.forEach(W=>Y(W)),k||G.forEach(W=>Y(W)),k}(this.style,this.transform.zoom);b&&function(C,z,k){for(let j=0;j<k.length;j++)ol(C,z,k[j])}(this,b,b.getVisibleCoordinates())}this.options.showPadding&&function(b){const C=b.transform.padding;Ya(b,b.transform.height-(C.top||0),3,xo),Ya(b,C.bottom||0,3,vo),ln(b,C.left||0,3,Ho),ln(b,b.transform.width-(C.right||0),3,Xo);const z=b.transform.centerPoint;(function(k,j,U,G){wn(k,j-1,U-10,2,20,G),wn(k,j-10,U-1,20,2,G)})(b,z.x,b.transform.height-z.y,Aa)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,a=this.transform.projMatrix;let l=this.terrainFacilitator.dirty;l||(l=t?!u.aZ(n,a):!u.a_(n,a)),l||(l=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),l&&(u.a$(n,a),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(d,_){const v=d.context,b=v.gl,C=or.unblended,z=new St(b.LEQUAL,St.ReadWrite,[0,1]),k=_.getTerrainMesh(),j=_.sourceCache.getRenderableTiles(),U=d.useProgram("terrainDepth");v.bindFramebuffer.set(_.getFramebuffer("depth").framebuffer),v.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),v.clear({color:u.aP.transparent,depth:1});for(const G of j){const Y=_.getTerrainData(G.tileID),W={u_matrix:d.transform.calculatePosMatrix(G.tileID.toUnwrapped()),u_ele_delta:_.getMeshFrameDelta(d.transform.zoom)};U.draw(v,b.TRIANGLES,z,er.disabled,C,yr.backCCW,W,Y,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}v.bindFramebuffer.set(null),v.viewport.set([0,0,d.width,d.height])}(this,this.style.map.terrain),function(d,_){const v=d.context,b=v.gl,C=or.unblended,z=new St(b.LEQUAL,St.ReadWrite,[0,1]),k=_.getTerrainMesh(),j=_.getCoordsTexture(),U=_.sourceCache.getRenderableTiles(),G=d.useProgram("terrainCoords");v.bindFramebuffer.set(_.getFramebuffer("coords").framebuffer),v.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),v.clear({color:u.aP.transparent,depth:1}),_.coordsIndex=[];for(const Y of U){const W=_.getTerrainData(Y.tileID);v.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,j.texture);const ee={u_matrix:d.transform.calculatePosMatrix(Y.tileID.toUnwrapped()),u_terrain_coords_id:(255-_.coordsIndex.length)/255,u_texture:0,u_ele_delta:_.getMeshFrameDelta(d.transform.zoom)};G.draw(v,b.TRIANGLES,z,er.disabled,C,yr.backCCW,ee,W,"terrain",k.vertexBuffer,k.indexBuffer,k.segments),_.coordsIndex.push(Y.tileID.key)}v.bindFramebuffer.set(null),v.viewport.set([0,0,d.width,d.height])}(this,this.style.map.terrain))}renderLayer(t,n,a,l){if(!a.isHidden(this.transform.zoom)&&(a.type==="background"||a.type==="custom"||(l||[]).length))switch(this.id=a.id,a.type){case"symbol":(function(d,_,v,b,C){if(d.renderPass!=="translucent")return;const z=er.disabled,k=d.colorModeForRenderPass();(v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(j,U,G,Y,W,ee,ce,J,he){const ye=U.transform,we=Dr(),Ce=W==="map",De=ee==="map";for(const Qe of j){const et=Y.getTile(Qe),Be=et.getBucket(G);if(!Be||!Be.text||!Be.text.segments.get().length)continue;const je=u.ag(Be.textSizeData,ye.zoom),at=vt(et,1,U.transform.zoom),Tt=wi(Qe.posMatrix,De,Ce,U.transform,at),Ue=G.layout.get("icon-text-fit")!=="none"&&Be.hasIconData();if(je){const He=Math.pow(2,ye.zoom-et.tileID.overscaledZ),wt=U.style.map.terrain?(Dt,jt)=>U.style.map.terrain.getElevation(Qe,Dt,jt):null,Sr=we.translatePosition(ye,et,ce,J);Ja(Be,Ce,De,he,ye,Tt,Qe.posMatrix,He,je,Ue,we,Sr,Qe.toUnwrapped(),wt)}}}(b,d,v,_,v.layout.get("text-rotation-alignment"),v.layout.get("text-pitch-alignment"),v.paint.get("text-translate"),v.paint.get("text-translate-anchor"),C),v.paint.get("icon-opacity").constantOr(1)!==0&&Wo(d,_,v,b,!1,v.paint.get("icon-translate"),v.paint.get("icon-translate-anchor"),v.layout.get("icon-rotation-alignment"),v.layout.get("icon-pitch-alignment"),v.layout.get("icon-keep-upright"),z,k),v.paint.get("text-opacity").constantOr(1)!==0&&Wo(d,_,v,b,!0,v.paint.get("text-translate"),v.paint.get("text-translate-anchor"),v.layout.get("text-rotation-alignment"),v.layout.get("text-pitch-alignment"),v.layout.get("text-keep-upright"),z,k),_.map.showCollisionBoxes&&(Zo(d,_,v,b,!0),Zo(d,_,v,b,!1))})(t,n,a,l,this.style.placement.variableOffsets);break;case"circle":(function(d,_,v,b){if(d.renderPass!=="translucent")return;const C=v.paint.get("circle-opacity"),z=v.paint.get("circle-stroke-width"),k=v.paint.get("circle-stroke-opacity"),j=!v.layout.get("circle-sort-key").isConstant();if(C.constantOr(1)===0&&(z.constantOr(1)===0||k.constantOr(1)===0))return;const U=d.context,G=U.gl,Y=d.depthModeForSublayer(0,St.ReadOnly),W=er.disabled,ee=d.colorModeForRenderPass(),ce=[];for(let J=0;J<b.length;J++){const he=b[J],ye=_.getTile(he),we=ye.getBucket(v);if(!we)continue;const Ce=we.programConfigurations.get(v.id),De=d.useProgram("circle",Ce),Qe=we.layoutVertexBuffer,et=we.indexBuffer,Be=d.style.map.terrain&&d.style.map.terrain.getTerrainData(he),je={programConfiguration:Ce,program:De,layoutVertexBuffer:Qe,indexBuffer:et,uniformValues:Oe(d,he,ye,v),terrainData:Be};if(j){const at=we.segments.get();for(const Tt of at)ce.push({segments:new u.$([Tt]),sortKey:Tt.sortKey,state:je})}else ce.push({segments:we.segments,sortKey:0,state:je})}j&&ce.sort((J,he)=>J.sortKey-he.sortKey);for(const J of ce){const{programConfiguration:he,program:ye,layoutVertexBuffer:we,indexBuffer:Ce,uniformValues:De,terrainData:Qe}=J.state;ye.draw(U,G.TRIANGLES,Y,W,ee,yr.disabled,De,Qe,v.id,we,Ce,J.segments,v.paint,d.transform.zoom,he)}})(t,n,a,l);break;case"heatmap":(function(d,_,v,b){if(v.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const C=d.context,z=C.gl,k=er.disabled,j=new or([z.ONE,z.ONE],u.aP.transparent,[!0,!0,!0,!0]);(function(U,G,Y){const W=U.gl;U.activeTexture.set(W.TEXTURE1),U.viewport.set([0,0,G.width/4,G.height/4]);let ee=Y.heatmapFbo;if(ee)W.bindTexture(W.TEXTURE_2D,ee.colorAttachment.get()),U.bindFramebuffer.set(ee.framebuffer);else{const ce=W.createTexture();W.bindTexture(W.TEXTURE_2D,ce),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),ee=Y.heatmapFbo=U.createFramebuffer(G.width/4,G.height/4,!1,!1),function(J,he,ye,we){var Ce,De;const Qe=J.gl,et=(Ce=J.HALF_FLOAT)!==null&&Ce!==void 0?Ce:Qe.UNSIGNED_BYTE,Be=(De=J.RGBA16F)!==null&&De!==void 0?De:Qe.RGBA;Qe.texImage2D(Qe.TEXTURE_2D,0,Be,he.width/4,he.height/4,0,Qe.RGBA,et,null),we.colorAttachment.set(ye)}(U,G,ce,ee)}})(C,d,v),C.clear({color:u.aP.transparent});for(let U=0;U<b.length;U++){const G=b[U];if(_.hasRenderableParent(G))continue;const Y=_.getTile(G),W=Y.getBucket(v);if(!W)continue;const ee=W.programConfigurations.get(v.id),ce=d.useProgram("heatmap",ee),{zoom:J}=d.transform;ce.draw(C,z.TRIANGLES,St.disabled,k,j,yr.disabled,xt(G.posMatrix,Y,J,v.paint.get("heatmap-intensity")),null,v.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,v.paint,d.transform.zoom,ee)}C.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(C,z){const k=C.context,j=k.gl,U=z.heatmapFbo;if(!U)return;k.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,U.colorAttachment.get()),k.activeTexture.set(j.TEXTURE1);let G=z.colorRampTexture;G||(G=z.colorRampTexture=new Ft(k,z.colorRamp,j.RGBA)),G.bind(j.LINEAR,j.CLAMP_TO_EDGE),C.useProgram("heatmapTexture").draw(k,j.TRIANGLES,St.disabled,er.disabled,C.colorModeForRenderPass(),yr.disabled,((Y,W,ee,ce)=>{const J=u.F();u.aO(J,0,Y.width,Y.height,0,0,1);const he=Y.context.gl;return{u_matrix:J,u_world:[he.drawingBufferWidth,he.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:W.paint.get("heatmap-opacity")}})(C,z),null,z.id,C.viewportBuffer,C.quadTriangleIndexBuffer,C.viewportSegments,z.paint,C.transform.zoom)}(d,v))})(t,n,a,l);break;case"line":(function(d,_,v,b){if(d.renderPass!=="translucent")return;const C=v.paint.get("line-opacity"),z=v.paint.get("line-width");if(C.constantOr(1)===0||z.constantOr(1)===0)return;const k=d.depthModeForSublayer(0,St.ReadOnly),j=d.colorModeForRenderPass(),U=v.paint.get("line-dasharray"),G=v.paint.get("line-pattern"),Y=G.constantOr(1),W=v.paint.get("line-gradient"),ee=v.getCrossfadeParameters(),ce=Y?"linePattern":U?"lineSDF":W?"lineGradient":"line",J=d.context,he=J.gl;let ye=!0;for(const we of b){const Ce=_.getTile(we);if(Y&&!Ce.patternsLoaded())continue;const De=Ce.getBucket(v);if(!De)continue;const Qe=De.programConfigurations.get(v.id),et=d.context.program.get(),Be=d.useProgram(ce,Qe),je=ye||Be.program!==et,at=d.style.map.terrain&&d.style.map.terrain.getTerrainData(we),Tt=G.constantOr(null);if(Tt&&Ce.imageAtlas){const wt=Ce.imageAtlas,Sr=wt.patternPositions[Tt.to.toString()],Dt=wt.patternPositions[Tt.from.toString()];Sr&&Dt&&Qe.setConstantPatternPositions(Sr,Dt)}const Ue=at?we:null,He=Y?ke(d,Ce,v,ee,Ue):U?ct(d,Ce,v,U,ee,Ue):W?Wt(d,Ce,v,De.lineClipsArray.length,Ue):gt(d,Ce,v,Ue);if(Y)J.activeTexture.set(he.TEXTURE0),Ce.imageAtlasTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE),Qe.updatePaintBuffers(ee);else if(U&&(je||d.lineAtlas.dirty))J.activeTexture.set(he.TEXTURE0),d.lineAtlas.bind(J);else if(W){const wt=De.gradients[v.id];let Sr=wt.texture;if(v.gradientVersion!==wt.version){let Dt=256;if(v.stepInterpolant){const jt=_.getSource().maxzoom,Tr=we.canonical.z===jt?Math.ceil(1<<d.transform.maxZoom-we.canonical.z):1;Dt=u.ac(u.aU(De.maxLineLength/u.W*1024*Tr),256,J.maxTextureSize)}wt.gradient=u.aV({expression:v.gradientExpression(),evaluationKey:"lineProgress",resolution:Dt,image:wt.gradient||void 0,clips:De.lineClipsArray}),wt.texture?wt.texture.update(wt.gradient):wt.texture=new Ft(J,wt.gradient,he.RGBA),wt.version=v.gradientVersion,Sr=wt.texture}J.activeTexture.set(he.TEXTURE0),Sr.bind(v.stepInterpolant?he.NEAREST:he.LINEAR,he.CLAMP_TO_EDGE)}Be.draw(J,he.TRIANGLES,k,d.stencilModeForClipping(we),j,yr.disabled,He,at,v.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,v.paint,d.transform.zoom,Qe,De.layoutVertexBuffer2),ye=!1}})(t,n,a,l);break;case"fill":(function(d,_,v,b){const C=v.paint.get("fill-color"),z=v.paint.get("fill-opacity");if(z.constantOr(1)===0)return;const k=d.colorModeForRenderPass(),j=v.paint.get("fill-pattern"),U=d.opaquePassEnabledForLayer()&&!j.constantOr(1)&&C.constantOr(u.aP.transparent).a===1&&z.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===U){const G=d.depthModeForSublayer(1,d.renderPass==="opaque"?St.ReadWrite:St.ReadOnly);_o(d,_,v,b,G,k,!1)}if(d.renderPass==="translucent"&&v.paint.get("fill-antialias")){const G=d.depthModeForSublayer(v.getPaintProperty("fill-outline-color")?2:0,St.ReadOnly);_o(d,_,v,b,G,k,!0)}})(t,n,a,l);break;case"fill-extrusion":(function(d,_,v,b){const C=v.paint.get("fill-extrusion-opacity");if(C!==0&&d.renderPass==="translucent"){const z=new St(d.context.gl.LEQUAL,St.ReadWrite,d.depthRangeFor3D);if(C!==1||v.paint.get("fill-extrusion-pattern").constantOr(1))Lr(d,_,v,b,z,er.disabled,or.disabled),Lr(d,_,v,b,z,d.stencilModeFor3D(),d.colorModeForRenderPass());else{const k=d.colorModeForRenderPass();Lr(d,_,v,b,z,er.disabled,k)}}})(t,n,a,l);break;case"hillshade":(function(d,_,v,b){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const C=d.context,z=d.depthModeForSublayer(0,St.ReadOnly),k=d.colorModeForRenderPass(),[j,U]=d.renderPass==="translucent"?d.stencilConfigForOverlap(b):[{},b];for(const G of U){const Y=_.getTile(G);Y.needsHillshadePrepare!==void 0&&Y.needsHillshadePrepare&&d.renderPass==="offscreen"?Yn(d,Y,v,z,er.disabled,k):d.renderPass==="translucent"&&nl(d,G,Y,v,z,j[G.overscaledZ],k)}C.viewport.set([0,0,d.width,d.height])})(t,n,a,l);break;case"raster":(function(d,_,v,b){if(d.renderPass!=="translucent"||v.paint.get("raster-opacity")===0||!b.length)return;const C=d.context,z=C.gl,k=_.getSource(),j=d.useProgram("raster"),U=d.colorModeForRenderPass(),[G,Y]=k instanceof Mn?[{},b]:d.stencilConfigForOverlap(b),W=Y[Y.length-1].overscaledZ,ee=!d.options.moving;for(const ce of Y){const J=d.depthModeForSublayer(ce.overscaledZ-W,v.paint.get("raster-opacity")===1?St.ReadWrite:St.ReadOnly,z.LESS),he=_.getTile(ce);he.registerFadeDuration(v.paint.get("raster-fade-duration"));const ye=_.findLoadedParent(ce,0),we=_.findLoadedSibling(ce),Ce=Ka(he,ye||we||null,_,v,d.transform,d.style.map.terrain);let De,Qe;const et=v.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;C.activeTexture.set(z.TEXTURE0),he.texture.bind(et,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(z.TEXTURE1),ye?(ye.texture.bind(et,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),De=Math.pow(2,ye.tileID.overscaledZ-he.tileID.overscaledZ),Qe=[he.tileID.canonical.x*De%1,he.tileID.canonical.y*De%1]):he.texture.bind(et,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const Be=d.style.map.terrain&&d.style.map.terrain.getTerrainData(ce),je=Be?ce:null,at=je?je.posMatrix:d.transform.calculatePosMatrix(ce.toUnwrapped(),ee),Tt=gr(at,Qe||[0,0],De||1,Ce,v);k instanceof Mn?j.draw(C,z.TRIANGLES,J,er.disabled,U,yr.disabled,Tt,Be,v.id,k.boundsBuffer,d.quadTriangleIndexBuffer,k.boundsSegments):j.draw(C,z.TRIANGLES,J,G[ce.overscaledZ],U,yr.disabled,Tt,Be,v.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}})(t,n,a,l);break;case"background":(function(d,_,v,b){const C=v.paint.get("background-color"),z=v.paint.get("background-opacity");if(z===0)return;const k=d.context,j=k.gl,U=d.transform,G=U.tileSize,Y=v.paint.get("background-pattern");if(d.isPatternMissing(Y))return;const W=!Y&&C.a===1&&z===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==W)return;const ee=er.disabled,ce=d.depthModeForSublayer(0,W==="opaque"?St.ReadWrite:St.ReadOnly),J=d.colorModeForRenderPass(),he=d.useProgram(Y?"backgroundPattern":"background"),ye=b||U.coveringTiles({tileSize:G,terrain:d.style.map.terrain});Y&&(k.activeTexture.set(j.TEXTURE0),d.imageManager.bind(d.context));const we=v.getCrossfadeParameters();for(const Ce of ye){const De=b?Ce.posMatrix:d.transform.calculatePosMatrix(Ce.toUnwrapped()),Qe=Y?Fn(De,z,d,Y,{tileID:Ce,tileSize:G},we):Gl(De,z,C),et=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Ce);he.draw(k,j.TRIANGLES,ce,ee,J,yr.disabled,Qe,et,v.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}})(t,0,a,l);break;case"custom":(function(d,_,v){const b=d.context,C=v.implementation;if(d.renderPass==="offscreen"){const z=C.prerender;z&&(d.setCustomLayerDefaults(),b.setColorMode(d.colorModeForRenderPass()),z.call(C,b.gl,d.transform.customLayerMatrix()),b.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),b.setColorMode(d.colorModeForRenderPass()),b.setStencilMode(er.disabled);const z=C.renderingMode==="3d"?new St(d.context.gl.LEQUAL,St.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,St.ReadOnly);b.setDepthMode(z),C.render(b.gl,d.transform.customLayerMatrix()),b.setDirty(),d.setBaseState(),b.bindFramebuffer.set(null)}})(t,0,a)}}translatePosMatrix(t,n,a,l,d){if(!a[0]&&!a[1])return t;const _=d?l==="map"?this.transform.angle:0:l==="viewport"?-this.transform.angle:0;if(_){const C=Math.sin(_),z=Math.cos(_);a=[a[0]*z-a[1]*C,a[0]*C+a[1]*z]}const v=[d?a[0]:vt(n,a[0],this.transform.zoom),d?a[1]:vt(n,a[1],this.transform.zoom),0],b=new Float32Array(16);return u.H(b,t,v),b}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),a=this.imageManager.getPattern(t.to.toString());return!n||!a}useProgram(t,n){this.cache=this.cache||{};const a=t+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new y(this.context,jo[t],n,_a[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ft(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:n}=this.context.gl;return this.width!==t||this.height!==n}}class Ve{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,a){const l=Math.pow(2,a),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(v=>{const b=1/(v=u.af([],v,t))[3]/n*l;return u.b0(v,v,[b,b,1/v[3],b])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(v=>{const b=function(j,U){var G=U[0],Y=U[1],W=U[2],ee=G*G+Y*Y+W*W;return ee>0&&(ee=1/Math.sqrt(ee)),j[0]=U[0]*ee,j[1]=U[1]*ee,j[2]=U[2]*ee,j}([],function(j,U,G){var Y=U[0],W=U[1],ee=U[2],ce=G[0],J=G[1],he=G[2];return j[0]=W*he-ee*J,j[1]=ee*ce-Y*he,j[2]=Y*J-W*ce,j}([],Ot([],d[v[0]],d[v[1]]),Ot([],d[v[2]],d[v[1]]))),C=-((z=b)[0]*(k=d[v[1]])[0]+z[1]*k[1]+z[2]*k[2]);var z,k;return b.concat(C)});return new Ve(d,_)}}class ft{constructor(t,n){this.min=t,this.max=n,this.center=function(a,l,d){return a[0]=.5*l[0],a[1]=.5*l[1],a[2]=.5*l[2],a}([],function(a,l,d){return a[0]=l[0]+d[0],a[1]=l[1]+d[1],a[2]=l[2]+d[2],a}([],this.min,this.max))}quadrant(t){const n=[t%2==0,t<2],a=Nt(this.min),l=Nt(this.max);for(let d=0;d<n.length;d++)a[d]=n[d]?this.min[d]:this.center[d],l[d]=n[d]?this.center[d]:this.max[d];return l[2]=this.max[2],new ft(a,l)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let l=0;l<t.planes.length;l++){const d=t.planes[l];let _=0;for(let v=0;v<n.length;v++)u.b1(d,n[v])>=0&&_++;if(_===0)return 0;_!==n.length&&(a=!1)}if(a)return 2;for(let l=0;l<3;l++){let d=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let v=0;v<t.points.length;v++){const b=t.points[v][l]-this.min[l];d=Math.min(d,b),_=Math.max(_,b)}if(_<0||d>this.max[l]-this.min[l])return 0}return 1}}class ir{constructor(t=0,n=0,a=0,l=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(a)||a<0||isNaN(l)||l<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=a,this.right=l}interpolate(t,n,a){return n.top!=null&&t.top!=null&&(this.top=u.z.number(t.top,n.top,a)),n.bottom!=null&&t.bottom!=null&&(this.bottom=u.z.number(t.bottom,n.bottom,a)),n.left!=null&&t.left!=null&&(this.left=u.z.number(t.left,n.left,a)),n.right!=null&&t.right!=null&&(this.right=u.z.number(t.right,n.right,a)),this}getCenter(t,n){const a=u.ac((this.left+t-this.right)/2,0,t),l=u.ac((this.top+n-this.bottom)/2,0,n);return new u.P(a,l)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ir(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Lt=85.051129;class wr{constructor(t,n,a,l,d){this.tileSize=512,this._renderWorldCopies=d===void 0||!!d,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=a??0,this._maxPitch=l??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new u.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ir,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new wr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const n=-u.b2(t,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var a=new u.A(4);return u.A!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a}(),function(a,l,d){var _=l[0],v=l[1],b=l[2],C=l[3],z=Math.sin(d),k=Math.cos(d);a[0]=_*k+b*z,a[1]=v*k+C*z,a[2]=_*-z+b*k,a[3]=v*-z+C*k}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=u.ac(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,a){this._unmodified=!1,this._edgeInsets.interpolate(t,n,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new u.b3(0,t)];if(this._renderWorldCopies){const a=this.pointCoordinate(new u.P(0,0)),l=this.pointCoordinate(new u.P(this.width,0)),d=this.pointCoordinate(new u.P(this.width,this.height)),_=this.pointCoordinate(new u.P(0,this.height)),v=Math.floor(Math.min(a.x,l.x,d.x,_.x)),b=Math.floor(Math.max(a.x,l.x,d.x,_.x)),C=1;for(let z=v-C;z<=b+C;z++)z!==0&&n.push(new u.b3(z,t))}return n}coveringTiles(t){var n,a;let l=this.coveringZoomLevel(t);const d=l;if(t.minzoom!==void 0&&l<t.minzoom)return[];t.maxzoom!==void 0&&l>t.maxzoom&&(l=t.maxzoom);const _=this.pointCoordinate(this.getCameraPoint()),v=u.Y.fromLngLat(this.center),b=Math.pow(2,l),C=[b*_.x,b*_.y,0],z=[b*v.x,b*v.y,0],k=Ve.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l);let j=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(j=l);const U=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,G=J=>({aabb:new ft([J*b,0,0],[(J+1)*b,b,0]),zoom:0,x:0,y:0,wrap:J,fullyVisible:!1}),Y=[],W=[],ee=l,ce=t.reparseOverscaled?d:l;if(this._renderWorldCopies)for(let J=1;J<=3;J++)Y.push(G(-J)),Y.push(G(J));for(Y.push(G(0));Y.length>0;){const J=Y.pop(),he=J.x,ye=J.y;let we=J.fullyVisible;if(!we){const Be=J.aabb.intersects(k);if(Be===0)continue;we=Be===2}const Ce=t.terrain?C:z,De=J.aabb.distanceX(Ce),Qe=J.aabb.distanceY(Ce),et=Math.max(Math.abs(De),Math.abs(Qe));if(J.zoom===ee||et>U+(1<<ee-J.zoom)-2&&J.zoom>=j){const Be=ee-J.zoom,je=C[0]-.5-(he<<Be),at=C[1]-.5-(ye<<Be);W.push({tileID:new u.Q(J.zoom===ee?ce:J.zoom,J.wrap,J.zoom,he,ye),distanceSq:cr([z[0]-.5-he,z[1]-.5-ye]),tileDistanceToCamera:Math.sqrt(je*je+at*at)})}else for(let Be=0;Be<4;Be++){const je=(he<<1)+Be%2,at=(ye<<1)+(Be>>1),Tt=J.zoom+1;let Ue=J.aabb.quadrant(Be);if(t.terrain){const He=new u.Q(Tt,J.wrap,Tt,je,at),wt=t.terrain.getMinMaxElevation(He),Sr=(n=wt.minElevation)!==null&&n!==void 0?n:this.elevation,Dt=(a=wt.maxElevation)!==null&&a!==void 0?a:this.elevation;Ue=new ft([Ue.min[0],Ue.min[1],Sr],[Ue.max[0],Ue.max[1],Dt])}Y.push({aabb:Ue,zoom:Tt,x:je,y:at,wrap:J.wrap,fullyVisible:we})}}return W.sort((J,he)=>J.distanceSq-he.distanceSq).map(J=>J.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=u.ac(t.lat,-85.051129,Lt);return new u.P(u.N(t.lng)*this.worldSize,u.O(n)*this.worldSize)}unproject(t){return new u.Y(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const n=this.elevation,a=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,l=this.pointLocation(this.centerPoint,t),d=t.getElevationForLngLatZoom(l,this.tileZoom);if(!(this.elevation-d))return;const _=a+n-d,v=Math.cos(this._pitch)*this.cameraToCenterDistance/_/u.b4(1,l.lat),b=this.scaleZoom(v/this.tileSize);this._elevation=d,this._center=l,this.zoom=b}setLocationAtPoint(t,n){const a=this.pointCoordinate(n),l=this.pointCoordinate(this.centerPoint),d=this.locationCoordinate(t),_=new u.Y(d.x-(a.x-l.x),d.y-(a.y-l.y));this.center=this.coordinateLocation(_),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,n){return n?this.coordinatePoint(this.locationCoordinate(t),n.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,n){return this.coordinateLocation(this.pointCoordinate(t,n))}locationCoordinate(t){return u.Y.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,n){if(n){const j=n.pointCoordinate(t);if(j!=null)return j}const a=[t.x,t.y,0,1],l=[t.x,t.y,1,1];u.af(a,a,this.pixelMatrixInverse),u.af(l,l,this.pixelMatrixInverse);const d=a[3],_=l[3],v=a[1]/d,b=l[1]/_,C=a[2]/d,z=l[2]/_,k=C===z?0:(0-C)/(z-C);return new u.Y(u.z.number(a[0]/d,l[0]/_,k)/this.worldSize,u.z.number(v,b,k)/this.worldSize)}coordinatePoint(t,n=0,a=this.pixelMatrix){const l=[t.x*this.worldSize,t.y*this.worldSize,n,1];return u.af(l,l,a),new u.P(l[0]/l[3],l[1]/l[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new vr().extend(this.pointLocation(new u.P(0,t))).extend(this.pointLocation(new u.P(this.width,t))).extend(this.pointLocation(new u.P(this.width,this.height))).extend(this.pointLocation(new u.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new vr([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Lt])}calculatePosMatrix(t,n=!1){const a=t.key,l=n?this._alignedPosMatrixCache:this._posMatrixCache;if(l[a])return l[a];const d=t.canonical,_=this.worldSize/this.zoomScale(d.z),v=d.x+Math.pow(2,d.z)*t.wrap,b=u.an(new Float64Array(16));return u.H(b,b,[v*_,d.y*_,0]),u.J(b,b,[_/u.W,_/u.W,1]),u.K(b,n?this.alignedProjMatrix:this.projMatrix,b),l[a]=new Float32Array(b),l[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,n){n=u.ac(+n,this.minZoom,this.maxZoom);const a={center:new u.M(t.lng,t.lat),zoom:n};let l=this.lngRange;if(!this._renderWorldCopies&&l===null){const J=179.9999999999;l=[-J,J]}const d=this.tileSize*this.zoomScale(a.zoom);let _=0,v=d,b=0,C=d,z=0,k=0;const{x:j,y:U}=this.size;if(this.latRange){const J=this.latRange;_=u.O(J[1])*d,v=u.O(J[0])*d,v-_<U&&(z=U/(v-_))}l&&(b=u.b2(u.N(l[0])*d,0,d),C=u.b2(u.N(l[1])*d,0,d),C<b&&(C+=d),C-b<j&&(k=j/(C-b)));const{x:G,y:Y}=this.project.call({worldSize:d},t);let W,ee;const ce=Math.max(k||0,z||0);if(ce){const J=new u.P(k?(C+b)/2:G,z?(v+_)/2:Y);return a.center=this.unproject.call({worldSize:d},J).wrap(),a.zoom+=this.scaleZoom(ce),a}if(this.latRange){const J=U/2;Y-J<_&&(ee=_+J),Y+J>v&&(ee=v-J)}if(l){const J=(b+C)/2;let he=G;this._renderWorldCopies&&(he=u.b2(G,J-d/2,J+d/2));const ye=j/2;he-ye<b&&(W=b+ye),he+ye>C&&(W=C-ye)}if(W!==void 0||ee!==void 0){const J=new u.P(W??G,ee??Y);a.center=this.unproject.call({worldSize:d},J).wrap()}return a}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:n,zoom:a}=this.getConstrained(this.center,this.zoom);this.center=n,this.zoom=a,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=u.b4(1,this.center.lat)*this.worldSize;let l=u.an(new Float64Array(16));u.J(l,l,[this.width/2,-this.height/2,1]),u.H(l,l,[1,-1,0]),this.labelPlaneMatrix=l,l=u.an(new Float64Array(16)),u.J(l,l,[1,-1,1]),u.H(l,l,[-1,-1,0]),u.J(l,l,[2/this.width,2/this.height,1]),this.glCoordMatrix=l;const d=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),_=Math.min(this.elevation,this.minElevationForCurrentTile),v=d-_*this._pixelPerMeter/Math.cos(this._pitch),b=_<0?v:d,C=Math.PI/2+this._pitch,z=this._fov*(.5+t.y/this.height),k=Math.sin(z)*b/Math.sin(u.ac(Math.PI-C-z,.01,Math.PI-.01)),j=this.getHorizon(),U=2*Math.atan(j/this.cameraToCenterDistance)*(.5+t.y/(2*j)),G=Math.sin(U)*b/Math.sin(u.ac(Math.PI-C-U,.01,Math.PI-.01)),Y=Math.min(k,G),W=1.01*(Math.cos(Math.PI/2-this._pitch)*Y+b),ee=this.height/50;l=new Float64Array(16),u.b5(l,this._fov,this.width/this.height,ee,W),l[8]=2*-t.x/this.width,l[9]=2*t.y/this.height,u.J(l,l,[1,-1,1]),u.H(l,l,[0,0,-this.cameraToCenterDistance]),u.b6(l,l,this._pitch),u.ad(l,l,this.angle),u.H(l,l,[-n,-a,0]),this.mercatorMatrix=u.J([],l,[this.worldSize,this.worldSize,this.worldSize]),u.J(l,l,[1,1,this._pixelPerMeter]),this.pixelMatrix=u.K(new Float64Array(16),this.labelPlaneMatrix,l),u.H(l,l,[0,0,-this.elevation]),this.projMatrix=l,this.invProjMatrix=u.as([],l),this.pixelMatrix3D=u.K(new Float64Array(16),this.labelPlaneMatrix,l);const ce=this.width%2/2,J=this.height%2/2,he=Math.cos(this.angle),ye=Math.sin(this.angle),we=n-Math.round(n)+he*ce+ye*J,Ce=a-Math.round(a)+he*J+ye*ce,De=new Float64Array(l);if(u.H(De,De,[we>.5?we-1:we,Ce>.5?Ce-1:Ce,0]),this.alignedProjMatrix=De,l=u.as(new Float64Array(16),this.pixelMatrix),!l)throw new Error("failed to invert matrix");this.pixelMatrixInverse=l,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new u.P(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return u.af(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.P(0,t))}getCameraQueryGeometry(t){const n=this.getCameraPoint();if(t.length===1)return[t[0],n];{let a=n.x,l=n.y,d=n.x,_=n.y;for(const v of t)a=Math.min(a,v.x),l=Math.min(l,v.y),d=Math.max(d,v.x),_=Math.max(_,v.y);return[new u.P(a,l),new u.P(d,l),new u.P(d,_),new u.P(a,_),new u.P(a,l)]}}lngLatToCameraDepth(t,n){const a=this.locationCoordinate(t),l=[a.x*this.worldSize,a.y*this.worldSize,n,1];return u.af(l,l,this.projMatrix),l[2]/l[3]}}function Br(c,t){let n,a=!1,l=null,d=null;const _=()=>{l=null,a&&(c.apply(d,n),l=setTimeout(_,t),a=!1)};return(...v)=>(a=!0,d=this,n=v,l||_(),l)}class Oi{constructor(t){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(l=>l.split("=")).forEach(l=>{l[0]===this._hashName&&(a=l)}),(a&&a[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(n.length>=3&&!n.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:a,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,n)}catch{}},this._updateHash=Br(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const n=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,l=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,l),_=Math.round(n.lng*d)/d,v=Math.round(n.lat*d)/d,b=this._map.getBearing(),C=this._map.getPitch();let z="";if(z+=t?`/${_}/${v}/${a}`:`${a}/${v}/${_}`,(b||C)&&(z+="/"+Math.round(10*b)/10),C&&(z+=`/${Math.round(C)}`),this._hashName){const k=this._hashName;let j=!1;const U=window.location.hash.slice(1).split("&").map(G=>{const Y=G.split("=")[0];return Y===k?(j=!0,`${Y}=${z}`):G}).filter(G=>G);return j||U.push(`${k}=${z}`),`#${U.join("&")}`}return`#${z}`}}const Mr={linearity:.3,easing:u.b7(0,0,.3,1)},Rr=u.e({deceleration:2500,maxSpeed:1400},Mr),ji=u.e({deceleration:20,maxSpeed:1400},Mr),Ji=u.e({deceleration:1e3,maxSpeed:360},Mr),ii=u.e({deceleration:1e3,maxSpeed:90},Mr);class cn{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ve.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=ve.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new u.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)n.zoom+=d.zoomDelta||0,n.bearing+=d.bearingDelta||0,n.pitch+=d.pitchDelta||0,d.panDelta&&n.pan._add(d.panDelta),d.around&&(n.around=d.around),d.pinchAround&&(n.pinchAround=d.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,l={};if(n.pan.mag()){const d=Tn(n.pan.mag(),a,u.e({},Rr,t||{}));l.offset=n.pan.mult(d.amount/n.pan.mag()),l.center=this._map.transform.center,Sn(l,d)}if(n.zoom){const d=Tn(n.zoom,a,ji);l.zoom=this._map.transform.zoom+d.amount,Sn(l,d)}if(n.bearing){const d=Tn(n.bearing,a,Ji);l.bearing=this._map.transform.bearing+u.ac(d.amount,-179,179),Sn(l,d)}if(n.pitch){const d=Tn(n.pitch,a,ii);l.pitch=this._map.transform.pitch+d.amount,Sn(l,d)}if(l.zoom||l.bearing){const d=n.pinchAround===void 0?n.around:n.pinchAround;l.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),u.e(l,{noMoveStart:!0})}}function Sn(c,t){(!c.duration||c.duration<t.duration)&&(c.duration=t.duration,c.easing=t.easing)}function Tn(c,t,n){const{maxSpeed:a,linearity:l,deceleration:d}=n,_=u.ac(c*l/(t/1e3),-a,a),v=Math.abs(_)/(d*l);return{easing:n.easing,duration:1e3*v,amount:_*(v/2)}}class Or extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,a,l={}){const d=se.mousePos(n.getCanvas(),a),_=n.unproject(d);super(t,u.e({point:d,lngLat:_,originalEvent:a},l)),this._defaultPrevented=!1,this.target=n}}class un extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,a){const l=t==="touchend"?a.changedTouches:a.touches,d=se.touchPos(n.getCanvasContainer(),l),_=d.map(b=>n.unproject(b)),v=d.reduce((b,C,z,k)=>b.add(C.div(k.length)),new u.P(0,0));super(t,{points:d,point:v,lngLats:_,lngLat:n.unproject(v),originalEvent:a}),this._defaultPrevented=!1}}class Ms extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,a){super(t,{originalEvent:a}),this._defaultPrevented=!1}}class ks{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Ms(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new Or(t.type,this._map,t))}mouseup(t){this._map.fire(new Or(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new Or(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Or(t.type,this._map,t))}mouseover(t){this._map.fire(new Or(t.type,this._map,t))}mouseout(t){this._map.fire(new Or(t.type,this._map,t))}touchstart(t){return this._firePreventable(new un(t.type,this._map,t))}touchmove(t){this._map.fire(new un(t.type,this._map,t))}touchend(t){this._map.fire(new un(t.type,this._map,t))}touchcancel(t){this._map.fire(new un(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xl{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Or(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Or("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Or(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xt{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(u.P.convert(t),this._map.terrain)}}class Ut{constructor(t,n){this._map=t,this._tr=new Xt(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(se.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const a=n;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const l=this._startPos;this._lastPos=a,this._box||(this._box=se.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const d=Math.min(l.x,a.x),_=Math.max(l.x,a.x),v=Math.min(l.y,a.y),b=Math.max(l.y,a.y);se.setTransform(this._box,`translate(${d}px,${v}px)`),this._box.style.width=_-d+"px",this._box.style.height=b-v+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const a=this._startPos,l=n;if(this.reset(),se.suppressClick(),a.x!==l.x||a.y!==l.y)return this._map.fire(new u.k("boxzoomend",{originalEvent:t})),{cameraAnimation:d=>d.fitScreenCoordinates(a,l,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(se.remove(this._box),this._box=null),se.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new u.k(t,{originalEvent:n}))}}function Qn(c,t){if(c.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${c.length}, points ${t.length}`);const n={};for(let a=0;a<c.length;a++)n[c[a].identifier]=t[a];return n}class Bn{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),a.length===this.numTouches&&(this.centroid=function(l){const d=new u.P(0,0);for(const _ of l)d._add(_);return d.div(l.length)}(n),this.touches=Qn(a,n)))}touchmove(t,n,a){if(this.aborted||!this.centroid)return;const l=Qn(a,n);for(const d in this.touches){const _=l[d];(!_||_.dist(this.touches[d])>30)&&(this.aborted=!0)}}touchend(t,n,a){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const l=!this.aborted&&this.centroid;if(this.reset(),l)return l}}}class Jo{constructor(t){this.singleTap=new Bn(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,a){this.singleTap.touchstart(t,n,a)}touchmove(t,n,a){this.singleTap.touchmove(t,n,a)}touchend(t,n,a){const l=this.singleTap.touchend(t,n,a);if(l){const d=t.timeStamp-this.lastTime<500,_=!this.lastTap||this.lastTap.dist(l)<30;if(d&&_||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=l,this.count===this.numTaps)return this.reset(),l}}}class yi{constructor(t){this._tr=new Xt(t),this._zoomIn=new Jo({numTouches:1,numTaps:2}),this._zoomOut=new Jo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,a){this._zoomIn.touchstart(t,n,a),this._zoomOut.touchstart(t,n,a)}touchmove(t,n,a){this._zoomIn.touchmove(t,n,a),this._zoomOut.touchmove(t,n,a)}touchend(t,n,a){const l=this._zoomIn.touchend(t,n,a),d=this._zoomOut.touchend(t,n,a),_=this._tr;return l?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:_.zoom+1,around:_.unproject(l)},{originalEvent:t})}):d?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:_.zoom-1,around:_.unproject(d)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _i{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const n=this._moveFunction(...t);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(t,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,n){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const l=n.length?n[0]:n;return!this._moved&&l.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=l,this._move(a,l))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&se.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const eo={0:1,2:2};class to{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const n=se.mouseButton(t);this._eventButton=n}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(n,a){const l=eo[a];return n.buttons===void 0||(n.buttons&l)!==l}(t,this._eventButton)}isValidEndEvent(t){return se.mouseButton(t)===this._eventButton}}class mr{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const Ci=c=>{c.mousedown=c.dragStart,c.mousemoveWindow=c.dragMove,c.mouseup=c.dragEnd,c.contextmenu=t=>{t.preventDefault()}},Wr=({enable:c,clickTolerance:t,bearingDegreesPerPixelMoved:n=.8})=>{const a=new to({checkCorrectEvent:l=>se.mouseButton(l)===0&&l.ctrlKey||se.mouseButton(l)===2});return new _i({clickTolerance:t,move:(l,d)=>({bearingDelta:(d.x-l.x)*n}),moveStateManager:a,enable:c,assignEvents:Ci})},Pa=({enable:c,clickTolerance:t,pitchDegreesPerPixelMoved:n=-.5})=>{const a=new to({checkCorrectEvent:l=>se.mouseButton(l)===0&&l.ctrlKey||se.mouseButton(l)===2});return new _i({clickTolerance:t,move:(l,d)=>({pitchDelta:(d.y-l.y)*n}),moveStateManager:a,enable:c,assignEvents:Ci})};class Ko{constructor(t,n){this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(t,n,a){return this._calculateTransform(t,n,a)}touchmove(t,n,a){if(this._active&&!(a.length<this.minTouchs()))return t.preventDefault(),this._calculateTransform(t,n,a)}touchend(t,n,a){this._calculateTransform(t,n,a),this._active&&a.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,a){a.length>0&&(this._active=!0);const l=Qn(a,n),d=new u.P(0,0),_=new u.P(0,0);let v=0;for(const C in l){const z=l[C],k=this._touches[C];k&&(d._add(z),_._add(z.sub(k)),v++,l[C]=z)}if(this._touches=l,v<this.minTouchs()||!_.mag())return;const b=_.div(v);return this._sum._add(b),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(v),panDelta:b}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,n,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,a){if(!this._firstTwoTouches)return;t.preventDefault();const[l,d]=this._firstTwoTouches,_=Ki(a,n,l),v=Ki(a,n,d);if(!_||!v)return;const b=this._aroundCenter?null:_.add(v).div(2);return this._move([_,v],b,t)}touchend(t,n,a){if(!this._firstTwoTouches)return;const[l,d]=this._firstTwoTouches,_=Ki(a,n,l),v=Ki(a,n,d);_&&v||(this._active&&se.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ki(c,t,n){for(let a=0;a<c.length;a++)if(c[a].identifier===n)return t[a]}function Rn(c,t){return Math.log(c/t)/Math.LN2}class Ma extends Yo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const a=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Rn(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Rn(this._distance,a),pinchAround:n}}}function Qo(c,t){return 180*c.angleWith(t)/Math.PI}class ea extends Yo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n,a){const l=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Qo(this._vector,l),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,a=Qo(t,this._startVector);return Math.abs(a)<n}}function al(c){return Math.abs(c.y)>Math.abs(c.x)}class Jl extends Yo{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,a){super.touchstart(t,n,a),this._currentTouchCount=a.length}_start(t){this._lastPoints=t,al(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,a){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const l=t[0].sub(this._lastPoints[0]),d=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(l,d,a.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(l.y+d.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,a){if(this._valid!==void 0)return this._valid;const l=t.mag()>=2,d=n.mag()>=2;if(!l&&!d)return;if(!l||!d)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const _=t.y>0==n.y>0;return al(t)&&al(n)&&_}}const Zc={panStep:100,bearingStep:15,pitchStep:10};class ta{constructor(t){this._tr=new Xt(t);const n=Zc;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,a=0,l=0,d=0,_=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?a=-1:(t.preventDefault(),d=-1);break;case 39:t.shiftKey?a=1:(t.preventDefault(),d=1);break;case 38:t.shiftKey?l=1:(t.preventDefault(),_=-1);break;case 40:t.shiftKey?l=-1:(t.preventDefault(),_=1);break;default:return}return this._rotationDisabled&&(a=0,l=0),{cameraAnimation:v=>{const b=this._tr;v.easeTo({duration:300,easeId:"keyboardHandler",easing:Wc,zoom:n?Math.round(b.zoom)+n*(t.shiftKey?2:1):b.zoom,bearing:b.bearing+a*this._bearingStep,pitch:b.pitch+l*this._pitchStep,offset:[-d*this._panStep,-_*this._panStep],center:b.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Wc(c){return c*(2-c)}const Kl=4.000244140625;class Yl{constructor(t,n){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=t,this._tr=new Xt(t),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!t[this._map.cooperativeGestures._bypassKey])return;let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const a=ve.now(),l=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,n!==0&&n%Kl==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":l>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(l*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=se.mousePos(this._map.getCanvas(),t),a=this._tr;this._around=n.y>a.transform.height/2-a.transform.getHorizon()?u.M.convert(this._aroundCenter?a.center:a.unproject(n)):u.M.convert(a.center),this._aroundPoint=a.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const v=this._type==="wheel"&&Math.abs(this._delta)>Kl?this._wheelZoomRate:this._defaultZoomRate;let b=2/(1+Math.exp(-Math.abs(this._delta*v)));this._delta<0&&b!==0&&(b=1/b);const C=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(C*b))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,a=this._startZoom,l=this._easing;let d,_=!1;if(this._type==="wheel"&&a&&l){const v=Math.min((ve.now()-this._lastWheelEventTime)/200,1),b=l(v);d=u.z.number(a,n,b),v<1?this._frameId||(this._frameId=!0):_=!0}else d=n,_=!0;return this._active=!0,_&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!_,zoomDelta:d-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=u.b8;if(this._prevEase){const a=this._prevEase,l=(ve.now()-a.start)/a.duration,d=a.easing(l+.01)-a.easing(l),_=.27/Math.sqrt(d*d+1e-4)*.01,v=Math.sqrt(.0729-_*_);n=u.b7(_,v,.25,1)}return this._prevEase={start:ve.now(),duration:t,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ql{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Hc{constructor(t){this._tr=new Xt(t),this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xc{constructor(){this._tap=new Jo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,n,a){if(!this._swipePoint)if(this._tapTime){const l=n[0],d=t.timeStamp-this._tapTime<500,_=this._tapPoint.dist(l)<30;d&&_?a.length>0&&(this._swipePoint=l,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(t,n,a)}touchmove(t,n,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const l=n[0],d=l.y-this._swipePoint.y;return this._swipePoint=l,t.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(t,n,a)}touchend(t,n,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const l=this._tap.touchend(t,n,a);l&&(this._tapTime=t.timeStamp,this._tapPoint=l)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ec{constructor(t,n,a){this._el=t,this._mousePan=n,this._touchPan=a}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Qa{constructor(t,n,a){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class tc{constructor(t,n,a,l){this._el=t,this._touchZoom=n,this._touchRotate=a,this._tapDragZoom=l,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class In{constructor(t,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=se.create("div","maplibregl-cooperative-gesture-screen",t);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const a=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),l=document.createElement("div");l.className="maplibregl-desktop-message",l.textContent=n,this._container.appendChild(l);const d=document.createElement("div");d.className="maplibregl-mobile-message",d.textContent=a,this._container.appendChild(d),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(se.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(t){this._onCooperativeGesture(t.touches.length===1)}wheel(t){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!t[this._bypassKey])}_onCooperativeGesture(t){this._enabled&&t&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const hn=c=>c.zoom||c.drag||c.pitch||c.rotate;class Jc extends u.k{}function Cn(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class zs{constructor(t,n){this.handleWindowEvent=l=>{this.handleEvent(l,`${l.type}Window`)},this.handleEvent=(l,d)=>{if(l.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const _=l.type==="renderFrame"?void 0:l,v={needsRenderFrame:!1},b={},C={},z=l.touches,k=z?this._getMapTouches(z):void 0,j=k?se.touchPos(this._map.getCanvas(),k):se.mousePos(this._map.getCanvas(),l);for(const{handlerName:Y,handler:W,allowed:ee}of this._handlers){if(!W.isEnabled())continue;let ce;this._blockedByActive(C,ee,Y)?W.reset():W[d||l.type]&&(ce=W[d||l.type](l,j,k),this.mergeHandlerResult(v,b,ce,Y,_),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()),(ce||W.isActive())&&(C[Y]=W)}const U={};for(const Y in this._previousActiveHandlers)C[Y]||(U[Y]=_);this._previousActiveHandlers=C,(Object.keys(U).length||Cn(v))&&(this._changes.push([v,b,U]),this._triggerRenderFrame()),(Object.keys(C).length||Cn(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=v;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new cn(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[l,d,_]of this._listeners)se.addEventListener(l,d,l===document?this.handleWindowEvent:this.handleEvent,_)}destroy(){for(const[t,n,a]of this._listeners)se.removeEventListener(t,n,t===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(t){const n=this._map,a=n.getCanvasContainer();this._add("mapEvent",new ks(n,t));const l=n.boxZoom=new Ut(n,t);this._add("boxZoom",l),t.interactive&&t.boxZoom&&l.enable();const d=n.cooperativeGestures=new In(n,t.cooperativeGestures);this._add("cooperativeGestures",d),t.cooperativeGestures&&d.enable();const _=new yi(n),v=new Hc(n);n.doubleClickZoom=new Ql(v,_),this._add("tapZoom",_),this._add("clickZoom",v),t.interactive&&t.doubleClickZoom&&n.doubleClickZoom.enable();const b=new Xc;this._add("tapDragZoom",b);const C=n.touchPitch=new Jl(n);this._add("touchPitch",C),t.interactive&&t.touchPitch&&n.touchPitch.enable(t.touchPitch);const z=Wr(t),k=Pa(t);n.dragRotate=new Qa(t,z,k),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]),t.interactive&&t.dragRotate&&n.dragRotate.enable();const j=(({enable:ce,clickTolerance:J})=>{const he=new to({checkCorrectEvent:ye=>se.mouseButton(ye)===0&&!ye.ctrlKey});return new _i({clickTolerance:J,move:(ye,we)=>({around:we,panDelta:we.sub(ye)}),activateOnStart:!0,moveStateManager:he,enable:ce,assignEvents:Ci})})(t),U=new Ko(t,n);n.dragPan=new ec(a,j,U),this._add("mousePan",j),this._add("touchPan",U,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&n.dragPan.enable(t.dragPan);const G=new ea,Y=new Ma;n.touchZoomRotate=new tc(a,Y,G,b),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&n.touchZoomRotate.enable(t.touchZoomRotate);const W=n.scrollZoom=new Yl(n,()=>this._triggerRenderFrame());this._add("scrollZoom",W,["mousePan"]),t.interactive&&t.scrollZoom&&n.scrollZoom.enable(t.scrollZoom);const ee=n.keyboard=new ta(n);this._add("keyboard",ee),t.interactive&&t.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Xl(n))}_add(t,n,a){this._handlers.push({handlerName:t,handler:n,allowed:a}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!hn(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,n,a){for(const l in t)if(l!==a&&(!n||n.indexOf(l)<0))return!0;return!1}_getMapTouches(t){const n=[];for(const a of t)this._el.contains(a.target)&&n.push(a);return n}mergeHandlerResult(t,n,a,l,d){if(!a)return;u.e(t,a);const _={handlerName:l,originalEvent:a.originalEvent||d};a.zoomDelta!==void 0&&(n.zoom=_),a.panDelta!==void 0&&(n.drag=_),a.pitchDelta!==void 0&&(n.pitch=_),a.bearingDelta!==void 0&&(n.rotate=_)}_applyChanges(){const t={},n={},a={};for(const[l,d,_]of this._changes)l.panDelta&&(t.panDelta=(t.panDelta||new u.P(0,0))._add(l.panDelta)),l.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+l.zoomDelta),l.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+l.bearingDelta),l.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+l.pitchDelta),l.around!==void 0&&(t.around=l.around),l.pinchAround!==void 0&&(t.pinchAround=l.pinchAround),l.noInertia&&(t.noInertia=l.noInertia),u.e(n,d),u.e(a,_);this._updateMapTransform(t,n,a),this._changes=[]}_updateMapTransform(t,n,a){const l=this._map,d=l._getTransformForUpdate(),_=l.terrain;if(!(Cn(t)||_&&this._terrainMovement))return this._fireEvents(n,a,!0);let{panDelta:v,zoomDelta:b,bearingDelta:C,pitchDelta:z,around:k,pinchAround:j}=t;j!==void 0&&(k=j),l._stop(!0),k=k||l.transform.centerPoint;const U=d.pointLocation(v?k.sub(v):k);C&&(d.bearing+=C),z&&(d.pitch+=z),b&&(d.zoom+=b),_?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?d.center=d.pointLocation(d.centerPoint.sub(v)):d.setLocationAtPoint(U,k):(this._terrainMovement=!0,this._map._elevationFreeze=!0,d.setLocationAtPoint(U,k)):d.setLocationAtPoint(U,k),l._applyUpdatedTransform(d),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,a,!0)}_fireEvents(t,n,a){const l=hn(this._eventsInProgress),d=hn(t),_={};for(const k in t){const{originalEvent:j}=t[k];this._eventsInProgress[k]||(_[`${k}start`]=j),this._eventsInProgress[k]=t[k]}!l&&d&&this._fireEvent("movestart",d.originalEvent);for(const k in _)this._fireEvent(k,_[k]);d&&this._fireEvent("move",d.originalEvent);for(const k in t){const{originalEvent:j}=t[k];this._fireEvent(k,j)}const v={};let b;for(const k in this._eventsInProgress){const{handlerName:j,originalEvent:U}=this._eventsInProgress[k];this._handlersById[j].isActive()||(delete this._eventsInProgress[k],b=n[j]||U,v[`${k}end`]=b)}for(const k in v)this._fireEvent(k,v[k]);const C=hn(this._eventsInProgress),z=(l||d)&&!C;if(z&&this._terrainMovement&&(this._map._elevationFreeze=!1,this._terrainMovement=!1,this._map.transform.recalculateZoom(this._map.terrain)),a&&z){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;!k||!k.essential&&ve.prefersReducedMotion?(this._map.fire(new u.k("moveend",{originalEvent:b})),j(this._map.getBearing())&&this._map.resetNorth()):(j(k.bearing||this._map.getBearing())&&(k.bearing=0),k.freezeElevation=!0,this._map.easeTo(k,{originalEvent:b})),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new u.k(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Jc("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ph extends u.E{constructor(t,n){super(),this._renderFrameCallback=()=>{const a=Math.min((ve.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new u.M(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,a){return t=u.P.convert(t).mult(-1),this.panTo(this.transform.center,u.e({offset:t},n),a)}panTo(t,n,a){return this.easeTo(u.e({center:t},n),a)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,a){return this.easeTo(u.e({zoom:t},n),a)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,a){return this.easeTo(u.e({bearing:t},n),a)}resetNorth(t,n){return this.rotateTo(0,u.e({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(u.e({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=vr.convert(t);const a=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),a,n)}_cameraForBoxAndBearing(t,n,a,l){const d={top:0,bottom:0,right:0,left:0};if(typeof(l=u.e({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=="number"){const Be=l.padding;l.padding={top:Be,bottom:Be,right:Be,left:Be}}l.padding=u.e(d,l.padding);const _=this.transform,v=_.padding,b=new vr(t,n),C=_.project(b.getNorthWest()),z=_.project(b.getNorthEast()),k=_.project(b.getSouthEast()),j=_.project(b.getSouthWest()),U=u.b9(-a),G=C.rotate(U),Y=z.rotate(U),W=k.rotate(U),ee=j.rotate(U),ce=new u.P(Math.max(G.x,Y.x,ee.x,W.x),Math.max(G.y,Y.y,ee.y,W.y)),J=new u.P(Math.min(G.x,Y.x,ee.x,W.x),Math.min(G.y,Y.y,ee.y,W.y)),he=ce.sub(J),ye=(_.width-(v.left+v.right+l.padding.left+l.padding.right))/he.x,we=(_.height-(v.top+v.bottom+l.padding.top+l.padding.bottom))/he.y;if(we<0||ye<0)return void u.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ce=Math.min(_.scaleZoom(_.scale*Math.min(ye,we)),l.maxZoom),De=u.P.convert(l.offset),Qe=new u.P((l.padding.left-l.padding.right)/2,(l.padding.top-l.padding.bottom)/2).rotate(u.b9(a)),et=De.add(Qe).mult(_.scale/_.zoomScale(Ce));return{center:_.unproject(C.add(k).div(2).sub(et)),zoom:Ce,bearing:a}}fitBounds(t,n,a){return this._fitInternal(this.cameraForBounds(t,n),n,a)}fitScreenCoordinates(t,n,a,l,d){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(u.P.convert(t)),this.transform.pointLocation(u.P.convert(n)),a,l),l,d)}_fitInternal(t,n,a){return t?(delete(n=u.e(t,n)).padding,n.linear?this.easeTo(n,a):this.flyTo(n,a)):this}jumpTo(t,n){this.stop();const a=this._getTransformForUpdate();let l=!1,d=!1,_=!1;return"zoom"in t&&a.zoom!==+t.zoom&&(l=!0,a.zoom=+t.zoom),t.center!==void 0&&(a.center=u.M.convert(t.center)),"bearing"in t&&a.bearing!==+t.bearing&&(d=!0,a.bearing=+t.bearing),"pitch"in t&&a.pitch!==+t.pitch&&(_=!0,a.pitch=+t.pitch),t.padding==null||a.isPaddingEqual(t.padding)||(a.padding=t.padding),this._applyUpdatedTransform(a),this.fire(new u.k("movestart",n)).fire(new u.k("move",n)),l&&this.fire(new u.k("zoomstart",n)).fire(new u.k("zoom",n)).fire(new u.k("zoomend",n)),d&&this.fire(new u.k("rotatestart",n)).fire(new u.k("rotate",n)).fire(new u.k("rotateend",n)),_&&this.fire(new u.k("pitchstart",n)).fire(new u.k("pitch",n)).fire(new u.k("pitchend",n)),this.fire(new u.k("moveend",n))}calculateCameraOptionsFromTo(t,n,a,l=0){const d=u.Y.fromLngLat(t,n),_=u.Y.fromLngLat(a,l),v=_.x-d.x,b=_.y-d.y,C=_.z-d.z,z=Math.hypot(v,b,C);if(z===0)throw new Error("Can't calculate camera options with same From and To");const k=Math.hypot(v,b),j=this.transform.scaleZoom(this.transform.cameraToCenterDistance/z/this.transform.tileSize),U=180*Math.atan2(v,-b)/Math.PI;let G=180*Math.acos(k/z)/Math.PI;return G=C<0?90-G:90+G,{center:_.toLngLat(),zoom:j,pitch:G,bearing:U}}easeTo(t,n){var a;this._stop(!1,t.easeId),((t=u.e({offset:[0,0],duration:500,easing:u.b8},t)).animate===!1||!t.essential&&ve.prefersReducedMotion)&&(t.duration=0);const l=this._getTransformForUpdate(),d=this.getZoom(),_=this.getBearing(),v=this.getPitch(),b=this.getPadding(),C="bearing"in t?this._normalizeBearing(t.bearing,_):_,z="pitch"in t?+t.pitch:v,k="padding"in t?t.padding:l.padding,j=u.P.convert(t.offset);let U=l.centerPoint.add(j);const G=l.pointLocation(U),{center:Y,zoom:W}=l.getConstrained(u.M.convert(t.center||G),(a=t.zoom)!==null&&a!==void 0?a:d);this._normalizeCenter(Y);const ee=l.project(G),ce=l.project(Y).sub(ee),J=l.zoomScale(W-d);let he,ye;t.around&&(he=u.M.convert(t.around),ye=l.locationPoint(he));const we={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||W!==d,this._rotating=this._rotating||_!==C,this._pitching=this._pitching||z!==v,this._padding=!l.isPaddingEqual(k),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,we),this.terrain&&this._prepareElevation(Y),this._ease(Ce=>{if(this._zooming&&(l.zoom=u.z.number(d,W,Ce)),this._rotating&&(l.bearing=u.z.number(_,C,Ce)),this._pitching&&(l.pitch=u.z.number(v,z,Ce)),this._padding&&(l.interpolatePadding(b,k,Ce),U=l.centerPoint.add(j)),this.terrain&&!t.freezeElevation&&this._updateElevation(Ce),he)l.setLocationAtPoint(he,ye);else{const De=l.zoomScale(l.zoom-d),Qe=W>d?Math.min(2,J):Math.max(.5,J),et=Math.pow(Qe,1-Ce),Be=l.unproject(ee.add(ce.mult(Ce*et)).mult(De));l.setLocationAtPoint(l.renderWorldCopies?Be.wrap():Be,U)}this._applyUpdatedTransform(l),this._fireMoveEvents(n)},Ce=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(n,Ce)},t),this}_prepareEase(t,n,a={}){this._moving=!0,n||a.moving||this.fire(new u.k("movestart",t)),this._zooming&&!a.zooming&&this.fire(new u.k("zoomstart",t)),this._rotating&&!a.rotating&&this.fire(new u.k("rotatestart",t)),this._pitching&&!a.pitching&&this.fire(new u.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&n!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(a-(n-(a*t+this._elevationStart))/(1-t)),this._elevationTarget=n}this.transform.elevation=u.z.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const n=t.clone(),{center:a,zoom:l,pitch:d,bearing:_,elevation:v}=this.transformCameraUpdate(n);a&&(n.center=a),l!==void 0&&(n.zoom=l),d!==void 0&&(n.pitch=d),_!==void 0&&(n.bearing=_),v!==void 0&&(n.elevation=v),this.transform.apply(n)}_fireMoveEvents(t){this.fire(new u.k("move",t)),this._zooming&&this.fire(new u.k("zoom",t)),this._rotating&&this.fire(new u.k("rotate",t)),this._pitching&&this.fire(new u.k("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const a=this._zooming,l=this._rotating,d=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new u.k("zoomend",t)),l&&this.fire(new u.k("rotateend",t)),d&&this.fire(new u.k("pitchend",t)),this.fire(new u.k("moveend",t))}flyTo(t,n){var a;if(!t.essential&&ve.prefersReducedMotion){const He=u.L(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(He,n)}this.stop(),t=u.e({offset:[0,0],speed:1.2,curve:1.42,easing:u.b8},t);const l=this._getTransformForUpdate(),d=this.getZoom(),_=this.getBearing(),v=this.getPitch(),b=this.getPadding(),C="bearing"in t?this._normalizeBearing(t.bearing,_):_,z="pitch"in t?+t.pitch:v,k="padding"in t?t.padding:l.padding,j=u.P.convert(t.offset);let U=l.centerPoint.add(j);const G=l.pointLocation(U),{center:Y,zoom:W}=l.getConstrained(u.M.convert(t.center||G),(a=t.zoom)!==null&&a!==void 0?a:d);this._normalizeCenter(Y);const ee=l.zoomScale(W-d),ce=l.project(G),J=l.project(Y).sub(ce);let he=t.curve;const ye=Math.max(l.width,l.height),we=ye/ee,Ce=J.mag();if("minZoom"in t){const He=u.ac(Math.min(t.minZoom,d,W),l.minZoom,l.maxZoom),wt=ye/l.zoomScale(He-d);he=Math.sqrt(wt/Ce*2)}const De=he*he;function Qe(He){const wt=(we*we-ye*ye+(He?-1:1)*De*De*Ce*Ce)/(2*(He?we:ye)*De*Ce);return Math.log(Math.sqrt(wt*wt+1)-wt)}function et(He){return(Math.exp(He)-Math.exp(-He))/2}function Be(He){return(Math.exp(He)+Math.exp(-He))/2}const je=Qe(!1);let at=function(He){return Be(je)/Be(je+he*He)},Tt=function(He){return ye*((Be(je)*(et(wt=je+he*He)/Be(wt))-et(je))/De)/Ce;var wt},Ue=(Qe(!0)-je)/he;if(Math.abs(Ce)<1e-6||!isFinite(Ue)){if(Math.abs(ye-we)<1e-6)return this.easeTo(t,n);const He=we<ye?-1:1;Ue=Math.abs(Math.log(we/ye))/he,Tt=()=>0,at=wt=>Math.exp(He*he*wt)}return t.duration="duration"in t?+t.duration:1e3*Ue/("screenSpeed"in t?+t.screenSpeed/he:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=_!==C,this._pitching=z!==v,this._padding=!l.isPaddingEqual(k),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(Y),this._ease(He=>{const wt=He*Ue,Sr=1/at(wt);l.zoom=He===1?W:d+l.scaleZoom(Sr),this._rotating&&(l.bearing=u.z.number(_,C,He)),this._pitching&&(l.pitch=u.z.number(v,z,He)),this._padding&&(l.interpolatePadding(b,k,He),U=l.centerPoint.add(j)),this.terrain&&!t.freezeElevation&&this._updateElevation(He);const Dt=He===1?Y:l.unproject(ce.add(J.mult(Tt(wt))).mult(Sr));l.setLocationAtPoint(l.renderWorldCopies?Dt.wrap():Dt,U),this._applyUpdatedTransform(l),this._fireMoveEvents(n)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){var a;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const l=this._onEaseEnd;delete this._onEaseEnd,l.call(this,n)}return t||(a=this.handlers)===null||a===void 0||a.stop(!1),this}_ease(t,n,a){a.animate===!1||a.duration===0?(t(1),n()):(this._easeStart=ve.now(),this._easeOptions=a,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,n){t=u.b2(t,-180,180);const a=Math.abs(t-n);return Math.abs(t-360-n)<a&&(t-=360),Math.abs(t+360-n)<a&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(!n.renderWorldCopies||n.lngRange)return;const a=t.lng-n.center.lng;t.lng+=a>180?-360:a<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(u.M.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const Kc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Yc{constructor(t=Kc){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=se.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=se.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=se.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){se.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const a=this._map._getUIString(`AttributionControl.${n}`);t.title=a,t.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(l=>typeof l!="string"?"":l)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const l=this._map.style.stylesheet;this.styleOwner=l.owner,this.styleId=l.id}const n=this._map.style.sourceCaches;for(const l in n){const d=n[l];if(d.used||d.usedForTerrain){const _=d.getSource();_.attribution&&t.indexOf(_.attribution)<0&&t.push(_.attribution)}}t=t.filter(l=>String(l).trim()),t.sort((l,d)=>l.length-d.length),t=t.filter((l,d)=>{for(let _=d+1;_<t.length;_++)if(t[_].indexOf(l)>=0)return!1;return!0});const a=t.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class rc{constructor(t={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=se.create("div","maplibregl-ctrl");const n=se.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){se.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ds{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,a=n?this._queue.concat(n):this._queue;for(const l of a)if(l.id===t)return void(l.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const a of n)if(!a.cancelled&&(a.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ra=u.X([{name:"a_pos3d",type:"Int16",components:3}]);class rt extends u.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,n){this.sourceCache.update(t,n),this._renderableTilesKeys=[];const a={};for(const l of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))a[l.key]=!0,this._renderableTilesKeys.push(l.key),this._tiles[l.key]||(l.posMatrix=new Float64Array(16),u.aO(l.posMatrix,0,u.W,0,u.W,0,1),this._tiles[l.key]=new Jr(l,this.tileSize));for(const l in this._tiles)a[l]||delete this._tiles[l]}freeRtt(t){for(const n in this._tiles){const a=this._tiles[n];(!t||a.tileID.equals(t)||a.tileID.isChildOf(t)||t.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const n={};for(const a of this._renderableTilesKeys){const l=this._tiles[a].tileID;if(l.canonical.equals(t.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16),u.aO(d.posMatrix,0,u.W,0,u.W,0,1),n[a]=d}else if(l.canonical.isChildOf(t.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16);const _=l.canonical.z-t.canonical.z,v=l.canonical.x-(l.canonical.x>>_<<_),b=l.canonical.y-(l.canonical.y>>_<<_),C=u.W>>_;u.aO(d.posMatrix,0,C,0,C,0,1),u.H(d.posMatrix,d.posMatrix,[-v*C,-b*C,0]),n[a]=d}else if(t.canonical.isChildOf(l.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16);const _=t.canonical.z-l.canonical.z,v=t.canonical.x-(t.canonical.x>>_<<_),b=t.canonical.y-(t.canonical.y>>_<<_),C=u.W>>_;u.aO(d.posMatrix,0,u.W,0,u.W,0,1),u.H(d.posMatrix,d.posMatrix,[v*C,b*C,0]),u.J(d.posMatrix,d.posMatrix,[1/2**_,1/2**_,0]),n[a]=d}}return n}getSourceTile(t,n){const a=this.sourceCache._source;let l=t.overscaledZ-this.deltaZoom;if(l>a.maxzoom&&(l=a.maxzoom),l<a.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(l).key);let d=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!d||!d.dem)&&n)for(;l>=a.minzoom&&(!d||!d.dem);)d=this.sourceCache.getTileByID(t.scaledTo(l--).key);return d}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=t)}}class Qc{constructor(t,n,a){this.painter=t,this.sourceCache=new rt(n),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,n,a,l=u.W){var d;if(!(n>=0&&n<l&&a>=0&&a<l))return 0;const _=this.getTerrainData(t),v=(d=_.tile)===null||d===void 0?void 0:d.dem;if(!v)return 0;const b=function(G,Y,W){var ee=Y[0],ce=Y[1];return G[0]=W[0]*ee+W[4]*ce+W[12],G[1]=W[1]*ee+W[5]*ce+W[13],G}([],[n/l*u.W,a/l*u.W],_.u_terrain_matrix),C=[b[0]*v.dim,b[1]*v.dim],z=Math.floor(C[0]),k=Math.floor(C[1]),j=C[0]-z,U=C[1]-k;return v.get(z,k)*(1-j)*(1-U)+v.get(z+1,k)*j*(1-U)+v.get(z,k+1)*(1-j)*U+v.get(z+1,k+1)*j*U}getElevationForLngLatZoom(t,n){const{tileID:a,mercatorX:l,mercatorY:d}=this._getOverscaledTileIDFromLngLatZoom(t,n);return this.getElevation(a,l%u.W,d%u.W,u.W)}getElevation(t,n,a,l=u.W){return this.getDEMElevation(t,n,a,l)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const l=this.painter.context,d=new u.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ft(l,d,l.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ft(l,new u.R({width:1,height:1}),l.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.an([])}const n=this.sourceCache.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const l=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new Ft(l,n.dem.getPixels(),l.gl.RGBA,{premultiply:!1}),n.demTexture.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const a=n&&n+n.tileID.key+t.key;if(a&&!this._demMatrixCache[a]){const l=this.sourceCache.sourceCache._source.maxzoom;let d=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=l?d=t.canonical.z-l:u.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const _=t.canonical.x-(t.canonical.x>>d<<d),v=t.canonical.y-(t.canonical.y>>d<<d),b=u.ba(new Float64Array(16),[1/(u.W<<d),1/(u.W<<d),0]);u.H(b,b,[_*u.W,v*u.W,0]),this._demMatrixCache[t.key]={matrix:b,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(t){const n=this.painter,a=n.width/devicePixelRatio,l=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===l||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ft(n.context,{width:a,height:l,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ft(n.context,{width:a,height:l,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(a,l,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,a,l))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let d=0,_=0;d<this._coordsTextureSize;d++)for(let v=0;v<this._coordsTextureSize;v++,_+=4)n[_+0]=255&v,n[_+1]=255&d,n[_+2]=v>>8<<4|d>>8,n[_+3]=0;const a=new u.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),l=new Ft(t,a,t.gl.RGBA,{premultiply:!1});return l.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=l,l}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),a=this.painter.context,l=a.gl,d=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),_=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),v=Math.round(this.painter.height/devicePixelRatio);a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),l.readPixels(d,v-_-1,1,1,l.RGBA,l.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null);const b=n[0]+(n[2]>>4<<8),C=n[1]+((15&n[2])<<8),z=this.coordsIndex[255-n[3]],k=z&&this.sourceCache.getTileByID(z);if(!k)return null;const j=this._coordsTextureSize,U=(1<<k.tileID.canonical.z)*j;return new u.Y((k.tileID.canonical.x*j+b)/U+k.tileID.wrap,(k.tileID.canonical.y*j+C)/U,this.getElevation(k.tileID,b,C,j))}depthAtPoint(t){const n=new Uint8Array(4),a=this.painter.context,l=a.gl;return a.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),l.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,l.RGBA,l.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,n=new u.bb,a=new u.aY,l=this.meshSize,d=u.W/l,_=l*l;for(let k=0;k<=l;k++)for(let j=0;j<=l;j++)n.emplaceBack(j*d,k*d,0);for(let k=0;k<_;k+=l+1)for(let j=0;j<l;j++)a.emplaceBack(j+k,l+j+k+1,l+j+k+2),a.emplaceBack(j+k,l+j+k+2,j+k+1);const v=n.length,b=v+2*(l+1);for(const k of[0,1])for(let j=0;j<=l;j++)for(const U of[0,1])n.emplaceBack(j*d,k*u.W,U);for(let k=0;k<2*l;k+=2)a.emplaceBack(b+k,b+k+1,b+k+3),a.emplaceBack(b+k,b+k+3,b+k+2),a.emplaceBack(v+k,v+k+3,v+k+1),a.emplaceBack(v+k,v+k+2,v+k+3);const C=n.length,z=C+2*(l+1);for(const k of[0,1])for(let j=0;j<=l;j++)for(const U of[0,1])n.emplaceBack(k*u.W,j*d,U);for(let k=0;k<2*l;k+=2)a.emplaceBack(C+k,C+k+1,C+k+3),a.emplaceBack(C+k,C+k+3,C+k+2),a.emplaceBack(z+k,z+k+3,z+k+1),a.emplaceBack(z+k,z+k+2,z+k+3);return this._mesh={indexBuffer:t.createIndexBuffer(a),vertexBuffer:t.createVertexBuffer(n,ra.members),segments:u.$.simpleSegment(0,0,n.length,a.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*u.bc/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,n){var a;const{tileID:l}=this._getOverscaledTileIDFromLngLatZoom(t,n);return(a=this.getMinMaxElevation(l).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,a={minElevation:null,maxElevation:null};return n&&n.dem&&(a.minElevation=n.dem.min*this.exaggeration,a.maxElevation=n.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(t,n){const a=u.Y.fromLngLat(t.wrap()),l=(1<<n)*u.W,d=a.x*l,_=a.y*l,v=Math.floor(d/u.W),b=Math.floor(_/u.W);return{tileID:new u.Q(n,0,n,v,b),mercatorX:d,mercatorY:_}}}class Fs{constructor(t,n,a){this._context=t,this._size=n,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new Ft(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(a.texture),{id:t,fbo:n,texture:a,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>t.id!==n),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const ro={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class eu{constructor(t,n){this.painter=t,this.terrain=n,this.pool=new Fs(t.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(a=>!t._layers[a].isHidden(n)),this._coordsDescendingInv={};for(const a in t.sourceCaches){this._coordsDescendingInv[a]={};const l=t.sourceCaches[a].getVisibleCoordinates();for(const d of l){const _=this.terrain.sourceCache.getTerrainCoords(d);for(const v in _)this._coordsDescendingInv[a][v]||(this._coordsDescendingInv[a][v]=[]),this._coordsDescendingInv[a][v].push(_[v])}}this._coordsDescendingInvStr={};for(const a of t._order){const l=t._layers[a],d=l.source;if(ro[l.type]&&!this._coordsDescendingInvStr[d]){this._coordsDescendingInvStr[d]={};for(const _ in this._coordsDescendingInv[d])this._coordsDescendingInvStr[d][_]=this._coordsDescendingInv[d][_].map(v=>v.key).sort().join()}}for(const a of this._renderableTiles)for(const l in this._coordsDescendingInvStr){const d=this._coordsDescendingInvStr[l][a.tileID.key];d&&d!==a.rttCoords[l]&&(a.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const n=t.type,a=this.painter,l=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(ro[n]&&(this._prevType&&ro[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(t.id),!l))return!0;if(ro[this._prevType]||ro[n]&&l){this._prevType=n;const d=this._stacks.length-1,_=this._stacks[d]||[];for(const v of this._renderableTiles){if(this.pool.isFull()&&(me(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(v),v.rtt[d]){const C=this.pool.getObjectForId(v.rtt[d].id);if(C.stamp===v.rtt[d].stamp){this.pool.useObject(C);continue}}const b=this.pool.getOrCreateFreeObject();this.pool.useObject(b),this.pool.stampObject(b),v.rtt[d]={id:b.id,stamp:b.stamp},a.context.bindFramebuffer.set(b.fbo.framebuffer),a.context.clear({color:u.aP.transparent,stencil:0}),a.currentStencilSource=void 0;for(let C=0;C<_.length;C++){const z=a.style._layers[_[C]],k=z.source?this._coordsDescendingInv[z.source][v.tileID.key]:[v.tileID];a.context.viewport.set([0,0,b.fbo.width,b.fbo.height]),a._renderTileClippingMasks(z,k),a.renderLayer(a,a.style.sourceCaches[z.source],z,k),z.source&&(v.rttCoords[z.source]=this._coordsDescendingInvStr[z.source][v.tileID.key])}}return me(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ro[n]}return!1}}const Ke={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},ic=le,fh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Kc,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:u.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},tu=c=>{c.touchstart=c.dragStart,c.touchmoveWindow=c.dragMove,c.touchend=c.dragEnd},nc={showCompass:!0,showZoom:!0,visualizePitch:!1};class ru{constructor(t,n,a=!1){this.mousedown=_=>{this.startMouse(u.e({},_,{ctrlKey:!0,preventDefault:()=>_.preventDefault()}),se.mousePos(this.element,_)),se.addEventListener(window,"mousemove",this.mousemove),se.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.moveMouse(_,se.mousePos(this.element,_))},this.mouseup=_=>{this.mouseRotate.dragEnd(_),this.mousePitch&&this.mousePitch.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=se.touchPos(this.element,_.targetTouches)[0],this.startTouch(_,this._startPos),se.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),se.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=se.touchPos(this.element,_.targetTouches)[0],this.moveTouch(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const l=t.dragRotate._mouseRotate.getClickTolerance(),d=t.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=Wr({clickTolerance:l,enable:!0}),this.touchRotate=(({enable:_,clickTolerance:v,bearingDegreesPerPixelMoved:b=.8})=>{const C=new mr;return new _i({clickTolerance:v,move:(z,k)=>({bearingDelta:(k.x-z.x)*b}),moveStateManager:C,enable:_,assignEvents:tu})})({clickTolerance:l,enable:!0}),this.map=t,a&&(this.mousePitch=Pa({clickTolerance:d,enable:!0}),this.touchPitch=(({enable:_,clickTolerance:v,pitchDegreesPerPixelMoved:b=-.5})=>{const C=new mr;return new _i({clickTolerance:v,move:(z,k)=>({pitchDelta:(k.y-z.y)*b}),moveStateManager:C,enable:_,assignEvents:tu})})({clickTolerance:d,enable:!0})),se.addEventListener(n,"mousedown",this.mousedown),se.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),se.addEventListener(n,"touchcancel",this.reset)}startMouse(t,n){this.mouseRotate.dragStart(t,n),this.mousePitch&&this.mousePitch.dragStart(t,n),se.disableDrag()}startTouch(t,n){this.touchRotate.dragStart(t,n),this.touchPitch&&this.touchPitch.dragStart(t,n),se.disableDrag()}moveMouse(t,n){const a=this.map,{bearingDelta:l}=this.mouseRotate.dragMove(t,n)||{};if(l&&a.setBearing(a.getBearing()+l),this.mousePitch){const{pitchDelta:d}=this.mousePitch.dragMove(t,n)||{};d&&a.setPitch(a.getPitch()+d)}}moveTouch(t,n){const a=this.map,{bearingDelta:l}=this.touchRotate.dragMove(t,n)||{};if(l&&a.setBearing(a.getBearing()+l),this.touchPitch){const{pitchDelta:d}=this.touchPitch.dragMove(t,n)||{};d&&a.setPitch(a.getPitch()+d)}}off(){const t=this.element;se.removeEventListener(t,"mousedown",this.mousedown),se.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),se.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),se.removeEventListener(window,"touchend",this.touchend),se.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){se.enableDrag(),se.removeEventListener(window,"mousemove",this.mousemove),se.removeEventListener(window,"mouseup",this.mouseup),se.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),se.removeEventListener(window,"touchend",this.touchend)}}let ia;function iu(c,t,n){const a=new u.M(c.lng,c.lat);if(c=new u.M(c.lng,c.lat),t){const l=new u.M(c.lng-360,c.lat),d=new u.M(c.lng+360,c.lat),_=n.locationPoint(c).distSqr(t);n.locationPoint(l).distSqr(t)<_?c=l:n.locationPoint(d).distSqr(t)<_&&(c=d)}for(;Math.abs(c.lng-n.center.lng)>180;){const l=n.locationPoint(c);if(l.x>=0&&l.y>=0&&l.x<=n.width&&l.y<=n.height)break;c.lng>n.center.lng?c.lng-=360:c.lng+=360}return c.lng!==a.lng&&n.locationPoint(c).y>n.height/2-n.getHorizon()?c:a}const oc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function na(c,t,n){const a=c.classList;for(const l in oc)a.remove(`maplibregl-${n}-anchor-${l}`);a.add(`maplibregl-${n}-anchor-${t}`)}class _r extends u.E{constructor(t){if(super(),this._onKeyPress=n=>{const a=n.code,l=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&l!==32&&l!==13||this.togglePopup()},this._onMapClick=n=>{const a=n.originalEvent.target,l=this._element;this._popup&&(a===l||l.contains(a))&&this.togglePopup()},this._update=n=>{var a;if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();(n?.type==="terrain"||n?.type==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?iu(this._lngLat,this._flatPos,this._map.transform):(a=this._lngLat)===null||a===void 0?void 0:a.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_=`rotateX(${this._map.getPitch()}deg)`),n&&n.type!=="moveend"||(this._pos=this._pos.round()),se.setTransform(this._element,`${oc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${d}`),ve.frameAsync(new AbortController).then(()=>{this._updateOpacity(n&&n.type==="moveend")}).catch(()=>{})},this._onMove=n=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.k("dragstart"))),this.fire(new u.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=u.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=se.create("div"),this._element.setAttribute("aria-label","Map marker");const n=se.createNS("http://www.w3.org/2000/svg","svg"),a=41,l=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${a}px`),n.setAttributeNS(null,"width",`${l}px`),n.setAttributeNS(null,"viewBox",`0 0 ${l} ${a}`);const d=se.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"stroke","none"),d.setAttributeNS(null,"stroke-width","1"),d.setAttributeNS(null,"fill","none"),d.setAttributeNS(null,"fill-rule","evenodd");const _=se.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"fill-rule","nonzero");const v=se.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"transform","translate(3.0, 29.0)"),v.setAttributeNS(null,"fill","#000000");const b=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ee of b){const ce=se.createNS("http://www.w3.org/2000/svg","ellipse");ce.setAttributeNS(null,"opacity","0.04"),ce.setAttributeNS(null,"cx","10.5"),ce.setAttributeNS(null,"cy","5.80029008"),ce.setAttributeNS(null,"rx",ee.rx),ce.setAttributeNS(null,"ry",ee.ry),v.appendChild(ce)}const C=se.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const z=se.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(z);const k=se.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"opacity","0.25"),k.setAttributeNS(null,"fill","#000000");const j=se.createNS("http://www.w3.org/2000/svg","path");j.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),k.appendChild(j);const U=se.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(6.0, 7.0)"),U.setAttributeNS(null,"fill","#FFFFFF");const G=se.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Y=se.createNS("http://www.w3.org/2000/svg","circle");Y.setAttributeNS(null,"fill","#000000"),Y.setAttributeNS(null,"opacity","0.25"),Y.setAttributeNS(null,"cx","5.5"),Y.setAttributeNS(null,"cy","5.5"),Y.setAttributeNS(null,"r","5.4999962");const W=se.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#FFFFFF"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962"),G.appendChild(Y),G.appendChild(W),_.appendChild(v),_.appendChild(C),_.appendChild(k),_.appendChild(U),_.appendChild(G),n.appendChild(_),n.setAttributeNS(null,"height",a*this._scale+"px"),n.setAttributeNS(null,"width",l*this._scale+"px"),this._element.appendChild(n),this._offset=u.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),na(this._element,this._anchor,"marker"),t&&t.className)for(const n of t.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),se.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=u.M.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const l=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[l,-1*(38.1-13.5+l)],"bottom-right":[-l,-1*(38.1-13.5+l)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var n,a;if(!(!((n=this._map)===null||n===void 0)&&n.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const l=this._map,d=l.terrain.depthAtPoint(this._pos),_=l.terrain.getElevationForLngLatZoom(this._lngLat,l.transform.tileZoom);if(l.transform.lngLatToCameraDepth(this._lngLat,_)-d<.006)return void(this._element.style.opacity=this._opacity);const v=-this._offset.y/l.transform._pixelPerMeter,b=Math.sin(l.getPitch()*Math.PI/180)*v,C=l.terrain.depthAtPoint(new u.P(this._pos.x,this._pos.y-this._offset.y)),z=l.transform.lngLatToCameraDepth(this._lngLat,_+b)-C>.006;!((a=this._popup)===null||a===void 0)&&a.isOpen()&&z&&this._popup.remove(),this._element.style.opacity=z?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=u.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,n){return t===void 0&&n===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const sl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let es=0,ts=!1;const nu={maxWidth:100,unit:"metric"};function ac(c,t,n){const a=n&&n.maxWidth||100,l=c._container.clientHeight/2,d=c.unproject([0,l]),_=c.unproject([a,l]),v=d.distanceTo(_);if(n&&n.unit==="imperial"){const b=3.2808*v;b>5280?Ls(t,a,b/5280,c._getUIString("ScaleControl.Miles")):Ls(t,a,b,c._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Ls(t,a,v/1852,c._getUIString("ScaleControl.NauticalMiles")):v>=1e3?Ls(t,a,v/1e3,c._getUIString("ScaleControl.Kilometers")):Ls(t,a,v,c._getUIString("ScaleControl.Meters"))}function Ls(c,t,n,a){const l=function(d){const _=Math.pow(10,`${Math.floor(d)}`.length-1);let v=d/_;return v=v>=10?10:v>=5?5:v>=3?3:v>=2?2:v>=1?1:function(b){const C=Math.pow(10,Math.ceil(-Math.log(b)/Math.LN10));return Math.round(b*C)/C}(v),_*v}(n);c.style.width=t*(l/n)+"px",c.innerHTML=`${l}&nbsp;${a}`}const io={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},ll=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ht(c){if(c){if(typeof c=="number"){const t=Math.round(Math.abs(c)/Math.SQRT2);return{center:new u.P(0,0),top:new u.P(0,c),"top-left":new u.P(t,t),"top-right":new u.P(-t,t),bottom:new u.P(0,-c),"bottom-left":new u.P(t,-t),"bottom-right":new u.P(-t,-t),left:new u.P(c,0),right:new u.P(-c,0)}}if(c instanceof u.P||Array.isArray(c)){const t=u.P.convert(c);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:u.P.convert(c.center||[0,0]),top:u.P.convert(c.top||[0,0]),"top-left":u.P.convert(c["top-left"]||[0,0]),"top-right":u.P.convert(c["top-right"]||[0,0]),bottom:u.P.convert(c.bottom||[0,0]),"bottom-left":u.P.convert(c["bottom-left"]||[0,0]),"bottom-right":u.P.convert(c["bottom-right"]||[0,0]),left:u.P.convert(c.left||[0,0]),right:u.P.convert(c.right||[0,0])}}return ht(new u.P(0,0))}const _t=le;A.AJAXError=u.bf,A.Evented=u.E,A.LngLat=u.M,A.MercatorCoordinate=u.Y,A.Point=u.P,A.addProtocol=u.bg,A.config=u.a,A.removeProtocol=u.bh,A.AttributionControl=Yc,A.BoxZoomHandler=Ut,A.CanvasSource=Fo,A.CooperativeGesturesHandler=In,A.DoubleClickZoomHandler=Ql,A.DragPanHandler=ec,A.DragRotateHandler=Qa,A.EdgeInsets=ir,A.FullscreenControl=class extends u.E{constructor(c={}){super(),this._onFullscreenChange=()=>{var t;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=n?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:u.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){se.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const c=this._fullscreenButton=se.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);se.create("span","maplibregl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.title=c}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new u.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new u.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},A.GeoJSONSource=Kt,A.GeolocateControl=class extends u.E{constructor(c){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new u.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new u.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const n=new u.M(t.coords.longitude,t.coords.latitude),a=t.coords.accuracy,l=this._map.getBearing(),d=u.e({bearing:l},this.options.fitBoundsOptions),_=vr.fromLngLat(n,a);this._map.fitBounds(_,d,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const n=new u.M(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&ts)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new u.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=se.create("button","maplibregl-ctrl-geolocate",this._container),se.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){u.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=se.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new _r({element:this._dotElement}),this._circleElement=se.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new _r({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new u.k("trackuserlocationend")))})}},this.options=u.e({},sl,c)}onAdd(c){return this._map=c,this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return u._(this,arguments,void 0,function*(t=!1){if(ia!==void 0&&!t)return ia;if(window.navigator.permissions===void 0)return ia=!!window.navigator.geolocation,ia;try{ia=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ia=!!window.navigator.geolocation}return ia})}().then(t=>this._setupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),se.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,es=0,ts=!1}_isOutOfMapMaxBounds(c){const t=this._map.getMaxBounds(),n=c.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const c=this._map.getBounds(),t=c.getSouthEast(),n=c.getNorthEast(),a=t.distanceTo(n),l=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}trigger(){if(!this._setup)return u.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":es--,ts=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new u.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),es++,es>1?(c={maximumAge:6e5,timeout:0},ts=!0):(c=this.options.positionOptions,ts=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},A.Hash=Oi,A.ImageSource=Mn,A.KeyboardHandler=ta,A.LngLatBounds=vr,A.LogoControl=rc,A.Map=class extends ph{constructor(c){if(u.bd.mark(u.be.create),(c=u.e({},fh,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new wr(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),{bearingSnap:c.bearingSnap}),this._contextLost=t=>{t.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new u.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new u.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=c.collectResourceTiming,this._renderTaskQueue=new Ds,this._controls=[],this._mapId=u.a3(),this._locale=u.e({},Ke,c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this.transformCameraUpdate=c.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=c.cancelPendingTileRequestsWhileZooming,this._imageQueueHandle=bt.addThrottleControl(()=>this.isMoving()),this._requestManager=new Pt(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const n=Br(a=>{this._trackResize&&!this._removed&&this.resize(a)._update()},50);this._resizeObserver=new ResizeObserver(a=>{t?n(a):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new zs(this,c),this._hash=c.hash&&new Oi(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,u.e({},c.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new Yc(typeof c.attributionControl=="boolean"?void 0:c.attributionControl)),c.maplibreLogo&&this.addControl(new rc,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new u.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new u.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new u.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(c,t){if(t===void 0&&(t=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new u.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=c.onAdd(this);this._controls.push(c);const a=this._controlPositions[t];return t.indexOf("bottom")!==-1?a.insertBefore(n,a.firstChild):a.appendChild(n),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new u.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(c);return t>-1&&this._controls.splice(t,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}calculateCameraOptionsFromTo(c,t,n,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(c,t,n,a)}resize(c){var t;const n=this._containerDimensions(),a=n[0],l=n[1],d=this._getClampedPixelRatio(a,l);if(this._resizeCanvas(a,l,d),this.painter.resize(a,l,d),this.painter.overLimit()){const v=this.painter.context.gl;this._maxCanvasSize=[v.drawingBufferWidth,v.drawingBufferHeight];const b=this._getClampedPixelRatio(a,l);this._resizeCanvas(a,l,b),this.painter.resize(a,l,b)}this.transform.resize(a,l),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,l);const _=!this._moving;return _&&(this.stop(),this.fire(new u.k("movestart",c)).fire(new u.k("move",c))),this.fire(new u.k("resize",c)),_&&this.fire(new u.k("moveend",c)),this}_getClampedPixelRatio(c,t){const{0:n,1:a}=this._maxCanvasSize,l=this.getPixelRatio(),d=c*l,_=t*l;return Math.min(d>n?n/d:1,_>a?a/_:1)*l}getPixelRatio(){var c;return(c=this._overridePixelRatio)!==null&&c!==void 0?c:devicePixelRatio}setPixelRatio(c){this._overridePixelRatio=c,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(c){return this.transform.setMaxBounds(vr.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c&&this.setZoom(c),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c&&this.setZoom(c),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c&&this.setPitch(c),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c&&this.setPitch(c),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this._update()}project(c){return this.transform.locationPoint(u.M.convert(c),this.style&&this.terrain)}unproject(c){return this.transform.pointLocation(u.P.convert(c),this.terrain)}isMoving(){var c;return this._moving||((c=this.handlers)===null||c===void 0?void 0:c.isMoving())}isZooming(){var c;return this._zooming||((c=this.handlers)===null||c===void 0?void 0:c.isZooming())}isRotating(){var c;return this._rotating||((c=this.handlers)===null||c===void 0?void 0:c.isRotating())}_createDelegatedListener(c,t,n){if(c==="mouseenter"||c==="mouseover"){let a=!1;return{layer:t,listener:n,delegates:{mousemove:d=>{const _=this.getLayer(t)?this.queryRenderedFeatures(d.point,{layers:[t]}):[];_.length?a||(a=!0,n.call(this,new Or(c,this,d.originalEvent,{features:_}))):a=!1},mouseout:()=>{a=!1}}}}if(c==="mouseleave"||c==="mouseout"){let a=!1;return{layer:t,listener:n,delegates:{mousemove:_=>{(this.getLayer(t)?this.queryRenderedFeatures(_.point,{layers:[t]}):[]).length?a=!0:a&&(a=!1,n.call(this,new Or(c,this,_.originalEvent)))},mouseout:_=>{a&&(a=!1,n.call(this,new Or(c,this,_.originalEvent)))}}}}{const a=l=>{const d=this.getLayer(t)?this.queryRenderedFeatures(l.point,{layers:[t]}):[];d.length&&(l.features=d,n.call(this,l),delete l.features)};return{layer:t,listener:n,delegates:{[c]:a}}}}on(c,t,n){if(n===void 0)return super.on(c,t);const a=this._createDelegatedListener(c,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(a);for(const l in a.delegates)this.on(l,a.delegates[l]);return this}once(c,t,n){if(n===void 0)return super.once(c,t);const a=this._createDelegatedListener(c,t,n);for(const l in a.delegates)this.once(l,a.delegates[l]);return this}off(c,t,n){return n===void 0?super.off(c,t):(this._delegatedListeners&&this._delegatedListeners[c]&&(a=>{const l=this._delegatedListeners[c];for(let d=0;d<l.length;d++){const _=l[d];if(_.layer===t&&_.listener===n){for(const v in _.delegates)this.off(v,_.delegates[v]);return l.splice(d,1),this}}})(),this)}queryRenderedFeatures(c,t){if(!this.style)return[];let n;const a=c instanceof u.P||Array.isArray(c),l=a?c:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(a?{}:c)||{},l instanceof u.P||typeof l[0]=="number")n=[u.P.convert(l)];else{const d=u.P.convert(l[0]),_=u.P.convert(l[1]);n=[d,new u.P(_.x,d.y),_,new u.P(d.x,_.y),d]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(c,t){return this.style.querySourceFeatures(c,t)}setStyle(c,t){return(t=u.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&c?(this._diffStyle(c,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(c,t))}setTransformRequest(c){return this._requestManager.setTransformRequest(c),this}_getUIString(c){const t=this._locale[c];if(t==null)throw new Error(`Missing UI string '${c}'`);return t}_updateStyle(c,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(c,t));const n=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!c)),c?(this.style=new Oo(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c,t,n):this.style.loadJSON(c,t,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Oo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,t){if(typeof c=="string"){const n=this._requestManager.transformRequest(c,"Style");u.h(n,new AbortController).then(a=>{this._updateDiff(a.data,t)}).catch(a=>{a&&this.fire(new u.j(a))})}else typeof c=="object"&&this._updateDiff(c,t)}_updateDiff(c,t){try{this.style.setState(c,t)&&this._update(!0)}catch(n){u.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(c,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.w("There is no style added to the map.")}addSource(c,t){return this._lazyInitEmptyStyle(),this.style.addSource(c,t),this._update(!0)}isSourceLoaded(c){const t=this.style&&this.style.sourceCaches[c];if(t!==void 0)return t.loaded();this.fire(new u.j(new Error(`There is no source with ID '${c}'`)))}setTerrain(c){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),c){const t=this.style.sourceCaches[c.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${c.source}`);this.terrain===null&&t.reload();for(const n in this.style._layers){const a=this.style._layers[n];a.type==="hillshade"&&a.source===c.source&&u.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Qc(this.painter,t,c),this.painter.renderToTexture=new eu(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==c.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new u.k("terrain",{terrain:c})),this}getTerrain(){var c,t;return(t=(c=this.terrain)===null||c===void 0?void 0:c.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const c=this.style&&this.style.sourceCaches;for(const t in c){const n=c[t]._tiles;for(const a in n){const l=n[a];if(l.state!=="loaded"&&l.state!=="errored")return!1}}return!0}removeSource(c){return this.style.removeSource(c),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,t,n={}){const{pixelRatio:a=1,sdf:l=!1,stretchX:d,stretchY:_,content:v,textFitWidth:b,textFitHeight:C}=n;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||u.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:z,height:k,data:j}=t,U=t;return this.style.addImage(c,{data:new u.R({width:z,height:k},new Uint8Array(j)),pixelRatio:a,stretchX:d,stretchY:_,content:v,textFitWidth:b,textFitHeight:C,sdf:l,version:0,userImage:U}),U.onAdd&&U.onAdd(this,c),this}}{const{width:z,height:k,data:j}=ve.getImageData(t);this.style.addImage(c,{data:new u.R({width:z,height:k},j),pixelRatio:a,stretchX:d,stretchY:_,content:v,textFitWidth:b,textFitHeight:C,sdf:l,version:0})}}updateImage(c,t){const n=this.style.getImage(c);if(!n)return this.fire(new u.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=t instanceof HTMLImageElement||u.b(t)?ve.getImageData(t):t,{width:l,height:d,data:_}=a;if(l===void 0||d===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(l!==n.data.width||d!==n.data.height)return this.fire(new u.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const v=!(t instanceof HTMLImageElement||u.b(t));return n.data.replace(_,v),this.style.updateImage(c,n),this}getImage(c){return this.style.getImage(c)}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new u.j(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c){return bt.getImage(this._requestManager.transformRequest(c,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(c,t){return this._lazyInitEmptyStyle(),this.style.addLayer(c,t),this._update(!0)}moveLayer(c,t){return this.style.moveLayer(c,t),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(c,t,n){return this.style.setLayerZoomRange(c,t,n),this._update(!0)}setFilter(c,t,n={}){return this.style.setFilter(c,t,n),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,t,n,a={}){return this.style.setPaintProperty(c,t,n,a),this._update(!0)}getPaintProperty(c,t){return this.style.getPaintProperty(c,t)}setLayoutProperty(c,t,n,a={}){return this.style.setLayoutProperty(c,t,n,a),this._update(!0)}getLayoutProperty(c,t){return this.style.getLayoutProperty(c,t)}setGlyphs(c,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(c,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(c,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(c,t,n,a=>{a||this._update(!0)}),this}removeSprite(c){return this._lazyInitEmptyStyle(),this.style.removeSprite(c),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(c,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(c,t,n=>{n||this._update(!0)}),this}setLight(c,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(c,t){return this.style.setFeatureState(c,t),this._update()}removeFeatureState(c,t){return this.style.removeFeatureState(c,t),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let c=0,t=0;return this._container&&(c=this._container.clientWidth||400,t=this._container.clientHeight||300),[c,t]}_setupContainer(){const c=this._container;c.classList.add("maplibregl-map");const t=this._canvasContainer=se.create("div","maplibregl-canvas-container",c);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=se.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),a=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],a);const l=this._controlContainer=se.create("div","maplibregl-control-container",c),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{d[_]=se.create("div",`maplibregl-ctrl-${_} `,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,t,n){this._canvas.width=Math.floor(n*c),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const c={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{t={requestedAttributes:c},a&&(t.statusMessage=a.statusMessage,t.type=a.type)},{once:!0});const n=this._canvas.getContext("webgl2",c)||this._canvas.getContext("webgl",c);if(!n){const a="Failed to initialize WebGL";throw t?(t.message=a,new Error(JSON.stringify(t))):new Error(a)}this.painter=new xe(n,this.transform),Ge.testSupport(n)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_render(c){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(c),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const l=this.transform.zoom,d=ve.now();this.style.zoomHistory.update(l,d);const _=new u.a8(l,{now:d,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),v=_.crossFadingFactor();v===1&&v===this._crossFadingFactor||(n=!0,this._crossFadingFactor=v),this.style.update(_)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new u.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.bd.mark(u.be.load),this.fire(new u.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const a=this._sourcesDirty||this._styleDirty||this._placementDirty;return a||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.k("idle")),!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,u.bd.mark(u.be.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var c;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),bt.removeThrottleControl(this._imageQueueHandle),(c=this._resizeObserver)===null||c===void 0||c.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),se.remove(this._canvasContainer),se.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),u.bd.clearMetrics(),this._removed=!0,this.fire(new u.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ve.frameAsync(this._frameRequest).then(c=>{u.bd.frame(c),this._frameRequest=null,this._render(c)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get version(){return ic}getCameraTargetElevation(){return this.transform.elevation}},A.MapMouseEvent=Or,A.MapTouchEvent=un,A.MapWheelEvent=Ms,A.Marker=_r,A.NavigationControl=class{constructor(c){this._updateZoomButtons=()=>{const t=this._map.getZoom(),n=t===this._map.getMaxZoom(),a=t===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,n)=>{const a=this._map._getUIString(`NavigationControl.${n}`);t.title=a,t.setAttribute("aria-label",a)},this.options=u.e({},nc,c),this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),se.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),se.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=se.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ru(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){se.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(c,t){const n=se.create("button",c,this._container);return n.type="button",n.addEventListener("click",t),n}},A.Popup=class extends u.E{constructor(c){super(),this.remove=()=>(this._content&&se.remove(this._content),this._container&&(se.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new u.k("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var n;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=se.create("div","maplibregl-popup",this._map.getContainer()),this._tip=se.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const v of this.options.className.split(" "))this._container.classList.add(v);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?iu(this._lngLat,this._flatPos,this._map.transform):(n=this._lngLat)===null||n===void 0?void 0:n.wrap(),this._trackPointer&&!t)return;const a=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationPoint(this._lngLat));let l=this.options.anchor;const d=ht(this.options.offset);if(!l){const v=this._container.offsetWidth,b=this._container.offsetHeight;let C;C=a.y+d.bottom.y<b?["top"]:a.y>this._map.transform.height-b?["bottom"]:[],a.x<v/2?C.push("left"):a.x>this._map.transform.width-v/2&&C.push("right"),l=C.length===0?"bottom":C.join("-")}let _=a.add(d[l]);this.options.subpixelPositioning||(_=_.round()),se.setTransform(this._container,`${oc[l]} translate(${_.x}px,${_.y}px)`),na(this._container,l,"popup")},this._onClose=()=>{this.remove()},this.options=u.e(Object.create(io),c)}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new u.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=u.M.convert(c),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){const t=document.createDocumentFragment(),n=document.createElement("body");let a;for(n.innerHTML=c;a=n.firstChild,a;)t.appendChild(a);return this.setDOMContent(t)}getMaxWidth(){var c;return(c=this._container)===null||c===void 0?void 0:c.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=se.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(c){return this._container&&this._container.classList.add(c),this}removeClassName(c){return this._container&&this._container.classList.remove(c),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){if(this._container)return this._container.classList.toggle(c)}setSubpixelPositioning(c){this.options.subpixelPositioning=c}_createCloseButton(){this.options.closeButton&&(this._closeButton=se.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(ll);c&&c.focus()}},A.RasterDEMTileSource=fa,A.RasterTileSource=Pn,A.ScaleControl=class{constructor(c){this._onMove=()=>{ac(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,ac(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},nu),c)}getDefaultPosition(){return"bottom-left"}onAdd(c){return this._map=c,this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){se.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},A.ScrollZoomHandler=Yl,A.Style=Oo,A.TerrainControl=class{constructor(c){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=c}onAdd(c){return this._map=c,this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=se.create("button","maplibregl-ctrl-terrain",this._container),se.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){se.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},A.TwoFingersTouchPitchHandler=Jl,A.TwoFingersTouchRotateHandler=ea,A.TwoFingersTouchZoomHandler=Ma,A.TwoFingersTouchZoomRotateHandler=tc,A.VectorTileSource=be,A.VideoSource=Do,A.addSourceType=(c,t)=>u._(void 0,void 0,void 0,function*(){if(xn(c))throw new Error(`A source type called "${c}" already exists.`);((n,a)=>{kn[n]=a})(c,t)}),A.clearPrewarmedResources=function(){const c=ri;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(Xr),ri=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},A.getMaxParallelImageRequests=function(){return u.a.MAX_PARALLEL_IMAGE_REQUESTS},A.getRTLTextPluginStatus=function(){return ci().getRTLTextPluginStatus()},A.getVersion=function(){return _t},A.getWorkerCount=function(){return ur.workerCount},A.getWorkerUrl=function(){return u.a.WORKER_URL},A.importScriptInWorkers=function(c){return qr().broadcast("IS",c)},A.prewarm=function(){nn().acquire(Xr)},A.setMaxParallelImageRequests=function(c){u.a.MAX_PARALLEL_IMAGE_REQUESTS=c},A.setRTLTextPlugin=function(c,t){return ci().setRTLTextPlugin(c,t)},A.setWorkerCount=function(c){ur.workerCount=c},A.setWorkerUrl=function(c){u.a.WORKER_URL=c}});var V=I;return V})})(oy);var l0=oy.exports;const _m=ep(l0);var sy={exports:{}};(function(g,f){(function(I,M){g.exports=M()})(ja,function(){var I=function(y,S){var O={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},K={on:function(ae,fe,ze){if(O[ae]===void 0)throw new Error("Invalid event type: "+ae);O[ae].push({selector:fe,fn:ze})},render:function(ae){S.store.featureChanged(ae)}},ne=function(ae,fe){for(var ze=O[ae],Oe=ze.length;Oe--;){var We=ze[Oe];if(We.selector(fe)){We.fn.call(K,fe)||S.store.render(),S.ui.updateMapClasses();break}}};return y.start.call(K),{render:y.render,stop:function(){y.stop&&y.stop()},trash:function(){y.trash&&(y.trash(),S.store.render())},combineFeatures:function(){y.combineFeatures&&y.combineFeatures()},uncombineFeatures:function(){y.uncombineFeatures&&y.uncombineFeatures()},drag:function(ae){ne("drag",ae)},click:function(ae){ne("click",ae)},mousemove:function(ae){ne("mousemove",ae)},mousedown:function(ae){ne("mousedown",ae)},mouseup:function(ae){ne("mouseup",ae)},mouseout:function(ae){ne("mouseout",ae)},keydown:function(ae){ne("keydown",ae)},keyup:function(ae){ne("keyup",ae)},touchstart:function(ae){ne("touchstart",ae)},touchmove:function(ae){ne("touchmove",ae)},touchend:function(ae){ne("touchend",ae)},tap:function(ae){ne("tap",ae)}}};function M(y){return y&&y.__esModule&&Object.prototype.hasOwnProperty.call(y,"default")?y.default:y}function R(y){if(y.__esModule)return y;var S=y.default;if(typeof S=="function"){var O=function K(){if(this instanceof K){var ne=[null];ne.push.apply(ne,arguments);var ae=Function.bind.apply(S,ne);return new ae}return S.apply(this,arguments)};O.prototype=S.prototype}else O={};return Object.defineProperty(O,"__esModule",{value:!0}),Object.keys(y).forEach(function(K){var ne=Object.getOwnPropertyDescriptor(y,K);Object.defineProperty(O,K,ne.get?ne:{enumerable:!0,get:function(){return y[K]}})}),O}var V={},A={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},u=A;function le(y){var S=0;if(y&&y.length>0){S+=Math.abs(Ae(y[0]));for(var O=1;O<y.length;O++)S-=Math.abs(Ae(y[O]))}return S}function Ae(y){var S,O,K,ne,ae,fe,ze=0,Oe=y.length;if(Oe>2){for(fe=0;fe<Oe;fe++)fe===Oe-2?(K=Oe-2,ne=Oe-1,ae=0):fe===Oe-1?(K=Oe-1,ne=0,ae=1):(K=fe,ne=fe+1,ae=fe+2),S=y[K],O=y[ne],ze+=(Ne(y[ae][0])-Ne(S[0]))*Math.sin(Ne(O[1]));ze=ze*u.RADIUS*u.RADIUS/2}return ze}function Ne(y){return y*Math.PI/180}V.geometry=function y(S){var O,K=0;switch(S.type){case"Polygon":return le(S.coordinates);case"MultiPolygon":for(O=0;O<S.coordinates.length;O++)K+=le(S.coordinates[O]);return K;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(O=0;O<S.geometries.length;O++)K+=y(S.geometries[O]);return K}},V.ring=Ae;var ve={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},se={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},Ge={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},yt={POLYGON:"polygon",LINE:"line_string",POINT:"point"},Fe={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},ot={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},zt={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},tr={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},bt={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Pt={ACTIVE:"true",INACTIVE:"false"},Nt=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],tt=-85,Ot=Object.freeze({__proto__:null,classes:ve,sources:se,cursors:Ge,types:yt,geojsonTypes:Fe,modes:ot,events:zt,updateActions:tr,meta:bt,activeStates:Pt,interactions:Nt,LAT_MIN:-90,LAT_RENDERED_MIN:tt,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),cr={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Cr(y,S){var O=cr[y.geometry.type]-cr[S.geometry.type];return O===0&&y.geometry.type===Fe.POLYGON?y.area-S.area:O}function li(y){return y.map(function(S){return S.geometry.type===Fe.POLYGON&&(S.area=V.geometry({type:Fe.FEATURE,property:{},geometry:S.geometry})),S}).sort(Cr).map(function(S){return delete S.area,S})}function Ft(y,S){return S===void 0&&(S=0),[[y.point.x-S,y.point.y-S],[y.point.x+S,y.point.y+S]]}function Er(y){if(this._items={},this._nums={},this._length=y?y.length:0,y)for(var S=0,O=y.length;S<O;S++)this.add(y[S]),y[S]!==void 0&&(typeof y[S]=="string"?this._items[y[S]]=S:this._nums[y[S]]=S)}Er.prototype.add=function(y){return this.has(y)||(this._length++,typeof y=="string"?this._items[y]=this._length:this._nums[y]=this._length),this},Er.prototype.delete=function(y){return this.has(y)===!1||(this._length--,delete this._items[y],delete this._nums[y]),this},Er.prototype.has=function(y){return(typeof y=="string"||typeof y=="number")&&(this._items[y]!==void 0||this._nums[y]!==void 0)},Er.prototype.values=function(){var y=this,S=[];return Object.keys(this._items).forEach(function(O){S.push({k:O,v:y._items[O]})}),Object.keys(this._nums).forEach(function(O){S.push({k:JSON.parse(O),v:y._nums[O]})}),S.sort(function(O,K){return O.v-K.v}).map(function(O){return O.k})},Er.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var rr=[bt.FEATURE,bt.MIDPOINT,bt.VERTEX],$t={click:function(y,S,O){return ti(y,S,O,O.options.clickBuffer)},touch:function(y,S,O){return ti(y,S,O,O.options.touchBuffer)}};function ti(y,S,O,K){if(O.map===null)return[];var ne=y?Ft(y,K):S,ae={};O.options.styles&&(ae.layers=O.options.styles.map(function(We){return We.id}).filter(function(We){return O.map.getLayer(We)!=null}));var fe=O.map.queryRenderedFeatures(ne,ae).filter(function(We){return rr.indexOf(We.properties.meta)!==-1}),ze=new Er,Oe=[];return fe.forEach(function(We){var Ze=We.properties.id;ze.has(Ze)||(ze.add(Ze),Oe.push(We))}),li(Oe)}function di(y,S){var O=$t.click(y,null,S),K={mouse:Ge.NONE};return O[0]&&(K.mouse=O[0].properties.active===Pt.ACTIVE?Ge.MOVE:Ge.POINTER,K.feature=O[0].properties.meta),S.events.currentModeName().indexOf("draw")!==-1&&(K.mouse=Ge.ADD),S.ui.queueMapClasses(K),S.ui.updateMapClasses(),O[0]}function pi(y,S){var O=y.x-S.x,K=y.y-S.y;return Math.sqrt(O*O+K*K)}function yn(y,S,O){O===void 0&&(O={});var K=O.fineTolerance!=null?O.fineTolerance:4,ne=O.grossTolerance!=null?O.grossTolerance:12,ae=O.interval!=null?O.interval:500;y.point=y.point||S.point,y.time=y.time||S.time;var fe=pi(y.point,S.point);return fe<K||fe<ne&&S.time-y.time<ae}function bi(y,S,O){O===void 0&&(O={});var K=O.tolerance!=null?O.tolerance:25,ne=O.interval!=null?O.interval:250;return y.point=y.point||S.point,y.time=y.time||S.time,pi(y.point,S.point)<K&&S.time-y.time<ne}var Ar={exports:{}},nr=Ar.exports=function(y,S){if(S||(S=16),y===void 0&&(y=128),y<=0)return"0";for(var O=Math.log(Math.pow(2,y))/Math.log(S),K=2;O===1/0;K*=2)O=Math.log(Math.pow(2,y/K))/Math.log(S)*K;var ne=O-Math.floor(O),ae="";for(K=0;K<Math.floor(O);K++)ae=Math.floor(Math.random()*S).toString(S)+ae;if(ne){var fe=Math.pow(S,ne);ae=Math.floor(Math.random()*fe).toString(S)+ae}var ze=parseInt(ae,S);return ze!==1/0&&ze>=Math.pow(2,y)?nr(y,S):ae};nr.rack=function(y,S,O){var K=function(ae){var fe=0;do{if(fe++>10){if(!O)throw new Error("too many ID collisions, use more bits");y+=O}var ze=nr(y,S)}while(Object.hasOwnProperty.call(ne,ze));return ne[ze]=ae,ze},ne=K.hats={};return K.get=function(ae){return K.hats[ae]},K.set=function(ae,fe){return K.hats[ae]=fe,K},K.bits=y||128,K.base=S||16,K};var Xr=M(Ar.exports),ur=function(y,S){this.ctx=y,this.properties=S.properties||{},this.coordinates=S.geometry.coordinates,this.id=S.id||Xr(),this.type=S.geometry.type};ur.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},ur.prototype.incomingCoords=function(y){this.setCoordinates(y)},ur.prototype.setCoordinates=function(y){this.coordinates=y,this.changed()},ur.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},ur.prototype.setProperty=function(y,S){this.properties[y]=S},ur.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:Fe.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},ur.prototype.internal=function(y){var S={id:this.id,meta:bt.FEATURE,"meta:type":this.type,active:Pt.INACTIVE,mode:y};if(this.ctx.options.userProperties)for(var O in this.properties)S["user_"+O]=this.properties[O];return{type:Fe.FEATURE,properties:S,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Zi=function(y,S){ur.call(this,y,S)};(Zi.prototype=Object.create(ur.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},Zi.prototype.updateCoordinate=function(y,S,O){this.coordinates=arguments.length===3?[S,O]:[y,S],this.changed()},Zi.prototype.getCoordinate=function(){return this.getCoordinates()};var ri=function(y,S){ur.call(this,y,S)};(ri.prototype=Object.create(ur.prototype)).isValid=function(){return this.coordinates.length>1},ri.prototype.addCoordinate=function(y,S,O){this.changed();var K=parseInt(y,10);this.coordinates.splice(K,0,[S,O])},ri.prototype.getCoordinate=function(y){var S=parseInt(y,10);return JSON.parse(JSON.stringify(this.coordinates[S]))},ri.prototype.removeCoordinate=function(y){this.changed(),this.coordinates.splice(parseInt(y,10),1)},ri.prototype.updateCoordinate=function(y,S,O){var K=parseInt(y,10);this.coordinates[K]=[S,O],this.changed()};var jr=function(y,S){ur.call(this,y,S),this.coordinates=this.coordinates.map(function(O){return O.slice(0,-1)})};(jr.prototype=Object.create(ur.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(y){return y.length>2})},jr.prototype.incomingCoords=function(y){this.coordinates=y.map(function(S){return S.slice(0,-1)}),this.changed()},jr.prototype.setCoordinates=function(y){this.coordinates=y,this.changed()},jr.prototype.addCoordinate=function(y,S,O){this.changed();var K=y.split(".").map(function(ne){return parseInt(ne,10)});this.coordinates[K[0]].splice(K[1],0,[S,O])},jr.prototype.removeCoordinate=function(y){this.changed();var S=y.split(".").map(function(K){return parseInt(K,10)}),O=this.coordinates[S[0]];O&&(O.splice(S[1],1),O.length<3&&this.coordinates.splice(S[0],1))},jr.prototype.getCoordinate=function(y){var S=y.split(".").map(function(K){return parseInt(K,10)}),O=this.coordinates[S[0]];return JSON.parse(JSON.stringify(O[S[1]]))},jr.prototype.getCoordinates=function(){return this.coordinates.map(function(y){return y.concat([y[0]])})},jr.prototype.updateCoordinate=function(y,S,O){this.changed();var K=y.split("."),ne=parseInt(K[0],10),ae=parseInt(K[1],10);this.coordinates[ne]===void 0&&(this.coordinates[ne]=[]),this.coordinates[ne][ae]=[S,O]};var nn={MultiPoint:Zi,MultiLineString:ri,MultiPolygon:jr},Wi=function(y,S,O,K,ne){var ae=O.split("."),fe=parseInt(ae[0],10),ze=ae[1]?ae.slice(1).join("."):null;return y[fe][S](ze,K,ne)},qr=function(y,S){if(ur.call(this,y,S),delete this.coordinates,this.model=nn[S.geometry.type],this.model===void 0)throw new TypeError(S.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(S.geometry.coordinates)};function Mt(y){this.map=y.map,this.drawConfig=JSON.parse(JSON.stringify(y.options||{})),this._ctx=y}(qr.prototype=Object.create(ur.prototype))._coordinatesToFeatures=function(y){var S=this,O=this.model.bind(this);return y.map(function(K){return new O(S.ctx,{id:Xr(),type:Fe.FEATURE,properties:{},geometry:{coordinates:K,type:S.type.replace("Multi","")}})})},qr.prototype.isValid=function(){return this.features.every(function(y){return y.isValid()})},qr.prototype.setCoordinates=function(y){this.features=this._coordinatesToFeatures(y),this.changed()},qr.prototype.getCoordinate=function(y){return Wi(this.features,"getCoordinate",y)},qr.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(y){return y.type===Fe.POLYGON?y.getCoordinates():y.coordinates})))},qr.prototype.updateCoordinate=function(y,S,O){Wi(this.features,"updateCoordinate",y,S,O),this.changed()},qr.prototype.addCoordinate=function(y,S,O){Wi(this.features,"addCoordinate",y,S,O),this.changed()},qr.prototype.removeCoordinate=function(y){Wi(this.features,"removeCoordinate",y),this.changed()},qr.prototype.getFeatures=function(){return this.features},Mt.prototype.setSelected=function(y){return this._ctx.store.setSelected(y)},Mt.prototype.setSelectedCoordinates=function(y){var S=this;this._ctx.store.setSelectedCoordinates(y),y.reduce(function(O,K){return O[K.feature_id]===void 0&&(O[K.feature_id]=!0,S._ctx.store.get(K.feature_id).changed()),O},{})},Mt.prototype.getSelected=function(){return this._ctx.store.getSelected()},Mt.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Mt.prototype.isSelected=function(y){return this._ctx.store.isSelected(y)},Mt.prototype.getFeature=function(y){return this._ctx.store.get(y)},Mt.prototype.select=function(y){return this._ctx.store.select(y)},Mt.prototype.deselect=function(y){return this._ctx.store.deselect(y)},Mt.prototype.deleteFeature=function(y,S){return S===void 0&&(S={}),this._ctx.store.delete(y,S)},Mt.prototype.addFeature=function(y){return this._ctx.store.add(y)},Mt.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Mt.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Mt.prototype.setActionableState=function(y){y===void 0&&(y={});var S={trash:y.trash||!1,combineFeatures:y.combineFeatures||!1,uncombineFeatures:y.uncombineFeatures||!1};return this._ctx.events.actionable(S)},Mt.prototype.changeMode=function(y,S,O){return S===void 0&&(S={}),O===void 0&&(O={}),this._ctx.events.changeMode(y,S,O)},Mt.prototype.updateUIClasses=function(y){return this._ctx.ui.queueMapClasses(y)},Mt.prototype.activateUIButton=function(y){return this._ctx.ui.setActiveButton(y)},Mt.prototype.featuresAt=function(y,S,O){if(O===void 0&&(O="click"),O!=="click"&&O!=="touch")throw new Error("invalid buffer type");return $t[O](y,S,this._ctx)},Mt.prototype.newFeature=function(y){var S=y.geometry.type;return S===Fe.POINT?new Zi(this._ctx,y):S===Fe.LINE_STRING?new ri(this._ctx,y):S===Fe.POLYGON?new jr(this._ctx,y):new qr(this._ctx,y)},Mt.prototype.isInstanceOf=function(y,S){if(y===Fe.POINT)return S instanceof Zi;if(y===Fe.LINE_STRING)return S instanceof ri;if(y===Fe.POLYGON)return S instanceof jr;if(y==="MultiFeature")return S instanceof qr;throw new Error("Unknown feature class: "+y)},Mt.prototype.doRender=function(y){return this._ctx.store.featureChanged(y)},Mt.prototype.onSetup=function(){},Mt.prototype.onDrag=function(){},Mt.prototype.onClick=function(){},Mt.prototype.onMouseMove=function(){},Mt.prototype.onMouseDown=function(){},Mt.prototype.onMouseUp=function(){},Mt.prototype.onMouseOut=function(){},Mt.prototype.onKeyUp=function(){},Mt.prototype.onKeyDown=function(){},Mt.prototype.onTouchStart=function(){},Mt.prototype.onTouchMove=function(){},Mt.prototype.onTouchEnd=function(){},Mt.prototype.onTap=function(){},Mt.prototype.onStop=function(){},Mt.prototype.onTrash=function(){},Mt.prototype.onCombineFeature=function(){},Mt.prototype.onUncombineFeature=function(){},Mt.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var pa={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},_n=Object.keys(pa);function Hn(y){var S=Object.keys(y);return function(O,K){K===void 0&&(K={});var ne={},ae=S.reduce(function(fe,ze){return fe[ze]=y[ze],fe},new Mt(O));return{start:function(){var fe=this;ne=ae.onSetup(K),_n.forEach(function(ze){var Oe,We=pa[ze],Ze=function(){return!1};y[We]&&(Ze=function(){return!0}),fe.on(ze,Ze,(Oe=We,function($e){return ae[Oe](ne,$e)}))})},stop:function(){ae.onStop(ne)},trash:function(){ae.onTrash(ne)},combineFeatures:function(){ae.onCombineFeatures(ne)},uncombineFeatures:function(){ae.onUncombineFeatures(ne)},render:function(fe,ze){ae.toDisplayFeatures(ne,fe,ze)}}}}function vr(y){return[].concat(y).filter(function(S){return S!==void 0})}function zo(){var y=this;if(!(y.ctx.map&&y.ctx.map.getSource(se.HOT)!==void 0))return Oe();var S=y.ctx.events.currentModeName();y.ctx.ui.queueMapClasses({mode:S});var O=[],K=[];y.isDirty?K=y.getAllIds():(O=y.getChangedIds().filter(function(We){return y.get(We)!==void 0}),K=y.sources.hot.filter(function(We){return We.properties.id&&O.indexOf(We.properties.id)===-1&&y.get(We.properties.id)!==void 0}).map(function(We){return We.properties.id})),y.sources.hot=[];var ne=y.sources.cold.length;y.sources.cold=y.isDirty?[]:y.sources.cold.filter(function(We){var Ze=We.properties.id||We.properties.parent;return O.indexOf(Ze)===-1});var ae=ne!==y.sources.cold.length||K.length>0;function fe(We,Ze){var $e=y.get(We).internal(S);y.ctx.events.currentModeRender($e,function(xt){y.sources[Ze].push(xt)})}if(O.forEach(function(We){return fe(We,"hot")}),K.forEach(function(We){return fe(We,"cold")}),ae&&y.ctx.map.getSource(se.COLD).setData({type:Fe.FEATURE_COLLECTION,features:y.sources.cold}),y.ctx.map.getSource(se.HOT).setData({type:Fe.FEATURE_COLLECTION,features:y.sources.hot}),y._emitSelectionChange&&(y.ctx.map.fire(zt.SELECTION_CHANGE,{features:y.getSelected().map(function(We){return We.toGeoJSON()}),points:y.getSelectedCoordinates().map(function(We){return{type:Fe.FEATURE,properties:{},geometry:{type:Fe.POINT,coordinates:We.coordinates}}})}),y._emitSelectionChange=!1),y._deletedFeaturesToEmit.length){var ze=y._deletedFeaturesToEmit.map(function(We){return We.toGeoJSON()});y._deletedFeaturesToEmit=[],y.ctx.map.fire(zt.DELETE,{features:ze})}function Oe(){y.isDirty=!1,y.clearChangedIds()}Oe(),y.ctx.map.fire(zt.RENDER,{})}function be(y){var S,O=this;this._features={},this._featureIds=new Er,this._selectedFeatureIds=new Er,this._selectedCoordinates=[],this._changedFeatureIds=new Er,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=y,this.sources={hot:[],cold:[]},this.render=function(){S||(S=requestAnimationFrame(function(){S=null,zo.call(O)}))},this.isDirty=!1}function Pn(y,S){var O=y._selectedCoordinates.filter(function(K){return y._selectedFeatureIds.has(K.feature_id)});y._selectedCoordinates.length===O.length||S.silent||(y._emitSelectionChange=!0),y._selectedCoordinates=O}be.prototype.createRenderBatch=function(){var y=this,S=this.render,O=0;return this.render=function(){O++},function(){y.render=S,O>0&&y.render()}},be.prototype.setDirty=function(){return this.isDirty=!0,this},be.prototype.featureChanged=function(y){return this._changedFeatureIds.add(y),this},be.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},be.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},be.prototype.getAllIds=function(){return this._featureIds.values()},be.prototype.add=function(y){return this.featureChanged(y.id),this._features[y.id]=y,this._featureIds.add(y.id),this},be.prototype.delete=function(y,S){var O=this;return S===void 0&&(S={}),vr(y).forEach(function(K){O._featureIds.has(K)&&(O._featureIds.delete(K),O._selectedFeatureIds.delete(K),S.silent||O._deletedFeaturesToEmit.indexOf(O._features[K])===-1&&O._deletedFeaturesToEmit.push(O._features[K]),delete O._features[K],O.isDirty=!0)}),Pn(this,S),this},be.prototype.get=function(y){return this._features[y]},be.prototype.getAll=function(){var y=this;return Object.keys(this._features).map(function(S){return y._features[S]})},be.prototype.select=function(y,S){var O=this;return S===void 0&&(S={}),vr(y).forEach(function(K){O._selectedFeatureIds.has(K)||(O._selectedFeatureIds.add(K),O._changedFeatureIds.add(K),S.silent||(O._emitSelectionChange=!0))}),this},be.prototype.deselect=function(y,S){var O=this;return S===void 0&&(S={}),vr(y).forEach(function(K){O._selectedFeatureIds.has(K)&&(O._selectedFeatureIds.delete(K),O._changedFeatureIds.add(K),S.silent||(O._emitSelectionChange=!0))}),Pn(this,S),this},be.prototype.clearSelected=function(y){return y===void 0&&(y={}),this.deselect(this._selectedFeatureIds.values(),{silent:y.silent}),this},be.prototype.setSelected=function(y,S){var O=this;return S===void 0&&(S={}),y=vr(y),this.deselect(this._selectedFeatureIds.values().filter(function(K){return y.indexOf(K)===-1}),{silent:S.silent}),this.select(y.filter(function(K){return!O._selectedFeatureIds.has(K)}),{silent:S.silent}),this},be.prototype.setSelectedCoordinates=function(y){return this._selectedCoordinates=y,this._emitSelectionChange=!0,this},be.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},be.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},be.prototype.getSelected=function(){var y=this;return this._selectedFeatureIds.values().map(function(S){return y.get(S)})},be.prototype.getSelectedCoordinates=function(){var y=this;return this._selectedCoordinates.map(function(S){return{coordinates:y.get(S.feature_id).getCoordinate(S.coord_path)}})},be.prototype.isSelected=function(y){return this._selectedFeatureIds.has(y)},be.prototype.setFeatureProperty=function(y,S,O){this.get(y).setProperty(S,O),this.featureChanged(y)},be.prototype.storeMapConfig=function(){var y=this;Nt.forEach(function(S){y.ctx.map[S]&&(y._mapInitialConfig[S]=y.ctx.map[S].isEnabled())})},be.prototype.restoreMapConfig=function(){var y=this;Object.keys(this._mapInitialConfig).forEach(function(S){y._mapInitialConfig[S]?y.ctx.map[S].enable():y.ctx.map[S].disable()})},be.prototype.getInitialConfigValue=function(y){return this._mapInitialConfig[y]===void 0||this._mapInitialConfig[y]};var fa=function(){for(var y=arguments,S={},O=0;O<arguments.length;O++){var K=y[O];for(var ne in K)Kt.call(K,ne)&&(S[ne]=K[ne])}return S},Kt=Object.prototype.hasOwnProperty,qt=M(fa),Mn=["mode","feature","mouse"];function Do(y){var S=null,O=null,K={onRemove:function(){return y.map.off("load",K.connect),clearInterval(O),K.removeLayers(),y.store.restoreMapConfig(),y.ui.removeButtons(),y.events.removeEventListeners(),y.ui.clearMapClasses(),y.boxZoomInitial&&y.map.boxZoom.enable(),y.map=null,y.container=null,y.store=null,S&&S.parentNode&&S.parentNode.removeChild(S),S=null,this},connect:function(){y.map.off("load",K.connect),clearInterval(O),K.addLayers(),y.store.storeMapConfig(),y.events.addEventListeners()},onAdd:function(ne){var ae=ne.fire;return ne.fire=function(fe,ze){var Oe=arguments;return ae.length===1&&arguments.length!==1&&(Oe=[qt({},{type:fe},ze)]),ae.apply(ne,Oe)},y.map=ne,y.events=function(fe){var ze=Object.keys(fe.options.modes).reduce(function(ke,ct){return ke[ct]=Hn(fe.options.modes[ct]),ke},{}),Oe={},We={},Ze={},$e=null,xt=null;Ze.drag=function(ke,ct){ct({point:ke.point,time:new Date().getTime()})?(fe.ui.queueMapClasses({mouse:Ge.DRAG}),xt.drag(ke)):ke.originalEvent.stopPropagation()},Ze.mousedrag=function(ke){Ze.drag(ke,function(ct){return!yn(Oe,ct)})},Ze.touchdrag=function(ke){Ze.drag(ke,function(ct){return!bi(We,ct)})},Ze.mousemove=function(ke){if((ke.originalEvent.buttons!==void 0?ke.originalEvent.buttons:ke.originalEvent.which)===1)return Ze.mousedrag(ke);var ct=di(ke,fe);ke.featureTarget=ct,xt.mousemove(ke)},Ze.mousedown=function(ke){Oe={time:new Date().getTime(),point:ke.point};var ct=di(ke,fe);ke.featureTarget=ct,xt.mousedown(ke)},Ze.mouseup=function(ke){var ct=di(ke,fe);ke.featureTarget=ct,yn(Oe,{point:ke.point,time:new Date().getTime()})?xt.click(ke):xt.mouseup(ke)},Ze.mouseout=function(ke){xt.mouseout(ke)},Ze.touchstart=function(ke){if(fe.options.touchEnabled){We={time:new Date().getTime(),point:ke.point};var ct=$t.touch(ke,null,fe)[0];ke.featureTarget=ct,xt.touchstart(ke)}},Ze.touchmove=function(ke){if(fe.options.touchEnabled)return xt.touchmove(ke),Ze.touchdrag(ke)},Ze.touchend=function(ke){if(ke.originalEvent.preventDefault(),fe.options.touchEnabled){var ct=$t.touch(ke,null,fe)[0];ke.featureTarget=ct,bi(We,{time:new Date().getTime(),point:ke.point})?xt.tap(ke):xt.touchend(ke)}};var pr=function(ke){return!(ke===8||ke===46||ke>=48&&ke<=57)};function gt(ke,ct,Qt){Qt===void 0&&(Qt={}),xt.stop();var Vr=ze[ke];if(Vr===void 0)throw new Error(ke+" is not valid");$e=ke;var gr=Vr(fe,ct);xt=I(gr,fe),Qt.silent||fe.map.fire(zt.MODE_CHANGE,{mode:ke}),fe.store.setDirty(),fe.store.render()}Ze.keydown=function(ke){(ke.srcElement||ke.target).classList.contains("mapboxgl-canvas")&&(ke.keyCode!==8&&ke.keyCode!==46||!fe.options.controls.trash?pr(ke.keyCode)?xt.keydown(ke):ke.keyCode===49&&fe.options.controls.point?gt(ot.DRAW_POINT):ke.keyCode===50&&fe.options.controls.line_string?gt(ot.DRAW_LINE_STRING):ke.keyCode===51&&fe.options.controls.polygon&&gt(ot.DRAW_POLYGON):(ke.preventDefault(),xt.trash()))},Ze.keyup=function(ke){pr(ke.keyCode)&&xt.keyup(ke)},Ze.zoomend=function(){fe.store.changeZoom()},Ze.data=function(ke){if(ke.dataType==="style"){var ct=fe.setup,Qt=fe.map,Vr=fe.options,gr=fe.store;Vr.styles.some(function(bs){return Qt.getLayer(bs.id)})||(ct.addLayers(),gr.setDirty(),gr.render())}};var Wt={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){$e=fe.options.defaultMode,xt=I(ze[$e](fe),fe)},changeMode:gt,actionable:function(ke){var ct=!1;Object.keys(ke).forEach(function(Qt){if(Wt[Qt]===void 0)throw new Error("Invalid action type");Wt[Qt]!==ke[Qt]&&(ct=!0),Wt[Qt]=ke[Qt]}),ct&&fe.map.fire(zt.ACTIONABLE,{actions:Wt})},currentModeName:function(){return $e},currentModeRender:function(ke,ct){return xt.render(ke,ct)},fire:function(ke,ct){Ze[ke]&&Ze[ke](ct)},addEventListeners:function(){fe.map.on("mousemove",Ze.mousemove),fe.map.on("mousedown",Ze.mousedown),fe.map.on("mouseup",Ze.mouseup),fe.map.on("data",Ze.data),fe.map.on("touchmove",Ze.touchmove),fe.map.on("touchstart",Ze.touchstart),fe.map.on("touchend",Ze.touchend),fe.container.addEventListener("mouseout",Ze.mouseout),fe.options.keybindings&&(fe.container.addEventListener("keydown",Ze.keydown),fe.container.addEventListener("keyup",Ze.keyup))},removeEventListeners:function(){fe.map.off("mousemove",Ze.mousemove),fe.map.off("mousedown",Ze.mousedown),fe.map.off("mouseup",Ze.mouseup),fe.map.off("data",Ze.data),fe.map.off("touchmove",Ze.touchmove),fe.map.off("touchstart",Ze.touchstart),fe.map.off("touchend",Ze.touchend),fe.container.removeEventListener("mouseout",Ze.mouseout),fe.options.keybindings&&(fe.container.removeEventListener("keydown",Ze.keydown),fe.container.removeEventListener("keyup",Ze.keyup))},trash:function(ke){xt.trash(ke)},combineFeatures:function(){xt.combineFeatures()},uncombineFeatures:function(){xt.uncombineFeatures()},getMode:function(){return $e}}}(y),y.ui=function(fe){var ze={},Oe=null,We={mode:null,feature:null,mouse:null},Ze={mode:null,feature:null,mouse:null};function $e(ke){Ze=qt(Ze,ke)}function xt(){var ke,ct;if(fe.container){var Qt=[],Vr=[];Mn.forEach(function(gr){Ze[gr]!==We[gr]&&(Qt.push(gr+"-"+We[gr]),Ze[gr]!==null&&Vr.push(gr+"-"+Ze[gr]))}),Qt.length>0&&(ke=fe.container.classList).remove.apply(ke,Qt),Vr.length>0&&(ct=fe.container.classList).add.apply(ct,Vr),We=qt(We,Ze)}}function pr(ke,ct){ct===void 0&&(ct={});var Qt=document.createElement("button");return Qt.className=ve.CONTROL_BUTTON+" "+ct.className,Qt.setAttribute("title",ct.title),ct.container.appendChild(Qt),Qt.addEventListener("click",function(Vr){if(Vr.preventDefault(),Vr.stopPropagation(),Vr.target===Oe)return gt(),void ct.onDeactivate();Wt(ke),ct.onActivate()},!0),Qt}function gt(){Oe&&(Oe.classList.remove(ve.ACTIVE_BUTTON),Oe=null)}function Wt(ke){gt();var ct=ze[ke];ct&&ct&&ke!=="trash"&&(ct.classList.add(ve.ACTIVE_BUTTON),Oe=ct)}return{setActiveButton:Wt,queueMapClasses:$e,updateMapClasses:xt,clearMapClasses:function(){$e({mode:null,feature:null,mouse:null}),xt()},addButtons:function(){var ke=fe.options.controls,ct=document.createElement("div");return ct.className=ve.CONTROL_GROUP+" "+ve.CONTROL_BASE,ke&&(ke[yt.LINE]&&(ze[yt.LINE]=pr(yt.LINE,{container:ct,className:ve.CONTROL_BUTTON_LINE,title:"LineString tool "+(fe.options.keybindings?"(l)":""),onActivate:function(){return fe.events.changeMode(ot.DRAW_LINE_STRING)},onDeactivate:function(){return fe.events.trash()}})),ke[yt.POLYGON]&&(ze[yt.POLYGON]=pr(yt.POLYGON,{container:ct,className:ve.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(fe.options.keybindings?"(p)":""),onActivate:function(){return fe.events.changeMode(ot.DRAW_POLYGON)},onDeactivate:function(){return fe.events.trash()}})),ke[yt.POINT]&&(ze[yt.POINT]=pr(yt.POINT,{container:ct,className:ve.CONTROL_BUTTON_POINT,title:"Marker tool "+(fe.options.keybindings?"(m)":""),onActivate:function(){return fe.events.changeMode(ot.DRAW_POINT)},onDeactivate:function(){return fe.events.trash()}})),ke.trash&&(ze.trash=pr("trash",{container:ct,className:ve.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){fe.events.trash()}})),ke.combine_features&&(ze.combine_features=pr("combineFeatures",{container:ct,className:ve.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){fe.events.combineFeatures()}})),ke.uncombine_features&&(ze.uncombine_features=pr("uncombineFeatures",{container:ct,className:ve.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){fe.events.uncombineFeatures()}}))),ct},removeButtons:function(){Object.keys(ze).forEach(function(ke){var ct=ze[ke];ct.parentNode&&ct.parentNode.removeChild(ct),delete ze[ke]})}}}(y),y.container=ne.getContainer(),y.store=new be(y),S=y.ui.addButtons(),y.options.boxSelect&&(y.boxZoomInitial=ne.boxZoom.isEnabled(),ne.boxZoom.disable(),ne.dragPan.disable(),ne.dragPan.enable()),ne.loaded()?K.connect():(ne.on("load",K.connect),O=setInterval(function(){ne.loaded()&&K.connect()},16)),y.events.start(),S},addLayers:function(){y.map.addSource(se.COLD,{data:{type:Fe.FEATURE_COLLECTION,features:[]},type:"geojson"}),y.map.addSource(se.HOT,{data:{type:Fe.FEATURE_COLLECTION,features:[]},type:"geojson"}),y.options.styles.forEach(function(ne){y.map.addLayer(ne)}),y.store.setDirty(!0),y.store.render()},removeLayers:function(){y.options.styles.forEach(function(ne){y.map.getLayer(ne.id)&&y.map.removeLayer(ne.id)}),y.map.getSource(se.COLD)&&y.map.removeSource(se.COLD),y.map.getSource(se.HOT)&&y.map.removeSource(se.HOT)}};return y.setup=K,K}var Fo=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function kn(y){return function(S){var O=S.featureTarget;return!!O&&!!O.properties&&O.properties.meta===y}}function xn(y){return!!y.originalEvent&&!!y.originalEvent.shiftKey&&y.originalEvent.button===0}function Hi(y){return!!y.featureTarget&&!!y.featureTarget.properties&&y.featureTarget.properties.active===Pt.ACTIVE&&y.featureTarget.properties.meta===bt.FEATURE}function Lo(y){return!!y.featureTarget&&!!y.featureTarget.properties&&y.featureTarget.properties.active===Pt.INACTIVE&&y.featureTarget.properties.meta===bt.FEATURE}function Re(y){return y.featureTarget===void 0}function ci(y){return!!y.featureTarget&&!!y.featureTarget.properties&&y.featureTarget.properties.meta===bt.FEATURE}function Jr(y){var S=y.featureTarget;return!!S&&!!S.properties&&S.properties.meta===bt.VERTEX}function zn(y){return!!y.originalEvent&&y.originalEvent.shiftKey===!0}function vn(y){return y.keyCode===27}function Le(y){return y.keyCode===13}var kt=Object.freeze({__proto__:null,isOfMetaType:kn,isShiftMousedown:xn,isActiveFeature:Hi,isInactiveFeature:Lo,noTarget:Re,isFeature:ci,isVertex:Jr,isShiftDown:zn,isEscapeKey:vn,isEnterKey:Le,isTrue:function(){return!0}}),It=Nr;function Nr(y,S){this.x=y,this.y=S}Nr.prototype={clone:function(){return new Nr(this.x,this.y)},add:function(y){return this.clone()._add(y)},sub:function(y){return this.clone()._sub(y)},multByPoint:function(y){return this.clone()._multByPoint(y)},divByPoint:function(y){return this.clone()._divByPoint(y)},mult:function(y){return this.clone()._mult(y)},div:function(y){return this.clone()._div(y)},rotate:function(y){return this.clone()._rotate(y)},rotateAround:function(y,S){return this.clone()._rotateAround(y,S)},matMult:function(y){return this.clone()._matMult(y)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(y){return this.x===y.x&&this.y===y.y},dist:function(y){return Math.sqrt(this.distSqr(y))},distSqr:function(y){var S=y.x-this.x,O=y.y-this.y;return S*S+O*O},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(y){return Math.atan2(this.y-y.y,this.x-y.x)},angleWith:function(y){return this.angleWithSep(y.x,y.y)},angleWithSep:function(y,S){return Math.atan2(this.x*S-this.y*y,this.x*y+this.y*S)},_matMult:function(y){var S=y[0]*this.x+y[1]*this.y,O=y[2]*this.x+y[3]*this.y;return this.x=S,this.y=O,this},_add:function(y){return this.x+=y.x,this.y+=y.y,this},_sub:function(y){return this.x-=y.x,this.y-=y.y,this},_mult:function(y){return this.x*=y,this.y*=y,this},_div:function(y){return this.x/=y,this.y/=y,this},_multByPoint:function(y){return this.x*=y.x,this.y*=y.y,this},_divByPoint:function(y){return this.x/=y.x,this.y/=y.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var y=this.y;return this.y=this.x,this.x=-y,this},_rotate:function(y){var S=Math.cos(y),O=Math.sin(y),K=S*this.x-O*this.y,ne=O*this.x+S*this.y;return this.x=K,this.y=ne,this},_rotateAround:function(y,S){var O=Math.cos(y),K=Math.sin(y),ne=S.x+O*(this.x-S.x)-K*(this.y-S.y),ae=S.y+K*(this.x-S.x)+O*(this.y-S.y);return this.x=ne,this.y=ae,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Nr.convert=function(y){return y instanceof Nr?y:Array.isArray(y)?new Nr(y[0],y[1]):y};var fi=M(It);function Ct(y,S){var O=S.getBoundingClientRect();return new fi(y.clientX-O.left-(S.clientLeft||0),y.clientY-O.top-(S.clientTop||0))}function wi(y,S,O,K){return{type:Fe.FEATURE,properties:{meta:bt.VERTEX,parent:y,coord_path:O,active:K?Pt.ACTIVE:Pt.INACTIVE},geometry:{type:Fe.POINT,coordinates:S}}}function bn(y,S,O){var K=S.geometry.coordinates,ne=O.geometry.coordinates;if(K[1]>85||K[1]<tt||ne[1]>85||ne[1]<tt)return null;var ae={lng:(K[0]+ne[0])/2,lat:(K[1]+ne[1])/2};return{type:Fe.FEATURE,properties:{meta:bt.MIDPOINT,parent:y,lng:ae.lng,lat:ae.lat,coord_path:O.properties.coord_path},geometry:{type:Fe.POINT,coordinates:[ae.lng,ae.lat]}}}function zr(y,S,O){S===void 0&&(S={}),O===void 0&&(O=null);var K,ne=y.geometry,ae=ne.type,fe=ne.coordinates,ze=y.properties&&y.properties.id,Oe=[];function We($e,xt){var pr="",gt=null;$e.forEach(function(Wt,ke){var ct=xt!=null?xt+"."+ke:String(ke),Qt=wi(ze,Wt,ct,Ze(ct));if(S.midpoints&&gt){var Vr=bn(ze,gt,Qt);Vr&&Oe.push(Vr)}gt=Qt;var gr=JSON.stringify(Wt);pr!==gr&&Oe.push(Qt),ke===0&&(pr=gr)})}function Ze($e){return!!S.selectedPaths&&S.selectedPaths.indexOf($e)!==-1}return ae===Fe.POINT?Oe.push(wi(ze,fe,O,Ze(O))):ae===Fe.POLYGON?fe.forEach(function($e,xt){We($e,O!==null?O+"."+xt:String(xt))}):ae===Fe.LINE_STRING?We(fe,O):ae.indexOf(Fe.MULTI_PREFIX)===0&&(K=ae.replace(Fe.MULTI_PREFIX,""),fe.forEach(function($e,xt){var pr={type:Fe.FEATURE,properties:y.properties,geometry:{type:K,coordinates:$e}};Oe=Oe.concat(zr(pr,S,xt))})),Oe}var Z={enable:function(y){setTimeout(function(){y.map&&y.map.doubleClickZoom&&y._ctx&&y._ctx.store&&y._ctx.store.getInitialConfigValue&&y._ctx.store.getInitialConfigValue("doubleClickZoom")&&y.map.doubleClickZoom.enable()},0)},disable:function(y){setTimeout(function(){y.map&&y.map.doubleClickZoom&&y.map.doubleClickZoom.disable()},0)}},F={exports:{}},L=function(y){if(!y||!y.type)return null;var S=$[y.type];if(!S)return null;if(S==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:y}]};if(S==="feature")return{type:"FeatureCollection",features:[y]};if(S==="featurecollection")return y},$={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},X=M(L),ie=Object.freeze({__proto__:null,default:function y(S){switch(S&&S.type||null){case"FeatureCollection":return S.features=S.features.reduce(function(O,K){return O.concat(y(K))},[]),S;case"Feature":return S.geometry?y(S.geometry).map(function(O){var K={type:"Feature",properties:JSON.parse(JSON.stringify(S.properties)),geometry:O};return S.id!==void 0&&(K.id=S.id),K}):[S];case"MultiPoint":return S.coordinates.map(function(O){return{type:"Point",coordinates:O}});case"MultiPolygon":return S.coordinates.map(function(O){return{type:"Polygon",coordinates:O}});case"MultiLineString":return S.coordinates.map(function(O){return{type:"LineString",coordinates:O}});case"GeometryCollection":return S.geometries.map(y).reduce(function(O,K){return O.concat(K)},[]);case"Point":case"Polygon":case"LineString":return[S]}}}),ue=L,pe=R(ie),te=function(y){return function S(O){return Array.isArray(O)&&O.length&&typeof O[0]=="number"?[O]:O.reduce(function(K,ne){return Array.isArray(ne)&&Array.isArray(ne[0])?K.concat(S(ne)):(K.push(ne),K)},[])}(y)};pe instanceof Function||(pe=pe.default);var _e={exports:{}},Me=_e.exports=function(y){return new Se(y)};function Se(y){this.value=y}function Te(y,S,O){var K=[],ne=[],ae=!0;return function fe(ze){var Oe=O?dt(ze):ze,We={},Ze=!0,$e={node:Oe,node_:ze,path:[].concat(K),parent:ne[ne.length-1],parents:ne,key:K.slice(-1)[0],isRoot:K.length===0,level:K.length,circular:null,update:function(gt,Wt){$e.isRoot||($e.parent.node[$e.key]=gt),$e.node=gt,Wt&&(Ze=!1)},delete:function(gt){delete $e.parent.node[$e.key],gt&&(Ze=!1)},remove:function(gt){vt($e.parent.node)?$e.parent.node.splice($e.key,1):delete $e.parent.node[$e.key],gt&&(Ze=!1)},keys:null,before:function(gt){We.before=gt},after:function(gt){We.after=gt},pre:function(gt){We.pre=gt},post:function(gt){We.post=gt},stop:function(){ae=!1},block:function(){Ze=!1}};if(!ae)return $e;function xt(){if(typeof $e.node=="object"&&$e.node!==null){$e.keys&&$e.node_===$e.node||($e.keys=ut($e.node)),$e.isLeaf=$e.keys.length==0;for(var gt=0;gt<ne.length;gt++)if(ne[gt].node_===ze){$e.circular=ne[gt];break}}else $e.isLeaf=!0,$e.keys=null;$e.notLeaf=!$e.isLeaf,$e.notRoot=!$e.isRoot}xt();var pr=S.call($e,$e.node);return pr!==void 0&&$e.update&&$e.update(pr),We.before&&We.before.call($e,$e.node),Ze&&(typeof $e.node!="object"||$e.node===null||$e.circular||(ne.push($e),xt(),Bt($e.keys,function(gt,Wt){K.push(gt),We.pre&&We.pre.call($e,$e.node[gt],gt);var ke=fe($e.node[gt]);O&&Gt.call($e.node,gt)&&($e.node[gt]=ke.node),ke.isLast=Wt==$e.keys.length-1,ke.isFirst=Wt==0,We.post&&We.post.call($e,ke),K.pop()}),ne.pop()),We.after&&We.after.call($e,$e.node)),$e}(y).node}function dt(y){if(typeof y=="object"&&y!==null){var S;if(vt(y))S=[];else if(Et(y)==="[object Date]")S=new Date(y.getTime?y.getTime():y);else if(function(ne){return Et(ne)==="[object RegExp]"}(y))S=new RegExp(y);else if(function(ne){return Et(ne)==="[object Error]"}(y))S={message:y.message};else if(function(ne){return Et(ne)==="[object Boolean]"}(y))S=new Boolean(y);else if(function(ne){return Et(ne)==="[object Number]"}(y))S=new Number(y);else if(function(ne){return Et(ne)==="[object String]"}(y))S=new String(y);else if(Object.create&&Object.getPrototypeOf)S=Object.create(Object.getPrototypeOf(y));else if(y.constructor===Object)S={};else{var O=y.constructor&&y.constructor.prototype||y.__proto__||{},K=function(){};K.prototype=O,S=new K}return Bt(ut(y),function(ne){S[ne]=y[ne]}),S}return y}Se.prototype.get=function(y){for(var S=this.value,O=0;O<y.length;O++){var K=y[O];if(!S||!Gt.call(S,K)){S=void 0;break}S=S[K]}return S},Se.prototype.has=function(y){for(var S=this.value,O=0;O<y.length;O++){var K=y[O];if(!S||!Gt.call(S,K))return!1;S=S[K]}return!0},Se.prototype.set=function(y,S){for(var O=this.value,K=0;K<y.length-1;K++){var ne=y[K];Gt.call(O,ne)||(O[ne]={}),O=O[ne]}return O[y[K]]=S,S},Se.prototype.map=function(y){return Te(this.value,y,!0)},Se.prototype.forEach=function(y){return this.value=Te(this.value,y,!1),this.value},Se.prototype.reduce=function(y,S){var O=arguments.length===1,K=O?this.value:S;return this.forEach(function(ne){this.isRoot&&O||(K=y.call(this,K,ne))}),K},Se.prototype.paths=function(){var y=[];return this.forEach(function(S){y.push(this.path)}),y},Se.prototype.nodes=function(){var y=[];return this.forEach(function(S){y.push(this.node)}),y},Se.prototype.clone=function(){var y=[],S=[];return function O(K){for(var ne=0;ne<y.length;ne++)if(y[ne]===K)return S[ne];if(typeof K=="object"&&K!==null){var ae=dt(K);return y.push(K),S.push(ae),Bt(ut(K),function(fe){ae[fe]=O(K[fe])}),y.pop(),S.pop(),ae}return K}(this.value)};var ut=Object.keys||function(y){var S=[];for(var O in y)S.push(O);return S};function Et(y){return Object.prototype.toString.call(y)}var vt=Array.isArray||function(y){return Object.prototype.toString.call(y)==="[object Array]"},Bt=function(y,S){if(y.forEach)return y.forEach(S);for(var O=0;O<y.length;O++)S(y[O],O,y)};Bt(ut(Se.prototype),function(y){Me[y]=function(S){var O=[].slice.call(arguments,1),K=new Se(S);return K[y].apply(K,O)}});var Gt=Object.hasOwnProperty||function(y,S){return S in y},hr=_e.exports,$r=mt;function mt(y){if(!(this instanceof mt))return new mt(y);this._bbox=y||[1/0,1/0,-1/0,-1/0],this._valid=!!y}mt.prototype.include=function(y){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],y[0]),this._bbox[1]=Math.min(this._bbox[1],y[1]),this._bbox[2]=Math.max(this._bbox[2],y[0]),this._bbox[3]=Math.max(this._bbox[3],y[1]),this},mt.prototype.equals=function(y){var S;return S=y instanceof mt?y.bbox():y,this._bbox[0]==S[0]&&this._bbox[1]==S[1]&&this._bbox[2]==S[2]&&this._bbox[3]==S[3]},mt.prototype.center=function(y){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},mt.prototype.union=function(y){var S;return this._valid=!0,S=y instanceof mt?y.bbox():y,this._bbox[0]=Math.min(this._bbox[0],S[0]),this._bbox[1]=Math.min(this._bbox[1],S[1]),this._bbox[2]=Math.max(this._bbox[2],S[2]),this._bbox[3]=Math.max(this._bbox[3],S[3]),this},mt.prototype.bbox=function(){return this._valid?this._bbox:null},mt.prototype.contains=function(y){if(!y)return this._fastContains();if(!this._valid)return null;var S=y[0],O=y[1];return this._bbox[0]<=S&&this._bbox[1]<=O&&this._bbox[2]>=S&&this._bbox[3]>=O},mt.prototype.intersect=function(y){return this._valid?(S=y instanceof mt?y.bbox():y,!(this._bbox[0]>S[2]||this._bbox[2]<S[0]||this._bbox[3]<S[1]||this._bbox[1]>S[3])):null;var S},mt.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var y="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",y)},mt.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var br=function(y){if(!y)return[];var S=pe(ue(y)),O=[];return S.features.forEach(function(K){K.geometry&&(O=O.concat(te(K.geometry.coordinates)))}),O},Gr=hr,Si=$r,Ti={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Zr=Object.keys(Ti);function Xn(y){for(var S=Si(),O=br(y),K=0;K<O.length;K++)S.include(O[K]);return S}F.exports=function(y){return Xn(y).bbox()},F.exports.polygon=function(y){return Xn(y).polygon()},F.exports.bboxify=function(y){return Gr(y).map(function(S){S&&Zr.some(function(O){return!!S[O]&&Ti[O].indexOf(S.type)!==-1})&&(S.bbox=Xn(S).bbox(),this.update(S))})};var ql=M(F.exports),Vt=-90;function ma(y,S){var O=Vt,K=90,ne=Vt,ae=90,fe=270,ze=-270;y.forEach(function(We){var Ze=ql(We),$e=Ze[1],xt=Ze[3],pr=Ze[0],gt=Ze[2];$e>O&&(O=$e),xt<K&&(K=xt),xt>ne&&(ne=xt),$e<ae&&(ae=$e),pr<fe&&(fe=pr),gt>ze&&(ze=gt)});var Oe=S;return O+Oe.lat>85&&(Oe.lat=85-O),ne+Oe.lat>90&&(Oe.lat=90-ne),K+Oe.lat<-85&&(Oe.lat=-85-K),ae+Oe.lat<Vt&&(Oe.lat=Vt-ae),fe+Oe.lng<=-270&&(Oe.lng+=360*Math.ceil(Math.abs(Oe.lng)/360)),ze+Oe.lng>=270&&(Oe.lng-=360*Math.ceil(Math.abs(Oe.lng)/360)),Oe}function ga(y,S){var O=ma(y.map(function(K){return K.toGeoJSON()}),S);y.forEach(function(K){var ne,ae=K.getCoordinates(),fe=function(Oe){var We={lng:Oe[0]+O.lng,lat:Oe[1]+O.lat};return[We.lng,We.lat]},ze=function(Oe){return Oe.map(function(We){return fe(We)})};K.type===Fe.POINT?ne=fe(ae):K.type===Fe.LINE_STRING||K.type===Fe.MULTI_POINT?ne=ae.map(fe):K.type===Fe.POLYGON||K.type===Fe.MULTI_LINE_STRING?ne=ae.map(ze):K.type===Fe.MULTI_POLYGON&&(ne=ae.map(function(Oe){return Oe.map(function(We){return ze(We)})})),K.incomingCoords(ne)})}var Yt={onSetup:function(y){var S=this,O={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:y.featureIds||[]};return this.setSelected(O.initiallySelectedFeatureIds.filter(function(K){return S.getFeature(K)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),O},fireUpdate:function(){this.map.fire(zt.UPDATE,{action:tr.MOVE,features:this.getSelected().map(function(y){return y.toGeoJSON()})})},fireActionable:function(){var y=this,S=this.getSelected(),O=S.filter(function(ze){return y.isInstanceOf("MultiFeature",ze)}),K=!1;if(S.length>1){K=!0;var ne=S[0].type.replace("Multi","");S.forEach(function(ze){ze.type.replace("Multi","")!==ne&&(K=!1)})}var ae=O.length>0,fe=S.length>0;this.setActionableState({combineFeatures:K,uncombineFeatures:ae,trash:fe})},getUniqueIds:function(y){return y.length?y.map(function(S){return S.properties.id}).filter(function(S){return S!==void 0}).reduce(function(S,O){return S.add(O),S},new Er).values():[]},stopExtendedInteractions:function(y){y.boxSelectElement&&(y.boxSelectElement.parentNode&&y.boxSelectElement.parentNode.removeChild(y.boxSelectElement),y.boxSelectElement=null),this.map.dragPan.enable(),y.boxSelecting=!1,y.canBoxSelect=!1,y.dragMoving=!1,y.canDragMove=!1},onStop:function(){Z.enable(this)},onMouseMove:function(y,S){return ci(S)&&y.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(y),!0},onMouseOut:function(y){return!y.dragMoving||this.fireUpdate()}};Yt.onTap=Yt.onClick=function(y,S){return Re(S)?this.clickAnywhere(y,S):kn(bt.VERTEX)(S)?this.clickOnVertex(y,S):ci(S)?this.clickOnFeature(y,S):void 0},Yt.clickAnywhere=function(y){var S=this,O=this.getSelectedIds();O.length&&(this.clearSelectedFeatures(),O.forEach(function(K){return S.doRender(K)})),Z.enable(this),this.stopExtendedInteractions(y)},Yt.clickOnVertex=function(y,S){this.changeMode(ot.DIRECT_SELECT,{featureId:S.featureTarget.properties.parent,coordPath:S.featureTarget.properties.coord_path,startPos:S.lngLat}),this.updateUIClasses({mouse:Ge.MOVE})},Yt.startOnActiveFeature=function(y,S){this.stopExtendedInteractions(y),this.map.dragPan.disable(),this.doRender(S.featureTarget.properties.id),y.canDragMove=!0,y.dragMoveLocation=S.lngLat},Yt.clickOnFeature=function(y,S){var O=this;Z.disable(this),this.stopExtendedInteractions(y);var K=zn(S),ne=this.getSelectedIds(),ae=S.featureTarget.properties.id,fe=this.isSelected(ae);if(!K&&fe&&this.getFeature(ae).type!==Fe.POINT)return this.changeMode(ot.DIRECT_SELECT,{featureId:ae});fe&&K?(this.deselect(ae),this.updateUIClasses({mouse:Ge.POINTER}),ne.length===1&&Z.enable(this)):!fe&&K?(this.select(ae),this.updateUIClasses({mouse:Ge.MOVE})):fe||K||(ne.forEach(function(ze){return O.doRender(ze)}),this.setSelected(ae),this.updateUIClasses({mouse:Ge.MOVE})),this.doRender(ae)},Yt.onMouseDown=function(y,S){return Hi(S)?this.startOnActiveFeature(y,S):this.drawConfig.boxSelect&&xn(S)?this.startBoxSelect(y,S):void 0},Yt.startBoxSelect=function(y,S){this.stopExtendedInteractions(y),this.map.dragPan.disable(),y.boxSelectStartLocation=Ct(S.originalEvent,this.map.getContainer()),y.canBoxSelect=!0},Yt.onTouchStart=function(y,S){if(Hi(S))return this.startOnActiveFeature(y,S)},Yt.onDrag=function(y,S){return y.canDragMove?this.dragMove(y,S):this.drawConfig.boxSelect&&y.canBoxSelect?this.whileBoxSelect(y,S):void 0},Yt.whileBoxSelect=function(y,S){y.boxSelecting=!0,this.updateUIClasses({mouse:Ge.ADD}),y.boxSelectElement||(y.boxSelectElement=document.createElement("div"),y.boxSelectElement.classList.add(ve.BOX_SELECT),this.map.getContainer().appendChild(y.boxSelectElement));var O=Ct(S.originalEvent,this.map.getContainer()),K=Math.min(y.boxSelectStartLocation.x,O.x),ne=Math.max(y.boxSelectStartLocation.x,O.x),ae=Math.min(y.boxSelectStartLocation.y,O.y),fe=Math.max(y.boxSelectStartLocation.y,O.y),ze="translate("+K+"px, "+ae+"px)";y.boxSelectElement.style.transform=ze,y.boxSelectElement.style.WebkitTransform=ze,y.boxSelectElement.style.width=ne-K+"px",y.boxSelectElement.style.height=fe-ae+"px"},Yt.dragMove=function(y,S){y.dragMoving=!0,S.originalEvent.stopPropagation();var O={lng:S.lngLat.lng-y.dragMoveLocation.lng,lat:S.lngLat.lat-y.dragMoveLocation.lat};ga(this.getSelected(),O),y.dragMoveLocation=S.lngLat},Yt.onTouchEnd=Yt.onMouseUp=function(y,S){var O=this;if(y.dragMoving)this.fireUpdate();else if(y.boxSelecting){var K=[y.boxSelectStartLocation,Ct(S.originalEvent,this.map.getContainer())],ne=this.featuresAt(null,K,"click"),ae=this.getUniqueIds(ne).filter(function(fe){return!O.isSelected(fe)});ae.length&&(this.select(ae),ae.forEach(function(fe){return O.doRender(fe)}),this.updateUIClasses({mouse:Ge.MOVE}))}this.stopExtendedInteractions(y)},Yt.toDisplayFeatures=function(y,S,O){S.properties.active=this.isSelected(S.properties.id)?Pt.ACTIVE:Pt.INACTIVE,O(S),this.fireActionable(),S.properties.active===Pt.ACTIVE&&S.geometry.type!==Fe.POINT&&zr(S).forEach(O)},Yt.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Yt.onCombineFeatures=function(){var y=this.getSelected();if(!(y.length===0||y.length<2)){for(var S=[],O=[],K=y[0].type.replace("Multi",""),ne=0;ne<y.length;ne++){var ae=y[ne];if(ae.type.replace("Multi","")!==K)return;ae.type.includes("Multi")?ae.getCoordinates().forEach(function(ze){S.push(ze)}):S.push(ae.getCoordinates()),O.push(ae.toGeoJSON())}if(O.length>1){var fe=this.newFeature({type:Fe.FEATURE,properties:O[0].properties,geometry:{type:"Multi"+K,coordinates:S}});this.addFeature(fe),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([fe.id]),this.map.fire(zt.COMBINE_FEATURES,{createdFeatures:[fe.toGeoJSON()],deletedFeatures:O})}this.fireActionable()}},Yt.onUncombineFeatures=function(){var y=this,S=this.getSelected();if(S.length!==0){for(var O=[],K=[],ne=function(fe){var ze=S[fe];y.isInstanceOf("MultiFeature",ze)&&(ze.getFeatures().forEach(function(Oe){y.addFeature(Oe),Oe.properties=ze.properties,O.push(Oe.toGeoJSON()),y.select([Oe.id])}),y.deleteFeature(ze.id,{silent:!0}),K.push(ze.toGeoJSON()))},ae=0;ae<S.length;ae++)ne(ae);O.length>1&&this.map.fire(zt.UNCOMBINE_FEATURES,{createdFeatures:O,deletedFeatures:K}),this.fireActionable()}};var mi=kn(bt.VERTEX),Bo=kn(bt.MIDPOINT),Dr={fireUpdate:function(){this.map.fire(zt.UPDATE,{action:tr.CHANGE_COORDINATES,features:this.getSelected().map(function(y){return y.toGeoJSON()})})},fireActionable:function(y){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:y.selectedCoordPaths.length>0})},startDragging:function(y,S){this.map.dragPan.disable(),y.canDragMove=!0,y.dragMoveLocation=S.lngLat},stopDragging:function(y){this.map.dragPan.enable(),y.dragMoving=!1,y.canDragMove=!1,y.dragMoveLocation=null},onVertex:function(y,S){this.startDragging(y,S);var O=S.featureTarget.properties,K=y.selectedCoordPaths.indexOf(O.coord_path);zn(S)||K!==-1?zn(S)&&K===-1&&y.selectedCoordPaths.push(O.coord_path):y.selectedCoordPaths=[O.coord_path];var ne=this.pathsToCoordinates(y.featureId,y.selectedCoordPaths);this.setSelectedCoordinates(ne)},onMidpoint:function(y,S){this.startDragging(y,S);var O=S.featureTarget.properties;y.feature.addCoordinate(O.coord_path,O.lng,O.lat),this.fireUpdate(),y.selectedCoordPaths=[O.coord_path]},pathsToCoordinates:function(y,S){return S.map(function(O){return{feature_id:y,coord_path:O}})},onFeature:function(y,S){y.selectedCoordPaths.length===0?this.startDragging(y,S):this.stopDragging(y)},dragFeature:function(y,S,O){ga(this.getSelected(),O),y.dragMoveLocation=S.lngLat},dragVertex:function(y,S,O){for(var K=y.selectedCoordPaths.map(function(ze){return y.feature.getCoordinate(ze)}),ne=ma(K.map(function(ze){return{type:Fe.FEATURE,properties:{},geometry:{type:Fe.POINT,coordinates:ze}}}),O),ae=0;ae<K.length;ae++){var fe=K[ae];y.feature.updateCoordinate(y.selectedCoordPaths[ae],fe[0]+ne.lng,fe[1]+ne.lat)}},clickNoTarget:function(){this.changeMode(ot.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(ot.SIMPLE_SELECT)},clickActiveFeature:function(y){y.selectedCoordPaths=[],this.clearSelectedCoordinates(),y.feature.changed()},onSetup:function(y){var S=y.featureId,O=this.getFeature(S);if(!O)throw new Error("You must provide a featureId to enter direct_select mode");if(O.type===Fe.POINT)throw new TypeError("direct_select mode doesn't handle point features");var K={featureId:S,feature:O,dragMoveLocation:y.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:y.coordPath?[y.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(S,K.selectedCoordPaths)),this.setSelected(S),Z.disable(this),this.setActionableState({trash:!0}),K},onStop:function(){Z.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(y,S,O){y.featureId===S.properties.id?(S.properties.active=Pt.ACTIVE,O(S),zr(S,{map:this.map,midpoints:!0,selectedPaths:y.selectedCoordPaths}).forEach(O)):(S.properties.active=Pt.INACTIVE,O(S)),this.fireActionable(y)},onTrash:function(y){y.selectedCoordPaths.sort(function(S,O){return O.localeCompare(S,"en",{numeric:!0})}).forEach(function(S){return y.feature.removeCoordinate(S)}),this.fireUpdate(),y.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(y),y.feature.isValid()===!1&&(this.deleteFeature([y.featureId]),this.changeMode(ot.SIMPLE_SELECT,{}))},onMouseMove:function(y,S){var O=Hi(S),K=mi(S),ne=Bo(S),ae=y.selectedCoordPaths.length===0;return O&&ae||K&&!ae?this.updateUIClasses({mouse:Ge.MOVE}):this.updateUIClasses({mouse:Ge.NONE}),(K||O||ne)&&y.dragMoving&&this.fireUpdate(),this.stopDragging(y),!0},onMouseOut:function(y){return y.dragMoving&&this.fireUpdate(),!0}};Dr.onTouchStart=Dr.onMouseDown=function(y,S){return mi(S)?this.onVertex(y,S):Hi(S)?this.onFeature(y,S):Bo(S)?this.onMidpoint(y,S):void 0},Dr.onDrag=function(y,S){if(y.canDragMove===!0){y.dragMoving=!0,S.originalEvent.stopPropagation();var O={lng:S.lngLat.lng-y.dragMoveLocation.lng,lat:S.lngLat.lat-y.dragMoveLocation.lat};y.selectedCoordPaths.length>0?this.dragVertex(y,S,O):this.dragFeature(y,S,O),y.dragMoveLocation=S.lngLat}},Dr.onClick=function(y,S){return Re(S)?this.clickNoTarget(y,S):Hi(S)?this.clickActiveFeature(y,S):Lo(S)?this.clickInactive(y,S):void this.stopDragging(y)},Dr.onTap=function(y,S){return Re(S)?this.clickNoTarget(y,S):Hi(S)?this.clickActiveFeature(y,S):Lo(S)?this.clickInactive(y,S):void 0},Dr.onTouchEnd=Dr.onMouseUp=function(y){y.dragMoving&&this.fireUpdate(),this.stopDragging(y)};var Fr={};function ya(y,S){return!!y.lngLat&&y.lngLat.lng===S[0]&&y.lngLat.lat===S[1]}Fr.onSetup=function(){var y=this.newFeature({type:Fe.FEATURE,properties:{},geometry:{type:Fe.POINT,coordinates:[]}});return this.addFeature(y),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Ge.ADD}),this.activateUIButton(yt.POINT),this.setActionableState({trash:!0}),{point:y}},Fr.stopDrawingAndRemove=function(y){this.deleteFeature([y.point.id],{silent:!0}),this.changeMode(ot.SIMPLE_SELECT)},Fr.onTap=Fr.onClick=function(y,S){this.updateUIClasses({mouse:Ge.MOVE}),y.point.updateCoordinate("",S.lngLat.lng,S.lngLat.lat),this.map.fire(zt.CREATE,{features:[y.point.toGeoJSON()]}),this.changeMode(ot.SIMPLE_SELECT,{featureIds:[y.point.id]})},Fr.onStop=function(y){this.activateUIButton(),y.point.getCoordinate().length||this.deleteFeature([y.point.id],{silent:!0})},Fr.toDisplayFeatures=function(y,S,O){var K=S.properties.id===y.point.id;if(S.properties.active=K?Pt.ACTIVE:Pt.INACTIVE,!K)return O(S)},Fr.onTrash=Fr.stopDrawingAndRemove,Fr.onKeyUp=function(y,S){if(vn(S)||Le(S))return this.stopDrawingAndRemove(y,S)};var gi={onSetup:function(){var y=this.newFeature({type:Fe.FEATURE,properties:{},geometry:{type:Fe.POLYGON,coordinates:[[]]}});return this.addFeature(y),this.clearSelectedFeatures(),Z.disable(this),this.updateUIClasses({mouse:Ge.ADD}),this.activateUIButton(yt.POLYGON),this.setActionableState({trash:!0}),{polygon:y,currentVertexPosition:0}},clickAnywhere:function(y,S){if(y.currentVertexPosition>0&&ya(S,y.polygon.coordinates[0][y.currentVertexPosition-1]))return this.changeMode(ot.SIMPLE_SELECT,{featureIds:[y.polygon.id]});this.updateUIClasses({mouse:Ge.ADD}),y.polygon.updateCoordinate("0."+y.currentVertexPosition,S.lngLat.lng,S.lngLat.lat),y.currentVertexPosition++,y.polygon.updateCoordinate("0."+y.currentVertexPosition,S.lngLat.lng,S.lngLat.lat)},clickOnVertex:function(y){return this.changeMode(ot.SIMPLE_SELECT,{featureIds:[y.polygon.id]})},onMouseMove:function(y,S){y.polygon.updateCoordinate("0."+y.currentVertexPosition,S.lngLat.lng,S.lngLat.lat),Jr(S)&&this.updateUIClasses({mouse:Ge.POINTER})}};gi.onTap=gi.onClick=function(y,S){return Jr(S)?this.clickOnVertex(y,S):this.clickAnywhere(y,S)},gi.onKeyUp=function(y,S){vn(S)?(this.deleteFeature([y.polygon.id],{silent:!0}),this.changeMode(ot.SIMPLE_SELECT)):Le(S)&&this.changeMode(ot.SIMPLE_SELECT,{featureIds:[y.polygon.id]})},gi.onStop=function(y){this.updateUIClasses({mouse:Ge.NONE}),Z.enable(this),this.activateUIButton(),this.getFeature(y.polygon.id)!==void 0&&(y.polygon.removeCoordinate("0."+y.currentVertexPosition),y.polygon.isValid()?this.map.fire(zt.CREATE,{features:[y.polygon.toGeoJSON()]}):(this.deleteFeature([y.polygon.id],{silent:!0}),this.changeMode(ot.SIMPLE_SELECT,{},{silent:!0})))},gi.toDisplayFeatures=function(y,S,O){var K=S.properties.id===y.polygon.id;if(S.properties.active=K?Pt.ACTIVE:Pt.INACTIVE,!K)return O(S);if(S.geometry.coordinates.length!==0){var ne=S.geometry.coordinates[0].length;if(!(ne<3)){if(S.properties.meta=bt.FEATURE,O(wi(y.polygon.id,S.geometry.coordinates[0][0],"0.0",!1)),ne>3){var ae=S.geometry.coordinates[0].length-3;O(wi(y.polygon.id,S.geometry.coordinates[0][ae],"0."+ae,!1))}if(ne<=4){var fe=[[S.geometry.coordinates[0][0][0],S.geometry.coordinates[0][0][1]],[S.geometry.coordinates[0][1][0],S.geometry.coordinates[0][1][1]]];if(O({type:Fe.FEATURE,properties:S.properties,geometry:{coordinates:fe,type:Fe.LINE_STRING}}),ne===3)return}return O(S)}}},gi.onTrash=function(y){this.deleteFeature([y.polygon.id],{silent:!0}),this.changeMode(ot.SIMPLE_SELECT)};var dr={onSetup:function(y){var S,O,K=(y=y||{}).featureId,ne="forward";if(K){if(!(S=this.getFeature(K)))throw new Error("Could not find a feature with the provided featureId");var ae=y.from;if(ae&&ae.type==="Feature"&&ae.geometry&&ae.geometry.type==="Point"&&(ae=ae.geometry),ae&&ae.type==="Point"&&ae.coordinates&&ae.coordinates.length===2&&(ae=ae.coordinates),!ae||!Array.isArray(ae))throw new Error("Please use the `from` property to indicate which point to continue the line from");var fe=S.coordinates.length-1;if(S.coordinates[fe][0]===ae[0]&&S.coordinates[fe][1]===ae[1])O=fe+1,S.addCoordinate.apply(S,[O].concat(S.coordinates[fe]));else{if(S.coordinates[0][0]!==ae[0]||S.coordinates[0][1]!==ae[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");ne="backwards",O=0,S.addCoordinate.apply(S,[O].concat(S.coordinates[0]))}}else S=this.newFeature({type:Fe.FEATURE,properties:{},geometry:{type:Fe.LINE_STRING,coordinates:[]}}),O=0,this.addFeature(S);return this.clearSelectedFeatures(),Z.disable(this),this.updateUIClasses({mouse:Ge.ADD}),this.activateUIButton(yt.LINE),this.setActionableState({trash:!0}),{line:S,currentVertexPosition:O,direction:ne}},clickAnywhere:function(y,S){if(y.currentVertexPosition>0&&ya(S,y.line.coordinates[y.currentVertexPosition-1])||y.direction==="backwards"&&ya(S,y.line.coordinates[y.currentVertexPosition+1]))return this.changeMode(ot.SIMPLE_SELECT,{featureIds:[y.line.id]});this.updateUIClasses({mouse:Ge.ADD}),y.line.updateCoordinate(y.currentVertexPosition,S.lngLat.lng,S.lngLat.lat),y.direction==="forward"?(y.currentVertexPosition++,y.line.updateCoordinate(y.currentVertexPosition,S.lngLat.lng,S.lngLat.lat)):y.line.addCoordinate(0,S.lngLat.lng,S.lngLat.lat)},clickOnVertex:function(y){return this.changeMode(ot.SIMPLE_SELECT,{featureIds:[y.line.id]})},onMouseMove:function(y,S){y.line.updateCoordinate(y.currentVertexPosition,S.lngLat.lng,S.lngLat.lat),Jr(S)&&this.updateUIClasses({mouse:Ge.POINTER})}};dr.onTap=dr.onClick=function(y,S){if(Jr(S))return this.clickOnVertex(y,S);this.clickAnywhere(y,S)},dr.onKeyUp=function(y,S){Le(S)?this.changeMode(ot.SIMPLE_SELECT,{featureIds:[y.line.id]}):vn(S)&&(this.deleteFeature([y.line.id],{silent:!0}),this.changeMode(ot.SIMPLE_SELECT))},dr.onStop=function(y){Z.enable(this),this.activateUIButton(),this.getFeature(y.line.id)!==void 0&&(y.line.removeCoordinate(""+y.currentVertexPosition),y.line.isValid()?this.map.fire(zt.CREATE,{features:[y.line.toGeoJSON()]}):(this.deleteFeature([y.line.id],{silent:!0}),this.changeMode(ot.SIMPLE_SELECT,{},{silent:!0})))},dr.onTrash=function(y){this.deleteFeature([y.line.id],{silent:!0}),this.changeMode(ot.SIMPLE_SELECT)},dr.toDisplayFeatures=function(y,S,O){var K=S.properties.id===y.line.id;if(S.properties.active=K?Pt.ACTIVE:Pt.INACTIVE,!K)return O(S);S.geometry.coordinates.length<2||(S.properties.meta=bt.FEATURE,O(wi(y.line.id,S.geometry.coordinates[y.direction==="forward"?S.geometry.coordinates.length-2:1],""+(y.direction==="forward"?S.geometry.coordinates.length-2:1),!1)),O(S))};var Ro={simple_select:Yt,direct_select:Dr,draw_point:Fr,draw_polygon:gi,draw_line_string:dr},po={defaultMode:ot.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Fo,modes:Ro,controls:{},userProperties:!1},Pr={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},fo={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Xi(y,S){return y.map(function(O){return O.source?O:qt(O,{id:O.id+"."+S,source:S==="hot"?se.HOT:se.COLD})})}var Oo={exports:{}};(function(y,S){var O="__lodash_hash_undefined__",K=9007199254740991,ne="[object Arguments]",ae="[object Array]",fe="[object Boolean]",ze="[object Date]",Oe="[object Error]",We="[object Function]",Ze="[object Map]",$e="[object Number]",xt="[object Object]",pr="[object Promise]",gt="[object RegExp]",Wt="[object Set]",ke="[object String]",ct="[object Symbol]",Qt="[object WeakMap]",Vr="[object ArrayBuffer]",gr="[object DataView]",bs=/^\[object .+?Constructor\]$/,Js=/^(?:0|[1-9]\d*)$/,fr={};fr["[object Float32Array]"]=fr["[object Float64Array]"]=fr["[object Int8Array]"]=fr["[object Int16Array]"]=fr["[object Int32Array]"]=fr["[object Uint8Array]"]=fr["[object Uint8ClampedArray]"]=fr["[object Uint16Array]"]=fr["[object Uint32Array]"]=!0,fr[ne]=fr[ae]=fr[Vr]=fr[fe]=fr[gr]=fr[ze]=fr[Oe]=fr[We]=fr[Ze]=fr[$e]=fr[xt]=fr[gt]=fr[Wt]=fr[ke]=fr[Qt]=!1;var Ks=typeof ja=="object"&&ja&&ja.Object===Object&&ja,Gl=typeof self=="object"&&self&&self.Object===Object&&self,Fn=Ks||Gl||Function("return this")(),_a=S&&!S.nodeType&&S,Va=_a&&y&&!y.nodeType&&y,xa=Va&&Va.exports===_a,va=xa&&Ks.process,No=function(){try{return va&&va.binding&&va.binding("util")}catch{}}(),Ii=No&&No.isTypedArray;function Ht(me,xe){for(var Ve=-1,ft=me==null?0:me.length;++Ve<ft;)if(xe(me[Ve],Ve,me))return!0;return!1}function ws(me){var xe=-1,Ve=Array(me.size);return me.forEach(function(ft,ir){Ve[++xe]=[ir,ft]}),Ve}function ba(me){var xe=-1,Ve=Array(me.size);return me.forEach(function(ft){Ve[++xe]=ft}),Ve}var $o,Ys,wa,Zl=Array.prototype,Vo=Function.prototype,Ua=Object.prototype,qa=Fn["__core-js_shared__"],Qs=Vo.toString,an=Ua.hasOwnProperty,Ga=($o=/[^.]+$/.exec(qa&&qa.keys&&qa.keys.IE_PROTO||""))?"Symbol(src)_1."+$o:"",Ss=Ua.toString,el=RegExp("^"+Qs.call(an).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ts=xa?Fn.Buffer:void 0,Sa=Fn.Symbol,Jn=Fn.Uint8Array,Is=Ua.propertyIsEnumerable,Wl=Zl.splice,mo=Sa?Sa.toStringTag:void 0,Cs=Object.getOwnPropertySymbols,Ta=Ts?Ts.isBuffer:void 0,Hl=(Ys=Object.keys,wa=Object,function(me){return Ys(wa(me))}),Uo=Ri(Fn,"DataView"),Ia=Ri(Fn,"Map"),Es=Ri(Fn,"Promise"),Za=Ri(Fn,"Set"),Wa=Ri(Fn,"WeakMap"),qo=Ri(Object,"create"),As=Yn(Uo),tl=Yn(Ia),Go=Yn(Es),Ln=Yn(Za),Ps=Yn(Wa),Ha=Sa?Sa.prototype:void 0,Ca=Ha?Ha.valueOf:void 0;function or(me){var xe=-1,Ve=me==null?0:me.length;for(this.clear();++xe<Ve;){var ft=me[xe];this.set(ft[0],ft[1])}}function sn(me){var xe=-1,Ve=me==null?0:me.length;for(this.clear();++xe<Ve;){var ft=me[xe];this.set(ft[0],ft[1])}}function St(me){var xe=-1,Ve=me==null?0:me.length;for(this.clear();++xe<Ve;){var ft=me[xe];this.set(ft[0],ft[1])}}function Kn(me){var xe=-1,Ve=me==null?0:me.length;for(this.__data__=new St;++xe<Ve;)this.add(me[xe])}function er(me){var xe=this.__data__=new sn(me);this.size=xe.size}function yr(me,xe){var Ve=vo(me),ft=!Ve&&xo(me),ir=!Ve&&!ft&&Ho(me),Lt=!Ve&&!ft&&!ir&&wn(me),wr=Ve||ft||ir||Lt,Br=wr?function(Rr,ji){for(var Ji=-1,ii=Array(Rr);++Ji<Rr;)ii[Ji]=ji(Ji);return ii}(me.length,String):[],Oi=Br.length;for(var Mr in me)!xe&&!an.call(me,Mr)||wr&&(Mr=="length"||ir&&(Mr=="offset"||Mr=="parent")||Lt&&(Mr=="buffer"||Mr=="byteLength"||Mr=="byteOffset")||nl(Mr,Oi))||Br.push(Mr);return Br}function go(me,xe){for(var Ve=me.length;Ve--;)if(Ka(me[Ve][0],xe))return Ve;return-1}function Zo(me){return me==null?me===void 0?"[object Undefined]":"[object Null]":mo&&mo in Object(me)?function(xe){var Ve=an.call(xe,mo),ft=xe[mo];try{xe[mo]=void 0;var ir=!0}catch{}var Lt=Ss.call(xe);return ir&&(Ve?xe[mo]=ft:delete xe[mo]),Lt}(me):function(xe){return Ss.call(xe)}(me)}function Xa(me){return ln(me)&&Zo(me)==ne}function rl(me,xe,Ve,ft,ir){return me===xe||(me==null||xe==null||!ln(me)&&!ln(xe)?me!=me&&xe!=xe:function(Lt,wr,Br,Oi,Mr,Rr){var ji=vo(Lt),Ji=vo(wr),ii=ji?ae:Lr(Lt),cn=Ji?ae:Lr(wr),Sn=(ii=ii==ne?xt:ii)==xt,Tn=(cn=cn==ne?xt:cn)==xt,Or=ii==cn;if(Or&&Ho(Lt)){if(!Ho(wr))return!1;ji=!0,Sn=!1}if(Or&&!Sn)return Rr||(Rr=new er),ji||wn(Lt)?Ea(Lt,wr,Br,Oi,Mr,Rr):function(Xt,Ut,Qn,Bn,Jo,yi,_i){switch(Qn){case gr:if(Xt.byteLength!=Ut.byteLength||Xt.byteOffset!=Ut.byteOffset)return!1;Xt=Xt.buffer,Ut=Ut.buffer;case Vr:return!(Xt.byteLength!=Ut.byteLength||!yi(new Jn(Xt),new Jn(Ut)));case fe:case ze:case $e:return Ka(+Xt,+Ut);case Oe:return Xt.name==Ut.name&&Xt.message==Ut.message;case gt:case ke:return Xt==Ut+"";case Ze:var eo=ws;case Wt:var to=1&Bn;if(eo||(eo=ba),Xt.size!=Ut.size&&!to)return!1;var mr=_i.get(Xt);if(mr)return mr==Ut;Bn|=2,_i.set(Xt,Ut);var Ci=Ea(eo(Xt),eo(Ut),Bn,Jo,yi,_i);return _i.delete(Xt),Ci;case ct:if(Ca)return Ca.call(Xt)==Ca.call(Ut)}return!1}(Lt,wr,ii,Br,Oi,Mr,Rr);if(!(1&Br)){var un=Sn&&an.call(Lt,"__wrapped__"),Ms=Tn&&an.call(wr,"__wrapped__");if(un||Ms){var ks=un?Lt.value():Lt,Xl=Ms?wr.value():wr;return Rr||(Rr=new er),Mr(ks,Xl,Br,Oi,Rr)}}return Or?(Rr||(Rr=new er),function(Xt,Ut,Qn,Bn,Jo,yi){var _i=1&Qn,eo=Wo(Xt),to=eo.length,mr=Wo(Ut).length;if(to!=mr&&!_i)return!1;for(var Ci=to;Ci--;){var Wr=eo[Ci];if(!(_i?Wr in Ut:an.call(Ut,Wr)))return!1}var Pa=yi.get(Xt);if(Pa&&yi.get(Ut))return Pa==Ut;var Ko=!0;yi.set(Xt,Ut),yi.set(Ut,Xt);for(var Yo=_i;++Ci<to;){var Ki=Xt[Wr=eo[Ci]],Rn=Ut[Wr];if(Bn)var Ma=_i?Bn(Rn,Ki,Wr,Ut,Xt,yi):Bn(Ki,Rn,Wr,Xt,Ut,yi);if(!(Ma===void 0?Ki===Rn||Jo(Ki,Rn,Qn,Bn,yi):Ma)){Ko=!1;break}Yo||(Yo=Wr=="constructor")}if(Ko&&!Yo){var Qo=Xt.constructor,ea=Ut.constructor;Qo==ea||!("constructor"in Xt)||!("constructor"in Ut)||typeof Qo=="function"&&Qo instanceof Qo&&typeof ea=="function"&&ea instanceof ea||(Ko=!1)}return yi.delete(Xt),yi.delete(Ut),Ko}(Lt,wr,Br,Oi,Mr,Rr)):!1}(me,xe,Ve,ft,rl,ir))}function il(me){return!(!Ya(me)||function(xe){return!!Ga&&Ga in xe}(me))&&(Xo(me)?el:bs).test(Yn(me))}function Ja(me){if(Ve=(xe=me)&&xe.constructor,ft=typeof Ve=="function"&&Ve.prototype||Ua,xe!==ft)return Hl(me);var xe,Ve,ft,ir=[];for(var Lt in Object(me))an.call(me,Lt)&&Lt!="constructor"&&ir.push(Lt);return ir}function Ea(me,xe,Ve,ft,ir,Lt){var wr=1&Ve,Br=me.length,Oi=xe.length;if(Br!=Oi&&!(wr&&Oi>Br))return!1;var Mr=Lt.get(me);if(Mr&&Lt.get(xe))return Mr==xe;var Rr=-1,ji=!0,Ji=2&Ve?new Kn:void 0;for(Lt.set(me,xe),Lt.set(xe,me);++Rr<Br;){var ii=me[Rr],cn=xe[Rr];if(ft)var Sn=wr?ft(cn,ii,Rr,xe,me,Lt):ft(ii,cn,Rr,me,xe,Lt);if(Sn!==void 0){if(Sn)continue;ji=!1;break}if(Ji){if(!Ht(xe,function(Tn,Or){if(un=Or,!Ji.has(un)&&(ii===Tn||ir(ii,Tn,Ve,ft,Lt)))return Ji.push(Or);var un})){ji=!1;break}}else if(ii!==cn&&!ir(ii,cn,Ve,ft,Lt)){ji=!1;break}}return Lt.delete(me),Lt.delete(xe),ji}function Wo(me){return function(xe,Ve,ft){var ir=Ve(xe);return vo(xe)?ir:function(Lt,wr){for(var Br=-1,Oi=wr.length,Mr=Lt.length;++Br<Oi;)Lt[Mr+Br]=wr[Br];return Lt}(ir,ft(xe))}(me,ol,_o)}function yo(me,xe){var Ve,ft,ir=me.__data__;return((ft=typeof(Ve=xe))=="string"||ft=="number"||ft=="symbol"||ft=="boolean"?Ve!=="__proto__":Ve===null)?ir[typeof xe=="string"?"string":"hash"]:ir.map}function Ri(me,xe){var Ve=function(ft,ir){return ft?.[ir]}(me,xe);return il(Ve)?Ve:void 0}or.prototype.clear=function(){this.__data__=qo?qo(null):{},this.size=0},or.prototype.delete=function(me){var xe=this.has(me)&&delete this.__data__[me];return this.size-=xe?1:0,xe},or.prototype.get=function(me){var xe=this.__data__;if(qo){var Ve=xe[me];return Ve===O?void 0:Ve}return an.call(xe,me)?xe[me]:void 0},or.prototype.has=function(me){var xe=this.__data__;return qo?xe[me]!==void 0:an.call(xe,me)},or.prototype.set=function(me,xe){var Ve=this.__data__;return this.size+=this.has(me)?0:1,Ve[me]=qo&&xe===void 0?O:xe,this},sn.prototype.clear=function(){this.__data__=[],this.size=0},sn.prototype.delete=function(me){var xe=this.__data__,Ve=go(xe,me);return!(Ve<0)&&(Ve==xe.length-1?xe.pop():Wl.call(xe,Ve,1),--this.size,!0)},sn.prototype.get=function(me){var xe=this.__data__,Ve=go(xe,me);return Ve<0?void 0:xe[Ve][1]},sn.prototype.has=function(me){return go(this.__data__,me)>-1},sn.prototype.set=function(me,xe){var Ve=this.__data__,ft=go(Ve,me);return ft<0?(++this.size,Ve.push([me,xe])):Ve[ft][1]=xe,this},St.prototype.clear=function(){this.size=0,this.__data__={hash:new or,map:new(Ia||sn),string:new or}},St.prototype.delete=function(me){var xe=yo(this,me).delete(me);return this.size-=xe?1:0,xe},St.prototype.get=function(me){return yo(this,me).get(me)},St.prototype.has=function(me){return yo(this,me).has(me)},St.prototype.set=function(me,xe){var Ve=yo(this,me),ft=Ve.size;return Ve.set(me,xe),this.size+=Ve.size==ft?0:1,this},Kn.prototype.add=Kn.prototype.push=function(me){return this.__data__.set(me,O),this},Kn.prototype.has=function(me){return this.__data__.has(me)},er.prototype.clear=function(){this.__data__=new sn,this.size=0},er.prototype.delete=function(me){var xe=this.__data__,Ve=xe.delete(me);return this.size=xe.size,Ve},er.prototype.get=function(me){return this.__data__.get(me)},er.prototype.has=function(me){return this.__data__.has(me)},er.prototype.set=function(me,xe){var Ve=this.__data__;if(Ve instanceof sn){var ft=Ve.__data__;if(!Ia||ft.length<199)return ft.push([me,xe]),this.size=++Ve.size,this;Ve=this.__data__=new St(ft)}return Ve.set(me,xe),this.size=Ve.size,this};var _o=Cs?function(me){return me==null?[]:(me=Object(me),function(xe,Ve){for(var ft=-1,ir=xe==null?0:xe.length,Lt=0,wr=[];++ft<ir;){var Br=xe[ft];Ve(Br,ft,xe)&&(wr[Lt++]=Br)}return wr}(Cs(me),function(xe){return Is.call(me,xe)}))}:function(){return[]},Lr=Zo;function nl(me,xe){return!!(xe=xe??K)&&(typeof me=="number"||Js.test(me))&&me>-1&&me%1==0&&me<xe}function Yn(me){if(me!=null){try{return Qs.call(me)}catch{}try{return me+""}catch{}}return""}function Ka(me,xe){return me===xe||me!=me&&xe!=xe}(Uo&&Lr(new Uo(new ArrayBuffer(1)))!=gr||Ia&&Lr(new Ia)!=Ze||Es&&Lr(Es.resolve())!=pr||Za&&Lr(new Za)!=Wt||Wa&&Lr(new Wa)!=Qt)&&(Lr=function(me){var xe=Zo(me),Ve=xe==xt?me.constructor:void 0,ft=Ve?Yn(Ve):"";if(ft)switch(ft){case As:return gr;case tl:return Ze;case Go:return pr;case Ln:return Wt;case Ps:return Qt}return xe});var xo=Xa(function(){return arguments}())?Xa:function(me){return ln(me)&&an.call(me,"callee")&&!Is.call(me,"callee")},vo=Array.isArray,Ho=Ta||function(){return!1};function Xo(me){if(!Ya(me))return!1;var xe=Zo(me);return xe==We||xe=="[object GeneratorFunction]"||xe=="[object AsyncFunction]"||xe=="[object Proxy]"}function Aa(me){return typeof me=="number"&&me>-1&&me%1==0&&me<=K}function Ya(me){var xe=typeof me;return me!=null&&(xe=="object"||xe=="function")}function ln(me){return me!=null&&typeof me=="object"}var wn=Ii?function(me){return function(xe){return me(xe)}}(Ii):function(me){return ln(me)&&Aa(me.length)&&!!fr[Zo(me)]};function ol(me){return(xe=me)!=null&&Aa(xe.length)&&!Xo(xe)?yr(me):Ja(me);var xe}y.exports=function(me,xe){return rl(me,xe)}})(Oo,Oo.exports);var on=M(Oo.exports);function Na(y,S){return y.length===S.length&&JSON.stringify(y.map(function(O){return O}).sort())===JSON.stringify(S.map(function(O){return O}).sort())}var jo={Polygon:jr,LineString:ri,Point:Zi,MultiPolygon:qr,MultiLineString:qr,MultiPoint:qr},Zt=Object.freeze({__proto__:null,CommonSelectors:kt,constrainFeatureMovement:ma,createMidPoint:bn,createSupplementaryPoints:zr,createVertex:wi,doubleClickZoom:Z,euclideanDistance:pi,featuresAt:$t,getFeatureAtAndSetCursors:di,isClick:yn,isEventAtCoordinates:ya,isTap:bi,mapEventToBoundingBox:Ft,ModeHandler:I,moveFeatures:ga,sortFeatures:li,stringSetsAreEqual:Na,StringSet:Er,theme:Fo,toDenseArray:vr}),$a=function(y,S){var O={options:y=function(ne){ne===void 0&&(ne={});var ae=qt(ne);return ne.controls||(ae.controls={}),ne.displayControlsDefault===!1?ae.controls=qt(fo,ne.controls):ae.controls=qt(Pr,ne.controls),(ae=qt(po,ae)).styles=Xi(ae.styles,"cold").concat(Xi(ae.styles,"hot")),ae}(y)};S=function(ne,ae){return ae.modes=ot,ae.getFeatureIdsAt=function(fe){return $t.click({point:fe},null,ne).map(function(ze){return ze.properties.id})},ae.getSelectedIds=function(){return ne.store.getSelectedIds()},ae.getSelected=function(){return{type:Fe.FEATURE_COLLECTION,features:ne.store.getSelectedIds().map(function(fe){return ne.store.get(fe)}).map(function(fe){return fe.toGeoJSON()})}},ae.getSelectedPoints=function(){return{type:Fe.FEATURE_COLLECTION,features:ne.store.getSelectedCoordinates().map(function(fe){return{type:Fe.FEATURE,properties:{},geometry:{type:Fe.POINT,coordinates:fe.coordinates}}})}},ae.set=function(fe){if(fe.type===void 0||fe.type!==Fe.FEATURE_COLLECTION||!Array.isArray(fe.features))throw new Error("Invalid FeatureCollection");var ze=ne.store.createRenderBatch(),Oe=ne.store.getAllIds().slice(),We=ae.add(fe),Ze=new Er(We);return(Oe=Oe.filter(function($e){return!Ze.has($e)})).length&&ae.delete(Oe),ze(),We},ae.add=function(fe){var ze=JSON.parse(JSON.stringify(X(fe))).features.map(function(Oe){if(Oe.id=Oe.id||Xr(),Oe.geometry===null)throw new Error("Invalid geometry: null");if(ne.store.get(Oe.id)===void 0||ne.store.get(Oe.id).type!==Oe.geometry.type){var We=jo[Oe.geometry.type];if(We===void 0)throw new Error("Invalid geometry type: "+Oe.geometry.type+".");var Ze=new We(ne,Oe);ne.store.add(Ze)}else{var $e=ne.store.get(Oe.id);$e.properties=Oe.properties,on($e.properties,Oe.properties)||ne.store.featureChanged($e.id),on($e.getCoordinates(),Oe.geometry.coordinates)||$e.incomingCoords(Oe.geometry.coordinates)}return Oe.id});return ne.store.render(),ze},ae.get=function(fe){var ze=ne.store.get(fe);if(ze)return ze.toGeoJSON()},ae.getAll=function(){return{type:Fe.FEATURE_COLLECTION,features:ne.store.getAll().map(function(fe){return fe.toGeoJSON()})}},ae.delete=function(fe){return ne.store.delete(fe,{silent:!0}),ae.getMode()!==ot.DIRECT_SELECT||ne.store.getSelectedIds().length?ne.store.render():ne.events.changeMode(ot.SIMPLE_SELECT,void 0,{silent:!0}),ae},ae.deleteAll=function(){return ne.store.delete(ne.store.getAllIds(),{silent:!0}),ae.getMode()===ot.DIRECT_SELECT?ne.events.changeMode(ot.SIMPLE_SELECT,void 0,{silent:!0}):ne.store.render(),ae},ae.changeMode=function(fe,ze){return ze===void 0&&(ze={}),fe===ot.SIMPLE_SELECT&&ae.getMode()===ot.SIMPLE_SELECT?(Na(ze.featureIds||[],ne.store.getSelectedIds())||(ne.store.setSelected(ze.featureIds,{silent:!0}),ne.store.render()),ae):(fe===ot.DIRECT_SELECT&&ae.getMode()===ot.DIRECT_SELECT&&ze.featureId===ne.store.getSelectedIds()[0]||ne.events.changeMode(fe,ze,{silent:!0}),ae)},ae.getMode=function(){return ne.events.getMode()},ae.trash=function(){return ne.events.trash({silent:!0}),ae},ae.combineFeatures=function(){return ne.events.combineFeatures({silent:!0}),ae},ae.uncombineFeatures=function(){return ne.events.uncombineFeatures({silent:!0}),ae},ae.setFeatureProperty=function(fe,ze,Oe){return ne.store.setFeatureProperty(fe,ze,Oe),ae},ae}(O,S),O.api=S;var K=Do(O);return S.onAdd=K.onAdd,S.onRemove=K.onRemove,S.types=yt,S.options=y,S};function Dn(y){$a(y,this)}return Dn.modes=Ro,Dn.constants=Ot,Dn.lib=Zt,Dn})})(sy);var c0=sy.exports;const u0=ep(c0);var xm=Object.prototype.toString,ly=function(f){var I=xm.call(f),M=I==="[object Arguments]";return M||(M=I!=="[object Array]"&&f!==null&&typeof f=="object"&&typeof f.length=="number"&&f.length>=0&&xm.call(f.callee)==="[object Function]"),M},ad,vm;function h0(){if(vm)return ad;vm=1;var g;if(!Object.keys){var f=Object.prototype.hasOwnProperty,I=Object.prototype.toString,M=ly,R=Object.prototype.propertyIsEnumerable,V=!R.call({toString:null},"toString"),A=R.call(function(){},"prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],le=function(se){var Ge=se.constructor;return Ge&&Ge.prototype===se},Ae={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},Ne=function(){if(typeof window>"u")return!1;for(var se in window)try{if(!Ae["$"+se]&&f.call(window,se)&&window[se]!==null&&typeof window[se]=="object")try{le(window[se])}catch{return!0}}catch{return!0}return!1}(),ve=function(se){if(typeof window>"u"||!Ne)return le(se);try{return le(se)}catch{return!1}};g=function(Ge){var yt=Ge!==null&&typeof Ge=="object",Fe=I.call(Ge)==="[object Function]",ot=M(Ge),zt=yt&&I.call(Ge)==="[object String]",tr=[];if(!yt&&!Fe&&!ot)throw new TypeError("Object.keys called on a non-object");var bt=A&&Fe;if(zt&&Ge.length>0&&!f.call(Ge,0))for(var Pt=0;Pt<Ge.length;++Pt)tr.push(String(Pt));if(ot&&Ge.length>0)for(var Nt=0;Nt<Ge.length;++Nt)tr.push(String(Nt));else for(var tt in Ge)!(bt&&tt==="prototype")&&f.call(Ge,tt)&&tr.push(String(tt));if(V)for(var Ot=ve(Ge),cr=0;cr<u.length;++cr)!(Ot&&u[cr]==="constructor")&&f.call(Ge,u[cr])&&tr.push(u[cr]);return tr}}return ad=g,ad}var d0=Array.prototype.slice,p0=ly,bm=Object.keys,ju=bm?function(f){return bm(f)}:h0(),wm=Object.keys;ju.shim=function(){if(Object.keys){var f=function(){var I=Object.keys(arguments);return I&&I.length===arguments.length}(1,2);f||(Object.keys=function(M){return p0(M)?wm(d0.call(M)):wm(M)})}else Object.keys=ju;return Object.keys||ju};var np=ju,f0=Error,m0=EvalError,g0=RangeError,y0=ReferenceError,cy=SyntaxError,ys=TypeError,_0=URIError,ch=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var f={},I=Symbol("test"),M=Object(I);if(typeof I=="string"||Object.prototype.toString.call(I)!=="[object Symbol]"||Object.prototype.toString.call(M)!=="[object Symbol]")return!1;var R=42;f[I]=R;for(I in f)return!1;if(typeof Object.keys=="function"&&Object.keys(f).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(f).length!==0)return!1;var V=Object.getOwnPropertySymbols(f);if(V.length!==1||V[0]!==I||!Object.prototype.propertyIsEnumerable.call(f,I))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var A=Object.getOwnPropertyDescriptor(f,I);if(A.value!==R||A.enumerable!==!0)return!1}return!0},Sm=typeof Symbol<"u"&&Symbol,x0=ch,op=function(){return typeof Sm!="function"||typeof Symbol!="function"||typeof Sm("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:x0()},sd={__proto__:null,foo:{}},v0=Object,b0=function(){return{__proto__:sd}.foo===sd.foo&&!(sd instanceof v0)},w0="Function.prototype.bind called on incompatible ",S0=Object.prototype.toString,T0=Math.max,I0="[object Function]",Tm=function(f,I){for(var M=[],R=0;R<f.length;R+=1)M[R]=f[R];for(var V=0;V<I.length;V+=1)M[V+f.length]=I[V];return M},C0=function(f,I){for(var M=[],R=I||0,V=0;R<f.length;R+=1,V+=1)M[V]=f[R];return M},E0=function(g,f){for(var I="",M=0;M<g.length;M+=1)I+=g[M],M+1<g.length&&(I+=f);return I},A0=function(f){var I=this;if(typeof I!="function"||S0.apply(I)!==I0)throw new TypeError(w0+I);for(var M=C0(arguments,1),R,V=function(){if(this instanceof R){var Ne=I.apply(this,Tm(M,arguments));return Object(Ne)===Ne?Ne:this}return I.apply(f,Tm(M,arguments))},A=T0(0,I.length-M.length),u=[],le=0;le<A;le++)u[le]="$"+le;if(R=Function("binder","return function ("+E0(u,",")+"){ return binder.apply(this,arguments); }")(V),I.prototype){var Ae=function(){};Ae.prototype=I.prototype,R.prototype=new Ae,Ae.prototype=null}return R},P0=A0,ap=Function.prototype.bind||P0,M0=Function.prototype.call,k0=Object.prototype.hasOwnProperty,z0=ap,uy=z0.call(M0,k0),Jt,D0=f0,F0=m0,L0=g0,B0=y0,Bl=cy,Ll=ys,R0=_0,hy=Function,ld=function(g){try{return hy('"use strict"; return ('+g+").constructor;")()}catch{}},Gs=Object.getOwnPropertyDescriptor;if(Gs)try{Gs({},"")}catch{Gs=null}var cd=function(){throw new Ll},O0=Gs?function(){try{return arguments.callee,cd}catch{try{return Gs(arguments,"callee").get}catch{return cd}}}():cd,Al=op(),j0=b0(),Li=Object.getPrototypeOf||(j0?function(g){return g.__proto__}:null),Ml={},N0=typeof Uint8Array>"u"||!Li?Jt:Li(Uint8Array),Zs={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Jt:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Jt:ArrayBuffer,"%ArrayIteratorPrototype%":Al&&Li?Li([][Symbol.iterator]()):Jt,"%AsyncFromSyncIteratorPrototype%":Jt,"%AsyncFunction%":Ml,"%AsyncGenerator%":Ml,"%AsyncGeneratorFunction%":Ml,"%AsyncIteratorPrototype%":Ml,"%Atomics%":typeof Atomics>"u"?Jt:Atomics,"%BigInt%":typeof BigInt>"u"?Jt:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Jt:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Jt:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Jt:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":D0,"%eval%":eval,"%EvalError%":F0,"%Float32Array%":typeof Float32Array>"u"?Jt:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Jt:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Jt:FinalizationRegistry,"%Function%":hy,"%GeneratorFunction%":Ml,"%Int8Array%":typeof Int8Array>"u"?Jt:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Jt:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Jt:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Al&&Li?Li(Li([][Symbol.iterator]())):Jt,"%JSON%":typeof JSON=="object"?JSON:Jt,"%Map%":typeof Map>"u"?Jt:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Al||!Li?Jt:Li(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Jt:Promise,"%Proxy%":typeof Proxy>"u"?Jt:Proxy,"%RangeError%":L0,"%ReferenceError%":B0,"%Reflect%":typeof Reflect>"u"?Jt:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Jt:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Al||!Li?Jt:Li(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Jt:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Al&&Li?Li(""[Symbol.iterator]()):Jt,"%Symbol%":Al?Symbol:Jt,"%SyntaxError%":Bl,"%ThrowTypeError%":O0,"%TypedArray%":N0,"%TypeError%":Ll,"%Uint8Array%":typeof Uint8Array>"u"?Jt:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Jt:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Jt:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Jt:Uint32Array,"%URIError%":R0,"%WeakMap%":typeof WeakMap>"u"?Jt:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Jt:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Jt:WeakSet};if(Li)try{null.error}catch(g){var $0=Li(Li(g));Zs["%Error.prototype%"]=$0}var V0=function g(f){var I;if(f==="%AsyncFunction%")I=ld("async function () {}");else if(f==="%GeneratorFunction%")I=ld("function* () {}");else if(f==="%AsyncGeneratorFunction%")I=ld("async function* () {}");else if(f==="%AsyncGenerator%"){var M=g("%AsyncGeneratorFunction%");M&&(I=M.prototype)}else if(f==="%AsyncIteratorPrototype%"){var R=g("%AsyncGenerator%");R&&Li&&(I=Li(R.prototype))}return Zs[f]=I,I},Im={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},qc=ap,Hu=uy,U0=qc.call(Function.call,Array.prototype.concat),q0=qc.call(Function.apply,Array.prototype.splice),Cm=qc.call(Function.call,String.prototype.replace),Xu=qc.call(Function.call,String.prototype.slice),G0=qc.call(Function.call,RegExp.prototype.exec),Z0=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,W0=/\\(\\)?/g,H0=function(f){var I=Xu(f,0,1),M=Xu(f,-1);if(I==="%"&&M!=="%")throw new Bl("invalid intrinsic syntax, expected closing `%`");if(M==="%"&&I!=="%")throw new Bl("invalid intrinsic syntax, expected opening `%`");var R=[];return Cm(f,Z0,function(V,A,u,le){R[R.length]=u?Cm(le,W0,"$1"):A||V}),R},X0=function(f,I){var M=f,R;if(Hu(Im,M)&&(R=Im[M],M="%"+R[0]+"%"),Hu(Zs,M)){var V=Zs[M];if(V===Ml&&(V=V0(M)),typeof V>"u"&&!I)throw new Ll("intrinsic "+f+" exists, but is not available. Please file an issue!");return{alias:R,name:M,value:V}}throw new Bl("intrinsic "+f+" does not exist!")},ha=function(f,I){if(typeof f!="string"||f.length===0)throw new Ll("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof I!="boolean")throw new Ll('"allowMissing" argument must be a boolean');if(G0(/^%?[^%]*%?$/,f)===null)throw new Bl("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var M=H0(f),R=M.length>0?M[0]:"",V=X0("%"+R+"%",I),A=V.name,u=V.value,le=!1,Ae=V.alias;Ae&&(R=Ae[0],q0(M,U0([0,1],Ae)));for(var Ne=1,ve=!0;Ne<M.length;Ne+=1){var se=M[Ne],Ge=Xu(se,0,1),yt=Xu(se,-1);if((Ge==='"'||Ge==="'"||Ge==="`"||yt==='"'||yt==="'"||yt==="`")&&Ge!==yt)throw new Bl("property names with quotes must have matching quotes");if((se==="constructor"||!ve)&&(le=!0),R+="."+se,A="%"+R+"%",Hu(Zs,A))u=Zs[A];else if(u!=null){if(!(se in u)){if(!I)throw new Ll("base intrinsic for "+f+" exists, but the property is not available.");return}if(Gs&&Ne+1>=M.length){var Fe=Gs(u,se);ve=!!Fe,ve&&"get"in Fe&&!("originalValue"in Fe.get)?u=Fe.get:u=u[se]}else ve=Hu(u,se),u=u[se];ve&&!le&&(Zs[A]=u)}}return u},J0=ha,Nu=J0("%Object.defineProperty%",!0)||!1;if(Nu)try{Nu({},"a",{value:1})}catch{Nu=!1}var sp=Nu,K0=ha,$u=K0("%Object.getOwnPropertyDescriptor%",!0);if($u)try{$u([],"length")}catch{$u=null}var lp=$u,Em=sp,Y0=cy,Pl=ys,Am=lp,cp=function(f,I,M){if(!f||typeof f!="object"&&typeof f!="function")throw new Pl("`obj` must be an object or a function`");if(typeof I!="string"&&typeof I!="symbol")throw new Pl("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Pl("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Pl("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Pl("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Pl("`loose`, if provided, must be a boolean");var R=arguments.length>3?arguments[3]:null,V=arguments.length>4?arguments[4]:null,A=arguments.length>5?arguments[5]:null,u=arguments.length>6?arguments[6]:!1,le=!!Am&&Am(f,I);if(Em)Em(f,I,{configurable:A===null&&le?le.configurable:!A,enumerable:R===null&&le?le.enumerable:!R,value:M,writable:V===null&&le?le.writable:!V});else if(u||!R&&!V&&!A)f[I]=M;else throw new Y0("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Ad=sp,dy=function(){return!!Ad};dy.hasArrayLengthDefineBug=function(){if(!Ad)return null;try{return Ad([],"length",{value:1}).length!==1}catch{return!0}};var up=dy,Q0=np,eb=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",tb=Object.prototype.toString,rb=Array.prototype.concat,Pm=cp,ib=function(g){return typeof g=="function"&&tb.call(g)==="[object Function]"},py=up(),nb=function(g,f,I,M){if(f in g){if(M===!0){if(g[f]===I)return}else if(!ib(M)||!M())return}py?Pm(g,f,I,!0):Pm(g,f,I)},fy=function(g,f){var I=arguments.length>2?arguments[2]:{},M=Q0(f);eb&&(M=rb.call(M,Object.getOwnPropertySymbols(f)));for(var R=0;R<M.length;R+=1)nb(g,M[R],f[M[R]],I[M[R]])};fy.supportsDescriptors=!!py;var Hs=fy,my={exports:{}},ob=ha,Mm=cp,ab=up(),km=lp,zm=ys,sb=ob("%Math.floor%"),lb=function(f,I){if(typeof f!="function")throw new zm("`fn` is not a function");if(typeof I!="number"||I<0||I>4294967295||sb(I)!==I)throw new zm("`length` must be a positive 32-bit integer");var M=arguments.length>2&&!!arguments[2],R=!0,V=!0;if("length"in f&&km){var A=km(f,"length");A&&!A.configurable&&(R=!1),A&&!A.writable&&(V=!1)}return(R||V||!M)&&(ab?Mm(f,"length",I,!0,!0):Mm(f,"length",I)),f};(function(g){var f=ap,I=ha,M=lb,R=ys,V=I("%Function.prototype.apply%"),A=I("%Function.prototype.call%"),u=I("%Reflect.apply%",!0)||f.call(A,V),le=sp,Ae=I("%Math.max%");g.exports=function(se){if(typeof se!="function")throw new R("a function is required");var Ge=u(f,A,arguments);return M(Ge,1+Ae(0,se.length-(arguments.length-1)),!0)};var Ne=function(){return u(f,V,arguments)};le?le(g.exports,"apply",{value:Ne}):g.exports.apply=Ne})(my);var $l=my.exports,gy=ha,yy=$l,cb=yy(gy("String.prototype.indexOf")),ho=function(f,I){var M=gy(f,!!I);return typeof M=="function"&&cb(f,".prototype.")>-1?yy(M):M},ub=np,_y=ch(),xy=ho,Dm=Object,hb=xy("Array.prototype.push"),Fm=xy("Object.prototype.propertyIsEnumerable"),db=_y?Object.getOwnPropertySymbols:null,vy=function(f,I){if(f==null)throw new TypeError("target must be an object");var M=Dm(f);if(arguments.length===1)return M;for(var R=1;R<arguments.length;++R){var V=Dm(arguments[R]),A=ub(V),u=_y&&(Object.getOwnPropertySymbols||db);if(u)for(var le=u(V),Ae=0;Ae<le.length;++Ae){var Ne=le[Ae];Fm(V,Ne)&&hb(A,Ne)}for(var ve=0;ve<A.length;++ve){var se=A[ve];if(Fm(V,se)){var Ge=V[se];M[se]=Ge}}}return M},ud=vy,pb=function(){if(!Object.assign)return!1;for(var g="abcdefghijklmnopqrst",f=g.split(""),I={},M=0;M<f.length;++M)I[f[M]]=f[M];var R=Object.assign({},I),V="";for(var A in R)V+=A;return g!==V},fb=function(){if(!Object.assign||!Object.preventExtensions)return!1;var g=Object.preventExtensions({1:2});try{Object.assign(g,"xy")}catch{return g[1]==="y"}return!1},by=function(){return!Object.assign||pb()||fb()?ud:Object.assign},mb=Hs,gb=by,yb=function(){var f=gb();return mb(Object,{assign:f},{assign:function(){return Object.assign!==f}}),f},_b=Hs,xb=$l,vb=vy,wy=by,bb=yb,wb=xb.apply(wy()),Sy=function(f,I){return wb(Object,arguments)};_b(Sy,{getPolyfill:wy,implementation:vb,shim:bb});var Sb=Sy,$c=function(){return typeof function(){}.name=="string"},Bc=Object.getOwnPropertyDescriptor;if(Bc)try{Bc([],"length")}catch{Bc=null}$c.functionsHaveConfigurableNames=function(){if(!$c()||!Bc)return!1;var f=Bc(function(){},"name");return!!f&&!!f.configurable};var Tb=Function.prototype.bind;$c.boundFunctionsHaveNames=function(){return $c()&&typeof Tb=="function"&&function(){}.bind().name!==""};var Ib=$c,Lm=cp,Cb=up(),Eb=Ib.functionsHaveConfigurableNames(),Ab=ys,Pb=function(f,I){if(typeof f!="function")throw new Ab("`fn` is not a function");var M=arguments.length>2&&!!arguments[2];return(!M||Eb)&&(Cb?Lm(f,"name",I,!0,!0):Lm(f,"name",I)),f},Mb=Pb,kb=ys,zb=Object,Ty=Mb(function(){if(this==null||this!==zb(this))throw new kb("RegExp.prototype.flags getter called on non-object");var f="";return this.hasIndices&&(f+="d"),this.global&&(f+="g"),this.ignoreCase&&(f+="i"),this.multiline&&(f+="m"),this.dotAll&&(f+="s"),this.unicode&&(f+="u"),this.unicodeSets&&(f+="v"),this.sticky&&(f+="y"),f},"get flags",!0),Db=Ty,Fb=Hs.supportsDescriptors,Lb=Object.getOwnPropertyDescriptor,Iy=function(){if(Fb&&/a/mig.flags==="gim"){var f=Lb(RegExp.prototype,"flags");if(f&&typeof f.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var I="",M={};if(Object.defineProperty(M,"hasIndices",{get:function(){I+="d"}}),Object.defineProperty(M,"sticky",{get:function(){I+="y"}}),I==="dy")return f.get}}return Db},Bb=Hs.supportsDescriptors,Rb=Iy,Ob=Object.getOwnPropertyDescriptor,jb=Object.defineProperty,Nb=TypeError,Bm=Object.getPrototypeOf,$b=/a/,Vb=function(){if(!Bb||!Bm)throw new Nb("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var f=Rb(),I=Bm($b),M=Ob(I,"flags");return(!M||M.get!==f)&&jb(I,"flags",{configurable:!0,enumerable:!1,get:f}),f},Ub=Hs,qb=$l,Gb=Ty,Cy=Iy,Zb=Vb,Ey=qb(Cy());Ub(Ey,{getPolyfill:Cy,implementation:Gb,shim:Zb});var Wb=Ey,Vu={exports:{}},Hb=ch,Xs=function(){return Hb()&&!!Symbol.toStringTag},Xb=Xs(),Jb=ho,Pd=Jb("Object.prototype.toString"),uh=function(f){return Xb&&f&&typeof f=="object"&&Symbol.toStringTag in f?!1:Pd(f)==="[object Arguments]"},Ay=function(f){return uh(f)?!0:f!==null&&typeof f=="object"&&typeof f.length=="number"&&f.length>=0&&Pd(f)!=="[object Array]"&&Pd(f.callee)==="[object Function]"},Kb=function(){return uh(arguments)}();uh.isLegacyArguments=Ay;var Py=Kb?uh:Ay;const Yb={},Qb=Object.freeze(Object.defineProperty({__proto__:null,default:Yb},Symbol.toStringTag,{value:"Module"})),e1=Qg(Qb);var hp=typeof Map=="function"&&Map.prototype,hd=Object.getOwnPropertyDescriptor&&hp?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Ju=hp&&hd&&typeof hd.get=="function"?hd.get:null,Rm=hp&&Map.prototype.forEach,dp=typeof Set=="function"&&Set.prototype,dd=Object.getOwnPropertyDescriptor&&dp?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Ku=dp&&dd&&typeof dd.get=="function"?dd.get:null,Om=dp&&Set.prototype.forEach,t1=typeof WeakMap=="function"&&WeakMap.prototype,Rc=t1?WeakMap.prototype.has:null,r1=typeof WeakSet=="function"&&WeakSet.prototype,Oc=r1?WeakSet.prototype.has:null,i1=typeof WeakRef=="function"&&WeakRef.prototype,jm=i1?WeakRef.prototype.deref:null,n1=Boolean.prototype.valueOf,o1=Object.prototype.toString,a1=Function.prototype.toString,s1=String.prototype.match,pp=String.prototype.slice,fs=String.prototype.replace,l1=String.prototype.toUpperCase,Nm=String.prototype.toLowerCase,My=RegExp.prototype.test,$m=Array.prototype.concat,ca=Array.prototype.join,c1=Array.prototype.slice,Vm=Math.floor,Md=typeof BigInt=="function"?BigInt.prototype.valueOf:null,pd=Object.getOwnPropertySymbols,kd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Rl=typeof Symbol=="function"&&typeof Symbol.iterator=="object",rn=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Rl||!0)?Symbol.toStringTag:null,ky=Object.prototype.propertyIsEnumerable,Um=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(g){return g.__proto__}:null);function qm(g,f){if(g===1/0||g===-1/0||g!==g||g&&g>-1e3&&g<1e3||My.call(/e/,f))return f;var I=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof g=="number"){var M=g<0?-Vm(-g):Vm(g);if(M!==g){var R=String(M),V=pp.call(f,R.length+1);return fs.call(R,I,"$&_")+"."+fs.call(fs.call(V,/([0-9]{3})/g,"$&_"),/_$/,"")}}return fs.call(f,I,"$&_")}var zd=e1,Gm=zd.custom,Zm=Dy(Gm)?Gm:null,u1=function g(f,I,M,R){var V=I||{};if(ps(V,"quoteStyle")&&V.quoteStyle!=="single"&&V.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(ps(V,"maxStringLength")&&(typeof V.maxStringLength=="number"?V.maxStringLength<0&&V.maxStringLength!==1/0:V.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var A=ps(V,"customInspect")?V.customInspect:!0;if(typeof A!="boolean"&&A!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(ps(V,"indent")&&V.indent!==null&&V.indent!=="	"&&!(parseInt(V.indent,10)===V.indent&&V.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(ps(V,"numericSeparator")&&typeof V.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var u=V.numericSeparator;if(typeof f>"u")return"undefined";if(f===null)return"null";if(typeof f=="boolean")return f?"true":"false";if(typeof f=="string")return Ly(f,V);if(typeof f=="number"){if(f===0)return 1/0/f>0?"0":"-0";var le=String(f);return u?qm(f,le):le}if(typeof f=="bigint"){var Ae=String(f)+"n";return u?qm(f,Ae):Ae}var Ne=typeof V.depth>"u"?5:V.depth;if(typeof M>"u"&&(M=0),M>=Ne&&Ne>0&&typeof f=="object")return Dd(f)?"[Array]":"[Object]";var ve=A1(V,M);if(typeof R>"u")R=[];else if(Fy(R,f)>=0)return"[Circular]";function se(rr,$t,ti){if($t&&(R=c1.call(R),R.push($t)),ti){var di={depth:V.depth};return ps(V,"quoteStyle")&&(di.quoteStyle=V.quoteStyle),g(rr,di,M+1,R)}return g(rr,V,M+1,R)}if(typeof f=="function"&&!Wm(f)){var Ge=x1(f),yt=zu(f,se);return"[Function"+(Ge?": "+Ge:" (anonymous)")+"]"+(yt.length>0?" { "+ca.call(yt,", ")+" }":"")}if(Dy(f)){var Fe=Rl?fs.call(String(f),/^(Symbol\(.*\))_[^)]*$/,"$1"):kd.call(f);return typeof f=="object"&&!Rl?Mc(Fe):Fe}if(I1(f)){for(var ot="<"+Nm.call(String(f.nodeName)),zt=f.attributes||[],tr=0;tr<zt.length;tr++)ot+=" "+zt[tr].name+"="+zy(h1(zt[tr].value),"double",V);return ot+=">",f.childNodes&&f.childNodes.length&&(ot+="..."),ot+="</"+Nm.call(String(f.nodeName))+">",ot}if(Dd(f)){if(f.length===0)return"[]";var bt=zu(f,se);return ve&&!E1(bt)?"["+Fd(bt,ve)+"]":"[ "+ca.call(bt,", ")+" ]"}if(p1(f)){var Pt=zu(f,se);return!("cause"in Error.prototype)&&"cause"in f&&!ky.call(f,"cause")?"{ ["+String(f)+"] "+ca.call($m.call("[cause]: "+se(f.cause),Pt),", ")+" }":Pt.length===0?"["+String(f)+"]":"{ ["+String(f)+"] "+ca.call(Pt,", ")+" }"}if(typeof f=="object"&&A){if(Zm&&typeof f[Zm]=="function"&&zd)return zd(f,{depth:Ne-M});if(A!=="symbol"&&typeof f.inspect=="function")return f.inspect()}if(v1(f)){var Nt=[];return Rm&&Rm.call(f,function(rr,$t){Nt.push(se($t,f,!0)+" => "+se(rr,f))}),Hm("Map",Ju.call(f),Nt,ve)}if(S1(f)){var tt=[];return Om&&Om.call(f,function(rr){tt.push(se(rr,f))}),Hm("Set",Ku.call(f),tt,ve)}if(b1(f))return fd("WeakMap");if(T1(f))return fd("WeakSet");if(w1(f))return fd("WeakRef");if(m1(f))return Mc(se(Number(f)));if(y1(f))return Mc(se(Md.call(f)));if(g1(f))return Mc(n1.call(f));if(f1(f))return Mc(se(String(f)));if(typeof window<"u"&&f===window)return"{ [object Window] }";if(f===ja)return"{ [object globalThis] }";if(!d1(f)&&!Wm(f)){var Ot=zu(f,se),cr=Um?Um(f)===Object.prototype:f instanceof Object||f.constructor===Object,Cr=f instanceof Object?"":"null prototype",li=!cr&&rn&&Object(f)===f&&rn in f?pp.call(_s(f),8,-1):Cr?"Object":"",Ft=cr||typeof f.constructor!="function"?"":f.constructor.name?f.constructor.name+" ":"",Er=Ft+(li||Cr?"["+ca.call($m.call([],li||[],Cr||[]),": ")+"] ":"");return Ot.length===0?Er+"{}":ve?Er+"{"+Fd(Ot,ve)+"}":Er+"{ "+ca.call(Ot,", ")+" }"}return String(f)};function zy(g,f,I){var M=(I.quoteStyle||f)==="double"?'"':"'";return M+g+M}function h1(g){return fs.call(String(g),/"/g,"&quot;")}function Dd(g){return _s(g)==="[object Array]"&&(!rn||!(typeof g=="object"&&rn in g))}function d1(g){return _s(g)==="[object Date]"&&(!rn||!(typeof g=="object"&&rn in g))}function Wm(g){return _s(g)==="[object RegExp]"&&(!rn||!(typeof g=="object"&&rn in g))}function p1(g){return _s(g)==="[object Error]"&&(!rn||!(typeof g=="object"&&rn in g))}function f1(g){return _s(g)==="[object String]"&&(!rn||!(typeof g=="object"&&rn in g))}function m1(g){return _s(g)==="[object Number]"&&(!rn||!(typeof g=="object"&&rn in g))}function g1(g){return _s(g)==="[object Boolean]"&&(!rn||!(typeof g=="object"&&rn in g))}function Dy(g){if(Rl)return g&&typeof g=="object"&&g instanceof Symbol;if(typeof g=="symbol")return!0;if(!g||typeof g!="object"||!kd)return!1;try{return kd.call(g),!0}catch{}return!1}function y1(g){if(!g||typeof g!="object"||!Md)return!1;try{return Md.call(g),!0}catch{}return!1}var _1=Object.prototype.hasOwnProperty||function(g){return g in this};function ps(g,f){return _1.call(g,f)}function _s(g){return o1.call(g)}function x1(g){if(g.name)return g.name;var f=s1.call(a1.call(g),/^function\s*([\w$]+)/);return f?f[1]:null}function Fy(g,f){if(g.indexOf)return g.indexOf(f);for(var I=0,M=g.length;I<M;I++)if(g[I]===f)return I;return-1}function v1(g){if(!Ju||!g||typeof g!="object")return!1;try{Ju.call(g);try{Ku.call(g)}catch{return!0}return g instanceof Map}catch{}return!1}function b1(g){if(!Rc||!g||typeof g!="object")return!1;try{Rc.call(g,Rc);try{Oc.call(g,Oc)}catch{return!0}return g instanceof WeakMap}catch{}return!1}function w1(g){if(!jm||!g||typeof g!="object")return!1;try{return jm.call(g),!0}catch{}return!1}function S1(g){if(!Ku||!g||typeof g!="object")return!1;try{Ku.call(g);try{Ju.call(g)}catch{return!0}return g instanceof Set}catch{}return!1}function T1(g){if(!Oc||!g||typeof g!="object")return!1;try{Oc.call(g,Oc);try{Rc.call(g,Rc)}catch{return!0}return g instanceof WeakSet}catch{}return!1}function I1(g){return!g||typeof g!="object"?!1:typeof HTMLElement<"u"&&g instanceof HTMLElement?!0:typeof g.nodeName=="string"&&typeof g.getAttribute=="function"}function Ly(g,f){if(g.length>f.maxStringLength){var I=g.length-f.maxStringLength,M="... "+I+" more character"+(I>1?"s":"");return Ly(pp.call(g,0,f.maxStringLength),f)+M}var R=fs.call(fs.call(g,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,C1);return zy(R,"single",f)}function C1(g){var f=g.charCodeAt(0),I={8:"b",9:"t",10:"n",12:"f",13:"r"}[f];return I?"\\"+I:"\\x"+(f<16?"0":"")+l1.call(f.toString(16))}function Mc(g){return"Object("+g+")"}function fd(g){return g+" { ? }"}function Hm(g,f,I,M){var R=M?Fd(I,M):ca.call(I,", ");return g+" ("+f+") {"+R+"}"}function E1(g){for(var f=0;f<g.length;f++)if(Fy(g[f],`
`)>=0)return!1;return!0}function A1(g,f){var I;if(g.indent==="	")I="	";else if(typeof g.indent=="number"&&g.indent>0)I=ca.call(Array(g.indent+1)," ");else return null;return{base:I,prev:ca.call(Array(f+1),I)}}function Fd(g,f){if(g.length===0)return"";var I=`
`+f.prev+f.base;return I+ca.call(g,","+I)+`
`+f.prev}function zu(g,f){var I=Dd(g),M=[];if(I){M.length=g.length;for(var R=0;R<g.length;R++)M[R]=ps(g,R)?f(g[R],g):""}var V=typeof pd=="function"?pd(g):[],A;if(Rl){A={};for(var u=0;u<V.length;u++)A["$"+V[u]]=V[u]}for(var le in g)ps(g,le)&&(I&&String(Number(le))===le&&le<g.length||Rl&&A["$"+le]instanceof Symbol||(My.call(/[^\w$]/,le)?M.push(f(le,g)+": "+f(g[le],g)):M.push(le+": "+f(g[le],g))));if(typeof pd=="function")for(var Ae=0;Ae<V.length;Ae++)ky.call(g,V[Ae])&&M.push("["+f(V[Ae])+"]: "+f(g[V[Ae]],g));return M}var By=ha,Vl=ho,P1=u1,M1=ys,Du=By("%WeakMap%",!0),Fu=By("%Map%",!0),k1=Vl("WeakMap.prototype.get",!0),z1=Vl("WeakMap.prototype.set",!0),D1=Vl("WeakMap.prototype.has",!0),F1=Vl("Map.prototype.get",!0),L1=Vl("Map.prototype.set",!0),B1=Vl("Map.prototype.has",!0),fp=function(g,f){for(var I=g,M;(M=I.next)!==null;I=M)if(M.key===f)return I.next=M.next,M.next=g.next,g.next=M,M},R1=function(g,f){var I=fp(g,f);return I&&I.value},O1=function(g,f,I){var M=fp(g,f);M?M.value=I:g.next={key:f,next:g.next,value:I}},j1=function(g,f){return!!fp(g,f)},Ry=function(){var f,I,M,R={assert:function(V){if(!R.has(V))throw new M1("Side channel does not contain "+P1(V))},get:function(V){if(Du&&V&&(typeof V=="object"||typeof V=="function")){if(f)return k1(f,V)}else if(Fu){if(I)return F1(I,V)}else if(M)return R1(M,V)},has:function(V){if(Du&&V&&(typeof V=="object"||typeof V=="function")){if(f)return D1(f,V)}else if(Fu){if(I)return B1(I,V)}else if(M)return j1(M,V);return!1},set:function(V,A){Du&&V&&(typeof V=="object"||typeof V=="function")?(f||(f=new Du),z1(f,V,A)):Fu?(I||(I=new Fu),L1(I,V,A)):(M||(M={key:{},next:null}),O1(M,V,A))}};return R},N1=uy,kc=Ry(),Oa=ys,mp={assert:function(g,f){if(!g||typeof g!="object"&&typeof g!="function")throw new Oa("`O` is not an object");if(typeof f!="string")throw new Oa("`slot` must be a string");if(kc.assert(g),!mp.has(g,f))throw new Oa("`"+f+"` is not present on `O`")},get:function(g,f){if(!g||typeof g!="object"&&typeof g!="function")throw new Oa("`O` is not an object");if(typeof f!="string")throw new Oa("`slot` must be a string");var I=kc.get(g);return I&&I["$"+f]},has:function(g,f){if(!g||typeof g!="object"&&typeof g!="function")throw new Oa("`O` is not an object");if(typeof f!="string")throw new Oa("`slot` must be a string");var I=kc.get(g);return!!I&&N1(I,"$"+f)},set:function(g,f,I){if(!g||typeof g!="object"&&typeof g!="function")throw new Oa("`O` is not an object");if(typeof f!="string")throw new Oa("`slot` must be a string");var M=kc.get(g);M||(M={},kc.set(g,M)),M["$"+f]=I}};Object.freeze&&Object.freeze(mp);var $1=mp,zc=$1,V1=SyntaxError,Xm=typeof StopIteration=="object"?StopIteration:null,U1=function(f){if(!Xm)throw new V1("this environment lacks StopIteration");zc.set(f,"[[Done]]",!1);var I={next:function(){var R=zc.get(this,"[[Iterator]]"),V=zc.get(R,"[[Done]]");try{return{done:V,value:V?void 0:R.next()}}catch(A){if(zc.set(R,"[[Done]]",!0),A!==Xm)throw A;return{done:!0,value:void 0}}}};return zc.set(I,"[[Iterator]]",f),I},q1={}.toString,Oy=Array.isArray||function(g){return q1.call(g)=="[object Array]"},G1=String.prototype.valueOf,Z1=function(f){try{return G1.call(f),!0}catch{return!1}},W1=Object.prototype.toString,H1="[object String]",X1=Xs(),jy=function(f){return typeof f=="string"?!0:typeof f!="object"?!1:X1?Z1(f):W1.call(f)===H1},gp=typeof Map=="function"&&Map.prototype?Map:null,J1=typeof Set=="function"&&Set.prototype?Set:null,Yu;gp||(Yu=function(f){return!1});var Ny=gp?Map.prototype.has:null,Jm=J1?Set.prototype.has:null;!Yu&&!Ny&&(Yu=function(f){return!1});var $y=Yu||function(f){if(!f||typeof f!="object")return!1;try{if(Ny.call(f),Jm)try{Jm.call(f)}catch{return!0}return f instanceof gp}catch{}return!1},K1=typeof Map=="function"&&Map.prototype?Map:null,yp=typeof Set=="function"&&Set.prototype?Set:null,Qu;yp||(Qu=function(f){return!1});var Km=K1?Map.prototype.has:null,Vy=yp?Set.prototype.has:null;!Qu&&!Vy&&(Qu=function(f){return!1});var Uy=Qu||function(f){if(!f||typeof f!="object")return!1;try{if(Vy.call(f),Km)try{Km.call(f)}catch{return!0}return f instanceof yp}catch{}return!1},Ym=Py,Qm=U1;if(op()||ch()){var md=Symbol.iterator;Vu.exports=function(f){if(f!=null&&typeof f[md]<"u")return f[md]();if(Ym(f))return Array.prototype[md].call(f)}}else{var Y1=Oy,Q1=jy,eg=ha,ew=eg("%Map%",!0),tw=eg("%Set%",!0),Co=ho,tg=Co("Array.prototype.push"),rg=Co("String.prototype.charCodeAt"),rw=Co("String.prototype.slice"),iw=function(f,I){var M=f.length;if(I+1>=M)return I+1;var R=rg(f,I);if(R<55296||R>56319)return I+1;var V=rg(f,I+1);return V<56320||V>57343?I+1:I+2},gd=function(f){var I=0;return{next:function(){var R=I>=f.length,V;return R||(V=f[I],I+=1),{done:R,value:V}}}},ig=function(f,I){if(Y1(f)||Ym(f))return gd(f);if(Q1(f)){var M=0;return{next:function(){var V=iw(f,M),A=rw(f,M,V);return M=V,{done:V>f.length,value:A}}}}if(I&&typeof f["_es6-shim iterator_"]<"u")return f["_es6-shim iterator_"]()};if(!ew&&!tw)Vu.exports=function(f){if(f!=null)return ig(f,!0)};else{var nw=$y,ow=Uy,ng=Co("Map.prototype.forEach",!0),og=Co("Set.prototype.forEach",!0);if(typeof process>"u"||!process.versions||!process.versions.node)var ag=Co("Map.prototype.iterator",!0),sg=Co("Set.prototype.iterator",!0);var lg=Co("Map.prototype.@@iterator",!0)||Co("Map.prototype._es6-shim iterator_",!0),cg=Co("Set.prototype.@@iterator",!0)||Co("Set.prototype._es6-shim iterator_",!0),aw=function(f){if(nw(f)){if(ag)return Qm(ag(f));if(lg)return lg(f);if(ng){var I=[];return ng(f,function(R,V){tg(I,[V,R])}),gd(I)}}if(ow(f)){if(sg)return Qm(sg(f));if(cg)return cg(f);if(og){var M=[];return og(f,function(R){tg(M,R)}),gd(M)}}};Vu.exports=function(f){return aw(f)||ig(f)}}}var sw=Vu.exports,ug=function(g){return g!==g},qy=function(f,I){return f===0&&I===0?1/f===1/I:!!(f===I||ug(f)&&ug(I))},lw=qy,Gy=function(){return typeof Object.is=="function"?Object.is:lw},cw=Gy,uw=Hs,hw=function(){var f=cw();return uw(Object,{is:f},{is:function(){return Object.is!==f}}),f},dw=Hs,pw=$l,fw=qy,Zy=Gy,mw=hw,Wy=pw(Zy(),Object);dw(Wy,{getPolyfill:Zy,implementation:fw,shim:mw});var gw=Wy,yw=$l,Hy=ho,_w=ha,Ld=_w("%ArrayBuffer%",!0),Uu=Hy("ArrayBuffer.prototype.byteLength",!0),xw=Hy("Object.prototype.toString"),hg=!!Ld&&!Uu&&new Ld(0).slice,dg=!!hg&&yw(hg),Xy=Uu||dg?function(f){if(!f||typeof f!="object")return!1;try{return Uu?Uu(f):dg(f,0),!0}catch{return!1}}:Ld?function(f){return xw(f)==="[object ArrayBuffer]"}:function(f){return!1},vw=Date.prototype.getDay,bw=function(f){try{return vw.call(f),!0}catch{return!1}},ww=Object.prototype.toString,Sw="[object Date]",Tw=Xs(),Iw=function(f){return typeof f!="object"||f===null?!1:Tw?bw(f):ww.call(f)===Sw},Bd=ho,Jy=Xs(),Ky,Yy,Rd,Od;if(Jy){Ky=Bd("Object.prototype.hasOwnProperty"),Yy=Bd("RegExp.prototype.exec"),Rd={};var yd=function(){throw Rd};Od={toString:yd,valueOf:yd},typeof Symbol.toPrimitive=="symbol"&&(Od[Symbol.toPrimitive]=yd)}var Cw=Bd("Object.prototype.toString"),Ew=Object.getOwnPropertyDescriptor,Aw="[object RegExp]",Pw=Jy?function(f){if(!f||typeof f!="object")return!1;var I=Ew(f,"lastIndex"),M=I&&Ky(I,"value");if(!M)return!1;try{Yy(f,Od)}catch(R){return R===Rd}}:function(f){return!f||typeof f!="object"&&typeof f!="function"?!1:Cw(f)===Aw},Mw=ho,pg=Mw("SharedArrayBuffer.prototype.byteLength",!0),kw=pg?function(f){if(!f||typeof f!="object")return!1;try{return pg(f),!0}catch{return!1}}:function(f){return!1},zw=Number.prototype.toString,Dw=function(f){try{return zw.call(f),!0}catch{return!1}},Fw=Object.prototype.toString,Lw="[object Number]",Bw=Xs(),Rw=function(f){return typeof f=="number"?!0:typeof f!="object"?!1:Bw?Dw(f):Fw.call(f)===Lw},Qy=ho,Ow=Qy("Boolean.prototype.toString"),jw=Qy("Object.prototype.toString"),Nw=function(f){try{return Ow(f),!0}catch{return!1}},$w="[object Boolean]",Vw=Xs(),Uw=function(f){return typeof f=="boolean"?!0:f===null||typeof f!="object"?!1:Vw&&Symbol.toStringTag in f?Nw(f):jw(f)===$w},jd={exports:{}},qw=Object.prototype.toString,Gw=op();if(Gw){var Zw=Symbol.prototype.toString,Ww=/^Symbol\(.*\)$/,Hw=function(f){return typeof f.valueOf()!="symbol"?!1:Ww.test(Zw.call(f))};jd.exports=function(f){if(typeof f=="symbol")return!0;if(qw.call(f)!=="[object Symbol]")return!1;try{return Hw(f)}catch{return!1}}}else jd.exports=function(f){return!1};var Xw=jd.exports,Nd={exports:{}},fg=typeof BigInt<"u"&&BigInt,Jw=function(){return typeof fg=="function"&&typeof BigInt=="function"&&typeof fg(42)=="bigint"&&typeof BigInt(42)=="bigint"},Kw=Jw();if(Kw){var Yw=BigInt.prototype.valueOf,Qw=function(f){try{return Yw.call(f),!0}catch{}return!1};Nd.exports=function(f){return f===null||typeof f>"u"||typeof f=="boolean"||typeof f=="string"||typeof f=="number"||typeof f=="symbol"||typeof f=="function"?!1:typeof f=="bigint"?!0:Qw(f)}}else Nd.exports=function(f){return!1};var eS=Nd.exports,tS=jy,rS=Rw,iS=Uw,nS=Xw,oS=eS,aS=function(f){if(f==null||typeof f!="object"&&typeof f!="function")return null;if(tS(f))return"String";if(rS(f))return"Number";if(iS(f))return"Boolean";if(nS(f))return"Symbol";if(oS(f))return"BigInt"},eh=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,mg=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,th;eh||(th=function(f){return!1});var $d=eh?eh.prototype.has:null,_d=mg?mg.prototype.has:null;!th&&!$d&&(th=function(f){return!1});var sS=th||function(f){if(!f||typeof f!="object")return!1;try{if($d.call(f,$d),_d)try{_d.call(f,_d)}catch{return!0}return f instanceof eh}catch{}return!1},Vd={exports:{}},lS=ha,e_=ho,cS=lS("%WeakSet%",!0),xd=e_("WeakSet.prototype.has",!0);if(xd){var vd=e_("WeakMap.prototype.has",!0);Vd.exports=function(f){if(!f||typeof f!="object")return!1;try{if(xd(f,xd),vd)try{vd(f,vd)}catch{return!0}return f instanceof cS}catch{}return!1}}else Vd.exports=function(f){return!1};var uS=Vd.exports,hS=$y,dS=Uy,pS=sS,fS=uS,mS=function(f){if(f&&typeof f=="object"){if(hS(f))return"Map";if(dS(f))return"Set";if(pS(f))return"WeakMap";if(fS(f))return"WeakSet"}return!1},t_=Function.prototype.toString,Dl=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,Ud,qu;if(typeof Dl=="function"&&typeof Object.defineProperty=="function")try{Ud=Object.defineProperty({},"length",{get:function(){throw qu}}),qu={},Dl(function(){throw 42},null,Ud)}catch(g){g!==qu&&(Dl=null)}else Dl=null;var gS=/^\s*class\b/,qd=function(f){try{var I=t_.call(f);return gS.test(I)}catch{return!1}},bd=function(f){try{return qd(f)?!1:(t_.call(f),!0)}catch{return!1}},Gu=Object.prototype.toString,yS="[object Object]",_S="[object Function]",xS="[object GeneratorFunction]",vS="[object HTMLAllCollection]",bS="[object HTML document.all class]",wS="[object HTMLCollection]",SS=typeof Symbol=="function"&&!!Symbol.toStringTag,TS=!(0 in[,]),Gd=function(){return!1};if(typeof document=="object"){var IS=document.all;Gu.call(IS)===Gu.call(document.all)&&(Gd=function(f){if((TS||!f)&&(typeof f>"u"||typeof f=="object"))try{var I=Gu.call(f);return(I===vS||I===bS||I===wS||I===yS)&&f("")==null}catch{}return!1})}var CS=Dl?function(f){if(Gd(f))return!0;if(!f||typeof f!="function"&&typeof f!="object")return!1;try{Dl(f,null,Ud)}catch(I){if(I!==qu)return!1}return!qd(f)&&bd(f)}:function(f){if(Gd(f))return!0;if(!f||typeof f!="function"&&typeof f!="object")return!1;if(SS)return bd(f);if(qd(f))return!1;var I=Gu.call(f);return I!==_S&&I!==xS&&!/^\[object HTML/.test(I)?!1:bd(f)},ES=CS,AS=Object.prototype.toString,r_=Object.prototype.hasOwnProperty,PS=function(f,I,M){for(var R=0,V=f.length;R<V;R++)r_.call(f,R)&&(M==null?I(f[R],R,f):I.call(M,f[R],R,f))},MS=function(f,I,M){for(var R=0,V=f.length;R<V;R++)M==null?I(f.charAt(R),R,f):I.call(M,f.charAt(R),R,f)},kS=function(f,I,M){for(var R in f)r_.call(f,R)&&(M==null?I(f[R],R,f):I.call(M,f[R],R,f))},zS=function(f,I,M){if(!ES(I))throw new TypeError("iterator must be a function");var R;arguments.length>=3&&(R=M),AS.call(f)==="[object Array]"?PS(f,I,R):typeof f=="string"?MS(f,I,R):kS(f,I,R)},DS=zS,FS=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],wd=FS,LS=typeof globalThis>"u"?ja:globalThis,BS=function(){for(var f=[],I=0;I<wd.length;I++)typeof LS[wd[I]]=="function"&&(f[f.length]=wd[I]);return f},rh=DS,RS=BS,gg=$l,_p=ho,Zu=lp,OS=_p("Object.prototype.toString"),i_=Xs(),yg=typeof globalThis>"u"?ja:globalThis,Zd=RS(),xp=_p("String.prototype.slice"),Sd=Object.getPrototypeOf,jS=_p("Array.prototype.indexOf",!0)||function(f,I){for(var M=0;M<f.length;M+=1)if(f[M]===I)return M;return-1},ih={__proto__:null};i_&&Zu&&Sd?rh(Zd,function(g){var f=new yg[g];if(Symbol.toStringTag in f){var I=Sd(f),M=Zu(I,Symbol.toStringTag);if(!M){var R=Sd(I);M=Zu(R,Symbol.toStringTag)}ih["$"+g]=gg(M.get)}}):rh(Zd,function(g){var f=new yg[g],I=f.slice||f.set;I&&(ih["$"+g]=gg(I))});var NS=function(f){var I=!1;return rh(ih,function(M,R){if(!I)try{"$"+M(f)===R&&(I=xp(R,1))}catch{}}),I},$S=function(f){var I=!1;return rh(ih,function(M,R){if(!I)try{M(f),I=xp(R,1)}catch{}}),I},VS=function(f){if(!f||typeof f!="object")return!1;if(!i_){var I=xp(OS(f),8,-1);return jS(Zd,I)>-1?I:I!=="Object"?!1:$S(f)}return Zu?NS(f):null},US=ho,_g=US("ArrayBuffer.prototype.byteLength",!0),qS=Xy,GS=function(f){return qS(f)?_g?_g(f):f.byteLength:NaN},n_=Sb,da=ho,xg=Wb,ZS=ha,Ol=sw,WS=Ry,vg=gw,bg=Py,wg=Oy,Sg=Xy,Tg=Iw,Ig=Pw,Cg=kw,Eg=np,Ag=aS,Pg=mS,Mg=VS,kg=GS,zg=da("SharedArrayBuffer.prototype.byteLength",!0),Dg=da("Date.prototype.getTime"),Td=Object.getPrototypeOf,Fg=da("Object.prototype.toString"),nh=ZS("%Set%",!0),Wd=da("Map.prototype.has",!0),oh=da("Map.prototype.get",!0),Lg=da("Map.prototype.size",!0),ah=da("Set.prototype.add",!0),o_=da("Set.prototype.delete",!0),sh=da("Set.prototype.has",!0),Wu=da("Set.prototype.size",!0);function Bg(g,f,I,M){for(var R=Ol(g),V;(V=R.next())&&!V.done;)if(ko(f,V.value,I,M))return o_(g,V.value),!0;return!1}function a_(g){if(typeof g>"u")return null;if(typeof g!="object")return typeof g=="symbol"?!1:typeof g=="string"||typeof g=="number"?+g==+g:!0}function HS(g,f,I,M,R,V){var A=a_(I);if(A!=null)return A;var u=oh(f,A),le=n_({},R,{strict:!1});return typeof u>"u"&&!Wd(f,A)||!ko(M,u,le,V)?!1:!Wd(g,A)&&ko(M,u,le,V)}function XS(g,f,I){var M=a_(I);return M??(sh(f,M)&&!sh(g,M))}function Rg(g,f,I,M,R,V){for(var A=Ol(g),u,le;(u=A.next())&&!u.done;)if(le=u.value,ko(I,le,R,V)&&ko(M,oh(f,le),R,V))return o_(g,le),!0;return!1}function ko(g,f,I,M){var R=I||{};if(R.strict?vg(g,f):g===f)return!0;var V=Ag(g),A=Ag(f);if(V!==A)return!1;if(!g||!f||typeof g!="object"&&typeof f!="object")return R.strict?vg(g,f):g==f;var u=M.has(g),le=M.has(f),Ae;if(u&&le){if(M.get(g)===M.get(f))return!0}else Ae={};return u||M.set(g,Ae),le||M.set(f,Ae),YS(g,f,R,M)}function Og(g){return!g||typeof g!="object"||typeof g.length!="number"||typeof g.copy!="function"||typeof g.slice!="function"||g.length>0&&typeof g[0]!="number"?!1:!!(g.constructor&&g.constructor.isBuffer&&g.constructor.isBuffer(g))}function JS(g,f,I,M){if(Wu(g)!==Wu(f))return!1;for(var R=Ol(g),V=Ol(f),A,u,le;(A=R.next())&&!A.done;)if(A.value&&typeof A.value=="object")le||(le=new nh),ah(le,A.value);else if(!sh(f,A.value)){if(I.strict||!XS(g,f,A.value))return!1;le||(le=new nh),ah(le,A.value)}if(le){for(;(u=V.next())&&!u.done;)if(u.value&&typeof u.value=="object"){if(!Bg(le,u.value,I.strict,M))return!1}else if(!I.strict&&!sh(g,u.value)&&!Bg(le,u.value,I.strict,M))return!1;return Wu(le)===0}return!0}function KS(g,f,I,M){if(Lg(g)!==Lg(f))return!1;for(var R=Ol(g),V=Ol(f),A,u,le,Ae,Ne,ve;(A=R.next())&&!A.done;)if(Ae=A.value[0],Ne=A.value[1],Ae&&typeof Ae=="object")le||(le=new nh),ah(le,Ae);else if(ve=oh(f,Ae),typeof ve>"u"&&!Wd(f,Ae)||!ko(Ne,ve,I,M)){if(I.strict||!HS(g,f,Ae,Ne,I,M))return!1;le||(le=new nh),ah(le,Ae)}if(le){for(;(u=V.next())&&!u.done;)if(Ae=u.value[0],ve=u.value[1],Ae&&typeof Ae=="object"){if(!Rg(le,g,Ae,ve,I,M))return!1}else if(!I.strict&&(!g.has(Ae)||!ko(oh(g,Ae),ve,I,M))&&!Rg(le,g,Ae,ve,n_({},I,{strict:!1}),M))return!1;return Wu(le)===0}return!0}function YS(g,f,I,M){var R,V;if(typeof g!=typeof f||g==null||f==null||Fg(g)!==Fg(f)||bg(g)!==bg(f))return!1;var A=wg(g),u=wg(f);if(A!==u)return!1;var le=g instanceof Error,Ae=f instanceof Error;if(le!==Ae||(le||Ae)&&(g.name!==f.name||g.message!==f.message))return!1;var Ne=Ig(g),ve=Ig(f);if(Ne!==ve||(Ne||ve)&&(g.source!==f.source||xg(g)!==xg(f)))return!1;var se=Tg(g),Ge=Tg(f);if(se!==Ge||(se||Ge)&&Dg(g)!==Dg(f)||I.strict&&Td&&Td(g)!==Td(f))return!1;var yt=Mg(g),Fe=Mg(f);if(yt!==Fe)return!1;if(yt||Fe){if(g.length!==f.length)return!1;for(R=0;R<g.length;R++)if(g[R]!==f[R])return!1;return!0}var ot=Og(g),zt=Og(f);if(ot!==zt)return!1;if(ot||zt){if(g.length!==f.length)return!1;for(R=0;R<g.length;R++)if(g[R]!==f[R])return!1;return!0}var tr=Sg(g),bt=Sg(f);if(tr!==bt)return!1;if(tr||bt)return kg(g)!==kg(f)?!1:typeof Uint8Array=="function"&&ko(new Uint8Array(g),new Uint8Array(f),I,M);var Pt=Cg(g),Nt=Cg(f);if(Pt!==Nt)return!1;if(Pt||Nt)return zg(g)!==zg(f)?!1:typeof Uint8Array=="function"&&ko(new Uint8Array(g),new Uint8Array(f),I,M);if(typeof g!=typeof f)return!1;var tt=Eg(g),Ot=Eg(f);if(tt.length!==Ot.length)return!1;for(tt.sort(),Ot.sort(),R=tt.length-1;R>=0;R--)if(tt[R]!=Ot[R])return!1;for(R=tt.length-1;R>=0;R--)if(V=tt[R],!ko(g[V],f[V],I,M))return!1;var cr=Pg(g),Cr=Pg(f);return cr!==Cr?!1:cr==="Set"||Cr==="Set"?JS(g,f,I,M):cr==="Map"?KS(g,f,I,M):!0}var QS=function(f,I,M){return ko(f,I,M,WS())};const e2=ep(QS);var t2=Object.defineProperty,xr=(g,f)=>t2(g,"name",{value:f,configurable:!0}),r2=class{constructor(f){this.direction=!1,this.compareProperties=!0;var I,M,R;this.precision=10**-((I=f?.precision)!=null?I:17),this.direction=(M=f?.direction)!=null?M:!1,this.compareProperties=(R=f?.compareProperties)!=null?R:!0}compare(f,I){if(f.type!==I.type||!Fc(f,I))return!1;switch(f.type){case"Point":return this.compareCoord(f.coordinates,I.coordinates);case"LineString":return this.compareLine(f.coordinates,I.coordinates);case"Polygon":return this.comparePolygon(f,I);case"GeometryCollection":return this.compareGeometryCollection(f,I);case"Feature":return this.compareFeature(f,I);case"FeatureCollection":return this.compareFeatureCollection(f,I);default:if(f.type.startsWith("Multi")){const M=Hd(f),R=Hd(I);return M.every(V=>R.some(A=>this.compare(V,A)))}}return!1}compareCoord(f,I){return f.length===I.length&&f.every((M,R)=>Math.abs(M-I[R])<this.precision)}compareLine(f,I,M=0,R=!1){if(!Fc(f,I))return!1;const V=f;let A=I;if(R&&!this.compareCoord(V[0],A[0])){const le=this.fixStartIndex(A,V);if(le)A=le;else return!1}const u=this.compareCoord(V[M],A[M]);return this.direction||u?this.comparePath(V,A):this.compareCoord(V[M],A[A.length-(1+M)])?this.comparePath(V.slice().reverse(),A):!1}fixStartIndex(f,I){let M,R=-1;for(let V=0;V<f.length;V++)if(this.compareCoord(f[V],I[0])){R=V;break}return R>=0&&(M=[].concat(f.slice(R,f.length),f.slice(1,R+1))),M}comparePath(f,I){return f.every((M,R)=>this.compareCoord(M,I[R]))}comparePolygon(f,I){if(this.compareLine(f.coordinates[0],I.coordinates[0],1,!0)){const M=f.coordinates.slice(1,f.coordinates.length),R=I.coordinates.slice(1,I.coordinates.length);return M.every(V=>R.some(A=>this.compareLine(V,A,1,!0)))}return!1}compareGeometryCollection(f,I){return Fc(f.geometries,I.geometries)&&this.compareBBox(f,I)&&f.geometries.every((M,R)=>this.compare(M,I.geometries[R]))}compareFeature(f,I){return f.id===I.id&&(this.compareProperties?e2(f.properties,I.properties):!0)&&this.compareBBox(f,I)&&this.compare(f.geometry,I.geometry)}compareFeatureCollection(f,I){return Fc(f.features,I.features)&&this.compareBBox(f,I)&&f.features.every((M,R)=>this.compare(M,I.features[R]))}compareBBox(f,I){return!f.bbox&&!I.bbox||(f.bbox&&I.bbox?this.compareCoord(f.bbox,I.bbox):!1)}};xr(r2,"GeojsonEquality");function Fc(g,f){return g.coordinates?g.coordinates.length===f.coordinates.length:g.length===f.length}xr(Fc,"sameLength");function Hd(g){return g.coordinates.map(f=>({type:g.type.replace("Multi",""),coordinates:f}))}xr(Hd,"explode");var Wn=63710088e-1,s_={centimeters:Wn*100,centimetres:Wn*100,degrees:360/(2*Math.PI),feet:Wn*3.28084,inches:Wn*39.37,kilometers:Wn/1e3,kilometres:Wn/1e3,meters:Wn,metres:Wn,miles:Wn/1609.344,millimeters:Wn*1e3,millimetres:Wn*1e3,nauticalmiles:Wn/1852,radians:1,yards:Wn*1.0936},jg={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function uo(g,f,I={}){const M={type:"Feature"};return(I.id===0||I.id)&&(M.id=I.id),I.bbox&&(M.bbox=I.bbox),M.properties=f||{},M.geometry=g,M}xr(uo,"feature");function i2(g,f,I={}){switch(g){case"Point":return co(f).geometry;case"LineString":return ua(f).geometry;case"Polygon":return Vc(f).geometry;case"MultiPoint":return l_(f).geometry;case"MultiLineString":return vp(f).geometry;case"MultiPolygon":return c_(f).geometry;default:throw new Error(g+" is invalid")}}xr(i2,"geometry");function co(g,f,I={}){if(!g)throw new Error("coordinates is required");if(!Array.isArray(g))throw new Error("coordinates must be an Array");if(g.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!jl(g[0])||!jl(g[1]))throw new Error("coordinates must contain numbers");return uo({type:"Point",coordinates:g},f,I)}xr(co,"point");function n2(g,f,I={}){return Ws(g.map(M=>co(M,f)),I)}xr(n2,"points");function Vc(g,f,I={}){for(const R of g){if(R.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(R[R.length-1].length!==R[0].length)throw new Error("First and last Position are not equivalent.");for(let V=0;V<R[R.length-1].length;V++)if(R[R.length-1][V]!==R[0][V])throw new Error("First and last Position are not equivalent.")}return uo({type:"Polygon",coordinates:g},f,I)}xr(Vc,"polygon");function o2(g,f,I={}){return Ws(g.map(M=>Vc(M,f)),I)}xr(o2,"polygons");function ua(g,f,I={}){if(g.length<2)throw new Error("coordinates must be an array of two or more positions");return uo({type:"LineString",coordinates:g},f,I)}xr(ua,"lineString");function a2(g,f,I={}){return Ws(g.map(M=>ua(M,f)),I)}xr(a2,"lineStrings");function Ws(g,f={}){const I={type:"FeatureCollection"};return f.id&&(I.id=f.id),f.bbox&&(I.bbox=f.bbox),I.features=g,I}xr(Ws,"featureCollection");function vp(g,f,I={}){return uo({type:"MultiLineString",coordinates:g},f,I)}xr(vp,"multiLineString");function l_(g,f,I={}){return uo({type:"MultiPoint",coordinates:g},f,I)}xr(l_,"multiPoint");function c_(g,f,I={}){return uo({type:"MultiPolygon",coordinates:g},f,I)}xr(c_,"multiPolygon");function s2(g,f,I={}){return uo({type:"GeometryCollection",geometries:g},f,I)}xr(s2,"geometryCollection");function l2(g,f=0){if(f&&!(f>=0))throw new Error("precision must be a positive number");const I=Math.pow(10,f||0);return Math.round(g*I)/I}xr(l2,"round");function u_(g,f="kilometers"){const I=s_[f];if(!I)throw new Error(f+" units is invalid");return g*I}xr(u_,"radiansToLength");function bp(g,f="kilometers"){const I=s_[f];if(!I)throw new Error(f+" units is invalid");return g/I}xr(bp,"lengthToRadians");function c2(g,f){return h_(bp(g,f))}xr(c2,"lengthToDegrees");function u2(g){let f=g%360;return f<0&&(f+=360),f}xr(u2,"bearingToAzimuth");function h_(g){return g%(2*Math.PI)*180/Math.PI}xr(h_,"radiansToDegrees");function h2(g){return g%360*Math.PI/180}xr(h2,"degreesToRadians");function d2(g,f="kilometers",I="kilometers"){if(!(g>=0))throw new Error("length must be a positive number");return u_(bp(g,f),I)}xr(d2,"convertLength");function p2(g,f="meters",I="kilometers"){if(!(g>=0))throw new Error("area must be a positive number");const M=jg[f];if(!M)throw new Error("invalid original units");const R=jg[I];if(!R)throw new Error("invalid final units");return g/M*R}xr(p2,"convertArea");function jl(g){return!isNaN(g)&&g!==null&&!Array.isArray(g)}xr(jl,"isNumber");function wp(g){return g!==null&&typeof g=="object"&&!Array.isArray(g)}xr(wp,"isObject");function f2(g){if(!g)throw new Error("bbox is required");if(!Array.isArray(g))throw new Error("bbox must be an Array");if(g.length!==4&&g.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");g.forEach(f=>{if(!jl(f))throw new Error("bbox must only contain numbers")})}xr(f2,"validateBBox");function m2(g){if(!g)throw new Error("id is required");if(["string","number"].indexOf(typeof g)===-1)throw new Error("id must be a number or a string")}xr(m2,"validateId");var g2=Object.defineProperty,xs=(g,f)=>g2(g,"name",{value:f,configurable:!0});function d_(g){if(!g)throw new Error("coord is required");if(!Array.isArray(g)){if(g.type==="Feature"&&g.geometry!==null&&g.geometry.type==="Point")return[...g.geometry.coordinates];if(g.type==="Point")return[...g.coordinates]}if(Array.isArray(g)&&g.length>=2&&!Array.isArray(g[0])&&!Array.isArray(g[1]))return[...g];throw new Error("coord must be GeoJSON Point or an Array of numbers")}xs(d_,"getCoord");function y2(g){if(Array.isArray(g))return g;if(g.type==="Feature"){if(g.geometry!==null)return g.geometry.coordinates}else if(g.coordinates)return g.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}xs(y2,"getCoords");function p_(g){if(g.length>1&&jl(g[0])&&jl(g[1]))return!0;if(Array.isArray(g[0])&&g[0].length)return p_(g[0]);throw new Error("coordinates must only contain numbers")}xs(p_,"containsNumber");function _2(g,f,I){if(!f||!I)throw new Error("type and name required");if(!g||g.type!==f)throw new Error("Invalid input to "+I+": must be a "+f+", given "+g.type)}xs(_2,"geojsonType");function x2(g,f,I){if(!g)throw new Error("No feature passed");if(!I)throw new Error(".featureOf() requires a name");if(!g||g.type!=="Feature"||!g.geometry)throw new Error("Invalid input to "+I+", Feature with geometry required");if(!g.geometry||g.geometry.type!==f)throw new Error("Invalid input to "+I+": must be a "+f+", given "+g.geometry.type)}xs(x2,"featureOf");function v2(g,f,I){if(!g)throw new Error("No featureCollection passed");if(!I)throw new Error(".collectionOf() requires a name");if(!g||g.type!=="FeatureCollection")throw new Error("Invalid input to "+I+", FeatureCollection required");for(const M of g.features){if(!M||M.type!=="Feature"||!M.geometry)throw new Error("Invalid input to "+I+", Feature with geometry required");if(!M.geometry||M.geometry.type!==f)throw new Error("Invalid input to "+I+": must be a "+f+", given "+M.geometry.type)}}xs(v2,"collectionOf");function Gc(g){return g.type==="Feature"?g.geometry:g}xs(Gc,"getGeom");function b2(g,f){return g.type==="FeatureCollection"?"FeatureCollection":g.type==="GeometryCollection"?"GeometryCollection":g.type==="Feature"&&g.geometry!==null?g.geometry.type:g.type}xs(b2,"getType");var w2=Object.defineProperty,Gi=(g,f)=>w2(g,"name",{value:f,configurable:!0});function Ul(g,f,I){if(g!==null)for(var M,R,V,A,u,le,Ae,Ne=0,ve=0,se,Ge=g.type,yt=Ge==="FeatureCollection",Fe=Ge==="Feature",ot=yt?g.features.length:1,zt=0;zt<ot;zt++){Ae=yt?g.features[zt].geometry:Fe?g.geometry:g,se=Ae?Ae.type==="GeometryCollection":!1,u=se?Ae.geometries.length:1;for(var tr=0;tr<u;tr++){var bt=0,Pt=0;if(A=se?Ae.geometries[tr]:Ae,A!==null){le=A.coordinates;var Nt=A.type;switch(Ne=I&&(Nt==="Polygon"||Nt==="MultiPolygon")?1:0,Nt){case null:break;case"Point":if(f(le,ve,zt,bt,Pt)===!1)return!1;ve++,bt++;break;case"LineString":case"MultiPoint":for(M=0;M<le.length;M++){if(f(le[M],ve,zt,bt,Pt)===!1)return!1;ve++,Nt==="MultiPoint"&&bt++}Nt==="LineString"&&bt++;break;case"Polygon":case"MultiLineString":for(M=0;M<le.length;M++){for(R=0;R<le[M].length-Ne;R++){if(f(le[M][R],ve,zt,bt,Pt)===!1)return!1;ve++}Nt==="MultiLineString"&&bt++,Nt==="Polygon"&&Pt++}Nt==="Polygon"&&bt++;break;case"MultiPolygon":for(M=0;M<le.length;M++){for(Pt=0,R=0;R<le[M].length;R++){for(V=0;V<le[M][R].length-Ne;V++){if(f(le[M][R][V],ve,zt,bt,Pt)===!1)return!1;ve++}Pt++}bt++}break;case"GeometryCollection":for(M=0;M<A.geometries.length;M++)if(Ul(A.geometries[M],f,I)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}Gi(Ul,"coordEach");function S2(g,f,I,M){var R=I;return Ul(g,function(V,A,u,le,Ae){A===0&&I===void 0?R=V:R=f(R,V,A,u,le,Ae)},M),R}Gi(S2,"coordReduce");function f_(g,f){var I;switch(g.type){case"FeatureCollection":for(I=0;I<g.features.length&&f(g.features[I].properties,I)!==!1;I++);break;case"Feature":f(g.properties,0);break}}Gi(f_,"propEach");function T2(g,f,I){var M=I;return f_(g,function(R,V){V===0&&I===void 0?M=R:M=f(M,R,V)}),M}Gi(T2,"propReduce");function m_(g,f){if(g.type==="Feature")f(g,0);else if(g.type==="FeatureCollection")for(var I=0;I<g.features.length&&f(g.features[I],I)!==!1;I++);}Gi(m_,"featureEach");function I2(g,f,I){var M=I;return m_(g,function(R,V){V===0&&I===void 0?M=R:M=f(M,R,V)}),M}Gi(I2,"featureReduce");function C2(g){var f=[];return Ul(g,function(I){f.push(I)}),f}Gi(C2,"coordAll");function Sp(g,f){var I,M,R,V,A,u,le,Ae,Ne,ve,se=0,Ge=g.type==="FeatureCollection",yt=g.type==="Feature",Fe=Ge?g.features.length:1;for(I=0;I<Fe;I++){for(u=Ge?g.features[I].geometry:yt?g.geometry:g,Ae=Ge?g.features[I].properties:yt?g.properties:{},Ne=Ge?g.features[I].bbox:yt?g.bbox:void 0,ve=Ge?g.features[I].id:yt?g.id:void 0,le=u?u.type==="GeometryCollection":!1,A=le?u.geometries.length:1,R=0;R<A;R++){if(V=le?u.geometries[R]:u,V===null){if(f(null,se,Ae,Ne,ve)===!1)return!1;continue}switch(V.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(f(V,se,Ae,Ne,ve)===!1)return!1;break}case"GeometryCollection":{for(M=0;M<V.geometries.length;M++)if(f(V.geometries[M],se,Ae,Ne,ve)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}se++}}Gi(Sp,"geomEach");function E2(g,f,I){var M=I;return Sp(g,function(R,V,A,u,le){V===0&&I===void 0?M=R:M=f(M,R,V,A,u,le)}),M}Gi(E2,"geomReduce");function ms(g,f){Sp(g,function(I,M,R,V,A){var u=I===null?null:I.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return f(uo(I,R,{bbox:V,id:A}),M,0)===!1?!1:void 0}var le;switch(u){case"MultiPoint":le="Point";break;case"MultiLineString":le="LineString";break;case"MultiPolygon":le="Polygon";break}for(var Ae=0;Ae<I.coordinates.length;Ae++){var Ne=I.coordinates[Ae],ve={type:le,coordinates:Ne};if(f(uo(ve,R),M,Ae)===!1)return!1}})}Gi(ms,"flattenEach");function A2(g,f,I){var M=I;return ms(g,function(R,V,A){V===0&&A===0&&I===void 0?M=R:M=f(M,R,V,A)}),M}Gi(A2,"flattenReduce");function g_(g,f){ms(g,function(I,M,R){var V=0;if(I.geometry){var A=I.geometry.type;if(!(A==="Point"||A==="MultiPoint")){var u,le=0,Ae=0,Ne=0;if(Ul(I,function(ve,se,Ge,yt,Fe){if(u===void 0||M>le||yt>Ae||Fe>Ne){u=ve,le=M,Ae=yt,Ne=Fe,V=0;return}var ot=ua([u,ve],I.properties);if(f(ot,M,R,Fe,V)===!1)return!1;V++,u=ve})===!1)return!1}}})}Gi(g_,"segmentEach");function P2(g,f,I){var M=I,R=!1;return g_(g,function(V,A,u,le,Ae){R===!1&&I===void 0?M=V:M=f(M,V,A,u,le,Ae),R=!0}),M}Gi(P2,"segmentReduce");function y_(g,f){if(!g)throw new Error("geojson is required");ms(g,function(I,M,R){if(I.geometry!==null){var V=I.geometry.type,A=I.geometry.coordinates;switch(V){case"LineString":if(f(I,M,R,0,0)===!1)return!1;break;case"Polygon":for(var u=0;u<A.length;u++)if(f(ua(A[u],I.properties),M,R,u)===!1)return!1;break}}})}Gi(y_,"lineEach");function M2(g,f,I){var M=I;return y_(g,function(R,V,A,u){V===0&&I===void 0?M=R:M=f(M,R,V,A,u)}),M}Gi(M2,"lineReduce");function k2(g,f){if(f=f||{},!wp(f))throw new Error("options is invalid");var I=f.featureIndex||0,M=f.multiFeatureIndex||0,R=f.geometryIndex||0,V=f.segmentIndex||0,A=f.properties,u;switch(g.type){case"FeatureCollection":I<0&&(I=g.features.length+I),A=A||g.features[I].properties,u=g.features[I].geometry;break;case"Feature":A=A||g.properties,u=g.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":u=g;break;default:throw new Error("geojson is invalid")}if(u===null)return null;var le=u.coordinates;switch(u.type){case"Point":case"MultiPoint":return null;case"LineString":return V<0&&(V=le.length+V-1),ua([le[V],le[V+1]],A,f);case"Polygon":return R<0&&(R=le.length+R),V<0&&(V=le[R].length+V-1),ua([le[R][V],le[R][V+1]],A,f);case"MultiLineString":return M<0&&(M=le.length+M),V<0&&(V=le[M].length+V-1),ua([le[M][V],le[M][V+1]],A,f);case"MultiPolygon":return M<0&&(M=le.length+M),R<0&&(R=le[M].length+R),V<0&&(V=le[M][R].length-V-1),ua([le[M][R][V],le[M][R][V+1]],A,f)}throw new Error("geojson is invalid")}Gi(k2,"findSegment");function z2(g,f){if(f=f||{},!wp(f))throw new Error("options is invalid");var I=f.featureIndex||0,M=f.multiFeatureIndex||0,R=f.geometryIndex||0,V=f.coordIndex||0,A=f.properties,u;switch(g.type){case"FeatureCollection":I<0&&(I=g.features.length+I),A=A||g.features[I].properties,u=g.features[I].geometry;break;case"Feature":A=A||g.properties,u=g.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":u=g;break;default:throw new Error("geojson is invalid")}if(u===null)return null;var le=u.coordinates;switch(u.type){case"Point":return co(le,A,f);case"MultiPoint":return M<0&&(M=le.length+M),co(le[M],A,f);case"LineString":return V<0&&(V=le.length+V),co(le[V],A,f);case"Polygon":return R<0&&(R=le.length+R),V<0&&(V=le[R].length+V),co(le[R][V],A,f);case"MultiLineString":return M<0&&(M=le.length+M),V<0&&(V=le[M].length+V),co(le[M][V],A,f);case"MultiPolygon":return M<0&&(M=le.length+M),R<0&&(R=le[M].length+R),V<0&&(V=le[M][R].length-V),co(le[M][R][V],A,f)}throw new Error("geojson is invalid")}Gi(z2,"findPoint");var D2=Object.defineProperty,F2=(g,f)=>D2(g,"name",{value:f,configurable:!0});function __(g,f={}){if(g.bbox!=null&&f.recompute!==!0)return g.bbox;const I=[1/0,1/0,-1/0,-1/0];return Ul(g,M=>{I[0]>M[0]&&(I[0]=M[0]),I[1]>M[1]&&(I[1]=M[1]),I[2]<M[0]&&(I[2]=M[0]),I[3]<M[1]&&(I[3]=M[1])}),I}F2(__,"bbox");function L2(g,f){var I=0,M=0,R=0,V=0,A=0,u=0,le=0,Ae=0,Ne=null,ve=null,se=g[0],Ge=g[1],yt=f.length;for(I;I<yt;I++){M=0;var Fe=f[I].length-1,ot=f[I];if(Ne=ot[0],Ne[0]!==ot[Fe][0]&&Ne[1]!==ot[Fe][1])throw new Error("First and last coordinates in a ring must be the same");for(A=Ne[0]-se,u=Ne[1]-Ge,M;M<Fe;M++){if(ve=ot[M+1],Ae=ve[1]-Ge,u<0&&Ae<0||u>0&&Ae>0){Ne=ve,u=Ae,A=Ne[0]-se;continue}if(le=ve[0]-g[0],Ae>0&&u<=0){if(V=A*Ae-le*u,V>0)R=R+1;else if(V===0)return 0}else if(u>0&&Ae<=0){if(V=A*Ae-le*u,V<0)R=R+1;else if(V===0)return 0}else if(Ae===0&&u<0){if(V=A*Ae-le*u,V===0)return 0}else if(u===0&&Ae<0){if(V=A*Ae-le*u,V===0)return 0}else if(u===0&&Ae===0){if(le<=0&&A>=0)return 0;if(A<=0&&le>=0)return 0}Ne=ve,u=Ae,A=le}}return R%2!==0}var B2=Object.defineProperty,x_=(g,f)=>B2(g,"name",{value:f,configurable:!0});function Nl(g,f,I={}){if(!g)throw new Error("point is required");if(!f)throw new Error("polygon is required");const M=d_(g),R=Gc(f),V=R.type,A=f.bbox;let u=R.coordinates;if(A&&v_(M,A)===!1)return!1;V==="Polygon"&&(u=[u]);let le=!1;for(var Ae=0;Ae<u.length;++Ae){const Ne=L2(M,u[Ae]);if(Ne===0)return!I.ignoreBoundary;Ne&&(le=!0)}return le}x_(Nl,"booleanPointInPolygon");function v_(g,f){return f[0]<=g[0]&&f[1]<=g[1]&&f[2]>=g[0]&&f[3]>=g[1]}x_(v_,"inBBox");class b_{constructor(f=[],I=R2){if(this.data=f,this.length=this.data.length,this.compare=I,this.length>0)for(let M=(this.length>>1)-1;M>=0;M--)this._down(M)}push(f){this.data.push(f),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const f=this.data[0],I=this.data.pop();return this.length--,this.length>0&&(this.data[0]=I,this._down(0)),f}peek(){return this.data[0]}_up(f){const{data:I,compare:M}=this,R=I[f];for(;f>0;){const V=f-1>>1,A=I[V];if(M(R,A)>=0)break;I[f]=A,f=V}I[f]=R}_down(f){const{data:I,compare:M}=this,R=this.length>>1,V=I[f];for(;f<R;){let A=(f<<1)+1,u=I[A];const le=A+1;if(le<this.length&&M(I[le],u)<0&&(A=le,u=I[le]),M(u,V)>=0)break;I[f]=u,f=A}I[f]=V}}function R2(g,f){return g<f?-1:g>f?1:0}function w_(g,f){return g.p.x>f.p.x?1:g.p.x<f.p.x?-1:g.p.y!==f.p.y?g.p.y>f.p.y?1:-1:1}function O2(g,f){return g.rightSweepEvent.p.x>f.rightSweepEvent.p.x?1:g.rightSweepEvent.p.x<f.rightSweepEvent.p.x?-1:g.rightSweepEvent.p.y!==f.rightSweepEvent.p.y?g.rightSweepEvent.p.y<f.rightSweepEvent.p.y?1:-1:1}class Ng{constructor(f,I,M,R){this.p={x:f[0],y:f[1]},this.featureId=I,this.ringId=M,this.eventId=R,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(f){return this.p.x===f.p.x&&this.p.y===f.p.y}}function j2(g,f){if(g.type==="FeatureCollection"){const I=g.features;for(let M=0;M<I.length;M++)$g(I[M],f)}else $g(g,f)}let Lu=0,Bu=0,Ru=0;function $g(g,f){const I=g.type==="Feature"?g.geometry:g;let M=I.coordinates;(I.type==="Polygon"||I.type==="MultiLineString")&&(M=[M]),I.type==="LineString"&&(M=[[M]]);for(let R=0;R<M.length;R++)for(let V=0;V<M[R].length;V++){let A=M[R][V][0],u=null;Bu=Bu+1;for(let le=0;le<M[R][V].length-1;le++){u=M[R][V][le+1];const Ae=new Ng(A,Lu,Bu,Ru),Ne=new Ng(u,Lu,Bu,Ru+1);Ae.otherEvent=Ne,Ne.otherEvent=Ae,w_(Ae,Ne)>0?(Ne.isLeftEndpoint=!0,Ae.isLeftEndpoint=!1):(Ae.isLeftEndpoint=!0,Ne.isLeftEndpoint=!1),f.push(Ae),f.push(Ne),A=u,Ru=Ru+1}}Lu=Lu+1}class N2{constructor(f){this.leftSweepEvent=f,this.rightSweepEvent=f.otherEvent}}function $2(g,f){if(g===null||f===null||g.leftSweepEvent.ringId===f.leftSweepEvent.ringId&&(g.rightSweepEvent.isSamePoint(f.leftSweepEvent)||g.rightSweepEvent.isSamePoint(f.leftSweepEvent)||g.rightSweepEvent.isSamePoint(f.rightSweepEvent)||g.leftSweepEvent.isSamePoint(f.leftSweepEvent)||g.leftSweepEvent.isSamePoint(f.rightSweepEvent)))return!1;const I=g.leftSweepEvent.p.x,M=g.leftSweepEvent.p.y,R=g.rightSweepEvent.p.x,V=g.rightSweepEvent.p.y,A=f.leftSweepEvent.p.x,u=f.leftSweepEvent.p.y,le=f.rightSweepEvent.p.x,Ae=f.rightSweepEvent.p.y,Ne=(Ae-u)*(R-I)-(le-A)*(V-M),ve=(le-A)*(M-u)-(Ae-u)*(I-A),se=(R-I)*(M-u)-(V-M)*(I-A);if(Ne===0)return!1;const Ge=ve/Ne,yt=se/Ne;if(Ge>=0&&Ge<=1&&yt>=0&&yt<=1){const Fe=I+Ge*(R-I),ot=M+Ge*(V-M);return[Fe,ot]}return!1}function V2(g,f){f=f||!1;const I=[],M=new b_([],O2);for(;g.length;){const R=g.pop();if(R.isLeftEndpoint){const V=new N2(R);for(let A=0;A<M.data.length;A++){const u=M.data[A];if(f&&u.leftSweepEvent.featureId===R.featureId)continue;const le=$2(V,u);le!==!1&&I.push(le)}M.push(V)}else R.isLeftEndpoint===!1&&M.pop()}return I}function U2(g,f){const I=new b_([],w_);return j2(g,I),V2(I,f)}var q2=Object.defineProperty,G2=(g,f)=>q2(g,"name",{value:f,configurable:!0}),Z2=U2;function hh(g,f,I={}){const{removeDuplicates:M=!0,ignoreSelfIntersections:R=!1}=I;let V=[];g.type==="FeatureCollection"?V=V.concat(g.features):g.type==="Feature"?V.push(g):(g.type==="LineString"||g.type==="Polygon"||g.type==="MultiLineString"||g.type==="MultiPolygon")&&V.push(uo(g)),f.type==="FeatureCollection"?V=V.concat(f.features):f.type==="Feature"?V.push(f):(f.type==="LineString"||f.type==="Polygon"||f.type==="MultiLineString"||f.type==="MultiPolygon")&&V.push(uo(f));const A=Z2(Ws(V),R);let u=[];if(M){const le={};A.forEach(Ae=>{const Ne=Ae.join(",");le[Ne]||(le[Ne]=!0,u.push(Ae))})}else u=A;return Ws(u.map(le=>co(le)))}G2(hh,"lineIntersect");var W2=Object.defineProperty,dh=(g,f)=>W2(g,"name",{value:f,configurable:!0});function lh(g,f={}){const I=Gc(g);switch(!f.properties&&g.type==="Feature"&&(f.properties=g.properties),I.type){case"Polygon":return S_(I,f);case"MultiPolygon":return T_(I,f);default:throw new Error("invalid poly")}}dh(lh,"polygonToLine");function S_(g,f={}){const M=Gc(g).coordinates,R=f.properties?f.properties:g.type==="Feature"?g.properties:{};return Tp(M,R)}dh(S_,"singlePolygonToLine");function T_(g,f={}){const M=Gc(g).coordinates,R=f.properties?f.properties:g.type==="Feature"?g.properties:{},V=[];return M.forEach(A=>{V.push(Tp(A,R))}),Ws(V)}dh(T_,"multiPolygonToLine");function Tp(g,f){return g.length>1?vp(g,f):ua(g[0],f)}dh(Tp,"coordsToLine");var H2=Object.defineProperty,vs=(g,f)=>H2(g,"name",{value:f,configurable:!0});function I_(g,f){let I=!0;return ms(g,M=>{ms(f,R=>{if(I===!1)return!1;I=C_(M.geometry,R.geometry)})}),I}vs(I_,"booleanDisjoint");function C_(g,f){switch(g.type){case"Point":switch(f.type){case"Point":return!M_(g.coordinates,f.coordinates);case"LineString":return!Xd(f,g);case"Polygon":return!Nl(g,f)}break;case"LineString":switch(f.type){case"Point":return!Xd(g,f);case"LineString":return!E_(g,f);case"Polygon":return!Jd(f,g)}break;case"Polygon":switch(f.type){case"Point":return!Nl(f,g);case"LineString":return!Jd(g,f);case"Polygon":return!A_(f,g)}}return!1}vs(C_,"disjoint");function Xd(g,f){for(let I=0;I<g.coordinates.length-1;I++)if(P_(g.coordinates[I],g.coordinates[I+1],f.coordinates))return!0;return!1}vs(Xd,"isPointOnLine");function E_(g,f){return hh(g,f).features.length>0}vs(E_,"isLineOnLine");function Jd(g,f){for(const M of f.coordinates)if(Nl(M,g))return!0;return hh(f,lh(g)).features.length>0}vs(Jd,"isLineInPoly");function A_(g,f){for(const M of g.coordinates[0])if(Nl(M,f))return!0;for(const M of f.coordinates[0])if(Nl(M,g))return!0;return hh(lh(g),lh(f)).features.length>0}vs(A_,"isPolyInPoly");function P_(g,f,I){const M=I[0]-g[0],R=I[1]-g[1],V=f[0]-g[0],A=f[1]-g[1];return M*A-R*V!==0?!1:Math.abs(V)>=Math.abs(A)?V>0?g[0]<=I[0]&&I[0]<=f[0]:f[0]<=I[0]&&I[0]<=g[0]:A>0?g[1]<=I[1]&&I[1]<=f[1]:f[1]<=I[1]&&I[1]<=g[1]}vs(P_,"isPointOnLineSegment");function M_(g,f){return g[0]===f[0]&&g[1]===f[1]}vs(M_,"compareCoords");var X2=Object.defineProperty,J2=(g,f)=>X2(g,"name",{value:f,configurable:!0});function Kd(g,f){let I=!1;return ms(g,M=>{ms(f,R=>{if(I===!0)return!0;I=!I_(M.geometry,R.geometry)})}),I}J2(Kd,"booleanIntersects");function K2(){const g=Ao.useRef(null),[f,I]=Ao.useState(null);Ao.useEffect(()=>{window.scrollTo(0,0)},[]);const M=gs();Po(M.breakpoints.up("md")),Uc();const R=tp(),{filteredValue:V,expand:A,notificationFilter:u,permitFilter:le,approvalFilter:Ae,compostFacilityFilter:Ne,landApplicationBioSolidsFilter:ve,operationalCertificateFilter:se,location:Ge,searchBy:yt,page:Fe,globalTextSearchFilter:ot,compostFacilityFilterDisabled:zt,landApplicationBioSolidsFilterDisabled:tr,lastModified:bt}=rp(tt=>tt.omrr);Ao.useEffect(()=>{const tt=new _m.Map({container:g.current,style:"https://api.maptiler.com/maps/openstreetmap/style.json?key=l0YRm3kb0FVo9JhCP3Ia",center:[-127.6476,53.7267],zoom:4,attributionControl:!1});I(tt);const Ot={type:"FeatureCollection",features:V.map(cr=>({type:"Feature",geometry:{type:"Point",coordinates:[cr.Longitude,cr.Latitude]},properties:{...cr}}))};return tt.on("load",()=>{tt.addSource("points",{type:"geojson",data:Ot}),tt.addLayer({id:"points",type:"circle",source:"points",paint:{"circle-radius":6,"circle-color":"#053662","circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}),tt.on("click","points",Cr=>{const li=Cr.features[0].geometry.coordinates.slice(),Ft=Cr.features[0].properties;Ft["Authorization Number"];const rr=` <div id="popupfacilities">${Ft?Object.entries(Ft).map(([$t,ti])=>`<div ><strong>${$t}:</strong> ${ti}</div>`).join(""):""}</div>`;new _m.Popup().setLngLat(li).setHTML(rr).addTo(tt)});const cr=new u0({displayControlsDefault:!1});tt.addControl(cr),tt.draw=cr,tt.on("draw.create",function(Cr){console.log(tt,"map when drawing");const li=Cr.features,Ft=li[0].geometry;if(li[0].geometry.type==="Polygon"){const rr=Ft.coordinates[0],$t=rr.map(nr=>[nr[0],nr[1]]),di=`POLYGON ((${rr.map(nr=>`${nr[0]} ${nr[1]}`).join(", ")}))`;console.log(di,"wkt polygon "),console.log({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[$t],properties:{}}}]},"geojson1");const yn=Vc([$t]),bi=tt.getSource("points")._data;console.log(bi,"geojson");const Ar=V.filter(nr=>{const Xr=co([nr.Longitude,nr.Latitude]);if(Kd(yn,Xr))return nr});console.log(Ar,"filterValueNew"),R(ym(Ar))}}),tt.on("draw.update",function(li){console.log("draw update event listner from map"),console.log(cr,"draw update from layer control panel");const Ft=li.features,Er=Ft[0].geometry;if(Ft[0].geometry.type==="Polygon"){const $t=Er.coordinates[0],ti=$t.map(Ar=>[Ar[0],Ar[1]]),pi=`POLYGON ((${$t.map(Ar=>`${Ar[0]} ${Ar[1]}`).join(", ")}))`;console.log(pi,"wkt polygon ");const yn=Vc([ti]),bi=V.filter(Ar=>{const nr=co([Ar.Longitude,Ar.Latitude]);if(Kd(yn,nr))return Ar});console.log(bi,"filterValueNew"),R(ym(bi))}}),tt.on("mouseenter","points",()=>{tt.getCanvas().style.cursor="pointer"}),tt.on("mouseleave","points",()=>{tt.getCanvas().style.cursor=""})}),()=>{tt.remove()}},[]);const Pt=()=>{const tt=f.draw;tt.deleteAll(),tt.changeMode("draw_polygon")},Nt=()=>{f.draw.deleteAll(),R(qs("all"))};return Ao.useEffect(()=>{if(!f)return;const tt={type:"FeatureCollection",features:V.map(Ot=>({type:"Feature",geometry:{type:"Point",coordinates:[Ot.Longitude,Ot.Latitude]},properties:{...Ot}}))};if(f){const Ot=document.getElementsByClassName("maplibregl-popup");Ot.length&&Ot[0].remove(),f.getSource("points")?.setData(tt),tt.features.length&&__(tt)}},[V]),T.jsx(oe,{container:!0,spacing:2,sx:{marginTop:"1vh"},children:T.jsx(oe,{item:!0,xs:12,children:T.jsxs(oe,{container:!0,spacing:2,children:[T.jsxs(oe,{position:"absolute",top:"70px",left:"10px",sx:{backgroundColor:"white",padding:"1em",margin:"0px",borderRadius:"25px",zIndex:100},children:[T.jsx(oe,{item:!0,xs:12,children:T.jsx(Zg,{sx:{minWidth:"100%",color:"#9F9D9C",marginBottom:"1.5em"},label:"Search Authorizations","data-testid":"auth-list-search-authorizations-textfield",value:ot,onChange:tt=>R(ny(tt.target.value)),variant:"outlined",InputProps:{startAdornment:T.jsx(Wg,{position:"start",children:T.jsx(Hg,{})})}})}),T.jsx(oe,{item:!0,xs:12,children:T.jsxs(oe,{container:!0,sx:{maxWidth:"100%"},justifyContent:"space-between",spacing:0,direction:{xs:"column",sm:"row"},children:[T.jsxs(oe,{position:"relative",sx:{},children:[T.jsxs(Mo,{sx:{marginTop:{xs:"1.5em",sm:"0"},padding:"0.6em 1.125em",background:"#053662",color:"#ffffff",borderRadius:"4px",textTransform:"none",order:1,display:"flex",justifyContent:"space-between",height:"100%",alignSelf:{sm:"center"},"&:hover":{background:"#053662",color:"#ffffff",boxShadow:"none"}},onClick:()=>R(ry(!A)),children:["Filter by Facility Type"," ",A?T.jsx(Jg,{}):T.jsx(Kg,{})]}),A&&T.jsxs(oe,{position:"absolute",top:"100%",left:"0",sx:{backgroundColor:"white",padding:"1em",margin:"0px",borderRadius:"25px",zIndex:100},item:!0,xs:12,children:[T.jsx(oe,{item:!0,xs:12,children:T.jsxs(oe,{container:!0,spacing:.5,direction:{xs:"column",sm:"column"},children:[T.jsx(oe,{item:!0,xs:12,sm:4,md:3,children:T.jsx(Bi,{checked:u,control:T.jsx(so,{}),label:"Notification",onClick:()=>R(lo("notification"))})}),T.jsx(oe,{item:!0,xs:12,sm:4,md:3,children:T.jsx(Bi,{control:T.jsx(so,{}),checked:le,label:"Permit",onClick:()=>R(lo("permit"))})}),T.jsx(oe,{item:!0,xs:12,sm:4,md:3,children:T.jsx(Bi,{checked:Ae,control:T.jsx(so,{}),label:"Approval",onClick:()=>R(lo("approval"))})}),T.jsx(oe,{item:!0,xs:12,sm:4,md:3,children:T.jsx(Bi,{checked:se,control:T.jsx(so,{}),label:"Operational Certificate",onClick:()=>R(lo("operationalCertificate"))})}),T.jsx(oe,{item:!0,xs:12,sm:4,md:3,children:T.jsx(Bi,{checked:Ne,control:T.jsx(so,{}),disabled:zt,label:"Compost Production Facility",onClick:()=>R(lo("compostFacility"))})}),T.jsx(oe,{item:!0,xs:12,sm:4,md:3,children:T.jsx(Bi,{checked:ve,control:T.jsx(so,{}),disabled:tr,label:"Land Application of Biosolids",onClick:()=>R(lo("landApplicationBioSolids"))})})]})}),T.jsx(oe,{item:!0,xs:12,children:T.jsx(oe,{container:!0,spacing:3,direction:"row",sx:{marginTop:"0.1em"},children:T.jsx(oe,{item:!0,xs:12,children:T.jsx(Mo,{sx:{border:"1px solid #353433",borderRadius:"4px",textTransform:"none"},variant:"contained",color:"secondary",onClick:()=>R(iy()),children:"Reset Filters"})})})})]})]}),T.jsx(Mo,{sx:{marginRight:"1em",marginTop:{xs:"1.5em",sm:"0"},padding:"0.2em 1.125em",background:"#053662",color:"#ffffff",borderRadius:"4px",textTransform:"none",order:1,display:"flex",justifyContent:"space-between",height:"100%",alignSelf:{sm:"center"},"&:hover":{background:"#053662",color:"#ffffff",boxShadow:"none"}},onClick:Nt,children:"Cancel Draw"}),T.jsx(Mo,{sx:{marginTop:{xs:"1.5em",sm:"0"},padding:"0.2em 1.125em",background:"#053662",color:"#ffffff",borderRadius:"4px",textTransform:"none",order:1,display:"flex",justifyContent:"space-between",height:"100%",alignSelf:{sm:"center"},"&:hover":{background:"#053662",color:"#ffffff",boxShadow:"none"}},onClick:Pt,children:"Draw"}),T.jsxs(Lc,{sx:{display:"flex",alignItems:"left",flexDirection:"row",marginLeft:"1em",justifyContent:"left"},direction:{xs:"column",md:"row"},children:[T.jsx(ao,{display:"flex",alignItems:"center",sx:{marginRight:"2em"},children:T.jsx("span",{children:"Search by: "})}),T.jsx(ao,{display:"flex",alignItems:"left",children:T.jsxs(Xg,{row:!0,name:"searchBy",defaultValue:"active",value:yt,children:[T.jsx(Bi,{value:"all",control:T.jsx(Fl,{}),label:"All",onClick:()=>R(qs("all"))}),T.jsx(Bi,{value:"active",control:T.jsx(Fl,{}),label:"Active",onClick:()=>R(qs("active"))}),T.jsx(Bi,{value:"inactive",control:T.jsx(Fl,{}),label:"Inactive",onClick:()=>R(qs("inactive"))})]})})]})]})})]}),T.jsx("div",{ref:g,id:"map-malibre",className:"map-maplibre-container"})]})})})}const Y2="/assets/marker-icon-2x-red-D0s-q2wj.png",Q2="/assets/marker-shadow-ByH7NwpC.png";var Ip={},Id={};const eT=Qg(Mv);var Vg;function k_(){return Vg||(Vg=1,function(g){"use client";Object.defineProperty(g,"__esModule",{value:!0}),Object.defineProperty(g,"default",{enumerable:!0,get:function(){return f.createSvgIcon}});var f=eT}(Id)),Id}var tT=Yg;Object.defineProperty(Ip,"__esModule",{value:!0});var En=Ip.default=void 0,rT=tT(k_()),iT=T;En=Ip.default=(0,rT.default)((0,iT.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");var Cp={},nT=Yg;Object.defineProperty(Cp,"__esModule",{value:!0});var An=Cp.default=void 0,oT=nT(k_()),aT=T;An=Cp.default=(0,oT.default)((0,aT.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");function sT(g,f){return T.jsxs(T.Fragment,{children:[g&&T.jsxs(T.Fragment,{children:[T.jsxs(oe,{container:!0,direction:"row",sx:{marginTop:"1.5em"},spacing:1,children:[T.jsx(oe,{item:!0,xs:3,children:T.jsx("span",{"data-testid":"auth-details-auth-status",style:{color:"#000000",fontFamily:"BCSans-Bold",fontSize:"1em",lineHeight:"1em"},children:"Authorization Status"})}),T.jsx(oe,{item:!0,xs:3,children:T.jsx("span",{"data-testid":"auth-details-auth-number",style:{color:"#000000",fontFamily:"BCSans-Bold",fontSize:"1em",lineHeight:"1em"},children:"Authorization Number"})}),T.jsx(oe,{item:!0,xs:3,children:T.jsx("span",{"data-testid":"auth-details-effactive-date",style:{color:"#000000",fontFamily:"BCSans-Bold",fontSize:"1em",lineHeight:"1em"},children:"Effective/Issue Date"})}),T.jsx(oe,{item:!0,xs:3,children:T.jsx("span",{"data-testid":"auth-details-last-ammendment-date",style:{color:"#000000",fontFamily:"BCSans-Bold",fontSize:"1em",lineHeight:"1em"},children:"Last Amendment Date"})})]}),T.jsxs(oe,{container:!0,direction:"row",spacing:1,sx:{marginTop:"0.2em"},children:[T.jsx(oe,{item:!0,xs:3,children:T.jsx(Ed,{"data-testid":"auth-details-auth-status-value",sx:{background:f["Authorization Status"]==="Active"?"#42814A":"#605E5C",color:"#ffffff"},label:f["Authorization Status"]})}),T.jsx(oe,{item:!0,xs:3,children:T.jsx("span",{"data-testid":"auth-details-auth-number-value",children:f["Authorization Number"]})}),T.jsx(oe,{item:!0,xs:3,children:T.jsx("span",{"data-testid":"auth-details-effactive-date-value",children:f["Effective/Issue Date"]?.toString()})}),T.jsx(oe,{item:!0,xs:3,children:T.jsx("span",{"data-testid":"auth-details-last-ammendment-date-value",children:f["Last Amendment Date"]?.toString()})})]})]}),!g&&T.jsxs(T.Fragment,{children:[T.jsxs(oe,{container:!0,direction:"row",sx:{marginTop:"1.5em"},spacing:0,children:[T.jsx(oe,{item:!0,xs:6,children:T.jsx("span",{"data-testid":"auth-details-auth-status",style:{color:"#000000",fontFamily:"BCSans-Bold",fontSize:".75em",lineHeight:"1em"},children:"Authorization Status"})}),T.jsx(oe,{item:!0,xs:6,children:T.jsx("span",{"data-testid":"auth-details-auth-number",style:{color:"#000000",fontFamily:"BCSans-Bold",fontSize:".75em",lineHeight:"1em"},children:"Authorization Number"})})]}),T.jsxs(oe,{container:!0,direction:"row",sx:{marginTop:".2em"},spacing:0,children:[T.jsx(oe,{item:!0,xs:6,children:T.jsx(Ed,{"data-testid":"auth-details-auth-status-value",sx:{background:f["Authorization Status"]==="Active"?"#42814A":"#605E5C",color:"#ffffff"},label:f["Authorization Status"]})}),T.jsx(oe,{item:!0,xs:6,children:T.jsx("span",{"data-testid":"auth-details-auth-number-value",children:f["Authorization Number"]})})]}),T.jsxs(oe,{container:!0,direction:"row",sx:{marginTop:"2em"},spacing:0,children:[T.jsx(oe,{item:!0,xs:6,children:T.jsx("span",{"data-testid":"auth-details-effactive-date",style:{color:"#000000",fontFamily:"BCSans-Bold",fontSize:".75em",lineHeight:"1em"},children:"Effective/Issue Date"})}),T.jsx(oe,{item:!0,xs:6,children:T.jsx("span",{"data-testid":"auth-details-last-ammendment-date",style:{color:"#000000",fontFamily:"BCSans-Bold",fontSize:".75em",lineHeight:"1em"},children:"Last Amendment Date"})})]}),T.jsxs(oe,{container:!0,direction:"row",sx:{marginTop:".2em"},spacing:0,children:[T.jsx(oe,{item:!0,xs:6,children:T.jsx("span",{"data-testid":"auth-details-effactive-date-valu",children:f["Effective/Issue Date"]?.toString()})}),T.jsx(oe,{item:!0,xs:6,children:T.jsx("span",{"data-testid":"auth-details-last-ammendment-valu",children:f["Last Amendment Date"]?.toString()})})]})]})]})}function lT(g){return T.jsx(T.Fragment,{children:(g["Authorization Type"]?.toLowerCase()==="permit"||g["Authorization Type"]?.toLowerCase()==="operational certificate"||g["Authorization Type"]?.toLowerCase()==="approval")&&T.jsx(T.Fragment,{children:T.jsxs(oe,{sx:{margin:"0 0 0"},container:!0,spacing:0,children:[T.jsx(oe,{item:!0,xs:12,sx:{marginBottom:"2em"},children:T.jsx("span",{style:{fontFamily:"BCSans-Bold",fontSize:"1.5em",color:"#000000"},children:"Authorization Details"})}),T.jsx(oe,{sx:{margin:"0 0 0.5em"},item:!0,xs:12,children:T.jsx("span",{style:{fontFamily:"BCSans-Bold",fontSize:".75em",color:"#000000"},children:"Authorization Type"})}),T.jsx(oe,{sx:{margin:{xs:"0 0 1em",md:"0 0 1.5em"}},item:!0,xs:12,children:T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000"},children:g["Authorization Type"]})}),T.jsx(oe,{item:!0,xs:12,children:T.jsxs(oe,{container:!0,direction:{xs:"column",md:"column",lg:"row"},children:[T.jsx(oe,{item:!0,xs:6,children:T.jsxs(oe,{container:!0,direction:"column",children:[T.jsx(oe,{sx:{margin:"0 0 0.5em"},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans-Bold",fontSize:".75em",color:"#000000"},children:"Regulation"})}),T.jsx(oe,{sx:{margin:{xs:"0 0 1em",md:"0 0 1.5em"}},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000",textDecoration:"underline"},children:"Waste Discharge Regulation"})})]})}),T.jsx(oe,{item:!0,xs:6,children:T.jsxs(oe,{container:!0,direction:"column",children:[T.jsx(oe,{sx:{margin:"0 0 0.5em"},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans-Bold",fontSize:".75em",color:"#000000"},children:"Schedule"})}),T.jsx(oe,{sx:{margin:"0 0 1.5em"},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000"},children:g["Waste Discharge Regulation"]})})]})})]})}),T.jsx(oe,{item:!0,xs:11,sx:{margin:"0"},children:T.jsx("span",{style:{fontFamily:"BCSans-Italic",fontSize:"1.1em"},children:"Permits, Operational Certificates, and Approvals are necessary for composting operations that handle 5,000 tonnes or more of finished compost per year from food waste or biosolids, as specified in the Organic Matter Recycling Regulation."})})]})})})}function cT(g){const f=gs();return Po(f.breakpoints.up("md")),T.jsx(T.Fragment,{children:g["Authorization Type"]?.toLowerCase()==="notification"&&g["Operation Type"]?.toLowerCase()==="compost production facility"&&T.jsx(T.Fragment,{children:T.jsxs(oe,{sx:{margin:"0 0 0"},container:!0,spacing:0,children:[T.jsx(oe,{item:!0,xs:12,sx:{marginBottom:"2em"},children:T.jsx("span",{style:{fontFamily:"BCSans-Bold",fontSize:"1.5em",color:"#000000"},children:"Authorization Details"})}),T.jsx(oe,{sx:{margin:"0 0 0.5em"},item:!0,xs:12,children:T.jsx("span",{style:{fontFamily:"BCSans-Bold",fontSize:".75em",color:"#000000"},children:"Authorization Type"})}),T.jsx(oe,{sx:{margin:{xs:"0 0 1em",md:"0 0 1.5em"}},item:!0,xs:12,children:T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000"},children:g["Authorization Type"]})}),T.jsx(oe,{item:!0,xs:12,children:T.jsxs(oe,{container:!0,direction:{xs:"column",md:"column",lg:"row"},children:[T.jsx(oe,{item:!0,xs:6,children:T.jsxs(oe,{container:!0,direction:"column",children:[T.jsx(oe,{sx:{margin:"0 0 0.5em"},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans-Bold",fontSize:".75em",color:"#000000"},children:"Operation Type"})}),T.jsx(oe,{sx:{margin:{xs:"0 0 1em",md:"0 0 1.5em"}},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000"},children:g["Operation Type"]})})]})}),T.jsx(oe,{item:!0,xs:6,children:T.jsxs(oe,{container:!0,direction:"column",children:[T.jsx(oe,{sx:{margin:"0 0 0.5em"},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans-Bold",fontSize:".75em",color:"#000000"},children:"Regulation"})}),T.jsx(oe,{sx:{margin:{xs:"0 0 1em",md:"0 0 1.5em"}},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000",textDecoration:"underline"},children:"Organic Matter Recycling Regulation"})})]})})]})}),T.jsx(oe,{item:!0,xs:12,children:T.jsxs(oe,{container:!0,direction:{xs:"column",md:"column",lg:"row"},children:[T.jsx(oe,{item:!0,xs:6,children:T.jsxs(oe,{container:!0,direction:"column",children:[T.jsx(oe,{sx:{margin:"0 0 0.5em"},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans-Bold",fontSize:".75em",color:"#000000"},children:"Types of Compost Produced"})}),T.jsx(oe,{sx:{margin:{xs:"0 0 1em",md:"0 0 1.5em"}},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000"},children:g["Type of Compost Produced"]})})]})}),T.jsx(oe,{item:!0,xs:6,children:T.jsxs(oe,{container:!0,direction:"column",children:[T.jsx(oe,{sx:{margin:"0 0 0.5em"},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans-Bold",fontSize:".75em",color:"#000000"},children:"Facility Design Capacity (tonnes per year)"})}),T.jsx(oe,{sx:{margin:"0 0 2em"},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000"},children:g["Facility Design Capacity (t/y)"]})})]})})]})}),T.jsx(oe,{item:!0,xs:12,sx:{margin:0,background:"#D8EAFD","& > .MuiGrid-root":{padding:{xs:"1.5em",md:"1.5em 2.5em 2em"}}},children:T.jsxs(oe,{container:!0,children:[T.jsx(oe,{item:!0,xs:12,sx:{margin:{xs:"0 0 1.5em"}},children:T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1.1em",color:"#000000"},children:"Organic Matter Used for Composting"})}),T.jsx(oe,{item:!0,xs:12,children:T.jsxs(oe,{container:!0,direction:{xs:"column",md:"row"},sx:{"& > .MuiGrid-item":{marginBottom:{xs:"1em",md:"1.5em"}}},children:[T.jsx(oe,{item:!0,xs:12,md:6,lg:4,xl:3,children:T.jsxs("div",{style:{display:"flex",justifyContent:"left"},children:[g["Yard Waste"]?T.jsx(En,{style:{color:"#42814A"}}):T.jsx(An,{style:{color:"#605E5C"}}),T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000",marginLeft:"0.5em"},children:"Yard Waste"})]})}),T.jsx(oe,{item:!0,xs:12,md:6,lg:4,xl:3,children:T.jsxs("div",{style:{display:"flex",justifyContent:"left"},children:[g.Biosolids?T.jsx(En,{style:{color:"#42814A"}}):T.jsx(An,{style:{color:"#605E5C"}}),T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000",marginLeft:"0.5em"},children:"Biosolids"})]})}),T.jsx(oe,{item:!0,xs:12,md:6,lg:4,xl:3,children:T.jsxs("div",{style:{display:"flex",justifyContent:"left"},children:[g.Whey?T.jsx(En,{style:{color:"#42814A"}}):T.jsx(An,{style:{color:"#605E5C"}}),T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000",marginLeft:"0.5em"},children:"Whey"})]})}),T.jsx(oe,{item:!0,xs:12,md:6,lg:4,xl:3,children:T.jsxs("div",{style:{display:"flex",justifyContent:"left"},children:[g["Untreated and Unprocessed Wood Residuals"]?T.jsx(En,{style:{color:"#42814A"}}):T.jsx(An,{style:{color:"#605E5C"}}),T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000",marginLeft:"0.5em"},children:"Untreated and Unprocessed Wood"})]})}),T.jsx(oe,{item:!0,xs:12,md:6,lg:4,xl:3,children:T.jsxs("div",{style:{display:"flex",justifyContent:"left"},children:[g["Poultry Carcasses"]?T.jsx(En,{style:{color:"#42814A"}}):T.jsx(An,{style:{color:"#605E5C"}}),T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000",marginLeft:"0.5em"},children:"Poultry Carcasses"})]})}),T.jsx(oe,{item:!0,xs:12,md:6,lg:4,xl:3,children:T.jsxs("div",{style:{display:"flex",justifyContent:"left"},children:[g["Fish Wastes"]?T.jsx(En,{style:{color:"#42814A"}}):T.jsx(An,{style:{color:"#605E5C"}}),T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000",marginLeft:"0.5em"},children:"Fish Wastes"})]})}),T.jsx(oe,{item:!0,xs:12,md:6,lg:4,xl:3,children:T.jsxs("div",{style:{display:"flex",justifyContent:"left"},children:[g["Food Waste"]?T.jsx(En,{style:{color:"#42814A"}}):T.jsx(An,{style:{color:"#605E5C"}}),T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000",marginLeft:"0.5em"},children:"Food Waste"})]})}),T.jsx(oe,{item:!0,xs:12,md:6,lg:4,xl:3,children:T.jsxs("div",{style:{display:"flex",justifyContent:"left"},children:[g["Brewery Waste/Wine Waste"]?T.jsx(En,{style:{color:"#42814A"}}):T.jsx(An,{style:{color:"#605E5C"}}),T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000",marginLeft:"0.5em"},children:"Brewary Waste/Wine Waste"})]})}),T.jsx(oe,{item:!0,xs:12,md:6,lg:4,xl:3,children:T.jsxs("div",{style:{display:"flex",justifyContent:"left"},children:[g["Animal Bedding"]?T.jsx(En,{style:{color:"#42814A"}}):T.jsx(An,{style:{color:"#605E5C"}}),T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000",marginLeft:"0.5em"},children:"Animal Bedding"})]})}),T.jsx(oe,{item:!0,xs:12,md:6,lg:4,xl:3,children:T.jsxs("div",{style:{display:"flex",justifyContent:"left"},children:[g["Domestic Septic Tank Sludge"]?T.jsx(En,{style:{color:"#42814A"}}):T.jsx(An,{style:{color:"#605E5C"}}),T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000",marginLeft:"0.5em"},children:"Domestic Septic Tank Sludge"})]})}),T.jsx(oe,{item:!0,xs:12,md:6,lg:4,xl:3,children:T.jsxs("div",{style:{display:"flex",justifyContent:"left"},children:[g["Hatchery Waste"]?T.jsx(En,{style:{color:"#42814A"}}):T.jsx(An,{style:{color:"#605E5C"}}),T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000",marginLeft:"0.5em"},children:"Hatchery Waste"})]})}),T.jsx(oe,{item:!0,xs:12,md:6,lg:4,xl:3,children:T.jsxs("div",{style:{display:"flex",justifyContent:"left"},children:[g.Manure?T.jsx(En,{style:{color:"#42814A"}}):T.jsx(An,{style:{color:"#605E5C"}}),T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000",marginLeft:"0.5em"},children:"Manure"})]})}),T.jsx(oe,{item:!0,xs:12,md:6,lg:4,xl:3,children:T.jsxs("div",{style:{display:"flex",justifyContent:"left"},children:[g["Milk Processing Waste"]?T.jsx(En,{style:{color:"#42814A"}}):T.jsx(An,{style:{color:"#605E5C"}}),T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000",marginLeft:"0.5em"},children:"Milk Processing Waste"})]})})]})})]})})]})})})}function uT(g){return T.jsx(T.Fragment,{children:g["Authorization Type"]?.toLowerCase()==="notification"&&g["Operation Type"]?.toLowerCase()?.includes("land application")&&T.jsx(T.Fragment,{children:T.jsxs(oe,{sx:{margin:"0 0 0"},container:!0,spacing:0,children:[T.jsx(oe,{item:!0,xs:12,sx:{marginBottom:"2em"},children:T.jsx("span",{style:{fontFamily:"BCSans-Bold",fontSize:"1.5em",color:"#000000"},children:"Authorization Details"})}),T.jsx(oe,{sx:{margin:"0 0 0.5em"},item:!0,xs:12,children:T.jsx("span",{style:{fontFamily:"BCSans-Bold",fontSize:".75em",color:"#000000"},children:"Authorization Type"})}),T.jsx(oe,{sx:{margin:{xs:"0 0 1em",md:"0 0 1.5em"}},item:!0,xs:12,children:T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000"},children:g["Authorization Type"]})}),T.jsx(oe,{item:!0,xs:12,children:T.jsxs(oe,{container:!0,direction:{xs:"column",md:"row"},children:[T.jsx(oe,{item:!0,xs:6,children:T.jsxs(oe,{container:!0,direction:"column",children:[T.jsx(oe,{sx:{margin:"0 0 0.5em"},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans-Bold",fontSize:".75em",color:"#000000"},children:"Operation Type"})}),T.jsx(oe,{sx:{margin:{xs:"0 0 1em",md:"0 0 1.5em"}},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000"},children:g["Operation Type"]})})]})}),T.jsx(oe,{item:!0,xs:6,children:T.jsxs(oe,{container:!0,direction:"column",children:[T.jsx(oe,{sx:{margin:"0 0 0.5em"},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans-Bold",fontSize:".75em",color:"#000000"},children:"Regulation"})}),T.jsx(oe,{sx:{margin:{xs:"0 0 1em",md:"0 0 1.5em"}},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000",textDecoration:"underline"},children:"Organic Matter Recycling Regulation"})})]})})]})}),T.jsx(oe,{item:!0,xs:12,children:T.jsxs(oe,{container:!0,direction:{xs:"column",md:"row"},children:[T.jsx(oe,{item:!0,xs:6,children:T.jsxs(oe,{container:!0,direction:"column",children:[T.jsx(oe,{sx:{margin:"0 0 0.5em"},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans-Bold",fontSize:".75em",color:"#000000"},children:"Material Land Applied"})}),T.jsx(oe,{sx:{margin:{xs:"0 0 1em",lg:"0"}},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000"},children:g["Material Land Applied"]})})]})}),T.jsx(oe,{item:!0,xs:6,children:T.jsxs(oe,{container:!0,direction:"column",children:[T.jsx(oe,{sx:{margin:"0 0 0.5em"},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans-Bold",fontSize:".75em",color:"#000000"},children:"Intended Date of Land Application"})}),T.jsx(oe,{sx:{margin:"0"},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000"},children:g["Intended Dates of Land Application"]})})]})})]})})]})})})}function hT(g){return T.jsx(T.Fragment,{children:g["Authorization Type"]?.toLowerCase()==="notification"&&g["Operation Type"]?.trim()===""&&T.jsx(T.Fragment,{children:T.jsxs(oe,{sx:{margin:"0 0 0"},container:!0,spacing:0,children:[T.jsx(oe,{item:!0,xs:12,sx:{marginBottom:"2em"},children:T.jsx("span",{style:{fontFamily:"BCSans-Bold",fontSize:"1.5em",color:"#000000"},children:"Authorization Details"})}),T.jsx(oe,{item:!0,xs:12,children:T.jsxs(oe,{container:!0,direction:{xs:"column",md:"column",lg:"row"},children:[T.jsx(oe,{item:!0,xs:6,children:T.jsxs(oe,{container:!0,direction:"column",children:[T.jsx(oe,{sx:{margin:"0 0 0.5em"},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans-Bold",fontSize:".75em",color:"#000000"},children:"Authorization Type"})}),T.jsx(oe,{sx:{margin:{xs:"0 0 1em",md:"0 0 1.5em"}},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000"},children:g["Authorization Type"]})})]})}),T.jsx(oe,{item:!0,xs:6,children:T.jsxs(oe,{container:!0,direction:"column",children:[T.jsx(oe,{sx:{margin:"0 0 0.5em"},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans-Bold",fontSize:".75em",color:"#000000"},children:"Regulation"})}),T.jsx(oe,{sx:{margin:"0 0 1.5em"},item:!0,xs:6,children:T.jsx("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000",textDecoration:"underline"},children:"Organic Matter Recycling Regulation"})})]})})]})}),T.jsx(oe,{item:!0,xs:12,sx:{margin:"0"},children:T.jsxs("span",{style:{color:"#000000",fontFamily:"BCSans-Italic",fontSize:"1.1em"},children:["Please note that authorizations issued prior to 2007 are currently categorized as historical data. The Authorization Management System (AMS), which houses authorization documentation, has constraints on the historical data it provides."," ",T.jsxs("a",{style:{color:"#000000"},href:"mailto:env.omrr.reg.reviews@gov.bc.ca",children:[" ","For additional information, please contact us."]})]})})]})})})}function dT(){Ao.useEffect(()=>{window.scrollTo(0,0)},[]);const g=gs(),f=Po(g.breakpoints.up("md"));Po(g.breakpoints.up("sm")),Po(g.breakpoints.up("xs")),Po(g.breakpoints.up("lg"));const I=new Wv.Icon({iconUrl:Y2,shadowUrl:Q2,iconSize:[50,82],iconAnchor:[25,82],popupAnchor:[1,-34],shadowSize:[82,82]}),M=Uc(),R=le=>{M(le)},A=Ov()?.state?.data;A&&A["Authorization Type"];let u;return A&&A.Latitude&&A.Longitude&&(u={lat:A.Latitude,lng:A.Longitude}),T.jsxs(oe,{container:!0,spacing:1,sx:{maxWidth:"100%",width:"100%",margin:0,padding:{xs:"6.5em 1em 0",md:"6.5em 2em 0"},"& > .MuiGrid-item":{paddingRight:{xs:".5em",md:0}}},children:[T.jsx(oe,{item:!0,xs:12,children:T.jsxs(Mo,{"data-testid":"auth-details-back-to-search",sx:{background:"#053662",color:"#ffffff",borderRadius:"4px",textTransform:"none",order:1,padding:"0.6em 1.125em 0.6em .5em","&:hover":{background:"#053662",color:"#ffffff",boxShadow:"none"}},onClick:()=>R("/search"),children:[T.jsx(kv,{sx:{marginRight:".25em"}}),"Back To Search"]})}),T.jsxs(oe,{item:!0,xs:12,sx:{marginTop:"1em"},children:[T.jsx(oe,{container:!0,direction:{xs:"column",md:"column",lg:"row"},children:T.jsx(oe,{item:!0,xs:12,children:T.jsx("span",{style:{color:"#000000",fontFamily:"BCSans-Bold",fontSize:"1.5em"},children:A["Regulated Party"]})})}),sT(f,A)]}),T.jsx(oe,{item:!0,xs:12,sx:{background:"#F1F8FE",margin:{xs:"2.5em .5em 0"},padding:{xs:"1.5em 1em !important",md:"1.5em !important"}},children:T.jsxs(oe,{justifyItems:"center",justifyContent:"center",container:!0,direction:{xs:"column",md:"column",lg:"row"},spacing:0,children:[T.jsx(oe,{item:!0,xs:6,children:T.jsxs(oe,{container:!0,spacing:0,children:[T.jsx(oe,{sx:{margin:{xs:"0 0 1em",md:"0 0 1.5em"}},item:!0,xs:12,children:T.jsx("span",{style:{fontFamily:"BCSans-Bold",fontSize:"1.5em",color:"#000000"},children:"Location Details"})}),T.jsx(oe,{sx:{margin:"0 0 0.5em"},item:!0,xs:12,children:T.jsxs("span",{style:{fontFamily:"BCSans-Bold",fontSize:".75em",color:"#000000"},children:["Facility Location"," "]})}),T.jsx(oe,{sx:{margin:{xs:"0 0 1em",md:"0 0 1.5em"}},item:!0,xs:12,children:T.jsxs("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000"},children:[A["Facility Location"]," "]})}),T.jsx(oe,{sx:{margin:"0"},item:!0,xs:12,children:T.jsxs(oe,{container:!0,spacing:0,direction:{xs:"column",md:"column",lg:"row"},children:[T.jsx(oe,{item:!0,xs:6,children:T.jsxs(oe,{container:!0,direction:"column",children:[T.jsx(oe,{item:!0,sx:{margin:"0 0 0.5em"},children:T.jsxs("span",{style:{fontFamily:"BCSans-Bold",fontSize:".75em",color:"#000000"},children:["Latitude"," "]})}),T.jsx(oe,{item:!0,sx:{margin:{xs:"0 0 1em",md:"0 0 1.5em"}},children:T.jsxs("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000"},children:[u?.lat," "]})})]})}),T.jsx(oe,{item:!0,xs:6,children:T.jsxs(oe,{container:!0,direction:"column",children:[T.jsx(oe,{item:!0,sx:{margin:"0 0 0.5em"},children:T.jsxs("span",{style:{fontFamily:"BCSans-Bold",fontSize:".75em",color:"#000000"},children:["Longitude"," "]})}),T.jsx(oe,{item:!0,sx:{margin:{xs:"0 0 1em",md:"0 0 1.5em"}},children:T.jsxs("span",{style:{fontFamily:"BCSans",fontSize:"1em",color:"#000000"},children:[u?.lng," "]})})]})})]})})]})}),u&&T.jsx(oe,{item:!0,xs:6,sx:{margin:"0"},children:T.jsxs(Hv,{id:"map",center:u,scrollWheelZoom:!1,zoom:14,style:{height:"35em",width:"100%"},className:"map-container",children:[T.jsx(Xv,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),T.jsx(Jv,{position:u,icon:I},A["Authorization Number"])]})})]})}),T.jsxs(oe,{item:!0,xs:12,sx:{background:"#F1F8FE",margin:{xs:"2.5em .5em 5em",md:"2.5em .5em 5em"},padding:{xs:"1.5em 1em 2em !important",md:"1.5em 1.5em 3em !important"}},children:[lT(A),cT(A),uT(A),hT(A)]})]})}function pT(){return T.jsxs(jv,{children:[T.jsx(Pc,{path:"/",element:T.jsx(gm,{})}),T.jsx(Pc,{path:"/search",element:T.jsx(s0,{})}),T.jsx(Pc,{path:"/map",element:T.jsx(K2,{})}),T.jsx(Pc,{path:"/authorization/:id",element:T.jsx(dT,{})}),T.jsx(Pc,{path:"*",element:T.jsx(gm,{})})]})}const fT="/assets/BCID_H_rgb_rev-BqkFTQDV.png",mT="/assets/BCID_V_rgb_rev-ikbkrEfZ.png",gT={appBar:{color:"#ffffff",backgroundColor:"#053662",borderBottom:"0.1em solid rgb(252, 186, 25) !important"}};function yT(){const[g,f]=Ao.useState(null),I=le=>{f(le.currentTarget)},M=()=>{f(null)},R=Uc(),V=le=>{R(le)},A=gs(),u=Po(A.breakpoints.up("md"));return T.jsx(Yd,{position:"fixed",sx:gT.appBar,children:T.jsxs(Qd,{sx:{flexDirection:"row",alignItems:"center",alignContent:"center",justifyContent:"space-between"},id:"back-to-top-anchor",children:[T.jsxs(jc,{direction:"row",justifyContent:"center",id:"logo_name",children:[T.jsx("a",{href:"/",style:{display:"inline-flex"},children:T.jsx(ao,{component:"img","data-testid":"header-logo",sx:{alignContent:"center",content:{xs:`url(${mT})`,sm:`url(${fT})`},height:"4em",position:"relative",top:"-2px"},alt:"Logo"})}),T.jsx("div",{style:{display:"inline-flex"},children:T.jsx(Eo,{"data-testid":"header-title",sx:{display:"inline-flex",fontFamily:"BCSans",fontSize:{xs:"1.25em",sm:"1.5em"},lineHeight:"100%",alignItems:"center",marginLeft:{xs:".25em",sm:".5em"}},children:"Organics Info"})})]}),T.jsxs(jc,{direction:"row",id:"nav",children:[u&&T.jsxs("div",{children:[T.jsx(gn,{sx:{textTransform:"none",textDecoration:"none",padding:".5em 1em",display:"inline-flex",justifyContent:"center"},onClick:()=>V("/search"),component:"button",children:T.jsxs("span",{style:{color:"#ffffff",textDecoration:"none",textTransform:"none",display:"inline-flex"},children:[T.jsx(zv,{sx:{display:"inline-flex",marginRight:".333em"},children:T.jsx(Ug,{color:"secondary"})}),"Text Search"]})}),T.jsx("a",{href:"mailto:env.omrr.reg.reviews@gov.bc.ca",children:T.jsx(gn,{component:"button",sx:{color:"#ffffff",textDecoration:"none",textTransform:"none",padding:".5em 1em"},children:"Contact Us"})})]}),!u&&T.jsxs("div",{children:[T.jsx(Cd,{onClick:I,children:T.jsx(qg,{color:"secondary"})}),T.jsxs(Dv,{id:"headerMenu",anchorEl:g,keepMounted:!0,open:!!g,onClose:M,children:[T.jsx(hm,{onClick:M,children:T.jsx(gn,{"data-testid":"header-text-search",sx:{textTransform:"none",textDecoration:"none",color:"inherit"},onClick:()=>V("/search"),component:"button",children:"Text Search"})}),T.jsx(hm,{onClick:M,children:T.jsx("a",{"data-testid":"header-contact-us",href:"mailto:env.omrr.reg.reviews@gov.bc.ca",style:{textDecoration:"none",color:"inherit"},children:"Contact Us"})})]})]})]})]})})}function _T(){const g=rp(I=>I.omrr.status);console.log(g);const f=tp();return Ao.useEffect(()=>{f(Ou())},[f]),T.jsx(oe,{container:!0,sx:{flexGrow:1},children:g==="loading"?T.jsxs(T.Fragment,{children:[T.jsx(oe,{item:!0,xs:12,children:T.jsx(pm,{})}),T.jsx(oe,{item:!0,xs:12,children:T.jsx(Fv,{})}),T.jsx(oe,{item:!0,xs:12,children:T.jsx(od,{})})]}):g==="failed"?T.jsxs(T.Fragment,{children:[T.jsx(oe,{item:!0,xs:12,children:T.jsx(pm,{})}),T.jsx(oe,{item:!0,xs:12,children:T.jsx(Lv,{message:"Loading Failed, Please try later refreshing the page",sx:{background:"#fffffff",backgroundColor:"#fffffff"},color:"error",anchorOrigin:{vertical:"top",horizontal:"right"},autoHideDuration:6e3,draggable:!0,open:!0})}),T.jsx(oe,{item:!0,xs:12,children:T.jsx(od,{})})]}):T.jsx(T.Fragment,{children:T.jsxs(Nv,{children:[T.jsx(oe,{item:!0,xs:12,children:T.jsx(yT,{})}),T.jsx(oe,{item:!0,xs:12,children:T.jsx(pT,{})}),T.jsx(oe,{item:!0,xs:12,children:T.jsx(od,{})})]})})})}const xT={value:0},z_=ey({name:"counter",initialState:xT,reducers:{increment:g=>{g.value+=1},decrement:g=>{g.value-=1},incrementByAmount:(g,f)=>{g.value+=f.payload}}});z_.actions;const vT=z_.reducer,bT=Uv({reducer:{counter:vT,omrr:ip.reducer}});ty(document.getElementById("root")).render(T.jsx(Ao.StrictMode,{children:T.jsxs($v,{theme:Nc,children:[T.jsx(Bv,{}),T.jsx(qv,{store:bT,children:T.jsx(_T,{})})]})}));
